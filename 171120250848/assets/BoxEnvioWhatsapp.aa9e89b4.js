import{_ as h,r as c,o as f,d as u,w as l,f as o,M as g,G as b,h as v,i as w,j as x,k as y,I as C,J as T,C as P,Q as m,K as q,D as N}from"./index.0fffb5c9.js";import{o as V}from"./open-url.280ca9a8.js";const S={data(){return{visivel:!1,text:"",contato:null,phone:null,clienteSistema:{},socket:{conectado:!1,socket:{}}}},props:{mensagem:{type:String,default:`Ol\xE1 *[PrimeiroApelido]*, tudo bem?
        Temos uma \xF3tima not\xEDcia.
        *Seu \xF3culos ficou pronto*, pode vir retirar na loja!
        At\xE9 mais \u{1F609}
        `}},methods:{async abrir(t,e){this.envelope=await $db.hibrido.le({table:"documento",id:t}),this.contato=await $db.hibrido.le({table:"contato",id:this.envelope.idContato}),this.contatoVendedor=await $db.hibrido.le({table:"contato",id:this.envelope.idContatoVendedor}),this.empresa=await $db.hibrido.le({table:"contato",id:this.envelope.idEmpresa});let i=await $db.contatoTelefone.le({idContato:this.envelope.idContato}),s=i.filter(r=>r.tipoTelefone==="WhatsApp");s.length||(s=i.filter(r=>r.tipoTelefone==="telefonePrincipal")),this.phone=s.length?s[0].telefone:null;const a=e.toLowerCase().replace(/\s/g,"");this.text=await $db.configuracoes.le({nome:`administracao.envelope.whatsapp.mensagem.${a}`}),this.text.length===0&&(this.text=await $db.configuracoes.le({nome:"administracao.envelope.whatsapp.mensagem"})),this.text=this.text.length?this.text[0].valor:this.mensagemPadrao,this.visivel=!0},async enviar(){let t=this.text;if(this.contato.nome&&(t=t.replace("[PrimeiroApelido]",this.contato.nome.split(" ")[0]),t=t.replace("[Nome]",this.contato.nome)),this.contato.apelido&&(t=t.replace("[PrimeiroNome]",this.contato.apelido.split(" ")[0]),t=t.replace("[Apelido]",this.contato.apelido)),t=t.replace(/(\[QuebraLinha])/g,"%0D"),this.$g.conexaoWpp.conectado===!0)try{const i=await this.formatarTelefone(this.phone),s=t;return await this.whatsAppEnviar({funcao:"enviar mensagem",telDestino:i,mensa:s}),await this.fechar(),this.$q.notifyPositive("Mensagem enviada com sucesso!"),!0}catch(i){this.$q.notifyError(i.message)}const e=`https://api.whatsapp.com/send?text=${t}&phone=55`;V(e+await this.formatarTelefone(this.phone))},async whatsAppEnviar(t){const e="cpf".concat(this.contatoVendedor.numeroDocumentoNacional||"_inexistente"),i="cnpj".concat(this.empresa.numeroDocumentoNacional.replace("/","_")||"_inexistente"),s=this.clienteSistema.bancoDeDados;if(!(await(await fetch("https://whats.b15.com.br",{method:"POST",body:JSON.stringify({...t,banco:e}),headers:{"Content-type":"application/json; charset=UTF-8"}})).json()).erro||!(await(await fetch("https://whats.b15.com.br",{method:"POST",body:JSON.stringify({...t,banco:i}),headers:{"Content-type":"application/json; charset=UTF-8"}})).json()).erro)return;if((await(await fetch("https://whats.b15.com.br",{method:"POST",body:JSON.stringify({...t,banco:s}),headers:{"Content-type":"application/json; charset=UTF-8"}})).json()).erro)throw new Error("Nenhuma conex\xE3o dispon\xEDvel para envio.")},async formatarTelefone(t){return!t&&typeof t!="string"?t:t.replace(/\D/g,"")},async fechar(){this.visivel=!1}},async mounted(){this.mensagemPadrao=this.mensagem.replace(/( {8})/g,""),this.clienteSistema=JSON.parse(localStorage.getItem("clienteSistema"))||{}}};function k(t,e,i,s,a,r){const p=c("campo"),d=c("g-label");return f(),u(N,{modelValue:a.visivel,"onUpdate:modelValue":e[8]||(e[8]=n=>a.visivel=n),onHide:e[9]||(e[9]=n=>r.fechar())},{default:l(()=>[o(g,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"420px"}},{default:l(()=>[o(b,null,{default:l(()=>[o(v,null,{default:l(()=>[o(w,null,{default:l(()=>[o(x,{name:"mdi-whatsapp",size:"sm"}),e[10]||(e[10]=y(" Enviar Mensagem "))]),_:1})]),_:1})]),_:1}),o(C,null,{default:l(()=>[o(T,{class:"q-pa-md"},{default:l(()=>[o(p,{modelValue:a.phone,"onUpdate:modelValue":e[0]||(e[0]=n=>a.phone=n),rotulo:"Telefone",tipo:"texto",mask:"(##) # ####-####",dense:"",filled:"",class:"q-mb-md"},null,8,["modelValue"]),o(p,{modelValue:a.text,"onUpdate:modelValue":e[1]||(e[1]=n=>a.text=n),filled:"",dense:"",tipo:"textoArea",class:"q-mb-md"},null,8,["modelValue"]),o(d,{caption:""},{default:l(()=>[e[11]||(e[11]=P("span",{class:"q-mr-sm"}," Voc\xEA pode usar os seguintes argumentos na mensagem para deixar ainda mais personalizado sua campanha: ",-1)),o(m,{onClick:e[2]||(e[2]=n=>a.text+=" *[PrimeiroNome]*"),label:"[PrimeiroNome]",class:"q-pa-none q-mr-sm",flat:"",dense:"",style:{"font-size":"0.75rem","font-weight":"400","line-height":"1.25rem","letter-spacing":"0.03333em"}}),o(m,{onClick:e[3]||(e[3]=n=>a.text+=" *[PrimeiroApelido]*"),label:"[PrimeiroApelido]",class:"q-pa-none q-mr-sm",flat:"",dense:"",style:{"font-size":"0.75rem","font-weight":"400","line-height":"1.25rem","letter-spacing":"0.03333em"}}),o(m,{onClick:e[4]||(e[4]=n=>a.text+=" *[Nome]*"),label:"[Nome]",class:"q-pa-none q-mr-sm",flat:"",dense:"",style:{"font-size":"0.75rem","font-weight":"400","line-height":"1.25rem","letter-spacing":"0.03333em"}}),o(m,{onClick:e[5]||(e[5]=n=>a.text+=" *[Apelido]*"),label:"[Apelido]",class:"q-pa-none q-mr-sm",flat:"",dense:"",style:{"font-size":"0.75rem","font-weight":"400","line-height":"1.25rem","letter-spacing":"0.03333em"}})]),_:1})]),_:1})]),_:1}),o(q,{class:"bg-white text-right border-top q-pa-sm"},{default:l(()=>[o(m,{onClick:e[6]||(e[6]=n=>r.fechar()),flat:"",label:"Cancelar",color:"tertiary",class:"q-mr-xs"}),o(m,{onClick:e[7]||(e[7]=n=>r.enviar()),unelevated:"",label:"Enviar",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var $=h(S,[["render",k]]);export{$ as B};
