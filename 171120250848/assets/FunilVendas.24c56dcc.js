import{_ as Q,bc as T,r as h,o as f,d as S,w as s,C as c,f as t,h as F,i as D,k as p,H as B,Q as _,N as H,at as $,D as j,Z as G,p as v,j as w,G as U,J as z,F as J,x as K,t as b,e as C,A as W,q as X,O as k,dW as q,m as I,bf as Z,P as Y,S as A,T as y,U as O,I as M,M as oo,as as x,b0 as eo}from"./index.0fffb5c9.js";import{C as to}from"./Campo.3201a7fd.js";import{M as ao}from"./ModalHistoricoStatus.8c507cb2.js";import{d as so}from"./vuedraggable.umd.5f9514a9.js";const lo={components:{Campo:to},data(){return{confirmado:!1}},emits:["cancelar","confirmar","update:modelValue"],methods:{eventoConfirmar(){T.log("CRMTrocarStatus","eventoConfirmar",this.dados),this.confirmado=!0,this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoCancelar(){T.log("CRMTrocarStatus","eventoCancelar",this.dados),this.confirmado=!1,this.eventoInput(!1)},eventoInput(a){this.$emit("update:modelValue",a)}},props:{modelValue:{required:!0,type:Boolean},dados:{required:!0,type:Object}},watch:{modelValue(a){a?this.confirmado=!1:this.confirmado||this.$emit("cancelar",this.dados)}}},ro={container:"",class:"bg-white"};function io(a,o,l,i,e,d){const r=h("campo"),g=h("row");return f(),S(j,{"model-value":l.modelValue,"onUpdate:modelValue":d.eventoInput},{default:s(()=>[c("div",ro,[t(F,{class:"bg-primary text-white"},{default:s(()=>[t(D,null,{default:s(()=>o[5]||(o[5]=[p("Trocar status")])),_:1}),B(t(_,{flat:"",round:"",dense:"",icon:"close"},null,512),[[H]])]),_:1}),c("form",{onSubmit:o[4]||(o[4]=$((...m)=>d.eventoConfirmar&&d.eventoConfirmar(...m),["prevent"])),class:"q-pa-md"},[t(g,{class:"q-col-gutter-sm"},{default:s(()=>[t(r,{modelValue:l.dados.nomeCliente,"onUpdate:modelValue":o[0]||(o[0]=m=>l.dados.nomeCliente=m),somenteLeitura:"",class:"col-12",rotulo:"Cliente"},null,8,["modelValue"]),t(r,{modelValue:l.dados.statusAtual,"onUpdate:modelValue":o[1]||(o[1]=m=>l.dados.statusAtual=m),somenteLeitura:"",class:"col-12",rotulo:"De"},null,8,["modelValue"]),t(r,{modelValue:l.dados.statusNovo,"onUpdate:modelValue":o[2]||(o[2]=m=>l.dados.statusNovo=m),somenteLeitura:"",class:"col-12",rotulo:"Para"},null,8,["modelValue"]),t(r,{modelValue:l.dados.observacao,"onUpdate:modelValue":o[3]||(o[3]=m=>l.dados.observacao=m),modelModifiers:{trim:!0},class:"col-12",maxlength:"50",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:1}),t(F,{color:"light"},{default:s(()=>[t(D),t(_,{flat:"",color:"tertiary",onClick:d.eventoCancelar,label:"Cancelar"},null,8,["onClick"]),t(_,{unelevated:"",color:"primary",type:"submit",label:"Trocar"})]),_:1})],32)])]),_:1},8,["model-value","onUpdate:modelValue"])}var no=Q(lo,[["render",io]]);const E={Or\u00E7amento:[],Conclu\u00EDdo:[]},uo={components:{Badge:G,CrmTrocarStatus:no,ModalHistoricoStatus:ao,draggable:so},data(){return{showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),fraseFiltro:"",listas:$utils.clonarV2(E),tamanhoLista:{},listasFiltradas:$utils.clonarV2(E),total:{},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1}},methods:{async eventoEnd(){for(const a in this.listasFiltradas)for(const o of this.listasFiltradas[a])if(o.crmFunilStatus!==a){$utils.gconsole.log("FunilVendas","eventoEnd De:",o.crmFunilStatus,"Para:",a,"codigo:",o.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoUsuario:null,nomeCliente:o.nomeCliente,observacao:"",statusAtual:o.crmFunilStatus,statusNovo:a},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(a){$utils.gconsole.log("FunilVendas","eventoConfirmaTroca",{...a}),this.$q.loading.show();try{let o;$db.usuario.logado.cpf&&(o=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(i=>{var e;return i.numeroDocumentoNacional.replace(/\D/g,"")===((e=$db.usuario.logado.cpf)==null?void 0:e.replace(/\D/g,""))})),a.cpfUsuario=o==null?void 0:o.numeroDocumentoNacional,await $db.crm.trocaStatusOnline(a),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(o){this.$q.notifyError("Erro na troca de status",o)}finally{this.$q.loading.hide()}},eventoCancelarTroca(a){$utils.gconsole.log("FunilVendas","eventoCancelarTroca",a),this.atualiza()},async empresaOpcoesCarregar(){const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=a.map(o=>({label:o.nome,value:o.codigoContato,id:o.id}))},async irParaAtendimento(a){const o=await $erp().contato.where({codigoContato:a}).first()||{};o.id&&this.$router.push({name:"Atendimento",params:{id:o.id}})},filtraDebounce(){$lodash.debounce(this.refazFiltro,700)()},refazFiltro(){$utils.gconsole.log("FunilVendas","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const a=$utils.removerAcentos((this.fraseFiltro||"").toUpperCase()).split(" ").filter(i=>i!==""),o={};for(const i in this.listas)for(const e of this.listas[i]){const d=$utils.removerAcentos((e.id||"").toUpperCase()+(e.nomeCliente||"").toUpperCase()+(e.nomeDigitador||"").toUpperCase()+(e.nomeVendedor||"").toUpperCase()+" "+String(e.numeroVenda||"")+" ");let r=!0;for(const g of a)isNaN(Number(g))?r=r&&d.includes(g):r=r&&d.includes(" "+g+" ");this.empresaSelecionada&&(r=r&&this.empresaSelecionada.value===e.codigoEmpresa),this.vendedorDigitadorSelecionado&&(r=r&&(this.vendedorDigitadorSelecionado.value===e.codigoContatoDigitador||this.vendedorDigitadorSelecionado.value===e.codigoContatoVendedor)),e.mostra=r,e.mostra&&(o[e.crmFunilStatus]=(o[e.crmFunilStatus]||0)+(e.totalDocumento||0))}const l={};for(const i in this.listas)this.tamanhoLista[i]=10,l[i]=this.listas[i].filter(e=>e.mostra).slice(0,this.tamanhoLista[i]),document.getElementById(i);this.listasFiltradas=l,this.$nextTick(()=>{for(const i in this.listasFiltradas)document.getElementById(i).removeEventListener("scroll",this.scrollHandler),document.getElementById(i).addEventListener("scroll",this.scrollHandler)}),this.total=o},scrollHandler(a){const o=a.target.id;a.target.scrollHeight-a.target.scrollTop-a.target.offsetHeight<100&&(this.tamanhoLista[o]+=10,this.listasFiltradas[o]=this.listas[o].filter(i=>i.mostra).slice(0,this.tamanhoLista[o]))},async atualiza(){try{const a=await $db.crm.leOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,...this.diretivaContatosAcessaTodosContatos?{}:{codigoContato:$db.usuario.logado.codigoContato}});$utils.gconsole.log("FunilVendas","atualiza()",a.length),$utils.verificarAlerta(!a||!a.length,"N\xE3o h\xE1 or\xE7amentos");let o=await $db.configuracoes.le({nome:"vendas.crm.status"});o=o.filter(e=>!["Or\xE7amento","Conclu\xEDdo"].includes(e.texto));const l={Or\u00E7amento:[]};for(const e of $lodash.orderBy(o,"valor","asc").map(d=>d.texto))l[e]=[];l.Conclu\u00EDdo=[];const i={};for(const e of a){let d="bordaVerdeCRM";const r={id:e.id,codigoContatoDigitador:e.codigoContatoDigitador||0,codigoContatoVendedor:e.codigoContatoVendedor||0,codigoDocumento:e.codigoDocumento||0,codigoContato:e.codigoContato||0,codigoEmpresa:e.codigoEmpresa||0,descricaoEmpresa:e.descricaoEmpresa||"",corBorda:d,dataHoraEmissao:new Date(e.dataHoraEmissao||""),mostra:!0,nomeCliente:e.nomeCliente||"-",nomeVendedor:e.nomeVendedor||"-",nomeDigitador:e.nomeDigitador||"-",numeroVenda:e.numeroVenda||"-",status:e.status||"",crmFunilStatus:e.crmFunilStatus||"Or\xE7amento",totalDocumento:e.totalDocumento||0};l[r.crmFunilStatus]&&(l[r.crmFunilStatus].push(r),i[r.crmFunilStatus]=(i[r.crmFunilStatus]||0)+(r.totalDocumento||0))}this.listas=l,this.total=i,this.refazFiltro()}catch(a){this.$q.notifyError("Erro na consulta online de or\xE7amentos",a)}}},watch:{entregueInicio(){$utils.gconsole.log("FunilVendas","entregueInicio"),this.atualiza()},entregueFim(){$utils.gconsole.log("FunilVendas","entregueFim"),this.atualiza()}},created(){$utils.gconsole.log("FunilVendas","created()"),$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then(a=>{this.diretivaContatosAcessaTodosContatos=a,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then(o=>{o.forEach(l=>{l.codigo&&this.vendedoresDigitadoresOpcoes.push({label:l.nome,value:l.codigo})})})),this.empresaOpcoesCarregar(),this.atualiza()})},beforeUnmount(){for(const a in E)!document.getElementById(a)||document.getElementById(a).removeEventListener("scroll",this.scrollHandler)}},co={id:"FunilVendas"},mo={class:"row overflowXCRM"},fo={class:"q-pa-none"},po={key:0,class:"text-body2"},go={key:0,class:"row"},vo={class:"col-12"},ho={class:"q-pa-md"},Co={class:"row q-mt-xs"},Vo={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},bo={class:"col-12"},_o={key:0,class:"text-caption q-mb-xs"},Fo={key:1,class:"text-caption q-mb-xs"},Do={key:2,class:"text-caption"};function wo(a,o,l,i,e,d){const r=h("barraTopo"),g=h("campo"),m=h("badge"),L=h("draggable"),N=h("crm-trocar-status"),R=h("modal-historico-status");return f(),v("div",co,[t(U,{elevated:"",class:"bg-gradiente text-white"},{default:s(()=>[t(r),t(F,{class:"q-px-sm"},{default:s(()=>[t(w,{name:"view_week",size:"sm"}),t(D,null,{default:s(()=>o[10]||(o[10]=[p("Funil de Vendas")])),_:1}),t(_,{onClick:o[0]||(o[0]=u=>e.showfilters=!e.showfilters),icon:"mdi-filter",round:"",dense:"",flat:""})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(z,null,{default:s(()=>[c("div",mo,[(f(!0),v(J,null,K(e.listasFiltradas,(u,V)=>(f(),v("div",{key:V,class:"no-shadow q-pa-none col coluna"},[c("div",fo,[t(F,{class:"no-shadow q-py-none q-px-sm text-white"},{default:s(()=>[t(D,null,{default:s(()=>[p(b(V),1)]),_:2},1024),e.total[V]?(f(),v("div",po,b(a.$filters.numero(e.total[V],2)),1)):C("",!0)]),_:2},1024),V==="Conclu\xEDdo"?(f(),v("div",go,[c("div",vo,[c("div",ho,[t(g,{modelValue:e.entregueInicio,"onUpdate:modelValue":o[1]||(o[1]=n=>e.entregueInicio=n),rotulo:"In\xEDcio",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),t(g,{modelValue:e.entregueFim,"onUpdate:modelValue":o[2]||(o[2]=n=>e.entregueFim=n),rotulo:"Fim",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"])])])])):C("",!0),t(L,{onEnd:d.eventoEnd,list:u,id:V,group:"osGroup",itemKey:"codigoDocumento",draggable:".extratoCRM",delay:"250",class:"dragAreaCRM"},{item:s(({element:n})=>[n.mostra&&(e.prazoSelecionado===null||e.prazoSelecionado.value===n.corBorda)?(f(),S(W,{key:0,class:X([n.corBorda,"q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 bg-white extratoCRM"])},{default:s(()=>[c("div",Co,[o[11]||(o[11]=c("div",{class:"col-6"},null,-1)),c("div",Vo,[t(m,{rotulo:a.$filters.numero(n.totalDocumento,2),icone:"shopping_cart",cor:"light",dica:"Total",class:"q-mx-sm"},null,8,["rotulo"]),t(m,{rotulo:n.numeroVenda,dica:"Vendas",icone:"assignment_turned_in",cor:"tertiary",escuro:""},null,8,["rotulo"])])]),t(k,{class:"q-pa-xs q-mb-sm text-subtitle1 text-weight-medium"},{default:s(()=>[p(b(n.nomeCliente),1)]),_:2},1024),t(k,{class:"row q-pa-xs q-pb-none"},{default:s(()=>[c("div",bo,[n.nomeVendedor&&n.nomeVendedor!=="-"?(f(),v("div",_o,[c("span",null,[t(q,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+b(n.nomeVendedor)+" ",1),t(I,{anchor:"bottom middle",self:"center middle"},{default:s(()=>o[12]||(o[12]=[p(" Vendedor ")])),_:1})])])):C("",!0),n.descricaoEmpresa&&n.descricaoEmpresa!=="-"?(f(),v("div",Fo,[c("span",null,[t(q,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+b(n.descricaoEmpresa)+" ",1),t(I,{anchor:"bottom middle",self:"center middle"},{default:s(()=>o[13]||(o[13]=[p(" Empresa ")])),_:1})])])):C("",!0),n.dataHoraEmissao?(f(),v("div",Do,[c("span",null,[t(q,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"}),p(" "+b(a.$filters.data(n.dataHoraEmissao)),1)])])):C("",!0),t(_,{icon:"more_vert",dense:"",round:"",unelevated:"",color:"white","text-color":"tertiary",class:"botaoVerMaisVert"},{default:s(()=>[t(Z,null,{default:s(()=>[B((f(),S(Y,{link:"",separator:""},{default:s(()=>[t(A,{onClick:P=>a.$refs.modalHistoricoStatus.mostrar({idDocumento:n.codigoDocumento}),clickable:""},{default:s(()=>[t(y,{avatar:""},{default:s(()=>[t(w,{name:"history"})]),_:1}),t(y,null,{default:s(()=>[t(O,null,{default:s(()=>o[14]||(o[14]=[p("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:2},1032,["onClick"]),t(A,{onClick:P=>d.irParaAtendimento(n.codigoContato),clickable:""},{default:s(()=>[t(y,{avatar:""},{default:s(()=>[t(w,{name:"launch"})]),_:1}),t(y,null,{default:s(()=>[t(O,null,{default:s(()=>o[15]||(o[15]=[p("Ir para o Atendimento")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[H]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):C("",!0)]),_:2},1032,["onEnd","list","id"])])]))),128))])]),_:1})]),_:1}),t(eo,{modelValue:e.showfilters,"onUpdate:modelValue":o[8]||(o[8]=u=>e.showfilters=u),bordered:"",side:"right",class:"hide-scrollbar"},{default:s(()=>[t(oo,{view:"hHh lpR lFr"},{default:s(()=>[t(U,{class:"bg-white"},{default:s(()=>[t(F,{class:"text-tertiary border-bottom"},{default:s(()=>[t(w,{class:"text-h5",name:"mdi-filter"}),t(D,null,{default:s(()=>o[16]||(o[16]=[p("Filtro Avan\xE7ado")])),_:1}),t(_,{dense:"",flat:"",icon:"close",round:"",onClick:o[3]||(o[3]=u=>e.showfilters=!e.showfilters)})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(z,{class:"q-pa-md"},{default:s(()=>[t(g,{modelValue:e.fraseFiltro,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.fraseFiltro=u),d.filtraDebounce],dense:"",rotulo:"Por cliente ou respons\xE1vel",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),e.diretivaContatosAcessaTodosContatos?(f(),S(x,{key:0,modelValue:e.vendedorDigitadorSelecionado,"onUpdate:modelValue":[o[5]||(o[5]=u=>e.vendedorDigitadorSelecionado=u),d.refazFiltro],options:e.vendedoresDigitadoresOpcoes,clearable:"",label:"Vendedor / Digitador",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])):C("",!0),t(x,{modelValue:e.prazoSelecionado,"onUpdate:modelValue":o[6]||(o[6]=u=>e.prazoSelecionado=u),options:e.prazoOpcoes,clearable:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","options"]),t(x,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[o[7]||(o[7]=u=>e.empresaSelecionada=u),d.refazFiltro],options:e.empresaOpcoes,clearable:"",label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:e.trocarStatusModal,"onUpdate:modelValue":o[9]||(o[9]=u=>e.trocarStatusModal=u),dados:e.trocarStatusDados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),t(R,{ref:"modalHistoricoStatus"},null,512)])}var Eo=Q(uo,[["render",wo]]);export{Eo as default};
