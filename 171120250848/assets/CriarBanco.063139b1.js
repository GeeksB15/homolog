import{_ as D,r,o as m,p as F,f as s,w as d,G as k,d as f,h as v,j as y,i as w,k as g,e as C,I as x,J as h,C as V,K as M,aU as _,Q as z,E as N}from"./index.0fffb5c9.js";import{S as O,a as Q}from"./SeletorPais.5c51ebe6.js";const j={components:{SeletorCidade:O,SeletorPais:Q},data(){return{dados:{cnpj:"",fantasia:"",razaoSocial:"",baseDados:"",codigoSistema:"",segmento:"",codigo:"",cpfUsuario:"",nomeUsuario:""},cnpjErro:!1,logado:$db.usuario.logado,servidor:"",servidores:[],opcoesServidores:[],sistemas:[],sistemasOptisoul:[{valor:"52",rotulo:"Optisoul - Plano Controle"},{valor:"53",rotulo:"Optisoul - Plano Gest\xE3o"},{valor:"57",rotulo:"Optisoul - Plano Venda Melhor"},{valor:"68",rotulo:"Optisoul - Operacional"}],sistemasB15:[{valor:"60",rotulo:"B15 Free"},{valor:"61",rotulo:"B15 Business"},{valor:"62",rotulo:"B15 Enterprise"}]}},methods:{consultarCep(){const a=this.dados.cep.replace(/[^0-9]/g,"");a.length<8||$utils.buscarEndereco(a).then(async({data:o})=>{if(this.dados.bairro=o.bairro,this.dados.complemento=o.complemento,this.dados.ibgeCod=o.ibge,this.dados.logradouro=o.logradouro,this.dados.municipio=o.localidade,this.dados.pais="Brasil",this.dados.codigoPais=1058,this.dados.uf=o.uf,this.dados.ufCod=$utils.mapearEstadoCodigo[o.uf],o.ibge){const t=await $db.cidade.le({cidadeCodIbge:o.ibge.toString(),ativo:!0});this.dados.cidadeCodChave=(t.find(u=>u.cod)||{}).cod,this.dados.idCidade=(t.find(u=>u.cod)||{}).id}})},async selecionarCidade(a,o){this.dados.municipio=a.municipio||"",this.dados.ibgeCod=a.ibgeCod||"",this.dados.uf=a.uf||"",this.dados.ufCod=a.ufCod||"",this.dados.cidadeCodChave=a.cidadeCodChave||"",this.dados.idCidade=a.value||"",this.dados.codigoPais=1058,this.dados.pais="Brasil"},async selecionarPais(a,o){this.dados.pais=a.nome,this.dados.codigoPais=a.codigo},async atualiza(){this.sistemas=this.logado.grupoInterno===2?this.sistemasOptisoul:[...this.sistemasOptisoul,...this.sistemasB15],this.dados.segmento=this.logado.grupoInterno===2?"\xD3tica":"",this.servidores=(await $utils.geeksApi({consultaServidores:{funcao:"1A0DDEF7-2051-4803-A6F6-DFC94F05F03D"}})).data.consultaServidores,this.opcoesServidores=this.servidores.opcoesServidores,this.servidor=""},async criarBanco(){$utils.gconsole.log("CriarBanco","criarBanco()",this.dados);try{$utils.verificarErro(!this.dados.cnpj,"CNPJ n\xE3o preenchido"),$utils.verificarErro(!$utils.validarDocumentoNacional(this.dados.cnpj),"CNPJ inv\xE1lido"),$utils.verificarErro(!this.dados.razaoSocial,"Raz\xE3o Social n\xE3o preenchido"),$utils.verificarErro(!this.dados.fantasia,"Fantasia n\xE3o preenchido"),$utils.verificarErro(!this.dados.codigoSistema,"Sistema n\xE3o selecionado"),$utils.verificarErro(!this.dados.cpfUsuario,"CFP do usu\xE1rio n\xE3o preenchido"),$utils.verificarErro(!$utils.validarDocumentoNacional(this.dados.cpfUsuario),"CPF inv\xE1lido"),$utils.verificarErro(!this.dados.nomeUsuario,"Nome do usu\xE1rio n\xE3o preenchido");const a=this.dados.cnpj||this.dados.cpfUsuario;$utils.verificarErro(!a,"CPF e CNPJ n\xE3o preenchidos"),this.dados.baseDados=this.$utils.removerCaracteresEspeciais(this.dados.baseDados).replace(/ /g,""),$utils.verificarErro(!this.dados.baseDados,"Base de Dados n\xE3o preenchido"),this.$q.loading.show({message:"Criando"});let o=await $utils.geeksApi({criarBancoBackupRestore:{funcao:"B19A71C9-B3F9-473B-9F83-BB6CF8A028D5",baseDados:this.dados.baseDados,servidor:this.servidor}});const t=o.data.criarBancoBackupRestore;$utils.gconsole.log("CriarBanco","retBackupRestore",t),this.$q.notifyPositive(`Banco ${t[0].baseDados} criado com sucesso`),await this.$nextTick(),o=await $utils.geeksApi({criaUsuarioPermissaoEmpresaContatoGrupo:{funcao:"9599A3F0-E41F-4CB9-BBF5-013FDA60E26B",servidor:this.servidor,...this.dados}});const u=o.data.criaUsuarioPermissaoEmpresaContatoGrupo;$utils.gconsole.log("CriarBanco","retGeral",u),this.$q.notifyPositive("Usuario, Empresa, Grupo e Permiss\xF5es criados com sucesso"),o=await $utils.geeksApi({criaParametrizacaoInicial:{funcao:"F6040D21-58E2-431D-B148-47911CB949B0",...this.dados}});const e=o.data.criaParametrizacaoInicial;$utils.gconsole.log("CriarBanco","retExecSp",e),this.$q.notifyPositive("Parametriza\xE7\xE3o inicial realizada com sucesso")}catch(a){this.$q.notifyError("Erro na cria\xE7\xE3o do banco",a)}finally{this.$q.loading.hide()}}},watch:{"dados.codigoSistema"(a){this.servidor=this.sistemasOptisoul.find(o=>o.valor===a)?this.servidores.padraoOptidados:this.servidores.padraoB15,this.dados.segmento=this.sistemasOptisoul.find(o=>o.valor===a)?"\xD3tica":""}},async mounted(){this.logado=$db.usuario.logado,await this.atualiza()}},q={id:"CriarBanco"},A={class:"col-4"},G={class:"col-2"};function I(a,o,t,u,e,c){const b=r("barraTopo"),l=r("campo"),n=r("row"),p=r("card"),B=r("SeletorCidade"),S=r("SeletorPais"),P=r("g-label"),E=r("g-col"),U=r("g-row");return m(),F("div",q,[s(N,{onSubmit:c.criarBanco},{default:d(()=>[s(k,{elevated:"",class:"bg-gradiente text-white"},{default:d(()=>[s(b),e.logado.modoDesenvolvedor.status?(m(),f(v,{key:0,class:"q-px-sm"},{default:d(()=>[s(y,{name:"mdi-database-plus",size:"sm"}),s(w,null,{default:d(()=>o[18]||(o[18]=[g("Cria\xE7\xE3o de banco para novo cliente")])),_:1})]),_:1})):C("",!0)]),_:1}),s(x,null,{default:d(()=>[e.logado.modoDesenvolvedor.status?(m(),f(h,{key:0,class:"u-container"},{default:d(()=>[s(p,null,{default:d(()=>[s(n,null,{default:d(()=>[s(l,{col:"3",modelValue:e.dados.cnpj,"onUpdate:modelValue":o[0]||(o[0]=i=>e.dados.cnpj=i),modelModifiers:{trim:!0},rotulo:"CNPJ",mask:"##.###.###/####-##"},null,8,["modelValue"]),s(l,{col:"9",modelValue:e.dados.fantasia,"onUpdate:modelValue":o[1]||(o[1]=i=>e.dados.fantasia=i),modelModifiers:{trim:!0},rotulo:"Fantasia"},null,8,["modelValue"]),s(l,{col:"12",modelValue:e.dados.razaoSocial,"onUpdate:modelValue":o[2]||(o[2]=i=>e.dados.razaoSocial=i),modelModifiers:{trim:!0},rotulo:"Raz\xE3o Social"},null,8,["modelValue"])]),_:1})]),_:1}),s(p,null,{default:d(()=>[s(n,null,{default:d(()=>o[19]||(o[19]=[g(" Endere\xE7o ")])),_:1}),s(n,null,{default:d(()=>[s(l,{col:"2",modelValue:e.dados.cep,"onUpdate:modelValue":o[3]||(o[3]=i=>e.dados.cep=i),modelModifiers:{trim:!0},rotulo:"CEP",onChange:o[4]||(o[4]=i=>c.consultarCep()),mask:"#####-###",rules:[i=>i&&i.replace(/\D/g,"").length===8||"O CEP est\xE1 muito curto."]},null,8,["modelValue","rules"]),s(l,{col:"5",modelValue:e.dados.logradouro,"onUpdate:modelValue":o[5]||(o[5]=i=>e.dados.logradouro=i),modelModifiers:{trim:!0},rotulo:"Endere\xE7o"},null,8,["modelValue"]),s(l,{col:"2",modelValue:e.dados.numero,"onUpdate:modelValue":o[6]||(o[6]=i=>e.dados.numero=i),modelModifiers:{trim:!0},rotulo:"Numero"},null,8,["modelValue"]),s(l,{col:"3",modelValue:e.dados.complemento,"onUpdate:modelValue":o[7]||(o[7]=i=>e.dados.complemento=i),modelModifiers:{trim:!0},rotulo:"Complemento"},null,8,["modelValue"])]),_:1}),s(n,null,{default:d(()=>[s(l,{col:"5",modelValue:e.dados.bairro,"onUpdate:modelValue":o[8]||(o[8]=i=>e.dados.bairro=i),modelModifiers:{trim:!0},rotulo:"Bairro"},null,8,["modelValue"]),s(l,{col:"1",modelValue:e.dados.uf,"onUpdate:modelValue":o[9]||(o[9]=i=>e.dados.uf=i),modelModifiers:{trim:!0},rotulo:"UF"},null,8,["modelValue"]),V("div",A,[s(B,{ibgeCod:e.dados.ibgeCod,onSelecionar:o[10]||(o[10]=i=>c.selecionarCidade(i,a.index)),required:"","somente-leitura":!1},null,8,["ibgeCod"])]),V("div",G,[s(S,{codigoPais:e.dados.codigoPais,onSelecionar:o[11]||(o[11]=i=>c.selecionarPais(i,a.index)),required:""},null,8,["codigoPais"])])]),_:1})]),_:1}),s(p,null,{default:d(()=>[s(n,null,{default:d(()=>[s(l,{col:"12",modelValue:e.dados.baseDados,"onUpdate:modelValue":o[12]||(o[12]=i=>e.dados.baseDados=i),modelModifiers:{trim:!0},rotulo:"Base de Dados"},null,8,["modelValue"]),s(l,{col:"6",modelValue:e.dados.codigoSistema,"onUpdate:modelValue":o[13]||(o[13]=i=>e.dados.codigoSistema=i),rotulo:"Sistema",tipo:"seletor",opcoes:e.sistemas},null,8,["modelValue","opcoes"]),s(l,{col:"3",modelValue:e.dados.segmento,"onUpdate:modelValue":o[14]||(o[14]=i=>e.dados.segmento=i),modelModifiers:{trim:!0},rotulo:"Segmento"},null,8,["modelValue"]),s(l,{col:"3",modelValue:e.servidor,"onUpdate:modelValue":o[15]||(o[15]=i=>e.servidor=i),rotulo:"Servidor",tipo:"seletor",opcoes:e.opcoesServidores},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),s(p,null,{default:d(()=>[s(n,null,{default:d(()=>[s(l,{col:"3",modelValue:e.dados.cpfUsuario,"onUpdate:modelValue":o[16]||(o[16]=i=>e.dados.cpfUsuario=i),modelModifiers:{trim:!0},rotulo:"CPF usuario",mask:"###.###.###-##"},null,8,["modelValue"]),s(l,{col:"9",modelValue:e.dados.nomeUsuario,"onUpdate:modelValue":o[17]||(o[17]=i=>e.dados.nomeUsuario=i),modelModifiers:{trim:!0},rotulo:"Nome"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):(m(),f(h,{key:1,class:"u-container"},{default:d(()=>[s(U,{items:"center",justify:"center",style:{position:"absolute",width:"100%",height:"100%"}},{default:d(()=>[s(E,{col:"12"},{default:d(()=>[s(P,{text:"h5 semi-bold center"},{default:d(()=>o[20]||(o[20]=[g("Usu\xE1rio sem permiss\xF5es!")])),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}),e.logado.modoDesenvolvedor.status?(m(),f(M,{key:0,class:"bg-white border-top"},{default:d(()=>[s(v,{class:"u-container q-px-sm"},{default:d(()=>[s(_),s(z,{type:"submit",label:"Criar",unelevated:"",color:"primary"})]),_:1})]),_:1})):C("",!0)]),_:1},8,["onSubmit"])])}var J=D(j,[["render",I]]);export{J as default};
