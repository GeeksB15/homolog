import{a as $,ai as x,aI as E,b as j}from"./index.0b6a0fa4.js";const c="https://api.plugnotas.com.br",l=function(){const e=new Headers;return e.append("Content-Type","application/json; charset=utf-8"),e.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6"),e},P={async cadastrar(e,a){const o=new Headers;o.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");let t={};const r=new FormData;r.append("arquivo",e),r.append("senha",a);try{t=await fetch("https://api.plugnotas.com.br/certificado",{method:"POST",headers:o,body:r})}catch(d){console.log(d.message)}const{message:s,data:n,error:i}=await t.json();return{message:s,data:n,error:i}},async consultar(e=""){let a={},o=e?`certificado/${e}`:"certificado",t={};try{a=await fetch(`${c}/${o}`,{method:"GET",headers:l()}),t=await a.json()}catch(r){console.log(r.message)}return t}},O={async consultar(e){let a;try{a=await fetch(`${c}/empresa/${e}`,{method:"GET",headers:l()}),a=await a.json()}catch(o){console.error(o.message),a={error:{}},a.error.message="N\xE3o foi poss\xEDvel estabelecer conex\xE3o com o servidor"}return a},async cadastrar(e){let a;try{a=await fetch(`${c}/empresa`,{method:"POST",headers:l(),body:JSON.stringify(e)}),a=await a.json()}catch(o){console.error(o.message),a={error:{}},a.error.message="N\xE3o foi poss\xEDvel estabelecer conex\xE3o com o servidor"}return a},async alterar(e,a){let o;try{o=await fetch(`${c}/empresa/${e}`,{method:"PATCH",headers:l(),body:JSON.stringify(a)}),o=await o.json()}catch(t){console.error(t.message),o={error:{}},o.error.message="N\xE3o foi poss\xEDvel estabelecer conex\xE3o com o servidor"}return o}},k={async transmitir(e){try{const o=await(await fetch(`${c}/nfse`,{method:"POST",headers:l(),body:JSON.stringify([e])})).json();return{nfse:o==null?void 0:o.documents,protocolo:o==null?void 0:o.protocol,mensagem:o==null?void 0:o.message,error:o==null?void 0:o.error}}catch(a){return console.log(a.message),{}}},async consultar(e){let a="",o=0,t={};for(;a!=="CONCLUIDO"&&o<12;){await $utils.dormir(5e3),console.log(`tentativa ${o}`);let r={};try{r=await fetch(`${c}/nfse/consultar/${e}`,{method:"GET",headers:l()}),t=await r.json(),t=t[0],a=t.situacao}catch(s){console.log(s.message)}o++}return t},async montarJsonParaPlugNotas(e){var o;let a={idIntegracao:e.id,prestador:{cpfCnpj:e.prestador.documento},servico:[{codigo:e.servico.itemListaServico,codigoTributacao:e.servico.codigoTributacaoMunicipio,discriminacao:e.servico.discriminacao,cnae:e.servico.codigoCnae,codigoCidadeIncidencia:`${e.servico.municipioPrestacaoServico}`,iss:{tipoTributacao:6,exigibilidade:1,retido:!1,aliquota:e.servico.valores.aliquota,valor:e.servico.valores.valorIss},valor:{servico:e.servico.valores.valorServicos,baseCalculo:e.servico.valores.baseCalculo,deducoes:"",descontoCondicionado:e.servico.valores.descontoCondicionado,descontoIncondicionado:e.servico.valores.descontoIncondicionado,liquido:e.servico.valores.valorLiquidoNfse},retencao:{pis:{valor:e.servico.valores.valorPis},cofins:{valor:e.servico.valores.valorCofins},csll:{valor:e.servico.valores.valorCsll},inss:{valor:e.servico.valores.valorInss},irrf:{valor:e.servico.valores.valorIr}},tributavel:!1}],naturezaTributacao:1,rps:{competencia:"",dataEmissao:e.dataEmissao,dataVencimento:"",serie:e.identificacaoRps.serie}};return(o=e.tomador)!=null&&o.documento?(a.tomador={},a.tomador={cpfCnpj:e.tomador.documento,razaoSocial:e.tomador.razaoSocial,endereco:{cep:e.tomador.endereco.cep,logradouro:e.tomador.endereco.rua,codigoCidade:`${e.tomador.endereco.cidade}`,estado:e.tomador.endereco.estado,numero:e.tomador.endereco.numero,bairro:e.tomador.endereco.bairro}}):console.log("NFSe sem tomador!"),a},async imprimirNFSe(e){const a=new Headers;a.append("Content-Type","application/pdf; charset=utf-8"),a.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");let o="";try{o=await fetch(`${c}/nfse/pdf/${e}`,{method:"GET",headers:a});const t=await o.blob();return await $utils.blobToBase64(t)}catch(t){console.error("Failed retrieving information",t.message)}return o},async baixarXmlNFSe(e,a){var n,i;let o,t,r;const s=new Headers;if(a!=null&&a.id&&(o=await $db.hibrido.le({table:"documentoFiscalEletronico",id:a.id}),t=$utils.clonarV2(o)),!o.id)throw new Error("api.PlugNotas.baixarXMLNFSe: N\xE3o foi poss\xEDvel obter o documento fiscal");if(r=(i=JSON.parse((n=o.json)!=null?n:null))==null?void 0:i.rps,!r)throw new Error("api.PlugNotas.baixarXMLNFSe: Dados de RPS n\xE3o informados");s.append("Content-Type","application/xml; charset=utf-8"),s.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");try{const d=await fetch(e,{method:"GET",headers:s});r.xml=await(d==null?void 0:d.text()),t.json=JSON.stringify({rps:r}),await $db.documentoFiscalEletronico.grava({atual:t,original:o})}catch(d){console.log(d.message)}return r.xml},async solicitarCancelamentoNFSe(e,a){let o={};try{o=await fetch(`${c}/nfse/cancelar/${e}`,{method:"POST",headers:l(),body:JSON.stringify(a)});const{message:t,data:r}=await o.json();o={message:t,data:r}}catch(t){console.log(t.message)}return o},async consultarCancelamentoNFSe(e){let a="",o=0,t={},r={};for(;a!=="CONCLUIDO"&&o<12;){await $utils.dormir(1e4),console.log(`tentativa ${o}`);let s={};try{s=await fetch(`${c}/nfse/cancelar/status/${e}`,{method:"GET",headers:l()});const{message:n,data:i}=await s.json();a=(i==null?void 0:i.status)||"",t=n,r=i}catch(n){console.log(n.message)}o++}return{message:t,data:r}}},F={async solicitarCancelamentoNFSe(e="627571d0a5906b4da2b740de"){const a=new Headers;a.append("Content-Type","application/json; charset=utf-8"),a.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");let o={};try{o=await fetch(`${c}/nfse/cancelar/${e}`,{method:"POST",headers:a,body:JSON.stringify('{"motivo": "Teste de cancelamento via plugNotas"}')})}catch(t){console.log(t.message)}await o},async consultarCancelamentoNFSe(e="fdc6de1a-8c73-44b9-8bc6-0e9fdc9b27da"){const a=new Headers;a.append("Content-Type","application/json; charset=utf-8"),a.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");let o={};try{o=await fetch(`${c}/nfse/cancelar/status/${e}`,{method:"GET",headers:a})}catch(t){console.log(t.message)}await o.json()},async alterarEmpresa(){let e;const a=new Headers;a.append("Content-Type","application/json; charset=utf-8"),a.append("x-api-key","89af78de-4278-48f8-b14e-43b34cbec4b6");const o={nfse:{config:{producao:!0}}};try{e=await fetch(`${c}/empresa/07660198000189`,{method:"PATCH",headers:a,body:JSON.stringify(o)})}catch(t){console.log(t.message)}console.log(await e.json())},async transmitir(){const e=new Headers;e.append("Content-Type","application/json; charset=utf-8"),e.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");const a=[{idIntegracao:"GEEKS0000007",prestador:{cpfCnpj:"08187168000160"},tomador:{cpfCnpj:"99999999999999",razaoSocial:"Empresa de Teste LTDA",inscricaoMunicipal:"8214100099",email:"teste@plugnotas.com.br",endereco:{descricaoCidade:"Maringa",cep:"87020100",tipoLogradouro:"Rua",logradouro:"Barao do rio branco",tipoBairro:"Centro",codigoCidade:"4115200",complemento:"sala 01",estado:"PR",numero:"1001",bairro:"Centro"}},servico:[{codigo:"14.10",codigoTributacao:"14.10",discriminacao:"Descri\xE7\xE3o dos servi\xE7os prestados, utilize | para quebra de linha na impress\xE3o.",cnae:"7490104",iss:{tipoTributacao:7,exigibilidade:1,aliquota:3},valor:{servico:1,descontoCondicionado:0,descontoIncondicionado:0}}]}];let o={};try{o=await fetch(`${c}/nfse`,{method:"POST",headers:e,body:JSON.stringify(a)})}catch(t){console.log(t.message)}await o.json(),await o.json()},async consultar(e="d449ce0c-edee-4e1b-a2c7-0566ccb185ff"){const a=new Headers;a.append("Content-Type","application/json; charset=utf-8"),a.append("x-api-key","2da392a6-79d2-4304-a8b7-959572c7e44d");let o={};try{o=await fetch(`${c}/nfse/consultar/${e}`,{method:"GET",headers:a})}catch(r){console.log(r.message)}return(await o.json())[0]}};var G={nfse:k,nfseMocado:F,certificado:P,empresa:O};const p=function(e){const{name:a,message:o}=e!=null?e:{};this.name=a,this.message=o,this.stack=new Error().stack};p.prototype=Object.create(p.prototype);p.prototype.constructor=p;var H={send:async function(e,a){var d,g,f,b,y;let o,t,r,s=[],n,i;if(o=await $db.configuracoes.porNome("integracao.bten.business"),t=(g=(d=o[0])==null?void 0:d.valor)!=null?g:!1,o=await $db.configuracoes.porNome("integracao.bten.authorization"),r=(b=(f=o[0])==null?void 0:f.valor)!=null?b:!1,n=await $db.contatoTelefone.le({idContato:e.id,tipoTelefone:"Celular | WhatsApp | Principal"}),i={business:t,authorization:r},!t)throw new p({name:"GeeksException",message:"Token business n\xE3o configurado"});if(!r)throw new p({name:"GeeksException",message:"Token authorization n\xE3o configurado"});if(!(n.length>0))throw new p({name:"GeeksException",message:"Nenhum telefone encontrado"});for(const S of n){const h=(y=S.telefone)==null?void 0:y.replace(/\D/g,""),N={name:e.nome,contact:`55${h}`,description:a.id,channel:"WHATSAPP_MESSAGE"};(await $({method:"post",url:"https://api-gateway-eaglecatch.herokuapp.com/v1/transaction",validateStatus:v=>v>=200&&v<=500,timeout:3e4,headers:i,data:N})).status!==200?s.push({status:!1,telefone:h}):s.push({status:!0,telefone:h})}return s}};const m="https://aupk1256rl.execute-api.us-east-2.amazonaws.com/dev",u=function(){const e=new Headers;return e.append("Content-Type","application/json; charset=utf-8"),e.append("x-api-key","cxiFyUfcWB6qvY7Uoo9tu6MRJnm68o3o0FMwKRm9"),e.append("data-raw",""),e},I={async criar(e,a){let o={},t="pedidos/criar";try{o=await fetch(`${m}/${t}`,{mode:"no-cors",method:"POST",headers:u(),body:a})}catch(r){console.log(r.message)}},async consultar(e){let a={},o=`pedidos/cnpj/${e}/1`,t={};try{a=await fetch(`${m}/${o}`,{mode:"no-cors",method:"GET",headers:u()}),t=a}catch(r){console.log(r.message)}return t}},z={async consultar(e){let a={},o={};try{a=await fetch("https://aupk1256rl.execute-api.us-east-2.amazonaws.com/dev/produtos/lista/1/32648411000184",{mode:"no-cors",method:"GET",headers:u()}),o=await a}catch(t){console.log(t.message)}return o}},B={async consultar(e){let a={},o=`servicos/cnpj/${e}`,t={};try{a=await fetch(`${m}/${o}`,{method:"GET",headers:u()}),t=await a}catch(r){console.log(r.message)}return t},async consultarServicoFamilia(e){let a={},o=`servicos/1/686/${e}`,t={};try{a=await fetch(`${m}/${o}`,{method:"GET",headers:u()}),t=await a}catch(r){console.log(r.message)}return t}};var J={pedidos:I,lentes:z,servicos:B};const T=x([]);function A(e){return e.funcao="enviar mensagem",fetch("https://whats.b15.com.br/",{method:"POST",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(a=>a.json())}async function C(){try{const e=(await $.get("https://whats.b15.com.br/conectados")).data,o=(await E({listaPendentesWhatsapp:{funcao:"E475EA1C-80FB-43B2-B581-B75829FB36C3"}})).data.listaPendentesWhatsapp.filter(t=>{const r=e[t.conexao]||"Desconectado";return r==="Conectando"||r==="Desconectado"});T.value=o||[]}catch(e){console.error("Ocorreu um erro [API]: ",e)}}C();var D={envia:A,pendentes:T,listaPendentes:C};const w={plugnotas:G,bten:H,zeiss:J,whatsapp:D};var L=j(async({app:e})=>{e.config.globalProperties.$api=w,globalThis.$api=w});export{L as default};
