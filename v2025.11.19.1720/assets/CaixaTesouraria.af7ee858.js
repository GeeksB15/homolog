import{_ as B,Z,r as E,o as f,d as x,w as s,f as i,M as K,G as W,h as Q,H as Y,Q as w,N as X,i as P,k as h,I as aa,J as oa,C as r,j,t as m,as as ta,p as q,aP as ea,e as C,O as k,m as A,q as T,A as I,R as O,P as V,F as z,x as $,S as M,K as ia,aU as sa,D as ra,Y as na,cT as R,bf as la,T as U,U as J,B as L}from"./index.0b6a0fa4.js";import{C as da}from"./CaixaFechar.26e64898.js";import{G as ca}from"./GChipsV2.a644728e.js";const ma={components:{Badge:Z,CaixaFechar:da},data(){return{documentoCaixa:{},mostrarDinheiro:!1,documentoStatusSelecionado:{},documentoStatus:[],caixa:{},campos:{},dinheiro:{},acertoDinheiro:0,acertos:[],totalAcertos:0,totalDinheiro:0,formasPagamento:[],totaisFormasPagamento:{},outrasFormasPagamento:{},condicoesPagamentoFechamento:{},valorAberturaSistema:0,valorFundoCaixa:0,valorFundoCaixaSistema:0,valorFechamento:0,diferencaFundo:0,diferencaAbertura:0,contatos:{},usuarios:{},documentos:{},mostrarSangrias:!1,sangrias:[],totalSangrias:0,mostrarSangriaFinal:!1,sangriaFinal:[],totalSangriaFinal:0,observacoesSangrias:{},mostrarDespesas:!1,despesas:[],totalDespesas:0,mostrarSuprimentos:!1,suprimentos:[],totalSuprimentos:0,visivel:!1,edicao:!1,carregando:!0,faturaModal:{visivel:!1,id:""},vendaModal:{visivel:!1,id:""},visibilidade:{botao:{reabrir:!1,finalizar:!1}},atualizarAoFecharModal:!1}},emits:["executar","update:modelValue"],methods:{aoFecharModal(){this.atualizarAoFecharModal&&this.$emit("executar","atualizar")},obterDivergencias(){let n=[],a=$utils.arredondar(-this.diferencaFundo);if(a){let v=this.formasPagamento.filter(_=>_.tipo===1);v.length&&(v=v[0],n.push({...v,diferenca:a}))}for(const v of this.formasPagamento.filter(_=>_.tipo!==1&&_.tipoFinanceiro==="T\xEDtulo Liquidado")){let _=(this.totaisFormasPagamento[v.id]||{}).totalSistema||0,o=(this.totaisFormasPagamento[v.id]||{}).totalInformadoUsuario||0;a=$utils.arredondar(_-o),a&&n.push({...v,diferenca:a})}return n},cor(n,a,v){let _=(this.totaisFormasPagamento[v]||{}).totalSistema||0,o=(this.totaisFormasPagamento[v]||{}).totalInformadoUsuario||0,p=$utils.arredondar(_-o);if(a==="card"){switch(n){case"outraFormaPagamento":if(p)return"itemError";break}return"itemOk"}switch(n){case"abertura":if(this.diferencaAbertura)return"text-negative";break;case"fundo":if(this.diferencaFundo)return"text-negative";break;case"outraFormaPagamento":if(p)return"text-negative";break}return"text-blue-8"},async atualizar(){var n,a;try{this.$q.loading.show({message:"Processando..."}),this.documentoCaixa=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),this.caixa=await $db.caixa.leCache({id:this.documentoCaixa.idCaixa});const v=await $db.contato.le({id:this.documentoCaixa.idEmpresa}),_=await $db.hibrido.le({table:"contato",id:this.documentoCaixa.idContato});let o=await $db.documentoStatus.le({idDocumento:this.documentoCaixa.id});switch(o=$lodash.orderBy(o,"dataHoraEmissao","desc"),this.visibilidade={botao:{reabrir:!1,finalizar:!1,fechar:!1}},(n=o[0])==null?void 0:n.statusFinalizado){case"Aguardando Confer\xEAncia":this.visibilidade.botao.reabrir=!0,this.visibilidade.botao.finalizar=!0;break;case"Reaberto":this.visibilidade.botao.fechar=!0;break;case"Fechado":this.visibilidade.botao.reabrir=!0;break}let p={};this.documentoStatus=[];for(let d of o){const g=await $db.contatoCpf.leCache(d.cpfUsuario);this.documentoStatus.push({label:`${d.statusFinalizado} - ${this.$filters.dataHora(d.dataHoraEmissao)} - ${(a=g==null?void 0:g.nome)!=null?a:"Usu\xE1rio n\xE3o identificado"}`,value:d.id,statusFinalizado:d.statusFinalizado})}this.documentoStatusSelecionado=this.documentoStatus[0],this.campos.caixaEmpresaNome=v.nome,this.campos.dataHoraAbertura=this.documentoCaixa.dataHoraEmissao,this.campos.nomeUsuarioAbertura=_.nome,this.valorAberturaSistema=0;const l=`declare @codigoFinanceiroPlanoConta int = (select codigoFinanceiroPlanoConta from financeiroPlanoConta where id = ${$utils.sqlStr(this.caixa.idPlanoConta)})
            declare @codigoEmpresa int = (select codigoEmpresa from documento where id = ${$utils.sqlStr(this.documentoCaixa.id)})
            declare @dataAbertura varchar(10) = (select format(cast(dataHoraEmissao as date), 'dd/MM/yyyy') dataAbertura from documento where id = ${$utils.sqlStr(this.documentoCaixa.id)})

          if (@codigoFinanceiroPlanoConta is not null and @codigoEmpresa is not null and @dataAbertura is not null)
          begin
            exec sp_financeiroMovimentacao_calcula_saldoPeriodo @codigoFinanceiroPlanoConta, @codigoEmpresa, 'DataPagamento', @dataAbertura, @dataAbertura, 0
          end`;let u=new Date(this.documentoCaixa.dataHoraEmissao).setMilliseconds(0);u=new Date(u);let b=await $utils.executarSql(l);b=$lodash.orderBy(b,"Ordem","asc"),b=b.filter(d=>!d.DataMovimento||new Date(d.DataMovimento)<u);const e=b[b.length-1];this.valorAberturaSistema=$utils.arredondar(e.ValorSaldo||0),this.diferencaAbertura=$utils.arredondar(((this.documentoCaixa||{}).valorAbertura||0)-this.valorAberturaSistema),this.$q.loading.hide(),this.visivel=!0,this.preencherConferencia()}catch(v){this.$q.notifyError("N\xE3o foi poss\xEDvel abrir a confer\xEAncia.",v)}finally{this.$q.loading.hide()}},fechar(){this.$refs.Fechar.mostrar({idDocumentoCaixa:this.documentoCaixa.id})},async finalizar(){var n,a;try{let v=this.obterDivergencias(),_="Deseja finalizar a confer\xEAncia?",o="Deseja finalizar a confer\xEAncia e lan\xE7ar movimenta\xE7\xF5es financeiras para acertar as diverg\xEAncias?";try{await new Promise((F,S)=>{this.$q.dialog({message:v.length?o:_,noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{F()}).onCancel(()=>{S()})}),this.$q.loading.show({message:"Processando..."})}catch{return}const p=$utils.dataAtual(),l=[],u=[];if(v.length){let F=await $db.documentoStatus.le({idDocumento:this.documentoCaixa.id});F=F.filter(y=>y.operacao==="Fechamento Caixa"&&y.statusFinalizado==="Aguardando Confer\xEAncia"&&y.statusOriginal==="Aberto");const S=F.length?F[0].dataHoraEmissao:p;let H=await $db.configuracoes.le({nome:"financeiro.planocontas.diferencacaixa"});if(H.length){const y=parseInt(H[0].valor);Number.isInteger(y)&&(H=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:y}))}if(!(H||{}).id){this.$q.notify("Faltando par\xE2metro da conta Diferen\xE7a de Caixa.");return}for(const y of v){const N=$utils.uuid();u.push(N),l.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:N,idEmpresa:this.documentoCaixa.idEmpresa,idContato:$db.usuario.logado.id,idFinanceiroPlanoConta:H.id,valorDebito:y.diferenca>0?y.diferenca:0,valorCredito:y.diferenca<0?Math.abs(y.diferenca):0,dataEmissao:p,dataCompetencia:S,dataVencimento:S,dataMovimento:S,descricao:`Acerto do caixa #${this.documentoCaixa.id} Conta ${y.descricao}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id}),l.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:N,idEmpresa:this.documentoCaixa.idEmpresa,idContato:$db.usuario.logado.id,idFinanceiroPlanoConta:y.tipo===1?this.documentoCaixa.idFinanceiroPlanoContaCaixa:y.idFinanceiroPlanoConta,valorDebito:y.diferenca<0?Math.abs(y.diferenca):0,valorCredito:y.diferenca>0?y.diferenca:0,dataEmissao:p,dataCompetencia:S,dataVencimento:S,dataMovimento:S,descricao:`Acerto do caixa #${this.documentoCaixa.id} Conta ${y.descricao}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Acerto",documentoId:this.documentoCaixa.id,idDocumentoCaixa:this.documentoCaixa.id})}}const b={id:$utils.uuid(),idDocumento:this.documentoCaixa.id,operacao:"Confer\xEAncia Finalizada",statusOriginal:"Aguardando Confer\xEAncia",statusFinalizado:"Fechado",dataHoraEmissao:p,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.documentoCaixa.id};let e=$utils.clonar(this.documentoCaixa);e.status="Fechado";let d,g=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:this.documentoStatus[0].value}});((n=g==null?void 0:g[0])==null?void 0:n.tabela)==="caixaCompleto"?(d=JSON.parse((a=g[0])==null?void 0:a.json),d.acertos=d.acertos||[],console.log("Finalizando",$utils.clonarV2(d))):g=g.map(F=>({...F,id:$utils.uuid(),idDocumentoStatus:b.id,dataHoraEmissao:p})),await $db.documento.grava({atual:e,original:this.documentoCaixa}),await $db.documentoStatus.grava({atual:b});for(const F of u)await $db.financeiroMovimentacaoN.grava({atual:{id:F}});for(const F of l)d?d.acertos.push(F):g.push({id:$utils.uuid(),idDocumentoCaixa:e.id,idDocumentoStatus:b.id,tabela:"financeiroMovimentacao",idTabela:F.id,json:JSON.stringify(F),dataHoraEmissao:p}),await $db.financeiroMovimentacao.grava({atual:F});if(d){console.log("Finalizado",$utils.clonarV2(d));const F={id:$utils.uuid(),idDocumentoCaixa:e.id,idDocumentoStatus:b.id,tabela:"caixaCompleto",json:JSON.stringify(d),dataHoraEmissao:p};await $db.hibrido.grava("caixaConsolidacao2",{atual:F})}else for(const F of g)await $db.hibrido.grava("caixaConsolidacao2",{atual:F});this.$q.loading.hide(),this.$emit("executar","atualizar"),this.visivel=!1,this.$q.notify({message:"Confer\xEAncia finalizada.",type:"positive"})}catch(v){this.$q.notifyError("N\xE3o foi poss\xEDvel finalizar a confer\xEAncia.",v)}finally{this.$q.loading.hide()}},async preencherConferencia(){var S,H,y,N;this.carregando=!0,await $utils.dormir(500),this.refreshData();const n=(S=this.documentoStatusSelecionado)==null?void 0:S.value;let a=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:n}});if(((H=a[0])==null?void 0:H.tabela)==="caixaCompleto")return this.preencherConferenciaNew(a);if(!a.length)try{const t=await $utils.geeksApi({caixaConsolidacao2:{funcao:"6B2B2761-B645-4818-BAC0-5DB6D946FDA1",idDocumentoStatus:n}});a=(y=t==null?void 0:t.data)==null?void 0:y.caixaConsolidacao2}catch(t){$q.notify({message:"N\xE3o foi poss\xEDvel obter informa\xE7\xF5es do servidor. Por favor, verifique sua conex\xE3o e tente novamente.",type:"negative"}),console.error(t)}a=a.map(t=>({...t,json:JSON.parse(t.json)}));let v={},_={};for(let t of a)if((N=t.json)!=null&&N.idContato){const c=await $db.contato.le({id:t.json.idContato}),D=await $db.usuario.le({id:t.json.idContato});c!=null&&c.id&&(v[c.id]=c),D!=null&&D.id&&(_[D.id]=D)}this.contatos=v,this.usuarios=_;let o=a.filter(t=>t.tabela==="financeiroMovimentacao"&&t.json.documentoTipo==="Acerto").map(t=>t.json);const p=a.filter(t=>t.tabela==="financeiroTitulo").map(t=>t.json),l=a.filter(t=>t.tabela==="financeiroMovimentacao").map(t=>t.json);this.sangrias=l.filter(t=>["Sangria"].includes(t.documentoTipo)&&t.valorCredito>0),this.totalSangrias=$utils.arredondar(this.sangrias.reduce((t,c)=>t+(c.valorCredito||0),0)),this.sangriaFinal=l.filter(t=>["Sangria Final"].includes(t.documentoTipo)&&t.valorCredito>0),this.totalSangriaFinal=$utils.arredondar(this.sangriaFinal.reduce((t,c)=>t+(c.valorCredito||0),0)),this.carregarObservacoesSangrias(),this.suprimentos=l.filter(t=>t.documentoTipo==="Suprimento"&&t.valorDebito>0),this.totalSuprimentos=$utils.arredondar(this.suprimentos.reduce((t,c)=>t+(c.valorDebito||0),0));const u=l.filter(t=>t.documentoTipo==="DespesaSimples"&&t.valorCredito>0);this.despesas=p.filter(t=>u.find(c=>c.idFinanceiroMovimentacaoN===t.idFinanceiroMovimentacaoAgrupamento)),this.totalDespesas=$utils.arredondar(this.despesas.reduce((t,c)=>t+(c.valorRealizado||0),0)),this.formasPagamento=(await $db.formaPagamento.listaCache()).map(t=>({id:t.id,idFinanceiroPlanoConta:t.idFinanceiroPlanoConta,tipoFinanceiro:t.tipoFinanceiro,tipo:t.tipo,descricao:t.descricao,mostrar:!1}));const b=a.filter(t=>t.tabela==="documentoCondicaoPagamento"&&t.json.ordem).map(t=>t.json);this.valorFechamento=$utils.arredondar(b.reduce((t,c)=>(this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&(t+=c.valor||0),t),0)),this.condicoesPagamentoFechamento=b.reduce((t,c)=>(t[c.idFormaPagamento]=c,t),{});let e=a.filter(t=>t.tabela==="documentoCondicaoPagamento"&&!t.json.ordem).map(t=>t.json);this.dinheiro=e.reduce((t,c)=>(this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&t.push(c),t),[]),this.totalDinheiro=$utils.arredondar(this.dinheiro.reduce((t,c)=>t+(c.valor||0),0)),this.valorFundoCaixa=$utils.arredondar(this.valorFechamento-this.sangriaFinal.filter(t=>t.documentoTipo==="Sangria Final").reduce((t,c)=>t+(c.valorCredito||0),0));const d=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalSangriaFinal-this.totalDespesas+this.totalSuprimentos;this.diferencaFundo=$utils.arredondar(this.valorFundoCaixa-d),this.acertoDinheiro=o.filter(t=>t.idFinanceiroPlanoConta===this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((t,c)=>t+(c.valorDebito||0)-(c.valorCredito||0),0),this.valorFundoCaixaSistema=$utils.arredondar(d+this.acertoDinheiro),this.acertoDinheiro=$utils.arredondar(this.acertoDinheiro*-1),this.outrasFormasPagamento=e.reduce((t,c)=>(!t[c.idFormaPagamento]&&this.formasPagamento.find(D=>D.id===c.idFormaPagamento&&D.idFinanceiroPlanoConta!==this.caixa.idPlanoConta)&&(t[c.idFormaPagamento]=[]),t[c.idFormaPagamento]&&t[c.idFormaPagamento].push(c),t),{});let g=e.reduce((t,c)=>(t[c.idFormaPagamento]||(t[c.idFormaPagamento]={totalInformadoUsuario:0}),t[c.idFormaPagamento]&&(t[c.idFormaPagamento].totalSistema===void 0?t[c.idFormaPagamento].totalSistema=c.valor||0:t[c.idFormaPagamento].totalSistema+=c.valor||0),t),{});g=b.reduce((t,c)=>(t[c.idFormaPagamento]||(t[c.idFormaPagamento]={totalSistema:0}),t[c.idFormaPagamento]&&(t[c.idFormaPagamento].totalInformadoUsuario===void 0?t[c.idFormaPagamento].totalInformadoUsuario=c.valor||0:t[c.idFormaPagamento].totalInformadoUsuario+=c.valor||0),t),g);for(const t in g)g[t].totalSistema=$utils.arredondar(g[t].totalSistema),g[t].totalInformadoUsuario=$utils.arredondar(g[t].totalInformadoUsuario);this.totaisFormasPagamento=g;let F=e.reduce((t,c)=>(t[c.idDocumento]||(t[c.idDocumento]={}),t),{});for(let t in F)F[t]=await $db.hibrido.le({table:"documento",id:t});this.documentos=F,this.acertos=o.filter(t=>t.idFinanceiroPlanoConta!==this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((t,c)=>{const D=this.formasPagamento.find(G=>G.idFinanceiroPlanoConta===c.idFinanceiroPlanoConta);return D&&t.push({descricao:D.descricao,valor:$utils.arredondar((c.valorCredito||0)-(c.valorDebito||0))}),t},[]),this.totalAcertos=$utils.arredondar(this.acertos.reduce((t,c)=>t+c.valor,0)),this.carregando=!1},async preencherConferenciaNew(n){var p;const a=JSON.parse((p=n[0])==null?void 0:p.json);console.log("PreencherConferencia",$utils.clonarV2(a));let v=a.acertos||[];this.sangrias=a.sangrias,this.totalSangrias=a.totalSangrias,this.sangriaFinal=(a.sangriaFinal||[]).filter(l=>l.valorCredito>0),this.totalSangriaFinal=$utils.arredondar($utils.somar(this.sangriaFinal,"valorCredito")),this.suprimentos=a.suprimentos,this.totalSuprimentos=a.totalSuprimentos,this.despesas=a.despesas,this.totalDespesas=a.totalDespesas,this.formasPagamento=(await $db.formaPagamento.listaCache()).map(l=>({...l,mostrar:!1})),n.filter(l=>l.tabela==="documentoCondicaoPagamento"&&l.json.ordem).map(l=>l.json),this.valorFechamento=a.campos.fechamento,this.dinheiro=a.pagamentos.reduce((l,u)=>(this.formasPagamento.find(b=>b.id===u.idFormaPagamento&&b.idFinanceiroPlanoConta===this.caixa.idPlanoConta)&&l.push(u),l),[]),this.totalDinheiro=$utils.arredondar(this.dinheiro.reduce((l,u)=>l+(u.valor||0),0)),this.valorFundoCaixa=a.campos.fundoCaixa;const _=this.valorAberturaSistema+this.totalDinheiro-this.totalSangrias-this.totalSangriaFinal-this.totalDespesas+this.totalSuprimentos;this.diferencaFundo=$utils.arredondar(this.valorFundoCaixa-_),this.acertoDinheiro=v.filter(l=>l.idFinanceiroPlanoConta===this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((l,u)=>l+(u.valorDebito||0)-(u.valorCredito||0),0),this.valorFundoCaixaSistema=$utils.arredondar(_+this.acertoDinheiro),this.acertoDinheiro=$utils.arredondar(this.acertoDinheiro*-1),this.outrasFormasPagamento=a.pagamentos.reduce((l,u)=>(!l[u.idFormaPagamento]&&this.formasPagamento.find(b=>b.id===u.idFormaPagamento&&b.idFinanceiroPlanoConta!==this.caixa.idPlanoConta)&&(l[u.idFormaPagamento]=[]),l[u.idFormaPagamento]&&l[u.idFormaPagamento].push(u),l),{});const o={};for(const l of a.valoresDigitados)o[l.id]={totalSistema:(l==null?void 0:l.totalSistema)||0,totalInformadoUsuario:(l==null?void 0:l.valor)||0};for(const l of a.condicaoPagamentoDinheiro)o[l.id]={totalSistema:(l==null?void 0:l.totalSistema)||0};this.totaisFormasPagamento=o,this.documentos=a.faturas.reduce((l,u)=>(l[u.id]=u,l),{}),this.acertos=v.filter(l=>l.idFinanceiroPlanoConta!==this.documentoCaixa.idFinanceiroPlanoContaCaixa).reduce((l,u)=>{const b=this.formasPagamento.find(e=>e.idFinanceiroPlanoConta===u.idFinanceiroPlanoConta);return b&&l.push({descricao:b.descricao,valor:$utils.arredondar((u.valorCredito||0)-(u.valorDebito||0))}),l},[]),this.totalAcertos=$utils.arredondar(this.acertos.reduce((l,u)=>l+u.valor,0)),this.carregando=!1},async reabrir(){var n,a;try{try{await new Promise((d,g)=>{this.$q.dialog({message:"Deseja reabrir o caixa para corre\xE7\xE3o?",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{d()}).onCancel(()=>{g()})}),this.$q.loading.show({message:"Processando..."})}catch{return}const v=$utils.dataAtual();let _=$utils.clonar(this.documentoCaixa),o,p=await $db.hibrido.lista({table:"caixaConsolidacao2",where:{idDocumentoStatus:this.documentoStatus[0].value}});((n=p==null?void 0:p[0])==null?void 0:n.tabela)==="caixaCompleto"?(o=JSON.parse((a=p[0])==null?void 0:a.json),console.log("Reabrindo",$utils.clonarV2(o))):p=p.map(d=>({...d,json:JSON.parse(d.json)}));let l,u;if(o)l=o.sangriaFinal||[],u=o.acertos||[];else{let d=p.filter(g=>g.tabela==="financeiroMovimentacao").map(g=>g.json);l=d.filter(g=>g.documentoTipo==="Sangria Final"),u=d.filter(g=>g.documentoTipo==="Acerto")}const b=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{idDocumentoCaixa:_.id,documentoTipo:"Acerto"}});u=u.concat(b);const e={id:$utils.uuid(),idDocumento:_.id,operacao:"Fechamento Caixa",statusOriginal:this.documentoStatus[0].statusFinalizado,statusFinalizado:"Reaberto",dataHoraEmissao:v,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:_.id};o?o.acertos=[]:(p=p.filter(d=>!["Sangria Final","Acerto"].includes(d.json.documentoTipo)),p=p.map(d=>({...d,id:$utils.uuid(),idDocumentoStatus:e.id,dataHoraEmissao:v,json:JSON.stringify(d.json)}))),_.status="Reaberto",_.dataHoraFinalizado="",await $db.documento.grava({atual:_,original:this.documentoCaixa}),await $db.documentoStatus.grava({atual:e}),await $db.financeiroMovimentacao.remove(u);for(const d of l)await $db.hibrido.grava("financeiroMovimentacao",{atual:{...d,valorCredito:0,valorDebito:0},original:d});if(o){o.sangriaFinal=await $db.caixa.leSangriaFinal(this.idDocumentoCaixa),console.log("Reaberto",$utils.clonarV2(o));const d={id:$utils.uuid(),idDocumentoCaixa:_.id,idDocumentoStatus:e.id,tabela:"caixaCompleto",json:JSON.stringify(o),dataHoraEmissao:v};await $db.hibrido.grava("caixaConsolidacao2",{atual:d})}else for(const d of p)await $db.hibrido.grava("caixaConsolidacao2",{atual:d});this.atualizar(),this.atualizarAoFecharModal=!0,this.$q.loading.hide()}catch(v){this.$q.notifyError("N\xE3o foi poss\xEDvel abrir a confer\xEAncia.",v)}finally{this.$q.loading.hide()}},refreshData(){this.mostrarDinheiro=!1,this.dinheiro={},this.acertoDinheiro=0,this.acertos=[],this.totalAcertos=0,this.formasPagamento=[],this.totaisFormasPagamento={},this.outrasFormasPagamento={},this.condicoesPagamentoFechamento={},this.valorFechamento=0,this.diferencaFundo=0,this.contatos={},this.usuarios={},this.documentos={},this.mostrarSangrias=!1,this.sangrias=[],this.totalSangrias=0,this.mostrarSangriaFinal=!1,this.sangriaFinal=[],this.totalSangriaFinal=0,this.mostrarDespesas=!1,this.despesas=[],this.totalDespesas=0,this.mostrarSuprimentos=!1,this.suprimentos=[],this.totalSuprimentos=0,this.mostrarDivergencias=!1,this.divergencias=[],this.totalDivergencias=0,this.edicao=!1,this.faturaModal={visivel:!1,id:""},this.vendaModal={visivel:!1,id:""}},async carregarObservacoesSangrias(){let n=await $db.hibrido.lista({table:"documento",whereIn:{id:this.sangrias.map(a=>a.documentoId)}});for(const a of n)this.observacoesSangrias[a.id]=a.observacao;n=await $db.hibrido.lista({table:"documento",whereIn:{id:this.sangriaFinal.map(a=>a.documentoId)}});for(const a of n)this.observacoesSangrias[a.id]=a.observacao}},props:{idDocumentoCaixa:{required:!0,type:String},modelValue:{required:!0,type:Boolean}},watch:{modelValue(n){n&&(this.atualizar(),this.refreshData())},visivel(n){this.$emit("update:modelValue",n)}}},ua={class:"layout-padding q-pa-none q-pb-md"},ha={class:"q-pt-md"},fa={class:"bg-white round-borders q-pa-md"},pa={class:"col-12 col-lg-8 text-tertiary"},ga={class:"Faturamento-historico col-12 col-lg-4 text-caption text-tertiary text-right"},va={key:0,class:"q-mt-lg text-center"},ba={key:1},Ca={class:"col-auto"},xa={class:"col-auto"},_a={key:0,class:"col-auto"},Fa={class:"col-auto"},qa={class:"q-pr-md q-pl-xs q-pt-md"},ya={class:"row"},wa={class:"q-pa-xs"},Sa={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Da={key:0,class:"q-px-md q-pb-md"},Pa={class:"col-9 col-lg-10 q-pl-sm"},ka={class:"row"},Aa={class:"col-12 col-sm"},za={class:"col-12 col-sm"},$a={class:"col-12 col-sm"},Va={class:"col-12 col-sm"},Ea={class:"q-pr-md q-pl-xs q-pt-md"},Ia={class:"row"},Ma={class:"q-pa-xs"},ja={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Ha={key:0,class:"q-px-md q-pb-md"},Na={class:"col-9 col-lg-10 q-pl-sm"},Oa={class:"row"},Ta={class:"col-12 col-sm"},Ua={class:"col-12 col-sm"},Qa={class:"col-12 col-sm"},Ba={class:"col-12 col-sm"},Ra={class:"q-pr-md q-pl-xs q-pt-md"},Ja={class:"row"},La={class:"q-pa-xs"},Ga={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},Za={key:1,class:"q-px-md q-pb-md"},Ka={class:"col-9 col-lg-10 q-pl-sm"},Wa={class:"row"},Ya={class:"col-12 col-sm"},Xa={class:"col-12 col-sm"},ao={class:"col-12 col-sm"},oo={class:"q-pr-md q-pl-xs q-pt-md"},to={class:"row"},eo={class:"q-pa-xs"},io={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},so={key:0,class:"q-px-md q-pb-md"},ro={class:"col-9 col-lg-10 q-pl-sm"},no={class:"row"},lo={class:"col-12 col-sm"},co={class:"col-12 col-sm"},mo={class:"col-12 col-sm"},uo={class:"col-12 col-sm"},ho={class:"col-12 col-sm"},fo={class:"q-pr-md q-pl-xs q-pt-md"},po={class:"row"},go={class:"q-pa-xs"},vo={class:"text-right text-h5 text-positive text-weight-bold q-mb-sm"},bo={key:0,class:"q-px-md q-pb-md"},Co={class:"col-9 col-lg-10 q-pl-sm"},xo={class:"row"},_o={class:"col-12 col-sm"},Fo={class:"col-12 col-sm"},qo={class:"col-12 col-sm"},yo={class:"col-12 col-sm"},wo={class:"col-12 col-sm"},So={key:4,class:"q-title"},Do={class:"q-pr-md q-pl-xs q-pt-md"},Po={class:"row"},ko={class:"text-right text-h5 text-warning text-weight-bold q-mb-sm"},Ao={class:"q-px-md q-pb-md"},zo={class:"col-9 col-lg-10 q-pl-sm"},$o={class:"row"},Vo={class:"col-12 col-sm"},Eo={class:"col-12 col-sm"},Io={class:"q-pr-md q-pl-xs q-pt-md"},Mo={class:"row"},jo={class:"q-pa-xs"},Ho={class:"text-weight-normal text-tertiary text-body2 q-pa-none q-ma-none"},No={key:1,class:"q-px-md q-pb-md"},Oo={class:"col-9 col-lg-10 q-pl-sm"},To={class:"row"},Uo={class:"col-12 col-sm"},Qo={class:"col-12 col-sm"},Bo={class:"col-12 col-sm"};function Ro(n,a,v,_,o,p){const l=E("row"),u=E("badge"),b=E("CaixaFechar");return f(),x(ra,{modelValue:o.visivel,"onUpdate:modelValue":a[11]||(a[11]=e=>o.visivel=e),onHide:p.aoFecharModal,maximized:"",class:"caixaconferir"},{default:s(()=>[i(K,{view:"hHh LpR fFf",container:"",class:"bg-light"},{default:s(()=>[i(W,null,{default:s(()=>[i(Q,{class:"bg-primary text-white"},{default:s(()=>[Y(i(w,{icon:"arrow_back",round:"",flat:"",dense:""},null,512),[[X]]),i(P,null,{default:s(()=>a[12]||(a[12]=[h("Conferir caixa")])),_:1})]),_:1})]),_:1}),i(aa,null,{default:s(()=>[i(oa,{class:"u-container"},{default:s(()=>[r("div",ua,[r("div",ha,[r("div",fa,[i(l,{class:"items-center q-col-gutter-md"},{default:s(()=>[r("div",pa,[i(j,{name:"place"}),h(" "+m(o.campos.caixaEmpresaNome),1)]),r("div",ga,[r("div",null,[h(m(n.$filters.dataHora(o.campos.dataHoraAbertura))+" ",1),i(j,{name:"calendar_today"}),a[13]||(a[13]=r("br",null,null,-1)),h(" "+m(o.campos.nomeUsuarioAbertura)+" ",1),i(j,{name:"person"})])]),i(ta,{modelValue:o.documentoStatusSelecionado,"onUpdate:modelValue":[a[0]||(a[0]=e=>o.documentoStatusSelecionado=e),p.preencherConferencia],label:"Hist\xF3rico",options:o.documentoStatus,filter:"",style:{"white-space":"pre-wrap !important"}},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1}),o.carregando?(f(),q("div",va,[i(ea,{color:"tertiary",size:50})])):C("",!0),o.carregando?C("",!0):(f(),q("div",ba,[i(l,{class:"q-col-gutter-md justify-around"},{default:s(()=>[r("div",Ca,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(n.$filters.numero(o.valorAberturaSistema,2))+" ",1),i(A,null,{default:s(()=>a[14]||(a[14]=[h("Valor no sistema")])),_:1})]),_:1}),i(P,{class:T(["q-display-1 text-weight-bold text-center",p.cor("abertura")])},{default:s(()=>[h(m(n.$filters.numero(o.documentoCaixa.valorAbertura,2))+" ",1),i(A,null,{default:s(()=>a[15]||(a[15]=[h("Valor digitado pelo usu\xE1rio")])),_:1})]),_:1},8,["class"]),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(n.$filters.numero(o.diferencaAbertura,2))+" ",1),i(A,null,{default:s(()=>a[16]||(a[16]=[h("Diferen\xE7a")])),_:1})]),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[17]||(a[17]=[h(" Abertura ")])),_:1})]),r("div",xa,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[18]||(a[18]=[h("\xA0")])),_:1}),i(P,{class:T(["q-display-1 text-weight-bold text-center",p.cor("fundo")])},{default:s(()=>[h(m(n.$filters.numero(o.valorFechamento,2))+" ",1),i(A,null,{default:s(()=>a[19]||(a[19]=[h("Valor digitado pelo usu\xE1rio")])),_:1})]),_:1},8,["class"]),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[20]||(a[20]=[h("\xA0")])),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[21]||(a[21]=[h(" Fechamento ")])),_:1})]),o.acertoDinheiro?(f(),q("div",_a,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[22]||(a[22]=[h("\xA0")])),_:1}),i(P,{class:"q-display-1 text-weight-bold text-center text-warning"},{default:s(()=>[h(m(n.$filters.numero(o.acertoDinheiro,2)),1)]),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[23]||(a[23]=[h("\xA0")])),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[24]||(a[24]=[h(" Acerto ")])),_:1})])):C("",!0),r("div",Fa,[i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(n.$filters.numero(o.valorFundoCaixaSistema,2))+" ",1),i(A,null,{default:s(()=>a[25]||(a[25]=[h("Valor no sistema")])),_:1})]),_:1}),i(P,{class:T(["q-display-1 text-weight-bold text-center",p.cor("fundo")])},{default:s(()=>[h(m(n.$filters.numero(o.valorFundoCaixa,2)),1)]),_:1},8,["class"]),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>[h(m(n.$filters.numero(o.diferencaFundo,2))+" ",1),i(A,null,{default:s(()=>a[26]||(a[26]=[h("Diferen\xE7a")])),_:1})]),_:1}),i(k,{class:"q-pa-none text-tertiary text-center"},{default:s(()=>a[27]||(a[27]=[h(" Fundo Caixa ")])),_:1})])]),_:1}),o.suprimentos.length?(f(),x(I,{key:0,class:"itemOk q-mt-md"},{default:s(()=>[r("div",qa,[r("div",ya,[i(P,null,{default:s(()=>a[28]||(a[28]=[h(" Suprimentos ")])),_:1}),r("div",wa,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.suprimentos.length),1)]),_:1})]),r("div",Sa,m(n.$filters.numero(o.totalSuprimentos,2)),1)])]),i(O,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarSuprimentos?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[1]||(a[1]=e=>o.mostrarSuprimentos=!o.mostrarSuprimentos)})):C("",!0),o.mostrarSuprimentos?C("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[2]||(a[2]=e=>o.mostrarSuprimentos=!o.mostrarSuprimentos)}))]),_:1}),o.mostrarSuprimentos?(f(),q("div",Da,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.suprimentos,e=>(f(),x(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d,g;return[r("div",Pa,[r("div",ka,[r("div",Aa,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||((g=o.usuarios[e.idContato])==null?void 0:g.nome)||"Nome n\xE3o encontrado"),1),r("div",za,m(e.documentoTipo),1),r("div",$a,m(n.$filters.numero(e.valorDebito,2)),1),r("div",Va,m(n.$filters.dataHora(e.dataMovimento)),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),o.despesas.length?(f(),x(I,{key:1,class:"itemOk q-mt-md"},{default:s(()=>[r("div",Ea,[r("div",Ia,[i(P,null,{default:s(()=>a[29]||(a[29]=[h(" Despesas ")])),_:1}),r("div",Ma,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.despesas.length),1)]),_:1})]),r("div",ja,m(n.$filters.numero(o.totalDespesas,2)),1)])]),i(O,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarDespesas?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[3]||(a[3]=e=>o.mostrarDespesas=!o.mostrarDespesas)})):C("",!0),o.mostrarDespesas?C("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[4]||(a[4]=e=>o.mostrarDespesas=!o.mostrarDespesas)}))]),_:1}),o.mostrarDespesas?(f(),q("div",Ha,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.despesas,e=>(f(),x(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d;return[r("div",Na,[r("div",Oa,[r("div",Ta,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||"Nome n\xE3o encontrado"),1),r("div",Ua,m(e.documentoTipo),1),r("div",Qa,m(n.$filters.numero(e.valorRealizado,2)),1),r("div",Ba,m(n.$filters.dataHora(e.dataMovimento)),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),i(I,{class:"itemOk q-my-md"},{default:s(()=>{var e,d;return[r("div",Ra,[r("div",Ja,[i(P,null,{default:s(()=>a[30]||(a[30]=[h(" Dinheiro ")])),_:1}),r("div",La,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.dinheiro.length),1)]),_:1})]),r("div",Ga,m(n.$filters.numero((d=o.totaisFormasPagamento[(e=o.dinheiro[0])==null?void 0:e.idFormaPagamento])==null?void 0:d.totalSistema,2)),1)])]),o.dinheiro.length?(f(),x(O,{key:0,class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarDinheiro?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[5]||(a[5]=g=>o.mostrarDinheiro=!o.mostrarDinheiro)})):C("",!0),o.mostrarDinheiro?C("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[6]||(a[6]=g=>o.mostrarDinheiro=!o.mostrarDinheiro)}))]),_:1})):C("",!0),o.mostrarDinheiro?(f(),q("div",Za,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.dinheiro,g=>(f(),x(M,{key:g.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var F;return[r("div",Ka,[r("div",Wa,[r("div",Ya,[h(m((F=o.documentos[g.idDocumento])==null?void 0:F.descricaoContato)+" ",1),i(u,{cor:"primary",escuro:"",class:"q-mx-sm"},{default:s(()=>{var S;return[h("#"+m((S=o.documentos[g.idDocumento])==null?void 0:S.numero),1)]}),_:2},1024)]),a[31]||(a[31]=r("div",{class:"col-12 col-sm"}," Dinheiro ",-1)),r("div",Xa,m(n.$filters.numero(g.valor,2)),1),r("div",ao,m(n.$filters.data(g.dataVencimento)),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]}),_:1}),o.sangrias.length?(f(),x(I,{key:2,class:"itemOk q-my-md q-mb-xl"},{default:s(()=>[r("div",oo,[r("div",to,[i(P,null,{default:s(()=>a[32]||(a[32]=[h(" Sangrias ")])),_:1}),r("div",eo,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.sangrias.length),1)]),_:1})]),r("div",io,m(n.$filters.numero(o.totalSangrias,2)),1)])]),i(O,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarSangrias?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[7]||(a[7]=e=>o.mostrarSangrias=!o.mostrarSangrias)})):C("",!0),o.mostrarSangrias?C("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[8]||(a[8]=e=>o.mostrarSangrias=!o.mostrarSangrias)}))]),_:1}),o.mostrarSangrias?(f(),q("div",so,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.sangrias,e=>(f(),x(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d,g;return[r("div",ro,[r("div",no,[r("div",lo,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||((g=o.usuarios[e.idContato])==null?void 0:g.nome)||"Nome n\xE3o encontrado"),1),r("div",co,m(e.documentoTipo),1),r("div",mo,m(n.$filters.numero(e.valorCredito,2)),1),r("div",uo,m(n.$filters.dataHora(e.dataMovimento)),1),r("div",ho,m(e.documentoObservacao||o.observacoesSangrias[e.documentoId]),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),o.sangriaFinal.length?(f(),x(I,{key:3,class:"itemOk q-my-md q-mb-xl"},{default:s(()=>[r("div",fo,[r("div",po,[i(P,null,{default:s(()=>a[33]||(a[33]=[h(" Sangria Final ")])),_:1}),r("div",go,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.sangriaFinal.length),1)]),_:1})]),r("div",vo,m(n.$filters.numero(o.totalSangriaFinal,2)),1)])]),i(O,{class:"content-center justify-center q-mt-lg"},{default:s(()=>[o.mostrarSangriaFinal?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:a[9]||(a[9]=e=>o.mostrarSangriaFinal=!o.mostrarSangriaFinal)})):C("",!0),o.mostrarSangriaFinal?C("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:a[10]||(a[10]=e=>o.mostrarSangriaFinal=!o.mostrarSangriaFinal)}))]),_:1}),o.mostrarSangriaFinal?(f(),q("div",bo,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.sangriaFinal,e=>(f(),x(M,{key:e.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var d,g;return[r("div",Co,[r("div",xo,[r("div",_o,m(e.nomeContato||((d=o.contatos[e.idContato])==null?void 0:d.nome)||((g=o.usuarios[e.idContato])==null?void 0:g.nome)||"Nome n\xE3o encontrado"),1),r("div",Fo,m(e.documentoTipo),1),r("div",qo,m(n.$filters.numero(e.valorCredito,2)),1),r("div",yo,m(n.$filters.dataHora(e.dataMovimento)),1),r("div",wo,m(e.documentoObservacao||o.observacoesSangrias[e.documentoId]),1)])])]}),_:2},1024))),128))]),_:1})])):C("",!0)]),_:1})):C("",!0),o.acertos.length||o.formasPagamento.filter(e=>e.tipo!==1&&(o.outrasFormasPagamento[e.id]||(o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario)).length?(f(),q("div",So," Outras formas de pagamento ")):C("",!0),o.acertos.length?(f(),x(I,{key:5,class:"itemWarning q-mt-md"},{default:s(()=>[r("div",Do,[r("div",Po,[i(P,null,{default:s(()=>a[34]||(a[34]=[h(" Acertos ")])),_:1}),r("div",ko,m(n.$filters.numero(o.totalAcertos,2)),1)])]),r("div",Ao,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.acertos,(e,d)=>(f(),x(M,{key:d,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>[r("div",zo,[r("div",$o,[r("div",Vo,m(e.descricao),1),r("div",Eo,m(n.$filters.numero(e.valor,2)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1})):C("",!0),(f(!0),q(z,null,$(o.formasPagamento.filter(e=>e.tipo!==1&&(o.outrasFormasPagamento[e.id]||(o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario)),e=>(f(),x(I,{key:e.id,class:T(["q-mt-md",p.cor("outraFormaPagamento","card",e.id)])},{default:s(()=>[r("div",Io,[r("div",Mo,[i(P,null,{default:s(()=>[h(m(e.descricao),1)]),_:2},1024),r("div",jo,[i(u,{cor:"primary",escuro:"",class:"q-mr-sm"},{default:s(()=>[h(m(o.outrasFormasPagamento[e.id]?(o.outrasFormasPagamento[e.id]||[]).length:0),1)]),_:2},1024)]),r("div",{class:T(["text-right text-h5 text-weight-bold q-mb-sm",p.cor("outraFormaPagamento","",e.id)])},[r("span",null,[h(m(n.$filters.numero((o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario,2))+" ",1),i(A,null,{default:s(()=>a[35]||(a[35]=[h("Digitado pelo usu\xE1rio")])),_:1})]),r("p",Ho,[h(m(n.$filters.numero((o.totaisFormasPagamento[e.id]||{}).totalSistema-(o.totaisFormasPagamento[e.id]||{}).totalInformadoUsuario,2))+" ",1),i(A,null,{default:s(()=>a[36]||(a[36]=[h("Diferen\xE7a")])),_:1})])],2)])]),o.outrasFormasPagamento[e.id]?(f(),x(O,{key:0,class:"content-center justify-center q-mt-lg"},{default:s(()=>[e.mostrar?(f(),x(w,{key:0,outline:"",size:"sm",icon:"keyboard_arrow_up",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ocultar Detalhes",onClick:d=>e.mostrar=!e.mostrar},null,8,["onClick"])):C("",!0),e.mostrar?C("",!0):(f(),x(w,{key:1,outline:"",size:"sm",icon:"keyboard_arrow_down",class:"no-shadow q-ma-xs",color:"grey",style:{"margin-top":"-30px"},label:"Ver Detalhes",onClick:d=>e.mostrar=!e.mostrar},null,8,["onClick"]))]),_:2},1024)):C("",!0),e.mostrar?(f(),q("div",No,[i(V,{highlight:"",class:"q-pa-none"},{default:s(()=>[(f(!0),q(z,null,$(o.outrasFormasPagamento[e.id],d=>(f(),x(M,{key:d.id,class:"row u-separador q-my-none q-pa-xs"},{default:s(()=>{var g;return[r("div",Oo,[r("div",To,[r("div",Uo,[h(m((g=o.documentos[d.idDocumento])==null?void 0:g.descricaoContato)+" ",1),i(u,{cor:"primary",escuro:"",class:"q-mx-sm"},{default:s(()=>{var F,S;return[h(" #"+m((S=(F=o.documentos[d.idDocumento])==null?void 0:F.id)==null?void 0:S.slice(-6)),1)]}),_:2},1024)]),r("div",Qo,m(n.$filters.numero(d.valor,2)),1),r("div",Bo,m(n.$filters.data(d.dataVencimento)),1)])])]}),_:2},1024))),128))]),_:2},1024)])):C("",!0)]),_:2},1032,["class"]))),128))]))])])])]),_:1})]),_:1}),i(ia,{class:"bg-light",bordered:""},{default:s(()=>[i(Q,{class:"bg-light text-tertiary q-pa-sm u-container"},{default:s(()=>[i(sa),o.visibilidade.botao.reabrir?(f(),x(w,{key:0,onClick:p.reabrir,color:"negative",flat:"",label:"Reabrir",unelevated:""},null,8,["onClick"])):C("",!0),o.visibilidade.botao.finalizar?(f(),x(w,{key:1,onClick:p.finalizar,label:"finalizar",color:"primary",class:"q-ml-sm",unelevated:""},null,8,["onClick"])):C("",!0),o.visibilidade.botao.fechar?(f(),x(w,{key:2,onClick:p.fechar,color:"primary",label:"refechar caixa",class:"q-ml-sm",unelevated:""},null,8,["onClick"])):C("",!0)]),_:1})]),_:1})]),_:1}),i(b,{ref:"Fechar",onFechado:p.atualizar},null,8,["onFechado"])]),_:1},8,["modelValue","onHide"])}var Jo=B(ma,[["render",Ro]]);const Lo={components:{Avatar:na,CaixaConferir:Jo},data(){return{empresa:{},contato:{},caixaConferirModal:{visivel:!1}}},emits:["atualizar"],methods:{abrirCaixaConferirModal(){this.caixaConferirModal.visivel=!0},async atualizar(){this.empresa=await $db.contato.le({id:this.documento.idEmpresa}),this.contato=await $db.contato.le({id:this.documento.idContato})},executar(n){switch(n){case"atualizar":this.atualizar(),this.$emit("atualizar")}}},props:{documento:{required:!0,type:Object}},mounted(){this.atualizar()}},Go={id:"CaixaCard",class:"q-mb-md"},Zo={class:"col-12 col-md-6 q-pl-none"},Ko={class:"col-12 col-md"},Wo={class:"text-left q-my-none"},Yo={class:"text-weight-bold"},Xo={class:"col-6 col-md-auto"},at={class:"text-left q-my-none"},ot={class:"col-6 col-md-auto"},tt={class:"text-left q-my-none"},et={class:"col-6 col-md"},it={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},st={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},rt={class:"col-6 col-md-auto"};function nt(n,a,v,_,o,p){const l=E("avatar"),u=E("row"),b=E("CaixaConferir");return f(),q("div",Go,[i(I,{class:"extratoItem bg-white q-pa-sm no-shadow"},{default:s(()=>[i(u,{class:"items-center q-mx-none q-px-none q-mb-sm"},{default:s(()=>[r("div",Zo,[i(Q,{class:"q-pa-none"},{default:s(()=>[i(l,{imagem:o.contato.imagem,rotulo:o.contato.nome,tamanho:"40",style:{float:"left"}},null,8,["imagem","rotulo"]),i(P,null,{default:s(()=>[h(m(o.contato.apelido),1)]),_:1}),i(R,{rounded:"",color:"grey",small:"",class:"q-ma-sm"},{default:s(()=>[h(m(v.documento.status),1)]),_:1}),i(R,{class:"q-mr-sm",rounded:"",color:"positive"},{default:s(()=>[h(" #"+m(parseInt(v.documento.numero)||(v.documento.id||"").slice(-6)),1)]),_:1})]),_:1})]),r("div",Ko,[r("p",Wo,[r("span",Yo,[i(j,{name:"business "}),h(" "+m(o.empresa.apelido),1)]),a[3]||(a[3]=r("br",null,null,-1)),h(" "+m(o.empresa.nome),1)])]),r("div",Xo,[r("p",at,[v.documento.dataHoraEmissao?(f(),x(j,{key:0,name:"mdi-calendar-today "})):C("",!0),h(" "+m(n.$filters.data(v.documento.dataHoraEmissao))+" ",1),i(A,null,{default:s(()=>a[4]||(a[4]=[h(" Abertura ")])),_:1})])]),r("div",ot,[r("p",tt,[v.documento.dataHoraEmissao?(f(),x(j,{key:0,name:"mdi-calendar-today"})):C("",!0),h(" "+m(n.$filters.data(v.documento.dataHoraFinalizado))+" ",1),i(A,null,{default:s(()=>a[5]||(a[5]=[h(" Fechamento ")])),_:1})])]),r("div",et,[r("p",it,m(n.$filters.numero(v.documento.totalDocumento,2)),1),r("p",st,m(n.$filters.numero(v.documento.subTotal,2)),1)]),r("div",rt,[i(w,{rounded:"",dense:"",flat:"",icon:"edit",class:"no-shadow q-ma-xs",size:"md",color:"primary",style:{float:"right"},onClick:p.abrirCaixaConferirModal},{default:s(()=>[i(A,null,{default:s(()=>a[6]||(a[6]=[h(" Abrir confer\xEAncia ")])),_:1})]),_:1},8,["onClick"]),i(w,{rounded:"",dense:"",flat:"",icon:"print",class:"no-shadow q-ma-xs",size:"md",color:"primary",style:{float:"right"}},{default:s(()=>[i(la,null,{default:s(()=>[i(V,{link:"",separator:""},{default:s(()=>[i(M,{clickable:"",onClick:a[0]||(a[0]=e=>{n.$imprimir("fechamento-de-caixa",v.documento.id)})},{default:s(()=>[i(U,{avatar:""},{default:s(()=>[i(j,{name:"print"})]),_:1}),i(U,null,{default:s(()=>[i(J,null,{default:s(()=>a[7]||(a[7]=[h("Imprimir Fechamento")])),_:1})]),_:1})]),_:1}),i(M,{clickable:"",onClick:a[1]||(a[1]=e=>{n.$imprimir("conferencia-de-caixa",v.documento.id)})},{default:s(()=>[i(U,{avatar:""},{default:s(()=>[i(j,{name:"print"})]),_:1}),i(U,null,{default:s(()=>[i(J,null,{default:s(()=>a[8]||(a[8]=[h("Imprimir Confer\xEAncia")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),i(b,{modelValue:o.caixaConferirModal.visivel,"onUpdate:modelValue":a[2]||(a[2]=e=>o.caixaConferirModal.visivel=e),idDocumentoCaixa:v.documento.id,onExecutar:p.executar},null,8,["modelValue","idDocumentoCaixa","onExecutar"])])}var lt=B(Lo,[["render",nt]]);const dt={components:{CaixaCard:lt,GChipsV2:ca},data(){return{documentosCaixaConferencia:[],documentosCaixaFechado:[],dataIni:"",dataFim:"",termosPesquisa:[]}},methods:{async filtrar(){let n=[];const a=await $db.contatoEmpresa.listaCache();let v=new Date(new Date(this.dataIni).toDateString()),_=new Date(new Date(this.dataFim).toDateString());for(const l of a)(await $db.hibrido.lista({table:"documento",where:{tipo:"Caixa",idEmpresa:l.id}})).forEach(b=>{const e=new Date(new Date(b.dataHoraEmissao).toDateString());e<=_&&e>=v&&n.push(b)});n.sort((l,u)=>new Date(l.dataHoraEmissao)>new Date(u.dataHoraEmissao)?-1:1);for(let l of this.termosPesquisa)l=l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),/^#\d+$/gi.test(l)?n=n.filter(u=>u.numero===Number(l.slice(1))):n=n.filter(u=>{const b=a.find(e=>e.id===u.idEmpresa);return((b.nome||"")+(b.apelido||"")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().search(l)!==-1});let o=n.filter(l=>l.status==="Aguardando Confer\xEAncia"),p=n.filter(l=>l.status==="Fechado");this.documentosCaixaConferencia=o,this.documentosCaixaFechado=p}},mounted(){const n=new Date(new Date().toDateString()),a=new Date(n);a.setDate(a.getDate()-7),this.dataIni=a,this.dataFim=n,this.filtrar()}},ct={class:"CaixaTesouraria"},mt={class:"col-12 col-md-6"},ut={class:"col"},ht={class:"col"},ft={class:"q-pa-sm"};function pt(n,a,v,_,o,p){const l=E("GChipsV2"),u=E("campo"),b=E("row"),e=E("caixa-card");return f(),q("div",ct,[i(I,{class:"q-pa-sm q-mx-sm no-shadow"},{default:s(()=>[i(b,{class:"items-center q-col-gutter-md"},{default:s(()=>[r("div",mt,[i(l,{modelValue:o.termosPesquisa,"onUpdate:modelValue":[a[0]||(a[0]=d=>o.termosPesquisa=d),p.filtrar],class:"q-px-none",placeholder:"Termo de pesquisa"},{prepend:s(()=>[i(j,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),r("div",ut,[i(u,{modelValue:o.dataIni,"onUpdate:modelValue":a[1]||(a[1]=d=>o.dataIni=d),tipo:"data",onInput:p.filtrar,dense:"",outlined:""},null,8,["modelValue","onInput"])]),a[3]||(a[3]=r("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[r("label",null,"at\xE9")],-1)),r("div",ht,[i(u,{modelValue:o.dataFim,"onUpdate:modelValue":a[2]||(a[2]=d=>o.dataFim=d),tipo:"data",onInput:p.filtrar,dense:"",outlined:""},null,8,["modelValue","onInput"])])]),_:1})]),_:1}),r("div",ft,[i(V,{class:"no-border"},{default:s(()=>[i(L,{"default-opened":"",label:"Aguardando Confer\xEAncia"},{default:s(()=>[(f(!0),q(z,null,$(o.documentosCaixaConferencia,d=>(f(),q("div",{key:d.id},[i(e,{documento:d,onAtualizar:p.filtrar},null,8,["documento","onAtualizar"])]))),128))]),_:1})]),_:1}),i(V,{class:"no-border"},{default:s(()=>[i(L,{"default-opened":"",label:"Fechado"},{default:s(()=>[(f(!0),q(z,null,$(o.documentosCaixaFechado,d=>(f(),q("div",{key:d.id},[i(e,{documento:d,onAtualizar:p.filtrar},null,8,["documento","onAtualizar"])]))),128))]),_:1})]),_:1})])])}var Ct=B(dt,[["render",pt]]);export{Ct as default};
