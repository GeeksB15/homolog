import{_ as lt,a3 as Et,r as pe,o as L,d as J,w as r,f as t,M as je,G as He,h as Pe,i as Re,k as z,t as ae,m as xe,e as re,H as be,Q as ce,N as Ee,I as Ze,J as Ge,p as Ie,a_ as Dt,a$ as dt,b5 as Vt,b6 as ut,W as $e,b7 as ht,d5 as gt,d6 as Me,K as Qe,aU as et,D as Le,bi as yt,ar as Fe,au as xt,bJ as wt,b4 as Be,C as ve,j as ie,bf as Ue,P as Ne,S as fe,T as Y,U as ue,v as Xe,B as ot,L as _t,F as De,x as Te,l as ct,aO as vt,E as st,br as mt,e5 as Pt,c as rt,bH as it,e6 as zt,as as Ft,at as Nt,aN as bt,A as At,O as Tt}from"./index.67592aac.js";import{Q as qt}from"./QUploader.8ae49bec.js";import{L as Bt}from"./Lista.f175e44e.js";import{Q as Ot}from"./QFab.5021a8c8.js";import{S as Mt}from"./SeletorCfop.877e73fd.js";import{C as Ut}from"./Campo.dab0559c.js";import"./xlsx.bc5dd6bb.js";import"./use-file.06b0a8bf.js";const Rt={components:{SeletorNcm:Et,SeletorCfop:Mt,Campo:Ut},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},compra:{},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(i,e,m){var a,c,v,w;this.compra=m,this.documentoItem=$utils.clonarV2(i),this.item=$utils.clonarV2(e),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const I=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:1}}),o=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:21}});this.impostoCstIcms=I.concat(o).map(b=>({rotulo:b.numero.trim()+" - "+b.descr,valor:Number(b.numero)})).sort((b,f)=>Number(b.valor)-Number(f.valor)),this.impostoIcmsModalidade=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:3}})).map(b=>({rotulo:b.numero.trim()+" - "+b.descr,valor:Number(b.numero)})).sort((b,f)=>Number(b.valor)-Number(f.valor)),this.impostoCstIcmsSt=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:4}})).map(b=>({rotulo:b.numero.trim()+" - "+b.descr,valor:Number(b.numero)})).sort((b,f)=>Number(b.valor)-Number(f.valor)),this.impostoCstIpi=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:5}})).map(b=>({rotulo:b.numero.trim()+" - "+b.descr,valor:Number(b.numero)})).sort((b,f)=>Number(b.valor)-Number(f.valor)),this.contaEstoque=(await $db.hibrido.lista({table:"financeiroPlanoConta"})).map(b=>{var f,u,k;return{rotulo:(k=(u=(f=b==null?void 0:b.descricao)!=null?f:" - "+(b==null?void 0:b.classificacao))!=null?u:" - "+(b==null?void 0:b.caminho))!=null?k:"",valor:b.id}}).sort((b,f)=>Number(b.valor)-Number(f.valor));let s;(a=this.documentoItem)!=null&&a.idCfop&&(s=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),s===void 0&&console.log("CFOP inv\xE1lido");const l=this.documentoItem.total/(this.documentoItem.quantidade||1)||0;this.documentoItem.cfop=(c=s==null?void 0:s.cfop.toString())!=null?c:"",this.documentoItem.codigoCfop=(v=s==null?void 0:s.codigoCfop)!=null?v:null,this.documentoItem.idCfop=(w=s==null?void 0:s.id)!=null?w:null,this.documentoItem.valorBaseIcms=this.documentoItem.valorBaseIcms||l,this.documentoItem.valorBaseIpi=this.documentoItem.valorBaseIpi||l,this.documentoItem.valorBaseIcmsSt=this.documentoItem.valorBaseIcmsSt||l,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(this.exibirIcms||(this.documentoItem.modalidadeBaseCalculo=null,this.documentoItem.codigoCst=null,this.documentoItem.percentualIcms=0,this.documentoItem.valorIcms=0),this.exibirIcmsSt||(this.documentoItem.modalidadeBaseCalculoST=null,this.documentoItem.percentualIcmsSt=0,this.documentoItem.valorIcmsSt=0),this.exibirIpi||(this.documentoItem.codigoCstIpi=null,this.documentoItem.percentualIpi=0,this.documentoItem.valorIpi=0),Object.keys(this.documentoItem.cfop).length>0){const i=await $db.hibrido.lista({table:"cfop",where:{cfop:Number(this.documentoItem.cfop)}});this.documentoItem.codigoCfop=i[0].codigoCfop,this.documentoItem.idCfop=i[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(i){$q.notifyError("Ocorreu um erro ao salvar o produto: ",i.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(i){var b,f,u,k,g,y,n,_,h,D;let e=(b=this.documentoItem.valorBaseIcms)!=null?b:0,m=(f=this.documentoItem.valorBaseIpi)!=null?f:0,I=(u=this.documentoItem.valorBaseIcmsSt)!=null?u:0,o=(k=this.documentoItem.percentualIcms)!=null?k:0,s=(g=this.documentoItem.percentualIpi)!=null?g:0,l=(y=this.documentoItem.percentualIVA)!=null?y:0,a=(n=this.documentoItem.percentualIcmsSt)!=null?n:0,c=(_=this.documentoItem.valorIcms)!=null?_:0,v=(h=this.documentoItem.valorIpi)!=null?h:0,w=(D=this.documentoItem.valorIcmsSt)!=null?D:0;["valorBaseIcms","percentualIcms"].includes(i)&&(c=e*o/100),i==="valorIcms"&&(o=c/e*100),["valorBaseIpi","percentualIpi"].includes(i)&&(v=m*s/100),i==="valorIpi"&&(s=v/m*100),i==="valorBaseIcmsSt"&&(l=0,I>0&&e>0&&I>=e&&(l=(I-e)/e*100),w=I*a/100-c),i==="percentualIVA"&&(I=e*(1+l/100),w=I*a/100-c),i==="percentualIcmsSt"&&(w=I*a/100-c),i==="valorIcmsSt"&&(a=w/I*100),this.documentoItem.valorBaseIcmsSt=parseFloat(I.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(o.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(a.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(s.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(l.toFixed(2)),this.documentoItem.valorIcms=parseFloat(c.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(w.toFixed(2)),this.documentoItem.valorIpi=parseFloat(v.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.codigoCst||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCstIpi||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var m,I;const i=this.documentoItem.cfop,e=await $erp().cfop.where({cfop:Number(i)}).first();e===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(m=e==null?void 0:e.id)!=null?m:null,this.documentoItem.codigoCfop=(I=e==null?void 0:e.CodigoCFOP)!=null?I:null},async consultarHistoricoItem(i){const e={};(i==null?void 0:i.atual)&&Object.keys(i.atual).length>0&&(i=i.atual);const I=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:i.id}})).filter(o=>(o.operacao==="Compra"||o.operacao==="Compra de Mercadoria")&&o.status==="Finalizado"&&o.operacaoFator===1&&o.quantidade>0);for(const o of I){const s=await $db.hibrido.le({table:"documento",id:o.idDocumento}),l=await $db.hibrido.le({table:"contato",id:s.idContato});e[o.idItem]||(e[o.idItem]={fornecedores:[]}),e[o.idItem].fornecedores.push({fornecedor:l.apelido||"",dataCompra:s.dataCompra||"",quantidade:o.quantidade||"",valorCusto:o.valorItem||"",valorTotal:o.valorItem*o.quantidade||""})}Object.keys(e).length>0?(this.historicoItem=e,this.historicoItem[i.id].fornecedores.sort((o,s)=>{const l=new Date(o.dataCompra||"1900-01-01");return new Date(s.dataCompra||"1900-01-01")-l})):this.historicoItem[i.id]={fornecedores:[]},this.exibirHistorico=!0},async consultarEstoqueItem(i){const e={};(i==null?void 0:i.atual)&&Object.keys(i.atual).length>0&&(i=i.atual);const m=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idItem:i.id},whereFilter:{tipoEstoque:"Dispon\xEDvel"}});for(const I of m){const o=await $db.hibrido.le({table:"contato",id:I.idEmpresa});e[I.idItem]||(e[I.idItem]={estoques:[]}),e[I.idItem].estoques.push({empresa:o.apelido||"",tipoEstoque:I.tipoEstoque||"",lote:I.lote||"-",quantidade:I.saldo||""})}Object.keys(e).length>0?(this.estoqueItem=e,this.estoqueItem[i.id].estoques.sort((I,o)=>{const s=Number(I.quantidade||0);return Number(o.quantidade||0)-s})):this.estoqueItem[i.id]={estoques:[]},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},Lt=["src"],$t={key:0},jt={key:0};function Ht(i,e,m,I,o,s){const l=pe("badge"),a=pe("g-col"),c=pe("g-row"),v=pe("campo"),w=pe("SeletorNcm"),b=pe("SeletorCfop"),f=pe("g-label");return L(),J(Le,{modelValue:o.visivel,"onUpdate:modelValue":e[36]||(e[36]=u=>o.visivel=u),persistent:""},{default:r(()=>[t(je,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:r(()=>[t(He,{class:"bg-primary"},{default:r(()=>[t(Pe,{class:"bg-primary text-white"},{default:r(()=>[t(Re,null,{default:r(()=>[z(ae(o.documentoItem.descricaoItem),1)]),_:1}),o.item.referencia?(L(),J(l,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:r(()=>[z(ae(o.item.referencia)+" ",1),t(xe,null,{default:r(()=>e[37]||(e[37]=[z(" Refer\xEAncia ")])),_:1})]),_:1})):re("",!0),o.item.codigoItem?(L(),J(l,{key:1,cor:"positive",class:"q-mr-sm"},{default:r(()=>[z(" #"+ae(o.item.codigoItem.toString().padStart(4,"0"))+" ",1),t(xe,null,{default:r(()=>e[38]||(e[38]=[z(" C\xF3digo Item ")])),_:1})]),_:1})):re("",!0),be(t(ce,{onClick:s.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[Ee]])]),_:1})]),_:1}),t(Ze,null,{default:r(()=>[t(Ge,null,{default:r(()=>[t(c,{gutter:"md"},{default:r(()=>[t(a,null,{default:r(()=>[t(c,{class:"col-12 text-center"},{default:r(()=>[t(a,null,{default:r(()=>{var u,k,g,y,n,_;return[((u=o.item)==null?void 0:u.imagem)||((g=(k=o.item)==null?void 0:k.atual)==null?void 0:g.imagem)?(L(),Ie("img",{key:0,src:((y=o.item)==null?void 0:y.imagem)||((_=(n=o.item)==null?void 0:n.atual)==null?void 0:_.imagem),alt:"",style:{"max-width":"33%"}},null,8,Lt)):re("",!0)]}),_:1})]),_:1}),t(Dt,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[0]||(e[0]=u=>o.abaSelecionada=u),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:r(()=>[t(dt,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),t(dt,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),t(dt,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),t(Vt,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[35]||(e[35]=u=>o.abaSelecionada=u),animated:"",class:"text-tertiary"},{default:r(()=>[t(ut,{name:"tab1",class:"q-px-sm"},{default:r(()=>[t(c,null,{default:r(()=>[t(a,null,{default:r(()=>[t(v,{modelValue:o.documentoItem.observacao,"onUpdate:modelValue":e[1]||(e[1]=u=>o.documentoItem.observacao=u),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(v,{modelValue:o.documentoItem.referenciaFornecedor,"onUpdate:modelValue":e[2]||(e[2]=u=>o.documentoItem.referenciaFornecedor=u),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(w,{modelValue:o.documentoItem.ncm,"onUpdate:modelValue":e[3]||(e[3]=u=>o.documentoItem.ncm=u),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(b,{modelValue:o.documentoItem.cfop,"onUpdate:modelValue":e[4]||(e[4]=u=>o.documentoItem.cfop=u),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:r(()=>[t(a,null,{default:r(()=>[t(f,{text:"sub1 medium"},{default:r(()=>e[39]||(e[39]=[z("Estoque")])),_:1})]),_:1})]),_:1}),t(c,{items:"center"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(v,{modelValue:o.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":e[5]||(e[5]=u=>o.documentoItem.idPlanoContaEstoque=u),opcoes:o.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:r(()=>[t(a,null,{default:r(()=>[t(f,{text:"sub1 medium"},{default:r(()=>e[40]||(e[40]=[z("Impostos")])),_:1})]),_:1})]),_:1}),t(c,null,{default:r(()=>[t($e,{label:"ICMS",modelValue:o.exibirIcms,"onUpdate:modelValue":e[6]||(e[6]=u=>o.exibirIcms=u)},null,8,["modelValue"])]),_:1}),o.exibirIcms?(L(),J(c,{key:0,items:"center"},{default:r(()=>[t(a,{col:"12 sm6"},{default:r(()=>[t(v,{modelValue:o.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":e[7]||(e[7]=u=>o.documentoItem.modalidadeBaseCalculo=u),opcoes:o.impostoIcmsModalidade,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),t(a,{col:"12 sm6"},{default:r(()=>[t(v,{modelValue:o.documentoItem.codigoCst,"onUpdate:modelValue":e[8]||(e[8]=u=>o.documentoItem.codigoCst=u),opcoes:o.impostoCstIcms,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.valorBaseIcms,"onUpdate:modelValue":e[9]||(e[9]=u=>o.documentoItem.valorBaseIcms=u),onBlur:e[10]||(e[10]=u=>s.calcularImpostos("valorBaseIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.percentualIcms,"onUpdate:modelValue":e[11]||(e[11]=u=>o.documentoItem.percentualIcms=u),onBlur:e[12]||(e[12]=u=>s.calcularImpostos("percentualIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.valorIcms,"onUpdate:modelValue":e[13]||(e[13]=u=>o.documentoItem.valorIcms=u),onBlur:e[14]||(e[14]=u=>s.calcularImpostos("valorIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):re("",!0),t(c,null,{default:r(()=>[t($e,{label:"ICMS ST",modelValue:o.exibirIcmsSt,"onUpdate:modelValue":e[15]||(e[15]=u=>o.exibirIcmsSt=u)},null,8,["modelValue"])]),_:1}),o.exibirIcmsSt?(L(),J(c,{key:1,items:"center"},{default:r(()=>[t(a,{col:"12 sm6"},{default:r(()=>[t(v,{modelValue:o.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":e[16]||(e[16]=u=>o.documentoItem.modalidadeBaseCalculoST=u),opcoes:o.impostoCstIcmsSt,"somente-leitura":o.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),t(a,{col:"12 sm6"},{default:r(()=>[t(v,{modelValue:o.documentoItem.percentualIVA,"onUpdate:modelValue":e[17]||(e[17]=u=>o.documentoItem.percentualIVA=u),onBlur:e[18]||(e[18]=u=>s.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":e[19]||(e[19]=u=>o.documentoItem.valorBaseIcmsSt=u),onBlur:e[20]||(e[20]=u=>s.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.percentualIcmsSt,"onUpdate:modelValue":e[21]||(e[21]=u=>o.documentoItem.percentualIcmsSt=u),onBlur:e[22]||(e[22]=u=>s.calcularImpostos("percentualIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.valorIcmsSt,"onUpdate:modelValue":e[23]||(e[23]=u=>o.documentoItem.valorIcmsSt=u),onBlur:e[24]||(e[24]=u=>s.calcularImpostos("valorIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):re("",!0),t(c,null,{default:r(()=>[t($e,{label:"IPI",modelValue:o.exibirIpi,"onUpdate:modelValue":e[25]||(e[25]=u=>o.exibirIpi=u)},null,8,["modelValue"])]),_:1}),o.exibirIpi?(L(),J(c,{key:2,items:"center"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(v,{modelValue:o.documentoItem.codigoCstIpi,"onUpdate:modelValue":e[26]||(e[26]=u=>o.documentoItem.codigoCstIpi=u),opcoes:o.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.valorBaseIpi,"onUpdate:modelValue":e[27]||(e[27]=u=>o.documentoItem.valorBaseIpi=u),onBlur:e[28]||(e[28]=u=>s.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.percentualIpi,"onUpdate:modelValue":e[29]||(e[29]=u=>o.documentoItem.percentualIpi=u),onBlur:e[30]||(e[30]=u=>s.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),t(a,{col:"12 sm4"},{default:r(()=>[t(v,{modelValue:o.documentoItem.valorIpi,"onUpdate:modelValue":e[31]||(e[31]=u=>o.documentoItem.valorIpi=u),onBlur:e[32]||(e[32]=u=>s.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):re("",!0)]),_:1}),t(ut,{name:"tab2",class:"q-px-sm"},{default:r(()=>[o.exibirHistorico?(L(),J(ht,{key:0,rows:o.historicoItem[o.documentoItem.idItem].fornecedores,columns:o.tabelaHistoricoItem.colunas,pagination:o.tabelaHistoricoItem.paginacao,"onUpdate:pagination":e[33]||(e[33]=u=>o.tabelaHistoricoItem.paginacao=u),"row-key":"index",class:"no-shadow text-left"},{body:r(u=>[t(gt,{props:u},{default:r(()=>[t(Me,{key:"fornecedor",props:u},{default:r(()=>[z(ae(u.row.fornecedor),1)]),_:2},1032,["props"]),t(Me,{key:"dataCompra",props:u},{default:r(()=>[u.row.dataCompra!==""?(L(),Ie("span",$t,ae(i.$filters.data(u.row.dataCompra)),1)):re("",!0)]),_:2},1032,["props"]),t(Me,{key:"quantidade",props:u},{default:r(()=>[z(ae(u.row.quantidade),1)]),_:2},1032,["props"]),t(Me,{key:"valorCusto",props:u},{default:r(()=>[z(ae(i.$filters.numero(u.row.valorCusto,2)),1)]),_:2},1032,["props"]),t(Me,{key:"valorTotal",props:u},{default:r(()=>[z(ae(i.$filters.numero(u.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):re("",!0)]),_:1}),t(ut,{name:"tab3",class:"q-px-sm"},{default:r(()=>[o.exibirEstoque?(L(),J(ht,{key:0,rows:o.estoqueItem[o.documentoItem.idItem].estoques,columns:o.tabelaEstoqueItem.colunas,pagination:o.tabelaEstoqueItem.paginacao,"onUpdate:pagination":e[34]||(e[34]=u=>o.tabelaEstoqueItem.paginacao=u),"row-key":"index",class:"no-shadow text-left"},{body:r(u=>[t(gt,{props:u},{default:r(()=>[t(Me,{key:"empresa",props:u},{default:r(()=>[z(ae(u.row.empresa),1)]),_:2},1032,["props"]),t(Me,{key:"tipoEstoque",props:u},{default:r(()=>[z(ae(u.row.tipoEstoque),1)]),_:2},1032,["props"]),t(Me,{key:"lote",props:u},{default:r(()=>[u.row.lote!==""?(L(),Ie("span",jt,ae(u.row.lote),1)):re("",!0)]),_:2},1032,["props"]),t(Me,{key:"quantidade",props:u},{default:r(()=>[z(ae(u.row.quantidade),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):re("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Qe,{class:"bg-light q-pa-sm",bordered:""},{default:r(()=>[t(Pe,null,{default:r(()=>[t(et),be(t(ce,{onClick:s.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[Ee]]),t(ce,{onClick:s.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Zt=lt(Rt,[["render",Ht]]);const Gt={components:{ModalEditarProdutoCompras:Zt,PromptItemV2:yt},data(){const i={tela:{},termoBusca:"",layoutCompraItens:[],ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},produtos:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const e=this.compra.condicaoPagamento;return/^[\d/]*$/.test(e)}],formaPagamentoRules:[async()=>{const e=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(e)}],comprasMigrar:[],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",alterarPrevisaoEntrega:!1,showContabilidade:!1};return this.limpaCampos(i),i},emits:["atualizar","dialogImprimirEtiquetas"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"},quantidadeItens(){return this.compraItens.reduce((i,e)=>i+e.quantidade,0)}},methods:{buscar(){try{let i=new Set((this.termoBusca||"").trim().toLowerCase().replace(/\s+/g," ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(" "));i=Array.from(i);for(const e of Object.values(this.layoutCompraItens)){let m=`${e.id} ${e.codigoItem?String(e.codigoItem)+" #"+String(e.codigoItem):""} `;m+=`${e.descricaoConcatenada||""} ${e.marca||""} ${e.grupo||""} ${e.subGrupo||""} `,m+=`${e.aplicacao||""} ${e.referencia?e.referencia+" Ref"+e.referencia:""} `,m+=`${e.codigoBarras||""} ${e.tipo||""} ${e.codigoBarrasAntigo||""} ${e.codigoAntigo||""}`,m=m.trim().toLowerCase().replace(/\s+/g," ").normalize("NFD").replace(/[\u0300-\u036f]/g,"");let I=!0;for(const o of i)if(m.indexOf(o)===-1){I=!1;break}I?e.visivel=!1:e.visivel=!0}}catch(i){console.error("Erro ao buscar item. ",i)}},editarProduto(i){const e=this.produtos[i.idItem],m=this.compra;this.$refs.ModalEditarProdutoCompras.mostrar(i,e,m)},removerItem(i){this.compraItens=this.compraItens.filter(e=>e.id!==i.id),this.calcularTotais()},async migrarParaOutraCompra(i,e){await $tryLoading(async()=>{const m=(e==null?void 0:e.id)||$utils.uuid(),I=e?{...e}:{...this.compra,id:m,codigoDocumento:void 0,numero:void 0,notaNumero:void 0,notaSerie:void 0,naturezaOperacao:void 0,dataCompra:void 0,chaveAcesso:void 0,totalDesconto:void 0,totalPercentualDesconto:void 0,valorFrete:void 0,valorSeguro:void 0,valorOutrasDespesas:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,dataHoraPrevisto:void 0,status:"Digita\xE7\xE3o"},o={...i,id:$utils.uuid(),codigoDocumentoItem:void 0,idDocumento:m,codigoDocumento:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,status:"Digita\xE7\xE3o"};this.calcularTotais("",I,[o]),await $db.hibrido.grava("documento",{atual:I,original:e}),await $db.hibrido.grava("documentoItem",{atual:o}),this.removerItem(i),this.salvar(),$q.notifyPositive("Item migrado com sucesso!")},{mensagem:"Migrando..."})},fecharEdicaoProduto(i){const e=this.compraItens.findIndex(m=>m.id===i.id);this.compraItens[e]=$utils.clonar(i),this.calcularTotaisItem(e)},async atualizar(){var o,s,l,a,c,v,w;this.compraOriginal=await $db.hibrido.le({table:"documento",id:this.compra.id}),this.compra=$utils.clonarV2(this.compraOriginal),$utils.verificarErro(!this.compra.id,"Compra n\xE3o encontrada"),this.compraItensOriginal=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.compra.id}})).sort((b,f)=>new Date(b.dataHoraEmissao||0)-new Date(f.dataHoraEmissao||0));const i=[...new Set(this.compraItensOriginal.map(b=>b.idItem))],e=(o=await $db.hibrido.lista({table:"item",columns:["id","codigoItem","codigoItem","codigoItem","descricaoConcatenada","marca","grupo","subGrupo","aplicacao","referencia","referencia","referencia","codigoBarras","tipo","codigoBarrasAntigo","codigoAntigo"],whereIn:{id:i}}))!=null?o:{};for(const b of this.compraItensOriginal)b.descricaoConcatenada=(e==null?void 0:e.find(f=>f.id===b.idItem).descricaoConcatenada)||"",this.layoutCompraItens[b.idItem]={...e==null?void 0:e.find(f=>f.id===b.idItem),codigoItem:((s=e==null?void 0:e.find(f=>f.id===b.idItem))==null?void 0:s.codigoItem[0])||((l=e==null?void 0:e.find(f=>f.id===b.idItem))==null?void 0:l.codigoItem),referencia:((a=e==null?void 0:e.find(f=>f.id===b.idItem))==null?void 0:a.referencia[0])||((c=e==null?void 0:e.find(f=>f.id===b.idItem))==null?void 0:c.referencia),visivel:!1};this.compraItens=$utils.clonarV2(this.compraItensOriginal),this.compraCondicoesDePagamentoOriginal=(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}})).sort((b,f)=>new Date(b.dataVencimento||0)-new Date(f.dataVencimento||0)),this.compraCondicoesDePagamento=$utils.clonarV2(this.compraCondicoesDePagamentoOriginal),this.compraTitulosOriginal=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}}),this.compraTitulos=$utils.clonarV2(this.compraTitulosOriginal),this.compraMovimentacoesOriginal=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.compra.id}}),this.compraMovimentacoes=$utils.clonarV2(this.compraMovimentacoesOriginal),this.compraDocumentoXmlOriginal=await $db.hibrido.lista({table:"documentoXML",where:{idDocumento:this.compra.id}}),this.compraDocumentoXml=$utils.clonarV2(this.compraDocumentoXmlOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(v=this.compra.calcularTributacao)!=null?v:!0,this.compra.naoGerarFinanceiro=(w=this.compra.naoGerarFinanceiro)!=null?w:!1;const m=[this.compra.idEmpresa,this.compra.idContato,this.compra.idContatoComprador,this.compra.idContatoVendedor,this.compra.idContatoTransportadora].filter(Boolean);this.carregarImagensContatos(m);const I=this.compraItens.map(({idItem:b})=>b).filter(Boolean);if(this.carregarImagensItens(I),this.valorTotalPagamento===0)for(const b of this.compraCondicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+b.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.carregarComprasMigrar(this.compra),this.calcularTotais(),this.exibeInfNota=!0},async carregarContatos(i){const e=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:i}});for(const m of e)this.contatos[m.id]=m},async carregarImagensContatos(i){if(!!i.length){await $utils.dormir(200);try{await this.carregarContatos(i)}catch(e){console.error("Erro ao carregar imagens de contatos - ",e)}}},async carregarComprasMigrar(i){try{this.comprasMigrar=(await $db.hibrido.lista({table:"documento",where:{tipo:"Compra",idContato:i.idContato},whereFilter:{idEmpresa:i.idEmpresa,status:"Digita\xE7\xE3o"}})).filter(({id:e})=>e!==i.id)}catch(e){console.error("Erro ao carregar compras para migra\xE7\xE3o - ",e)}},async carregarItens(i){const e=await $db.hibrido.lista({table:"item",columns:["id","descricao","imagem","valorCustoReposicao","marca","referencia","codigoItem"],whereIn:{id:i}});for(const m of e)this.produtos[m.id]=m},async carregarImagensItens(i){if(!!i.length){await $utils.dormir(200);try{await this.carregarItens(i)}catch(e){console.error("Erro ao ler imagens de itens - ",e)}}},async salvar_click(){await $tryLoading(async()=>{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const i=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=Fe.formatDate(i)}this.calcularTotais(),await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi salva com sucesso.":"O Pedido de Compra foi salvo com sucesso.")},{mensagem:"Salvando..."})},async excluir_click(){!await $q.dialogSimNao({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`})||await $tryLoading(async()=>{this.visivel=!1,this.operacao=this.compra.operacao,this.compra={},this.compraCondicoesDePagamento=[],this.compraItens=[],this.compraMovimentacoes=[],this.compraTitulos=[],this.compraDocumentoXml=[],await this.salvar(),await this.fechar(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi excluida com sucesso.":"O Pedido de Compra foi excluido com sucesso.")},{mensagem:"Excluindo..."})},async criar(){await $tryLoading(async()=>{const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(!(i.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}let e=i[0];if(i.length>1){const o={ativo:!0,empresas:!0};if(e=await $g.promptContato.show({filtro:o,placeholder:"Selecione a empresa"}),!e){this.ocultarModal();return}}const m=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[e.id]||await this.carregarContatos([e.id]),this.limpaCampos(this),this.compra={id:$utils.uuid(),tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",descricaoEmpresa:m.nome,numeroDocumentoEmpresa:m.numeroDocumentoNacional,descricaoContato:"",idContatoComprador:null,dataHoraEmissao:$utils.dataAtual(),tipoFrete:"CIF",tipoTransporte:null,idEmpresa:m.idContato,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0,valorOutrasDespesas:0},!await this.abrirModalFornecedor()){this.ocultarModal();return}this.documentoNovo=!0,this.exibeInfNota=!0,this.visivel=!0})},async validaCampos(){try{if($utils.verificarErro(!this.compra.descricaoContato,"N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!"),$utils.verificarErro(!this.compraItens.length,"N\xE3o \xE9 permitido finalizar compra sem itens!"),!this.compra.naoGerarFinanceiro){const i=$utils.arredondar(this.compraCondicoesDePagamento.reduce((e,m)=>e+m.valor,0));$utils.verificarErro(!this.compra.formaDePagamento,"N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!"),$utils.verificarErro(this.compraCondicoesDePagamento.length>0&&this.compra.totalDocumento!==i,"N\xE3o \xE9 permitido finalizar a compra se o valor total difere da soma das parcelas!"),$utils.verificarErro(this.compraCondicoesDePagamento.length===0,'Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!')}return this.compra.operacao==="Nota de Entrada"&&($utils.verificarErro(!this.compra.notaNumero,"N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!"),$utils.verificarErro(!this.compra.notaSerie,"N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!"),$utils.verificarErro(!this.compra.naturezaOperacao,"N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!"),$utils.verificarErro(!this.compra.dataCompra,"N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!"),$utils.verificarErro(!this.compra.chaveAcesso,"N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!")),!0}catch(i){return $q.notifyError("Ocorreu um erro na valida\xE7\xE3o de campos",i),!1}},async finalizar_click(){if(!await this.validaCampos())return;let i=!this.compra.naoGerarFinanceiro;await $tryLoading(async()=>{this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.provisaoCompra=i?1:void 0,await this.finalizarItens(),i?await this.gerarFinanceiro():(this.compraTitulos=[],this.compraMovimentacoes=[]),await this.salvar(),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi finalizada com sucesso!":"O Pedido de Compra foi finalizada com sucesso!"),i&&$q.notifyPositive("Provisionamento gerado com sucesso!")},{mensagem:"Finalizando Compra..."})},finalizarItens(){var s,l;let i=1,e=0,m=0,I=!1;const o=this.compra;if(o.subTotalProduto>0&&(o.tipoFrete==="FOB"&&o.freteSeparado===0&&(e=(o.valorFrete||0)+(o.valorSeguro||0)),i=((o.subTotalProduto||0)+(o.valorOutrasDespesas||0)-(o.totalDesconto||0)+(e||0))/(o.subTotalProduto||1)),m=this.compraItens.reduce((a,c)=>a+c.valorIcmsSt,m),m!==o.valorIcmsSt&&(I=!0),o.operacao==="Nota de Entrada")for(const a of this.compraItens)I&&(a.valorIcmsSt=o.valorIcmsSt*((a==null?void 0:a.total)||0)/(o.subTotalProduto>0?o.subTotalProduto:1)),a.valorFreteRateado=o.valorFrete*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),a.valorSeguroRateado=o.valorSeguro*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),a.valorOutrasDespesasRateado=(o.valorOutrasDespesas||0)*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),a.descontoTotalRateado=(o.totalDesconto||0)*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),(a==null?void 0:a.valorIcmsSt)-(a==null?void 0:a.valorIcms)>0&&((a==null?void 0:a.valorIcmsSt)||0)-((a==null?void 0:a.valorIcms)||0),a.valorRealTotal=((a==null?void 0:a.total)||0)*i+((a==null?void 0:a.valorIpi)||0)+((a==null?void 0:a.valorIcms)||0),a.valorRealTotalImpostos=((a==null?void 0:a.total)||0)+a.valorFreteRateado+a.valorSeguroRateado+a.valorOutrasDespesasRateado-a.descontoTotalRateado+((a==null?void 0:a.valorIpi)||0)+((a==null?void 0:a.valorIcmsSt)||0),a.valorReal=a.valorRealTotalImpostos/((a==null?void 0:a.quantidade)||1),a.valorCustoReposicao=((s=this.produtos[a.idItem])==null?void 0:s.valorCustoReposicao)||0;if(o.operacao==="Pedido de Compra")for(const a of this.compraItens){I&&(a.valorIcmsSt=$utils.arredondar(o.valorIcmsSt*(a.total||0)/(o.subTotalProduto>0?o.subTotalProduto:1))),a.valorFreteRateado=$utils.arredondar((o.valorFrete||0)*(a.total||0)/(o.subTotalProduto||1),4),a.valorSeguroRateado=$utils.arredondar((o.valorSeguro||0)*(a.total||0)/(o.subTotalProduto||1),4),a.valorOutrasDespesasRateado=$utils.arredondar((o.valorOutrasDespesas||0)*(a.total||0)/(o.subTotalProduto||1),4),a.descontoTotalRateado=$utils.arredondar((o.totalDesconto||0)*(a.total||0)/(o.subTotalProduto||1),4);let c=0;a.valorIcmsSt-a.valorIcms>0&&(c=$utils.arredondar((a.valorIcmsSt||0)-(a.valorIcms||0),2)),a.valorRealTotal=$utils.arredondar((a.total||0)*i+(a.valorIpi||0)+(c>0?c:0),2),a.valorRealTotalImpostos=$utils.arredondar((a.total||0)+a.valorFreteRateado+a.valorSeguroRateado+a.valorOutrasDespesasRateado-a.descontoTotalRateado+(a.valorIpi||0)+(a.valorIcmsSt||0),4),a.valorReal=$utils.arredondar(a.valorRealTotalImpostos/(a.quantidade||1),4),a.valorCustoReposicao=$utils.arredondar(((l=this.produtos[a.idItem])==null?void 0:l.valorCustoReposicao)||0,2)}},async transformarEmNotaDeEntrada_click(){this.compra.operacao==="Pedido de Compra"&&await $tryLoading(async()=>{var m;const i=this.compraItens.map(({idItem:I})=>I).filter(Boolean),e=await $db.hibrido.lista({table:"itemFornecedor",whereIn:{idItem:i},whereFilter:{idContato:this.compra.idContato}});for(const I of this.compraItens)if(!e.some(({idItem:o})=>o===I.idItem)){const o={id:$utils.uuid(),idItem:I.idItem,idContato:this.compra.idContato,referencia:"",descricao:I.descricaoItem};await $db.hibrido.grava("itemFornecedor",{atual:o,original:{}})}for(const I of this.compraTitulos)I.formaDePagamento=(m=this.compra.formaDePagamento)!=null?m:"";this.compra.operacao="Nota de Entrada",this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.salvar(),$q.notifyPositive("Nota de Entrada gerada com sucesso!")},{mensagem:"Processando..."})},async mostrar({id:i}){this.visivel=!0;const e=$utils.logarIni("ComprasFicha");await $tryLoading(async()=>{this.compra.id=i,await this.atualizar()}),$utils.logarFim(e,1)},fechar(){this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.produtos=[],this.limpaCampos(this),this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.visivel=!1},async abrirModalEmpresa(){const i={ativo:!0,empresas:!0},e=await $g.promptContato.show({filtro:i,placeholder:"Selecione"});if(!e)return;let m=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[e.id]||await this.carregarContatos([e.id]),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=m.InscricaoMunicipalEmpresa},async abrirModalComprador(){const i=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});i.id&&(this.compra.idContatoComprador=i.id),this.contatos[i.id]||await this.carregarContatos([i.id])},async abrirModalFornecedor(){const i={ativo:!0},e=await $g.promptContato.show({filtro:i,placeholder:"Selecione o fornecedor"});if(!e)return e;const m=await $db.contatoTelefone.le({idContato:e.id}),I=await $db.contatoEndereco.le({idContato:e.id}),o=m.find(a=>a.tipoTelefone==="Principal"||a.tipoTelefone==="WhatsApp")||m[0]||null,s=I.find(a=>a.grupo==="Principal")||I[0]||null;let l;return s&&Object.keys(s).length>0&&(l=`${s.logradouro}, ${s.numero} ${s.complemento} - ${s.bairro} - ${s.municipio}/${s.uf}`),e.id&&(this.compra.idContato=e.id,this.compra.descricaoContato=e.nome,this.compra.numeroDocumentoContato=e.numeroDocumentoNacional,this.compra.emailContato=(e==null?void 0:e.email)||null,this.compra.regimeContato=(e==null?void 0:e.regime)||null,this.compra.telefoneContato=(o==null?void 0:o.telefone)||null,this.compra.descricaoContatoEndereco=l||null),this.contatos[e.id]||await this.carregarContatos([e.id]),e},async abrirModalVendedor(){const i=(await $db.contato.leFilhos(this.compra.idContato)).map(m=>m.id),e=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:i}});e.id&&(this.compra.idContatoVendedor=e.id),this.contatos[e.id]||await this.carregarContatos([e.id])},async abrirModalTransportador(){const i=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});i.id&&(this.compra.idContatoTransportadora=i.id),this.contatos[i.id]||await this.carregarContatos([i.id])},async selecionarContato(i){const{placeholder:e,filtro:m}={placeholder:"Selecione o contato",filtro:{ativo:!0},...i},I=await $g.promptContato.show({filtro:m,placeholder:e});if(!I)throw new Error("Contato n\xE3o selecionado");return I},async adicionarItem(){let i={},e=[];for(const m of e)i[m.idItem]={item:await $db.hibrido.le({table:"item",id:m.idItem}),quantidade:m.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},trocarItens(i){const e=Object.keys(i)[0],m=i[e].item;this.produtos[e]=m},async selecionarItens(i){var e,m;for(const I in i){let o=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",whereFilter:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:I}});o=o[0];const s=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((e=s.find(u=>u.id))==null?void 0:e.valor);const l=i[I].item||{},a=((m=(await $db.hibrido.lista({table:"itemFornecedor",whereFilter:{idItem:l.id}}))[0])==null?void 0:m.referencia)||null,c=i[I].quantidade||0,v=(l==null?void 0:l.valorCustoReposicao)||(o==null?void 0:o.valorCustoMedio)||0;let w=this.compraItens.find(u=>u.idItem===I);const b=(await $erp().cfop.where({cfop:5102}).toArray())[0],f=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral");if(w)w.quantidade=$utils.arredondar(c,4),w.quantidadeRealizado=$utils.arredondar(c,4),w.subTotal=$utils.arredondar(v,2),w.total=$utils.arredondar(c*v,2);else{const u={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:l.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:l.id,referencia:l.referencia,referenciaFornecedor:a,ncm:l.ncm||null,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:b==null?void 0:b.id,idPlanoContaEstoque:f==null?void 0:f.id,quantidade:$utils.arredondar(c,4),quantidadeRealizado:$utils.arredondar(c,4),status:"Digita\xE7\xE3o",tipoItem:l.tipo,subTotal:$utils.arredondar(v,2),total:$utils.arredondar(c*v,2),unidade:l.unidade,valorCustoMedio:(o==null?void 0:o.valorCustoMedio)||0,valorItem:v,valorOriginal:v,observacao:""};this.compraItens.push(u),await this.carregarItens([l.id])}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let u in this.compraItens)this.compra.subTotal+=this.compraItens[u].total,this.compra.subTotalProduto+=this.compraItens[u].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},calcularTotaisItem(i,e){const m=$utils.clonar(this.compraItens[i]);m.valorOriginal;const I=m.quantidade||0;let o=m.valorItem||0,s=m.descontoPercentualItem||0,l=m.descontoItem||0,a=m.subTotal||0,c=m.total||0;e==="descontoPercentualItem"&&((s<0||s>100)&&(s=0),l=o*s/100,a=o-l),e==="descontoItem"&&((l<0||l>o)&&(l=0),s=l/o*100,a=o-l),e==="valorItem"&&(l>o&&(l=0,s=0),s=l/o*100,a=o-l),e==="subTotal"&&((a<0||a>o)&&(a=o),l=o-a,s=l/o*100),c=I*a,m.valorItem=o,m.descontoItem=l,m.descontoPercentualItem=s,m.subTotal=a,m.total=c,this.compraItens[i]=m,this.calcularTotais("totalDesconto")},calcularTotais(i,e,m){const I=e||$utils.clonar(this.compra),o=m||this.compraItens;let s=0,l=0,a=0,c=I.totalDesconto||0,v=I.totalPercentualDesconto||0,w=I.valorFrete||0,b=I.valorSeguro||0,f=I.valorOutrasDespesas||0,u=0,k=0,g=0,y=0,n=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const _ of o)s+=_.total,u+=_.valorBaseIcms||0,k+=_.valorIcms||0,g+=_.valorBaseIcmsSt||0,y+=_.valorIcmsSt||0,n+=_.valorIpi||0;i==="totalPercentualDesconto"&&(this.erroDesconto=!1,(v<0||v>100)&&(this.erroDesconto=!0),c=s*v/100),i==="totalDesconto"&&(this.erroDesconto=!1,(c<0||c>s)&&(this.erroDesconto=!0),v=c/s*100),w<0&&(this.erroFrete=!0),w=I.tipoFrete==="FOB"?w:0,b<0&&(this.erroSeguro=!0),b=I.tipoFrete==="FOB"?b:0,f<0&&(this.erroOutrasDespesas=!0),I.calcularTributacao||(u=0,k=0,g=0,y=0),I.totalComImposto||(n=0),l=s-c+w+b+f,a=l+n+y,I.valorBaseIcms=$utils.arredondar(u,2),I.valorIcms=$utils.arredondar(k),I.valorBaseIcmsSt=$utils.arredondar(g),I.valorIcmsSt=$utils.arredondar(y),I.valorIpi=$utils.arredondar(n),I.totalDesconto=$utils.arredondar(c),I.totalPercentualDesconto=$utils.arredondar(v),I.subTotalProduto=$utils.arredondar(s),I.totalProduto=$utils.arredondar(s)-$utils.arredondar(c),I.subTotal=$utils.arredondar(l),I.totalDocumento=$utils.arredondar(a),e||(this.compra=I)},limpaCampos(i){i.compra={},i.compraOriginal={},i.compraItens=[],i.compraItensOriginal=[],i.compraCondicoesDePagamento=[],i.compraCondicoesDePagamentoOriginal=[],i.compraTitulos=[],i.compraTitulosOriginal=[],i.compraMovimentacoes=[],i.compraMovimentacoesOriginal=[],i.compraDocumentoXml=[],i.compraDocumentoXmlOriginal=[],i.dataPrevistaEntrega="",i.horaPrevistaEntrega=""},async salvar(){this.compra.totalComImposto&&delete this.compra.totalComImposto;for(const e of this.compraItens)e.dataHoraFinalizado=this.compra.dataHoraFinalizado,e.status=this.compra.status;const i=[];this.compra.id?await $db.hibrido.preGrava(i,"documento",{atual:this.compra,original:this.compraOriginal}):this.compraOriginal.id&&await $db.hibrido.preRemove(i,"documento",this.compraOriginal),await $db.hibrido.preGravaLista(i,"documentoItem",{atual:this.compraItens,original:this.compraItensOriginal}),await $db.hibrido.preGravaLista(i,"documentoCondicaoPagamento",{atual:this.compraCondicoesDePagamento,original:this.compraCondicoesDePagamentoOriginal}),await $db.hibrido.preGravaLista(i,"financeiroTitulo",{atual:this.compraTitulos,original:this.compraTitulosOriginal}),await $db.hibrido.preGravaLista(i,"financeiroMovimentacao",{atual:this.compraMovimentacoes,original:this.compraMovimentacoesOriginal}),await $db.hibrido.preGravaLista(i,"documentoXML",{atual:this.compraDocumentoXml,original:this.compraDocumentoXmlOriginal}),await $db.hibrido.enviaLote(i),this.compra.totalComImposto=!0,this.calculaKardex()},async calculaKardex(){const i=$utils.logarIni("calculaKardex"),e=this.compraItens.map(({idItem:m})=>m).filter(Boolean);try{e.length&&await $utils.geeksApi({calculaKardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idsItem:e}})}catch(m){console.error(`Erro ao calcular Kardex
`,m)}$utils.logarFim(i,e.length)},async reabrir_click(){var e;const i=(e=this.compraTitulos)!=null&&e.length?this.compra.operacao==="Nota de Entrada"?"<strong>A movimenta\xE7\xE3o financeira ser\xE1 retornada ao status de provisionada!</strong>":"<strong>O Financeiro ser\xE1 apagado!</strong>":"";!await $q.dialogSimNao({title:"Reabertura",message:`Deseja reabrir o documento?<br/>${i}`,html:!0})||await $tryLoading(async()=>{await this.retornarParaDigitacao(),await this.salvar(),await this.atualizar(),$q.notifyPositive("Documento reaberto para digita\xE7\xE3o!")},{mensagem:"Reabrindo..."})},async retornarParaDigitacao(){$utils.verificarErro(this.compra.status!=="Finalizado","N\xE3o \xE9 poss\xEDvel realizar esta opera\xE7\xE3o em documento n\xE3o finalizado.");const i=this.compraTitulos.filter(({dataPagamento:e})=>e);$utils.verificarErro(i.length,"N\xE3o \xE9 poss\xEDvel excluir o Financeiro. Parcelas provisionadas j\xE1 pagas!"),this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",this.compra.operacao==="Pedido de Compra"&&(this.compraTitulos=[],this.compraMovimentacoes=[]),this.compra.operacao==="Nota de Entrada"&&this.compraTitulos.forEach(e=>{e.formaDePagamento=`Provis\xE3o Pedido - ${e.formaDePagamento}`})},async removerPagamento_click(i){try{this.compraCondicoesDePagamento=this.compraCondicoesDePagamento.filter(e=>e.id!==i.id),this.compraCondicoesDePagamento.sort((e,m)=>{let I=new Date(e.dataVencimento),o=new Date(m.dataVencimento);return I-o}),await this.atualizaValorTotalPagamento({condicao:i,acao:"remover"})}catch(e){console.log(e.message)}},async gerarCondicoesDePagamento_click(){var i;try{let e=this.compra.id,m=this.compra.condicaoPagamento,I=(i=this.compra.notaNumero)!=null?i:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(e,m,I),this.compra.naoGerarFinanceiro&&(this.compraCondicoesDePagamento=[])}catch(e){console.log(e.message)}},async gerarParcelamento(i,e,m){this.compraCondicoesDePagamento=[];const I=$utils.clonar(this.compra),o=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`,s=Fe.formatDate(o)||I.dataHoraPrevisto,l=I.dataCompra||s||$utils.dataAtual(),a=e.split("/"),c=a.length,v=(I==null?void 0:I.freteSeparado)||0;let w=$utils.arredondar(I==null?void 0:I.totalDocumento,2);const b=$utils.arredondar(((I==null?void 0:I.valorFrete)||0)+((I==null?void 0:I.valorSeguro)||0),2);if(v&&(I==null?void 0:I.tipoFrete)==="FOB"&&b>0){let k;s?k=new Date(s):(k=new Date(l),k.setDate(k.getDate()+Number(a[0]||0)));let g={id:$utils.uuid(),idDocumento:I==null?void 0:I.id,dataVencimento:Fe.formatDate(k),valor:b,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.compraCondicoesDePagamento.push(g),w-=b}let f=0,u=$utils.arredondar(w/c,2);for(let k in a){let g=new Date(l);g.setDate(g.getDate()+Number(a[k]||0));let y={id:$utils.uuid(),idDocumento:I==null?void 0:I.id,dataVencimento:Fe.formatDate(g),valor:u,observacao:""};this.compraCondicoesDePagamento.push(y),f+=u||0}f=$utils.arredondar(f||0,2),w=$utils.arredondar(w||0,2),w!==f&&(this.compraCondicoesDePagamento[0].valor=$utils.arredondar(this.compraCondicoesDePagamento[0].valor+w-f,2)),this.valorTotalPagamento=v&&(I==null?void 0:I.tipoFrete)==="FOB"?$utils.arredondar(w+b,2):w},async gerarFinanceiro(){var l,a;const i=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral"),e=[];for(const c of this.compraItens){if(c.idPlanoContaEstoque===i.id)continue;const v=(c.total||0)-(c.descontoTotalRateado||0),w=e.findIndex(({idPlanoContaEstoque:b})=>b===c.idPlanoContaEstoque);w!==-1?e[w].valor+=v:e.push({idPlanoContaEstoque:c.idPlanoContaEstoque,idPlanoContaDestino:"",valor:v,porcentagem:0})}for(const c of e)c.valor=$utils.arredondar(c.valor),c.porcentagem=$utils.arredondar(c.valor/this.compra.totalDocumento,4);const m=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.freteaquisicao"),I=this.compraTitulos.filter(({dataPagamento:c})=>c);$utils.verificarErro(I.length,"N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");const o=Fe.formatDate(new Date().setHours(0,0,0,0));this.compraTitulos=[];for(const c in this.compraCondicoesDePagamento){const v=this.compraCondicoesDePagamento[c],w=[v.observacao,this.compra.codigoDocumento?`Pedido de Compra: ${this.compra.codigoDocumento}`:"",this.compra.notaNumero?`Nota nro: ${this.compra.notaNumero}`:""].filter(Boolean).join(" | "),b={id:$utils.uuid(),dataEmissao:o,dataCompetencia:o,dataVencimento:Fe.formatDate(new Date(v.dataVencimento).setHours(0,0,0,0)),dataVencimentoOriginal:Fe.formatDate(new Date(v.dataVencimento).setHours(0,0,0,0)),valor:$utils.arredondar(v.valor,2),tipoJuros:"dia",valorMulta:0,percentualJuros:0,documentoTipo:this.compra.operacao,parcela:`${Number(c)+1}/${this.compraCondicoesDePagamento.length}`,descricao:this.compra.operacao,observacao:w,formaDePagamento:this.compra.operacao==="Pedido de Compra"?`Provis\xE3o Pedido - ${(l=this.compra.formaDePagamento)!=null?l:""}`:(a=this.compra.formaDePagamento)!=null?a:"",receberPagar:0,valorOriginal:$utils.arredondar(v.valor,2),documentoVinculado:1,valorTotal:$utils.arredondar(v.valor,2),valorARealizar:$utils.arredondar(v.valor,2),valorDesconto:0,percentualDesconto:0,idEmpresa:this.compra.idEmpresa,idContato:(v==null?void 0:v.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:this.compra.idContato,idFinanceiroPlanoConta:v.observacao==="Valor Frete + Seguro"?m.id:i==null?void 0:i.id,documentoId:this.compra.id,idFinanceiroMovimentacaoAgrupamentoAutomatico:$utils.uuid(),cobrancaAtivo:1};this.compraTitulos.push(b)}const s=$utils.uuid();this.compraMovimentacoes=[];for(const c of e){const v={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:i.id,dataEmissao:o,valorCredito:this.compra.totalDocumento*c.porcentagem,valorDebito:0,descricao:i.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:o,dataVencimento:o,dataMovimento:o,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(v);const w=await $db.financeiroPlanoConta.leCache({id:c.idPlanoContaEstoque}),b={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:c.idPlanoContaEstoque,dataEmissao:o,valorCredito:0,valorDebito:this.compra.totalDocumento*c.porcentagem,descricao:w.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:o,dataVencimento:o,dataMovimento:o,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(b)}},async atualizaValorTotalPagamento({condicao:i,acao:e}){!i||e==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-i.valor)},async ajustarPrevisaoEntrega(i){i==="alterar"&&(this.alterarPrevisaoEntrega=!0),i==="salvar"&&(await $tryLoading(async()=>{const e=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;$utils.verificarErro(!this.dataPrevistaEntrega&&this.horaPrevistaEntrega,"\xC9 necess\xE1rio preencher uma data em conjunto com a hora."),Fe.formatDate(e)!==Fe.formatDate(this.compra.dataHoraPrevisto)?(this.compra.dataHoraPrevisto=Fe.formatDate(e)||"",await this.salvar(),await this.atualizar(),$q.notifyPositive("A previs\xE3o foi salva com sucesso")):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")}),this.alterarPrevisaoEntrega=!1)},dialogImprimirEtiquetas(i,e){this.$emit("dialogImprimirEtiquetas",{acao:i,item:e})},resize(){this.tela={width:$utils.tela("ComprasFicha").width,pageWidth:$utils.tela("ComprasFichaPage").width}}}},Wt={id:"Fatura",class:"bg-white rounded-borders"},Xt={class:"bg-grey-2 rounded-borders q-px-xs"},Qt={class:"CompraItem bg-white rounded-borders q-px-xs q-mb-sm"},Kt={class:"bg-grey-2 rounded-borders q-pa-sm"},Yt={class:"flex items-center justify-center",style:{height:"40px"}},Jt={class:"flex items-center justify-center",style:{height:"40px"}},ea={class:"flex items-center justify-center",style:{height:"40px"}},ta={class:"text-weight-bold"},aa={class:"text-weight-bold"},oa={class:"text-weight-bold"};function ra(i,e,m,I,o,s){const l=pe("g-label"),a=pe("g-col"),c=pe("Badge"),v=pe("BadgeCopiarUid"),w=pe("g-row"),b=pe("avatar"),f=pe("campo"),u=pe("badge"),k=pe("badgeCopiarUid"),g=pe("SeletorItem"),y=pe("ModalEditarProdutoCompras"),n=pe("PromptItemV2"),_=xt("mask");return L(),Ie(De,null,[t(Le,{modelValue:i.visivel,"onUpdate:modelValue":e[40]||(e[40]=h=>i.visivel=h),persistent:"",maximized:"",onKeyup:mt(s.fechar,["esc"]),id:"ComprasFicha"},{default:r(()=>[t(je,{view:"hHh lpR lFr",container:"",class:"bg-light"},{default:r(()=>[t(wt,{onResize:e[0]||(e[0]=h=>s.resize())}),t(He,null,{default:r(()=>[t(Pe,null,{default:r(()=>[t(ce,{onClick:s.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),t(Re,null,{default:r(()=>[z(ae(i.compra.operacao),1)]),_:1}),be(t(ce,{onClick:s.salvar_click,unelevated:"",label:"Salvar",color:"white","text-color":"primary",class:"q-ml-sm"},null,8,["onClick"]),[[Be,i.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),t(Ze,null,{default:r(()=>[t(Ge,{id:"ComprasFichaPage",class:"u-container q-py-md"},{default:r(()=>[ve("div",Wt,[t(w,{gutter:"sm"},{default:r(()=>[t(a,{col:"12 sm12 md6"},{default:r(()=>[t(w,{items:"center",justify:"end",class:"hideondesktop"},{default:r(()=>[t(a,{col:"xs-shrink",order:"1 sm0"},{default:r(()=>[be(t(l,{caption:"",tip:`Emitido \xE1s ${i.$filters.hora(i.compra.dataHoraEmissao)}`},{default:r(()=>[t(ie,{name:"mdi-calendar-today",size:"sm"}),z(" "+ae(i.$filters.data(i.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Be,i.compra.dataHoraEmissao]])]),_:1}),t(a,{col:"xs-shrink",order:"1 sm0"},{default:r(()=>[be(t(l,{caption:"",tip:`Finalizado \xE1s ${i.$filters.hora(i.compra.dataHoraFinalizado)}`},{default:r(()=>[t(ie,{name:"mdi-calendar-today",size:"xs"}),z(" "+ae(i.$filters.data(i.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Be,i.compra.dataHoraFinalizado]])]),_:1}),t(a,{col:"xs12 sm-shrink",order:"0 sm1"},{default:r(()=>[t(w,{items:"center",justify:"end"},{default:r(()=>[t(c,{rotulo:i.compra.status,escuro:i.compra.status!=="Digita\xE7\xE3o",cor:i.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",class:"q-ml-sm"},null,8,["rotulo","escuro","cor"]),t(v,{id:i.compra.id,numero:i.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),t(ce,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:r(()=>[t(Ue,null,{default:r(()=>[be((L(),J(Ne,{link:"",separator:""},{default:r(()=>[i.alterarPrevisaoEntrega?(L(),J(fe,{key:1,clickable:"",onClick:e[2]||(e[2]=h=>s.ajustarPrevisaoEntrega("salvar"))},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"local_shipping"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[43]||(e[43]=[z("Salvar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:1})):(L(),J(fe,{key:0,disable:i.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:e[1]||(e[1]=h=>s.ajustarPrevisaoEntrega("alterar"))},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"local_shipping"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[42]||(e[42]=[z("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:1},8,["disable"])),t(fe,{onClick:e[3]||(e[3]=h=>s.dialogImprimirEtiquetas("adicionar",i.compra)),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[44]||(e[44]=[z(" Adicionar Etiquetas ")])),_:1})]),_:1})]),_:1}),t(fe,{onClick:e[4]||(e[4]=h=>s.dialogImprimirEtiquetas("impressao",i.compra)),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[45]||(e[45]=[z(" Imprimir Etiquetas ")])),_:1})]),_:1})]),_:1})]),_:1})),[[Ee]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(w,null,{default:r(()=>[t(a,{col:"12 sm6"},{default:r(()=>[t(w,null,{default:r(()=>[t(a,{col:"xs-shrink"},{default:r(()=>{var h,D;return[t(b,{imagem:(h=i.contatos[i.compra.idContato])==null?void 0:h.imagem,rotulo:(D=i.contatos[i.compra.idContato])==null?void 0:D.apelido,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:1}),t(a,{col:"xs"},{default:r(()=>{var h;return[t(f,{modelValue:(h=i.contatos[i.compra.idContato])==null?void 0:h.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){s.abrirModalFornecedor()}}],disable:i.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1})]),_:1})]),_:1}),t(a,{col:"12 sm6"},{default:r(()=>{var h;return[t(f,{modelValue:(h=i.contatos[i.compra.idContatoVendedor])==null?void 0:h.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),t(a,{col:"12 sm6"},{default:r(()=>{var h;return[t(f,{modelValue:(h=i.contatos[i.compra.idEmpresa])==null?void 0:h.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){s.abrirModalEmpresa()}}],disable:i.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1}),t(a,{col:"12 sm6"},{default:r(()=>{var h;return[t(f,{modelValue:(h=i.contatos[i.compra.idContatoComprador])==null?void 0:h.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),t(a,{col:"12 sm6"},{default:r(()=>{var h;return[t(f,{modelValue:(h=i.contatos[i.compra.idContatoTransportadora])==null?void 0:h.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),t(a,{col:"12 sm6"},{default:r(()=>[t(w,null,{default:r(()=>[t(a,{col:"7"},{default:r(()=>[t(Xe,{modelValue:i.dataPrevistaEntrega,"onUpdate:modelValue":e[5]||(e[5]=h=>i.dataPrevistaEntrega=h),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),t(a,{col:"5"},{default:r(()=>[t(Xe,{modelValue:i.horaPrevistaEntrega,"onUpdate:modelValue":e[6]||(e[6]=h=>i.horaPrevistaEntrega=h),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(a,{col:"12 sm12 md6"},{default:r(()=>[t(w,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:r(()=>[t(a,{col:"shrink"},{default:r(()=>[be(t(l,{caption:"",tip:`Emitido \xE1s ${i.$filters.hora(i.compra.dataHoraEmissao)}`},{default:r(()=>[t(ie,{name:"mdi-calendar-today",size:"xs"}),z(" "+ae(i.$filters.data(i.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Be,i.compra.dataHoraEmissao]])]),_:1}),t(a,{col:"shrink"},{default:r(()=>[be(t(l,{caption:"",tip:`Finalizado \xE1s ${i.$filters.hora(i.compra.dataHoraFinalizado)}`},{default:r(()=>[t(ie,{name:"mdi-calendar",size:"xs"}),z(" "+ae(i.$filters.data(i.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Be,i.compra.dataHoraFinalizado]])]),_:1}),t(a,{col:"12 sm-shrink"},{default:r(()=>[t(w,{justify:"end",items:"center"},{default:r(()=>[t(u,{rotulo:i.compra.status,escuro:i.compra.status!=="Digita\xE7\xE3o",cor:i.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",class:"q-ml-sm"},null,8,["rotulo","escuro","cor"]),t(k,{id:i.compra.id,numero:i.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),t(ce,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:r(()=>[t(Ue,null,{default:r(()=>[be((L(),J(Ne,{link:"",separator:""},{default:r(()=>[i.alterarPrevisaoEntrega?(L(),J(fe,{key:1,clickable:"",onClick:e[8]||(e[8]=h=>s.ajustarPrevisaoEntrega("salvar"))},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"local_shipping"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[47]||(e[47]=[z("Salvar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:1})):(L(),J(fe,{key:0,disable:i.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:e[7]||(e[7]=h=>s.ajustarPrevisaoEntrega("alterar"))},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"local_shipping"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[46]||(e[46]=[z("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:1},8,["disable"])),t(fe,{onClick:e[9]||(e[9]=h=>s.dialogImprimirEtiquetas("adicionar",i.compra)),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[48]||(e[48]=[z(" Adicionar Etiquetas ")])),_:1})]),_:1})]),_:1}),t(fe,{onClick:e[10]||(e[10]=h=>s.dialogImprimirEtiquetas("impressao",i.compra)),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[49]||(e[49]=[z(" Imprimir Etiquetas ")])),_:1})]),_:1})]),_:1})]),_:1})),[[Ee]])]),_:1})]),_:1})]),_:1})]),_:1}),t(a,{col:"12"},{default:r(()=>[t(f,{modelValue:i.compra.observacao,"onUpdate:modelValue":e[11]||(e[11]=h=>i.compra.observacao=h),rotulo:"Observa\xE7\xE3o",rows:"4","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{gutter:"sm"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[i.exibeInfNota?(L(),J(ot,{key:0,class:"notaEntrada bg-grey-2","default-opened":i.compra.notaNumero>0||i.documentoNovo,"header-class":"q-px-xs"},{header:r(()=>[t(Y,null,{default:r(()=>[t(l,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:r(()=>e[50]||(e[50]=[z("Nota de Entrada")])),_:1})]),_:1})]),default:r(()=>[t(w,{gutter:"sm"},{default:r(()=>[t(a,{col:"12 sm6 md3"},{default:r(()=>[be(t(f,{modelValue:i.compra.notaNumero,"onUpdate:modelValue":e[12]||(e[12]=h=>i.compra.notaNumero=h),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"]),[[_,"##########"]])]),_:1}),t(a,{col:"12 sm6 md3"},{default:r(()=>[t(f,{modelValue:i.compra.notaSerie,"onUpdate:modelValue":e[13]||(e[13]=h=>i.compra.notaSerie=h),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm6 md3"},{default:r(()=>[t(f,{modelValue:i.compra.naturezaOperacao,"onUpdate:modelValue":e[14]||(e[14]=h=>i.compra.naturezaOperacao=h),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm6 md3"},{default:r(()=>[t(f,{modelValue:i.compra.dataCompra,"onUpdate:modelValue":e[15]||(e[15]=h=>i.compra.dataCompra=h),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12"},{default:r(()=>[t(f,{modelValue:i.compra.chaveAcesso,"onUpdate:modelValue":e[16]||(e[16]=h=>i.compra.chaveAcesso=h),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1},8,["default-opened"])):re("",!0)]),_:1})]),_:1}),t(w,{gutter:"sm"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[ve("div",Xt,[t(w,null,{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(l,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:r(()=>[e[51]||(e[51]=z(" Carrinho ")),t(Ot,{flat:"",icon:"mdi-filter",size:"md",color:"tertiary",direction:"left",class:"float-right",padding:"xs"},{default:r(()=>[t(Xe,{modelValue:i.termoBusca,"onUpdate:modelValue":[e[17]||(e[17]=h=>i.termoBusca=h),e[18]||(e[18]=h=>s.buscar())],debounce:500,label:"Buscar","clear-icon":"close",standout:"",outlined:"",clearable:"",dense:"",class:"bg-white",style:_t(`width: ${i.tela.pageWidth>=768?i.tela.pageWidth/2:i.tela.pageWidth-80}px;`)},{prepend:r(()=>[t(ie,{name:"mdi-filter"})]),_:1},8,["modelValue","style"])]),_:1}),t(ce,{onClick:e[19]||(e[19]=h=>s.adicionarItem()),disable:i.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(L(!0),Ie(De,null,Te(i.compraItens,(h,D)=>{var x;return be((L(),J(a,{key:D,col:"12"},{default:r(()=>[ve("div",Qt,[t(w,{items:"center",justify:"between"},{default:r(()=>[t(a,{col:"auto",order:"0 sm0"},{default:r(()=>{var F;return[t(b,{imagem:(F=i.produtos[h.idItem])==null?void 0:F.imagem,rotulo:h.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:2},1024),t(a,{col:"12 sm",order:"2 sm1"},{default:r(()=>{var F,B;return[t(g,{modelValue:h.idItem,"onUpdate:modelValue":$=>h.idItem=$,onSelecionarItens:s.trocarItens,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Produto",class:"q-mb-xs"},null,8,["modelValue","onUpdate:modelValue","onSelecionarItens","somente-leitura"]),t(l,{caption:"",inline:"",class:"q-mr-xs"},{default:r(()=>{var $,T;return[z(ae((T=($=i.produtos[h.idItem])==null?void 0:$.marca)!=null?T:""),1)]}),_:2},1024),(F=i.produtos[h.idItem])!=null&&F.referencia?(L(),J(u,{key:0,rotulo:(B=i.produtos[h.idItem])==null?void 0:B.referencia,denso:""},null,8,["rotulo"])):re("",!0)]}),_:2},1024),t(a,{col:"shrink",order:"1 sm2"},{default:r(()=>[t(ce,{onClick:F=>s.editarProduto(h),icon:"edit",color:"primary",disable:i.compra.status!=="Digita\xE7\xE3o",round:"",dense:"",flat:""},null,8,["onClick","disable"]),t(ce,{onClick:F=>s.removerItem(h),icon:"delete",color:"tertiary",disable:i.compra.status!=="Digita\xE7\xE3o",round:"",dense:"",flat:""},null,8,["onClick","disable"]),t(ce,{disable:i.compra.status!=="Digita\xE7\xE3o",round:"",dense:"",flat:"",icon:"more_vert",color:"tertiary"},{default:r(()=>[i.compra.status==="Digita\xE7\xE3o"?(L(),J(Ue,{key:0},{default:r(()=>[be((L(),J(Ne,{link:"",separator:""},{default:r(()=>[(L(!0),Ie(De,null,Te(i.comprasMigrar,F=>(L(),J(fe,{key:F.id,onClick:B=>s.migrarParaOutraCompra(h,F),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"mdi-folder-move"})]),_:1}),t(Y,null,{default:r(()=>[z(ae(`Migrar para Compra #${F.numero||F.id.slice(-6)}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(fe,{onClick:F=>s.migrarParaOutraCompra(h),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"mdi-folder-move"})]),_:1}),t(Y,null,{default:r(()=>e[52]||(e[52]=[z("Migrar para nova Compra")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[Ee]])]),_:2},1024)):re("",!0)]),_:2},1032,["disable"])]),_:2},1024)]),_:2},1024),t(w,null,{default:r(()=>[t(a,{col:"4 md"},{default:r(()=>[t(f,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:h.valorItem,"onUpdate:modelValue":F=>h.valorItem=F,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",onBlur:F=>s.calcularTotaisItem(D,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),t(a,{col:"4 md"},{default:r(()=>[t(w,{items:"center"},{default:r(()=>[t(a,{col:"shrink"},{default:r(()=>[t(ie,{name:"mdi-minus",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:h.descontoPercentualItem,"onUpdate:modelValue":F=>h.descontoPercentualItem=F,outlined:"",suffix:"%","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",onBlur:F=>s.calcularTotaisItem(D,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(a,{col:"4 md"},{default:r(()=>[t(f,{dense:"",tipo:"decimal",modelValue:h.descontoItem,"onUpdate:modelValue":F=>h.descontoItem=F,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:F=>s.calcularTotaisItem(D,"descontoItem"),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),t(a,{col:"6 md"},{default:r(()=>[t(w,{items:"center"},{default:r(()=>[t(a,{col:"shrink",class:"hideonmobile"},{default:r(()=>[t(ie,{name:"mdi-equal",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:h.subTotal,"onUpdate:modelValue":F=>h.subTotal=F,onBlur:F=>s.calcularTotaisItem(D,"subTotal"),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(a,{col:"6 md"},{default:r(()=>[t(w,{items:"center"},{default:r(()=>[t(a,{col:"shrink"},{default:r(()=>[t(ie,{name:"mdi-close",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{dense:"",max:"100",min:"0",outlined:"",modelValue:h.quantidade,"onUpdate:modelValue":F=>h.quantidade=F,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:F=>s.calcularTotaisItem(D),disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[53]||(e[53]=[z("Quantidade")])),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),t(a,{col:"12 md"},{default:r(()=>[t(w,{items:"center"},{default:r(()=>[t(a,{col:"shrink",class:"hideonmobile"},{default:r(()=>[t(ie,{name:"mdi-equal",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":"",modelValue:h.total,"onUpdate:modelValue":F=>h.total=F,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1024)),[[Be,!((x=i.layoutCompraItens[h.idItem])!=null&&x.visivel)]])}),128))]),_:1})])]),_:1})]),_:1}),t(w,{gutter:"sm"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[ve("div",Kt,[t(w,{items:"center",justify:"end"},{default:r(()=>[t(a,{col:"3 sm2 md-shrink",text:"bold"},{default:r(()=>e[54]||(e[54]=[z(" Calcular ")])),_:1}),t(a,{col:"9 sm10 md",text:"right"},{default:r(()=>[t($e,{modelValue:i.compra.calcularTributacao,"onUpdate:modelValue":[e[20]||(e[20]=h=>i.compra.calcularTributacao=h),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),t(a,{col:"6 md-shrink"},{default:r(()=>e[55]||(e[55]=[z(" Base ICMS ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:r(()=>[t(f,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:i.compra.valorBaseIcms,"onUpdate:modelValue":e[21]||(e[21]=h=>i.compra.valorBaseIcms=h),"somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"6 md-shrink"},{default:r(()=>e[56]||(e[56]=[z(" Valor ICMS ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:r(()=>[t(f,{dense:"",outlined:"",modelValue:i.compra.valorIcms,"onUpdate:modelValue":e[22]||(e[22]=h=>i.compra.valorIcms=h),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"6 md-shrink"},{default:r(()=>e[57]||(e[57]=[z(" Base ICMS ST ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:r(()=>[t(f,{dense:"",outlined:"",modelValue:i.compra.valorBaseIcmsSt,"onUpdate:modelValue":e[23]||(e[23]=h=>i.compra.valorBaseIcmsSt=h),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"6 md-shrink"},{default:r(()=>e[58]||(e[58]=[z(" ICMS ST ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:r(()=>[t(f,{dense:"",outlined:"",modelValue:i.compra.valorIcmsSt,"onUpdate:modelValue":e[24]||(e[24]=h=>i.compra.valorIcmsSt=h),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})])]),_:1})]),_:1}),t(w,{gutter:"md",items:"center",justify:"end"},{default:r(()=>[t(a,{col:"xs12 sm8 md4"},{default:r(()=>[t(w,{items:"center"},{default:r(()=>[t(a,{col:"3",text:"bold"},{default:r(()=>e[59]||(e[59]=[z(" Subtotal ")])),_:1}),t(a,{col:"xs",text:"right bold"},{default:r(()=>[z(ae(i.$filters.numero(i.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),t(ct,{class:"q-mb-md q-mt-xs"}),t(w,{items:"center"},{default:r(()=>[t(a,{col:"xs3"},{default:r(()=>e[60]||(e[60]=[z(" Desconto ")])),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{tipo:"decimal",decimals:"2",modelValue:i.compra.totalPercentualDesconto,"onUpdate:modelValue":e[25]||(e[25]=h=>i.compra.totalPercentualDesconto=h),onBlur:e[26]||(e[26]=h=>s.calcularTotais("totalPercentualDesconto")),suffix:"%",error:i.erroDesconto,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{tipo:"decimal",decimals:"2",modelValue:i.compra.totalDesconto,"onUpdate:modelValue":e[27]||(e[27]=h=>i.compra.totalDesconto=h),onBlur:e[28]||(e[28]=h=>s.calcularTotais("totalDesconto")),error:i.erroDesconto,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),t(w,{items:"center"},{default:r(()=>[t(a,{col:"xs3"},{default:r(()=>e[61]||(e[61]=[z(" Frete ")])),_:1}),t(a,{col:"xs"},{default:r(()=>[t(vt,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:i.compra.tipoFrete,"onUpdate:modelValue":[e[29]||(e[29]=h=>i.compra.tipoFrete=h),s.calcularTotais],dense:"",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),t(vt,{label:"FOB",val:"FOB",modelValue:i.compra.tipoFrete,"onUpdate:modelValue":[e[30]||(e[30]=h=>i.compra.tipoFrete=h),s.calcularTotais],dense:"",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorFrete,"onUpdate:modelValue":e[31]||(e[31]=h=>i.compra.valorFrete=h),onBlur:s.calcularTotais,error:i.erroFrete,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),t(w,{items:"center"},{default:r(()=>[t(a,{col:"xs3"},{default:r(()=>e[62]||(e[62]=[z(" Seguro ")])),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorSeguro,"onUpdate:modelValue":e[32]||(e[32]=h=>i.compra.valorSeguro=h),onBlur:s.calcularTotais,error:i.erroSeguro,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),t(w,{items:"center"},{default:r(()=>[t(a,{col:"xs5"},{default:r(()=>e[63]||(e[63]=[z(" Outras despesas ")])),_:1}),t(a,{col:"xs"},{default:r(()=>[t(f,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorOutrasDespesas,"onUpdate:modelValue":e[33]||(e[33]=h=>i.compra.valorOutrasDespesas=h),onBlur:s.calcularTotais,error:i.erroOutrasDespesas,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),t(ct,{class:"q-mt-md q-mb-xs"}),t(w,{items:"center"},{default:r(()=>[t(a,{col:"xs4",text:"bold"},{default:r(()=>e[64]||(e[64]=[z(" Total ")])),_:1}),t(a,{col:"xs",text:"right bold"},{default:r(()=>[z(ae(i.$filters.numero(i.compra.totalProduto,2)),1)]),_:1})]),_:1}),i.compra.totalComImposto?(L(),J(w,{key:0,items:"center"},{default:r(()=>[t(a,{col:"xs4",text:"bold"},{default:r(()=>e[65]||(e[65]=[z(" Total IPI ")])),_:1}),t(a,{col:"xs",text:"right bold"},{default:r(()=>[z(ae(i.$filters.numero(i.compra.valorIpi,2)),1)]),_:1})]),_:1})):re("",!0),t(w,{items:"center"},{default:r(()=>[t(a,{col:"xs5",text:"bold"},{default:r(()=>e[66]||(e[66]=[z(" Total c/ Impostos ")])),_:1}),t(a,{col:"xs-shrink"},{default:r(()=>[t($e,{disable:i.compra.status!=="Digita\xE7\xE3o",modelValue:i.compra.totalComImposto,"onUpdate:modelValue":[e[34]||(e[34]=h=>i.compra.totalComImposto=h),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),t(a,{col:"xs",text:"right bold"},{default:r(()=>[z(ae(i.$filters.numero(i.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{gutter:"sm"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(l,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:r(()=>e[67]||(e[67]=[z("Faturar")])),_:1})]),_:1}),t(a,{col:"12"},{default:r(()=>[t(f,{modelValue:i.compra.observacaoFaturamento,"onUpdate:modelValue":e[35]||(e[35]=h=>i.compra.observacaoFaturamento=h),rows:"4",tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento"},null,8,["modelValue"])]),_:1}),t(a,{mg:"md-y",col:"12"},{default:r(()=>[t(st,{ref:"formAdicionarPagamento"},{default:r(()=>[t(w,{items:"start",justify:"center"},{default:r(()=>[t(a,{col:"12 sm6 md"},{default:r(()=>[t(f,{modelValue:i.compra.formaDePagamento,"onUpdate:modelValue":e[36]||(e[36]=h=>i.compra.formaDePagamento=h),rules:i.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",outlined:"",rotulo:"Forma de pagamento"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),t(a,{col:"12 sm6 md"},{default:r(()=>[t(f,{modelValue:i.compra.condicaoPagamento,"onUpdate:modelValue":e[37]||(e[37]=h=>i.compra.condicaoPagamento=h),rules:i.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",outlined:"",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),t(a,{col:"shrink sm4 md",text:"bold"},{default:r(()=>[ve("div",Yt,[t($e,{modelValue:i.compra.freteSeparado,"onUpdate:modelValue":[e[38]||(e[38]=h=>i.compra.freteSeparado=h),s.calcularTotais],disable:i.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-mx-sm"},null,8,["modelValue","onUpdate:modelValue","disable"]),e[68]||(e[68]=z(" Frete Separado "))])]),_:1}),t(a,{col:"shrink sm4 md",text:"bold"},{default:r(()=>[ve("div",Jt,[t($e,{modelValue:i.compra.naoGerarFinanceiro,"onUpdate:modelValue":[e[39]||(e[39]=h=>i.compra.naoGerarFinanceiro=h),s.calcularTotais],disable:i.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-mx-sm"},null,8,["modelValue","onUpdate:modelValue","disable"]),e[69]||(e[69]=z(" N\xE3o gerar financeiro "))])]),_:1}),t(a,{col:"12 sm4 md",text:"center"},{default:r(()=>[ve("div",ea,[t(ce,{onClick:s.gerarCondicoesDePagamento_click,disable:i.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])])]),_:1})]),_:1})]),_:1},512)]),_:1}),be(t(a,{col:"12"},{default:r(()=>[t(l,{text:"sub1 medium"},{default:r(()=>e[70]||(e[70]=[z("Condi\xE7\xF5es de pagamento")])),_:1}),(L(!0),Ie(De,null,Te(i.compraCondicoesDePagamento,h=>(L(),J(Ne,{key:h.id},{default:r(()=>[t(w,{gutter:"sm",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:r(()=>[t(a,{col:"xs6 md-shrink"},{default:r(()=>[t(f,{modelValue:h.dataVencimento,"onUpdate:modelValue":D=>h.dataVencimento=D,rotulo:"Data vencimento","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(a,{col:"xs6 md2"},{default:r(()=>[t(f,{modelValue:h.valor,"onUpdate:modelValue":D=>h.valor=D,rotulo:"Valor",decimals:"2",zerosDireita:"2","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",align:"left",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(a,{col:"xs-grow"},{default:r(()=>[t(f,{modelValue:h.observacao,"onUpdate:modelValue":D=>h.observacao=D,rotulo:"Observa\xE7\xE3o","somente-leitura":i.compra.status!=="Digita\xE7\xE3o"||h.observacao==="Valor Frete + Seguro"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(a,{col:"xs-shrink",text:"right"},{default:r(()=>[t(ce,{onClick:D=>s.removerPagamento_click(h),color:"tertiary",flat:"",disable:i.compra.status!=="Digita\xE7\xE3o",icon:"delete",round:"",dense:""},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),i.valorTotalPagamento>0?(L(),J(w,{key:0,mg:"md-t",items:"center",justify:"center"},{default:r(()=>[t(a,{col:"shrink",text:"body2 bold"},{default:r(()=>[z(" Valor total: "+ae(i.$filters.numero(i.valorTotalPagamento,2)),1)]),_:1})]),_:1})):re("",!0)]),_:1},512),[[Be,i.compraCondicoesDePagamento.length>0]])]),_:1}),i.$db.usuario.desenvolvedor()?(L(),J(w,{key:0,gutter:"sm"},{default:r(()=>[t(a,{col:"12"},{default:r(()=>[t(ot,{onShow:i.showContabilidade,"expand-separator":"",dense:"","expand-icon-class":"q-px-sm","header-class":"q-pa-sm border-bottom",class:"bg-amber-2 border-full bordered-radius"},{header:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"credit_card",size:"sm"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[71]||(e[71]=[z("Contabilidade")])),_:1}),t(ue,{caption:""},{default:r(()=>e[72]||(e[72]=[z("Apenas desenvolvedores")])),_:1})]),_:1})]),default:r(()=>[i.compraTitulos.length?(L(),J(Ne,{key:0,class:"q-pa-xs"},{default:r(()=>[t(l,{icon:"list sm tertiary left",text:"sub2 medium"},{default:r(()=>e[73]||(e[73]=[z("Titulos")])),_:1}),(L(!0),Ie(De,null,Te(i.compraTitulos,h=>(L(),J(ot,{key:h.id,dense:"","hide-expand-icon":"","expand-separator":"","header-class":"q-pa-none border-bottom",class:"border-full"},{header:r(()=>[t(w,{gutter:"xs-x",width:"100%",class:"cursor-pointer"},{default:r(()=>[t(a,{col:"6 sm3 md2"},{default:r(()=>[t(f,{modelValue:h.dataVencimento,dense:"",borderless:"","somente-leitura":"",rotulo:"Data vencimento",tipo:"data"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"6 sm3 md2"},{default:r(()=>[t(f,{modelValue:h.dataPagamento||"A pagar",tipo:h.dataPagamento?"data":"texto",dense:"",borderless:"","somente-leitura":"",rotulo:"Data pagamento"},null,8,["modelValue","tipo"])]),_:2},1024),t(a,{col:"6 sm3 md2"},{default:r(()=>[t(f,{modelValue:h.parcela,"somente-leitura":"",borderless:"",align:"left",rotulo:"Parcela"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"6 sm6 md2"},{default:r(()=>[t(f,{modelValue:h.valor,"somente-leitura":"",borderless:"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"12 sm6 md2"},{default:r(()=>[t(f,{modelValue:h.formaDePagamento,borderless:"","somente-leitura":"",rotulo:"Forma de pagamento"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"12 sm12 md2"},{default:r(()=>[t(f,{modelValue:h.observacao,borderless:"","somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):re("",!0),i.compraMovimentacoes.length?(L(),J(Ne,{key:1,class:"q-pa-xs q-pt-lg"},{default:r(()=>[t(l,{icon:"list sm tertiary left",text:"sub2 medium"},{default:r(()=>e[74]||(e[74]=[z("Movimenta\xE7\xF4es")])),_:1}),(L(!0),Ie(De,null,Te(i.compraMovimentacoes,h=>(L(),J(ot,{key:h.id,dense:"","hide-expand-icon":"","expand-separator":"","header-class":"q-pa-none border-bottom",class:"border-full"},{header:r(()=>[t(w,{gutter:"xs-x",width:"100%",class:"cursor-pointer"},{default:r(()=>[t(a,{col:"6 sm12 md-grow"},{default:r(()=>[t(f,{modelValue:h.descricao,ocultarAjuda:"","somente-leitura":"",borderless:"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"6 sm md2"},{default:r(()=>[t(f,{modelValue:h.dataCompetencia,"somente-leitura":"",borderless:"",ocultarAjuda:"",dense:"",rotulo:"Data competencia",tipo:"data"},null,8,["modelValue"])]),_:2},1024),h.valorCredito?(L(),J(a,{key:0,col:"xs sm md2"},{default:r(()=>[t(f,{modelValue:h.valorCredito,"somente-leitura":"",borderless:"",ocultarAjuda:"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):re("",!0),h.valorDebito?(L(),J(a,{key:1,col:"xs sm md2"},{default:r(()=>[t(f,{modelValue:h.valorDebito,"somente-leitura":"",borderless:"",ocultarAjuda:"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):re("",!0),t(a,{col:"12 md-grow"},{default:r(()=>[t(f,{modelValue:h.observacao,ocultarAjuda:"",borderless:"","somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):re("",!0)]),_:1},8,["onShow"])]),_:1})]),_:1})):re("",!0)])]),_:1})]),_:1}),t(Qe,{class:"bg-white border-top"},{default:r(()=>[t(w,{gutter:"sm",items:"center",class:"u-container"},{default:r(()=>[t(a,{col:"12 sm",color:"text-tertiary"},{default:r(()=>[t(l,{text:"caption medium"},{default:r(()=>[e[75]||(e[75]=z(" Valor Total: ")),ve("span",ta,ae(i.$filters.numero(i.compra.totalDocumento,2)),1)]),_:1}),t(l,{text:"caption medium"},{default:r(()=>[e[76]||(e[76]=z(" SKU: ")),ve("span",aa,ae(s.skus),1),ve("span",oa,ae(s.quantidadeItens?` (${s.quantidadeItens})`:""),1)]),_:1})]),_:1}),t(a,{col:"12 sm-shrink",text:"right"},{default:r(()=>[i.compra.status==="Digita\xE7\xE3o"?(L(),J(ce,{key:0,onClick:s.excluir_click,flat:"",type:"submit",label:"Excluir",color:"white","text-color":"negative",class:"q-px-sm q-ml-sm"},null,8,["onClick"])):re("",!0),i.compra.status==="Digita\xE7\xE3o"?(L(),J(ce,{key:1,onClick:s.finalizar_click,unelevated:"",label:"Finalizar",color:"primary",type:"submit",class:"q-px-sm q-ml-sm"},null,8,["onClick"])):re("",!0),i.compra.status==="Finalizado"?(L(),J(ce,{key:2,onClick:s.reabrir_click,flat:"",label:"Reabrir",color:"tertiary",type:"submit",class:"q-px-sm q-ml-sm"},null,8,["onClick"])):re("",!0),i.compra.status==="Finalizado"&&i.compra.operacao==="Pedido de Compra"?(L(),J(ce,{key:3,onClick:s.transformarEmNotaDeEntrada_click,unelevated:"",type:"submit",color:"primary",label:`${i.tela.pageWidth>=768?"Transformar em Nota de Entrada":"Transf. Nota Entrada"}`,class:"q-px-sm q-ml-sm"},null,8,["onClick","label"])):re("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),t(y,{ref:"ModalEditarProdutoCompras",onSalvar:s.fecharEdicaoProduto},null,8,["onSalvar"]),t(n,{modelValue:i.adicionar.modal.value,"onUpdate:modelValue":e[41]||(e[41]=h=>i.adicionar.modal.value=h),filtro:{ativo:!0,idEmpresa:i.compra.idEmpresa},ref:"promptItem",habilitarQuantidade:!0,exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:s.selecionarItens},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var ia=lt(Gt,[["render",ra]]);const sa={components:{PromptItemV2:yt},data(){return{visivel:!1,termoBusca:"",compra:{},compraItensNaoVinculados:[],layoutCompra:[],edicaoGeral:{marca:"",grupo:"",subGrupo:"",percentualMarkup:0},mostrarItemModal:!1,idxItem:0,tela:{width:0},modalMarkup:{visivel:!1,idItem:"",custo:0,fator:0,lucro:0,markup:0,venda:0,origem:{}}}},emits:["atualizar","concluirImportacao"],computed:{produtosNaoVinculados(){return this.compra.documentosItem.reduce((i,e)=>i+(e.vinculado?0:1),0)},quantProdutos(){return this.compra.documentosItem.reduce((i,e)=>i+1,0)}},methods:{async abrir(i){await this.atualizar(i),this.visivel=!0},async fechar(){this.visivel=!1,this.termoBusca="",this.compra={},this.compraItensNaoVinculados=[],this.layoutCompra=[],this.edicaoGeral={marca:"",grupo:"",subGrupo:"",percentualMarkup:0}},async atualizar(i){this.compra=i;for(const e of this.compra.documentosItem)this.recalcular(e);this.compraItensNaoVinculados=this.compra.documentosItem.filter(({vinculado:e})=>!e);for(const e of this.compraItensNaoVinculados)this.layoutCompra[e.item.id]={...e.item,visivel:!1}},buscar(){try{let i=new Set((this.termoBusca||"").trim().toLowerCase().replace(/\s+/g," ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(" "));i=Array.from(i);for(const e of Object.values(this.layoutCompra)){let m=`${e.descricao||""} ${e.marca||""} ${e.grupo||""} ${e.subGrupo||""} `;m+=`${e.referencia?e.referencia+" Ref"+e.referencia:""} `,m+=`${e.codigoBarras||""} ${e.tipo||""} ${e.codigoBarrasAntigo||""}`,m=m.trim().toLowerCase().replace(/\s+/g," ").normalize("NFD").replace(/[\u0300-\u036f]/g,"");let I=!0;for(const o of i)if(m.indexOf(o)===-1){I=!1;break}I?e.visivel=!1:e.visivel=!0}}catch(i){console.error("Erro ao buscar item. ",i)}},async selecionarItens(i){await $tryLoading(async()=>{var l,a,c;const e=(l=Object.values(i)[0])==null?void 0:l.item;$utils.verificarErro(!(e!=null&&e.id),"Produto inv\xE1lido"),this.compraItensNaoVinculados[this.idxItem].item=e;const{documentoItem:m,item:I,nfeProd:o}=this.compraItensNaoVinculados[this.idxItem];m.idItem=I.id,m.descricaoItem=I.descricao;const s={id:$utils.uuid(),idItem:m.idItem,idContato:this.compra.documento.idContato,referencia:o.cProd,descricao:o.xProd};(c=(a=this.compra)==null?void 0:a.fornecedor)!=null&&c.contato&&$db.compra.gravaFornecedor({atual:this.compra.fornecedor}),await $db.hibrido.grava("itemFornecedor",{atual:s}),this.compraItensNaoVinculados[this.idxItem].vinculado=!0,this.compraItensNaoVinculados=this.compra.documentosItem.filter(({vinculado:v})=>!v),$q.notifyPositive(`Produto vinculado com sucesso: ${I.descricao}`)},{mensagem:"Vinculando produto..."}),this.mostrarItemModal=!1},aplicarPropriedades(){var i,e;try{for(const m of this.compraItensNaoVinculados)if(!m.vinculado&&!((e=this.layoutCompra[(i=m==null?void 0:m.item)==null?void 0:i.id])!=null&&e.visivel)){const I=this.edicaoGeral;I.marca&&(m.item.marca=I.marca),I.grupo&&(m.item.grupo=I.grupo),I.subGrupo&&(m.item.subGrupo=I.subGrupo),I.percentualMarkup&&(m.item.percentualMarkup=I.percentualMarkup,this.recalcular(m)),(I.marca||I.grupo||I.subGrupo||I.percentualMarkup)&&this.$q.notify({type:"positive",message:"Propriedades aplicadas."})}}catch(m){this.$q.notify({type:"negative",message:"Erro ao aplicar as propriedades aos itens."}),console.error("Erro ao aplicar as propriedades aos itens.",m)}},async recalcular(i){const{item:m,documentoItem:I,itemAnterior:o=$utils.clonarV2(i.item)}=i,{valorFreteRateado:s=0,valorSeguroRateado:l=0,valorOutrasDespesasRateado:a=0}=I;i.valoresEdicao||(i.valoresEdicao={valorOutrasDespesas:s+l+a,percentualIpi:I.percentualIpi||0,percentualIcmsSt:I.percentualIcmsSt||0,percentualDifal:0});const{valorOutrasDespesas:c,percentualIpi:v,percentualIcmsSt:w,percentualDifal:b}=i.valoresEdicao,{valorCusto:f=0,percentualMarkup:u=0,valorVenda:k=0}=m,g=f+c,y=g*v/100,n=g*w/100,_=g*b/100;m.valorCustoReposicao=$utils.arredondar(g+y+n+_,2),k!==o.valorVenda?m.percentualMarkup=$utils.arredondar(100*(k-m.valorCustoReposicao)/k,2):m.valorVenda=$utils.arredondar(m.valorCustoReposicao/(1-u/100),2),m.valorVenda===0&&(m.percentualMarkup=(m.valorVenda-m.valorCustoReposicao)/(m.valorVenda+1e-9)*100),i.itemAnterior=$utils.clonarV2(m)},async adicionarItens(){for(const i of this.compra.documentosItem)i.vinculado||await this.adicionarItem(i)},async adicionarItem(i){i.buttonLoading=!0,await this.$nextTick(),await $tryLoading(async()=>{var o,s;const e=await $db.hibrido.lista({table:"item",where:{referencia:i.item.referencia}});$utils.verificarErro(e.length,"Referencia j\xE1 utilizada por outro produto"),i.documentoItem.descricaoItem=i.item.descricao,i.item.descricaoConcatenada=i.item.descricao;const m=i.nfeProd,I={id:$utils.uuid(),idItem:i.item.id,idContato:this.compra.documento.idContato,referencia:m.cProd,descricao:m.xProd};await $db.hibrido.grava("item",{atual:i.item}),await $db.item.carregarMemoria(i.item.id),(s=(o=this.compra)==null?void 0:o.fornecedor)!=null&&s.contato&&$db.compra.gravaFornecedor({atual:this.compra.fornecedor}),await $db.hibrido.grava("itemFornecedor",{atual:I}),i.vinculado=!0,this.$q.notify({type:"positive",message:`Item criado com sucesso: ${i.item.descricao}`})},{mensagem:"Cadastrando produto..."}),i.buttonLoading=!1},async salvar(){try{this.compra.documentosItem.some(({vinculado:i})=>!i)?this.$q.notify({type:"warning",message:"Verifique todos os itens n\xE3o vinculados!"}):(this.mostrarItemModal=!1,this.visivel=!1,this.$emit("concluirImportacao",this.compra),this.$q.notify({type:"positive",message:"Concluindo importa\xE7\xE3o!"}))}catch(i){this.$q.notify({type:"negative",message:"Erro ao salvar compra."}),console.error("Erro ao salvar XML compra. ",i)}},edicaoGeralMarkup(){this.edicaoGeral.percentualMarkup=this.edicaoGeral.percentualMarkup>99.99?99.99:this.edicaoGeral.percentualMarkup},rules(i,e){if(i==="lucro"){e.item.valorVenda=e.item.valorCustoReposicao/(1-e.item.percentualMarkup/100),this.$nextTick(()=>{e.item.percentualMarkup>99.99&&(e.item.percentualMarkup=99.99,this.rules("lucro",e))});return}if(i==="venda"){e.item.valorVenda<0&&this.$nextTick(()=>{e.item.valorVenda=e.item.valorCustoReposicao,this.rules("venda",e)}),e.item.valorVenda===0?e.item.percentualMarkup=(e.item.valorVenda-e.item.valorCustoReposicao)/(e.item.valorVenda+1e-9)*100:e.item.percentualMarkup=(e.item.valorVenda-e.item.valorCustoReposicao)/e.item.valorVenda*100,this.$nextTick(()=>{e.item.percentualMarkup>99.99&&(e.item.percentualMarkup=99.99,this.rules("lucro",e))});return}},abrirModalMarkup(i){this.modalMarkup={visivel:!0,idItem:i.item.id,custo:i.item.valorCustoReposicao,fator:i.item.valorVenda===0?0:i.item.valorVenda/i.item.valorCustoReposicao,lucro:i.item.valorVenda===0?(i.item.valorVenda-i.item.valorCustoReposicao)/(i.item.valorVenda+1e-9)*100:(i.item.valorVenda-i.item.valorCustoReposicao)/i.item.valorVenda*100,markup:i.item.valorVenda&&i.item.valorCustoReposicao?(i.item.valorVenda/i.item.valorCustoReposicao-1)*100:0,venda:i.item.valorVenda,origem:{custo:i.item.valorCustoReposicao,venda:i.item.valorVenda,lucro:i.item.percentualMarkup}}},fecharModalMarkup(i=!1){i?(this.compraItensNaoVinculados.filter(e=>e.item.id===this.modalMarkup.idItem)[0].item.valorCustoReposicao=this.modalMarkup.custo,this.compraItensNaoVinculados.filter(e=>e.item.id===this.modalMarkup.idItem)[0].item.valorVenda=this.modalMarkup.venda,this.compraItensNaoVinculados.filter(e=>e.item.id===this.modalMarkup.idItem)[0].item.percentualMarkup=this.modalMarkup.lucro):(this.compraItensNaoVinculados.filter(e=>e.item.id===this.modalMarkup.idItem)[0].item.valorCustoReposicao=this.modalMarkup.origem.custo,this.compraItensNaoVinculados.filter(e=>e.item.id===this.modalMarkup.idItem)[0].item.valorVenda=this.modalMarkup.origem.venda,this.compraItensNaoVinculados.filter(e=>e.item.id===this.modalMarkup.idItem)[0].item.percentualMarkup=this.modalMarkup.origem.lucro),this.modalMarkup={visivel:!1,idItem:"",custo:0,fator:0,lucro:0,markup:0,venda:0,origem:{}}},calcularModalMarkup(i){const e=this.modalMarkup,m=1e-9;if(i==="custo"){e.custo<0&&this.$nextTick(()=>{e.custo=0,e.fator=0,e.lucro=0,e.markup=0,e.venda=0}),e.markup=(e.venda/e.custo-1)*100,e.venda===0?(e.lucro=(e.venda-e.custo)/(e.venda+m)*100,e.fator=0):(e.lucro=(e.venda-e.custo)/e.venda*100,e.fator=e.venda/e.custo),this.$nextTick(()=>{e.lucro>99.99&&(e.lucro=99.99,this.calcularModalMarkup("lucro"))});return}if(i==="fator"){e.fator===0?(e.venda=0,e.lucro=(e.venda-e.custo)/(e.venda+m)*100):(e.venda=e.custo*e.fator,e.lucro=(e.venda-e.custo)/e.venda*100),e.markup=(e.venda/e.custo-1)*100,this.$nextTick(()=>{e.lucro>99.99&&(e.lucro=99.99,this.calcularModalMarkup("lucro"))});return}if(i==="lucro"){e.venda=e.custo/(1-e.lucro/100),e.markup=(e.venda/e.custo-1)*100,e.fator=e.venda/e.custo,this.$nextTick(()=>{e.lucro>99.99&&(e.lucro=99.99,this.calcularModalMarkup("lucro"))});return}if(i==="markup"){e.markup<-100&&this.$nextTick(()=>{e.markup=-100,this.calcularModalMarkup("markup")}),e.venda=e.custo+e.markup/100*e.custo,e.venda===0?(e.lucro=(e.venda-e.custo)/(e.venda+m)*100,e.fator=0):(e.lucro=(e.venda-e.custo)/e.venda*100,e.fator=e.venda/e.custo),this.$nextTick(()=>{e.lucro>99.99&&(e.lucro=99.99,this.calcularModalMarkup("lucro"))});return}if(i==="venda"){e.venda<0&&this.$nextTick(()=>{e.venda=e.custo,this.calcularModalMarkup("venda")}),e.markup=(e.venda/e.custo-1)*100,e.venda===0?(e.lucro=(e.venda-e.custo)/(e.venda+m)*100,e.fator=0):(e.lucro=(e.venda-e.custo)/e.venda*100,e.fator=e.venda/e.custo),this.$nextTick(()=>{e.lucro>99.99&&(e.lucro=99.99,this.calcularModalMarkup("lucro"))});return}},resize(){this.tela={width:$utils.tela("ImportacaoXML").width}}}},la={class:"bg-white q-pa-sm rounded-borders shadow fit"},na={class:"q-mb-md q-mx-sm rounded-borders shadow"},da={class:"q-mb-md q-mx-sm rounded-borders shadow"},ua={class:"text-weight-bold"},ca={class:"text-weight-bold"};function ma(i,e,m,I,o,s){const l=pe("ajuda"),a=pe("g-label"),c=pe("campo"),v=pe("g-col"),w=pe("g-row"),b=pe("PromptItemV2");return L(),J(Le,{modelValue:o.visivel,"onUpdate:modelValue":e[22]||(e[22]=f=>o.visivel=f),persistent:"",maximized:"",onKeyup:mt(s.fechar,["esc"])},{default:r(()=>[t(je,{container:"",view:"hHh LpR fFf",class:"bg-light",id:"ImportacaoXML"},{default:r(()=>[t(wt,{onResize:e[0]||(e[0]=f=>s.resize())}),t(He,{class:"bg-transparent"},{default:r(()=>[t(Pe,{class:"bg-primary"},{default:r(()=>[t(ce,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:s.fechar},null,8,["onClick"]),t(Re,null,{default:r(()=>e[23]||(e[23]=[z("Importar XML x Cadastro")])),_:1}),t(l)]),_:1}),t(Pe,{class:"u-container bg-light q-px-sm q-py-md"},{default:r(()=>[ve("div",la,[t(Xe,{modelValue:o.termoBusca,"onUpdate:modelValue":[e[1]||(e[1]=f=>o.termoBusca=f),e[2]||(e[2]=f=>s.buscar())],debounce:500,label:"Buscar","clear-icon":"close",standout:"",outlined:"",clearable:"",dense:""},{prepend:r(()=>[t(ie,{name:"mdi-filter"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t(Ze,null,{default:r(()=>[t(Ge,{class:"u-container"},{default:r(()=>[ve("div",na,[t(w,{gutter:"sm",bg:"bg-white"},{default:r(()=>[t(v,{col:"12"},{default:r(()=>[t(a,{icon:"mdi-set-none sm tertiary left",text:"body1 medium",class:"q-mb-md"},{default:r(()=>e[24]||(e[24]=[z(" Propriedades para todos os produtos ")])),_:1}),t(w,null,{default:r(()=>[t(v,{col:"12 md"},{default:r(()=>[t(c,{modelValue:o.edicaoGeral.marca,"onUpdate:modelValue":e[3]||(e[3]=f=>o.edicaoGeral.marca=f),dense:"",outlined:"",rotulo:"Marca",tipo:"texto"},null,8,["modelValue"])]),_:1}),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:o.edicaoGeral.grupo,"onUpdate:modelValue":e[4]||(e[4]=f=>o.edicaoGeral.grupo=f),dense:"",outlined:"",rotulo:"Grupo",tipo:"texto"},null,8,["modelValue"])]),_:1}),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:o.edicaoGeral.subGrupo,"onUpdate:modelValue":e[5]||(e[5]=f=>o.edicaoGeral.subGrupo=f),dense:"",outlined:"",rotulo:"SubGrupo",tipo:"texto"},null,8,["modelValue"])]),_:1})]),_:1}),t(w,{items:"center",justify:"end"},{default:r(()=>[t(v,{col:"6 sm-shrink"},{default:r(()=>[t(c,{modelValue:o.edicaoGeral.percentualMarkup,"onUpdate:modelValue":e[6]||(e[6]=f=>o.edicaoGeral.percentualMarkup=f),opcoes:{maximumValue:99.99},rules:s.edicaoGeralMarkup(),"lazy-rules":"",dense:"",outlined:"",rotulo:"Margem de Lucro",suffix:"%",tipo:"decimal",decimals:"2",col:"2"},null,8,["modelValue","rules"])]),_:1}),t(v,{col:"6 sm-shrink",text:"right"},{default:r(()=>[t(ce,{onClick:s.aplicarPropriedades,unelevated:"",color:"primary",class:"q-px-sm"},{default:r(()=>[t(ie,{name:"play_arrow",class:"q-mr-xs"}),e[25]||(e[25]=z(" Aplicar "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),t(Pt,{items:o.compraItensNaoVinculados,separator:""},{default:r(({item:f,index:u})=>{var k,g;return[be(ve("div",da,[t(w,{gutter:"sm",bg:"bg-white"},{default:r(()=>[t(v,{col:"12"},{default:r(()=>[t(w,null,{default:r(()=>[t(v,{col:"12 md"},{default:r(()=>[t(c,{modelValue:f.item.descricao,"onUpdate:modelValue":y=>f.item.descricao=y,"somente-leitura":!!f.vinculado,outlined:"",dense:"",rotulo:"Descri\xE7\xE3o Item",tipo:"texto",align:"left",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(v,{col:"12 md"},{default:r(()=>[t(c,{modelValue:f.item.referencia,"onUpdate:modelValue":y=>f.item.referencia=y,"somente-leitura":!!f.vinculado,outlined:"",dense:"",rotulo:"Referencia",tipo:"texto",maxlength:"30",align:"left",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),t(w,null,{default:r(()=>[t(v,{col:"12 md"},{default:r(()=>[t(c,{modelValue:f.item.marca,"onUpdate:modelValue":y=>f.item.marca=y,"somente-leitura":!!f.vinculado,outlined:"",dense:"",rotulo:"Marca",tipo:"texto",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.item.grupo,"onUpdate:modelValue":y=>f.item.grupo=y,"somente-leitura":!!f.vinculado,outlined:"",dense:"",rotulo:"Grupo",tipo:"texto",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.item.subGrupo,"onUpdate:modelValue":y=>f.item.subGrupo=y,"somente-leitura":!!f.vinculado,outlined:"",dense:"",rotulo:"SubGrupo",tipo:"texto",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),t(w,null,{default:r(()=>[t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.item.valorCusto,"onUpdate:modelValue":y=>f.item.valorCusto=y,"somente-leitura":"",outlined:"",dense:"",rotulo:"Valor pr\xE9 custo",tipo:"decimal",decimals:"4",zerosDireita:"2",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.valoresEdicao.valorOutrasDespesas,"onUpdate:modelValue":y=>f.valoresEdicao.valorOutrasDespesas=y,onBlur:y=>s.recalcular(f),"somente-leitura":!!f.vinculado,dense:"",outlined:"",rotulo:"Outras Despesas",tipo:"decimal",decimals:"4",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.valoresEdicao.percentualIpi,"onUpdate:modelValue":y=>f.valoresEdicao.percentualIpi=y,onBlur:y=>s.recalcular(f),"somente-leitura":!!f.vinculado,opcoes:{maximumValue:100},outlined:"",dense:"",rotulo:"IPI",suffix:"%",tipo:"decimal",decimals:"2",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.valoresEdicao.percentualIcmsSt,"onUpdate:modelValue":y=>f.valoresEdicao.percentualIcmsSt=y,onBlur:y=>s.recalcular(f),opcoes:{maximumValue:100},"somente-leitura":!!f.vinculado,dense:"",outlined:"",rotulo:"ST",suffix:"%",tipo:"decimal",decimals:"2",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.valoresEdicao.percentualDifal,"onUpdate:modelValue":y=>f.valoresEdicao.percentualDifal=y,onBlur:y=>s.recalcular(f),opcoes:{maximumValue:100},"somente-leitura":!!f.vinculado,dense:"",outlined:"",rotulo:"DIFAL",suffix:"%",tipo:"decimal",decimals:"2",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.item.valorCustoReposicao,"onUpdate:modelValue":y=>f.item.valorCustoReposicao=y,"somente-leitura":"",dense:"",outlined:"",rotulo:"Custo de reposi\xE7\xE3o",tipo:"decimal",decimals:"4",zerosDireita:"2",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.item.percentualMarkup,"onUpdate:modelValue":y=>f.item.percentualMarkup=y,onBlur:y=>s.recalcular(f),rules:[y=>{y>99.99&&s.abrirModalMarkup(f)}],"somente-leitura":!!f.vinculado,opcoes:{maximumValue:99.99},after:[{icon:"calculate",color:"primary",round:!0,dense:!0,flat:!0,handler:()=>s.abrirModalMarkup(f)}],dense:"",outlined:"",rotulo:"Margem de Lucro",tipo:"decimal",suffix:"%",decimals:"2"},null,8,["modelValue","onUpdate:modelValue","onBlur","rules","somente-leitura","after"])]),_:2},1024),t(v,{col:"6 md"},{default:r(()=>[t(c,{modelValue:f.item.valorVenda,"onUpdate:modelValue":y=>f.item.valorVenda=y,onBlur:y=>s.recalcular(f),"somente-leitura":!!f.vinculado,rules:s.rules("venda",f),dense:"",outlined:"",rotulo:"Valor de Venda",tipo:"decimal",decimals:"4",zerosDireita:"2",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura","rules"])]),_:2},1024)]),_:2},1024),f.vinculado?(L(),J(w,{key:1,items:"center",justify:"end"},{default:r(()=>e[29]||(e[29]=[z(" Produto vinculado ")])),_:1})):(L(),J(w,{key:0,items:"center",justify:"end"},{default:r(()=>[t(v,{col:"shrink"},{default:r(()=>[t(ce,{onClick:()=>{o.mostrarItemModal=!o.mostrarItemModal,o.idxItem=u},unelevated:"",color:"primary",class:"q-px-sm"},{default:r(()=>[t(ie,{name:"search",class:"q-mr-xs"}),e[26]||(e[26]=z(" Vincular "))]),_:2},1032,["onClick"])]),_:2},1024),t(v,{col:"shrink"},{default:r(()=>[t(a,{text:"body1 center"},{default:r(()=>e[27]||(e[27]=[z("OU")])),_:1})]),_:1}),t(v,{col:"shrink"},{default:r(()=>[t(ce,{onClick:y=>s.adicionarItem(f),loading:f.buttonLoading,unelevated:"",color:"primary",class:"q-px-sm"},{default:r(()=>[t(ie,{name:"add",class:"q-mr-xs"}),e[28]||(e[28]=z(" Novo "))]),_:2},1032,["onClick","loading"])]),_:2},1024)]),_:2},1024))]),_:2},1024)]),_:2},1024)],512),[[Be,!((g=o.layoutCompra[(k=f==null?void 0:f.item)==null?void 0:k.id])!=null&&g.visivel)]])]}),_:1},8,["items"])]),_:1})]),_:1}),t(Qe,{class:"bg-white border-top"},{default:r(()=>[t(Pe,{class:"u-container"},{default:r(()=>[t(fe,{class:"q-pa-none"},{default:r(()=>[t(Y,null,{default:r(()=>[t(ue,{caption:"",class:"text-weight-medium"},{default:r(()=>[e[30]||(e[30]=z(" Produtos: ")),ve("span",ua,ae(s.quantProdutos),1)]),_:1}),t(ue,{caption:"",class:"text-weight-medium"},{default:r(()=>[e[31]||(e[31]=z(" N\xE3o vinculados: ")),ve("span",ca,ae(s.produtosNaoVinculados),1)]),_:1})]),_:1})]),_:1}),t(et),s.produtosNaoVinculados?(L(),J(ce,{key:0,onClick:s.adicionarItens,unelevated:"",color:"primary",class:"q-px-sm q-ml-sm"},{default:r(()=>[t(ie,{name:"add"}),e[32]||(e[32]=z(" Incluir Todos "))]),_:1},8,["onClick"])):(L(),J(ce,{key:1,onClick:s.salvar,unelevated:"",color:"primary",class:"q-px-sm q-ml-sm"},{default:r(()=>[t(ie,{name:"save",class:"q-mr-xs"}),e[33]||(e[33]=z(" Salvar "))]),_:1},8,["onClick"]))]),_:1})]),_:1}),t(b,{modelValue:o.mostrarItemModal,"onUpdate:modelValue":e[7]||(e[7]=f=>o.mostrarItemModal=f),onSelecionarItens:s.selecionarItens,filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},exibirValorVenda:!1,habilitarQuantidade:!1,ref:"promptItem"},null,8,["modelValue","onSelecionarItens","filtro"]),t(Le,{modelValue:o.modalMarkup.visivel,"onUpdate:modelValue":e[20]||(e[20]=f=>o.modalMarkup.visivel=f),onKeyup:e[21]||(e[21]=mt(f=>s.fecharModalMarkup(),["esc"])),persistent:""},{default:r(()=>[t(je,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:_t(o.tela.width<=550?"height:100%; max-height:560px;":"height:100%; max-height:480px; max-width:550px;")},{default:r(()=>[t(He,null,{default:r(()=>[t(Pe,null,{default:r(()=>[t(ie,{name:"calculate",size:"sm",flat:""}),t(Re,null,{default:r(()=>e[34]||(e[34]=[z("Markup X Margem de Lucro")])),_:1})]),_:1})]),_:1}),t(Ze,null,{default:r(()=>[t(Ge,null,{default:r(()=>[t(w,{gutter:"md",class:"q-mb-lg"},{default:r(()=>[t(v,{col:"12"},{default:r(()=>[t(a,{bordered:"","rounded-borders":"",text:"caption",class:"q-pa-sm"},{default:r(()=>e[35]||(e[35]=[ve("strong",null,"N\xE3o \xE9 para ter margem\xA0de\xA0lucro superior a 99.99%",-1),z(", o c\xE1lculo do lucro \xE9 sempre sobre o valor da venda, a explica\xE7\xE3o vem da an\xE1lise que o lucro da "),ve("strong",null,"EMPRESA",-1),z(" sempre \xE9 c\xE1lculado com base no "),ve("strong",null,"LUCRO",-1),z(" x "),ve("strong",null,"FATURAMENTO",-1),z(". ")])),_:1})]),_:1})]),_:1}),t(w,{gutter:"md-x",justify:"center"},{default:r(()=>[t(v,{col:"11 sm5"},{default:r(()=>[t(c,{modelValue:o.modalMarkup.custo,"onUpdate:modelValue":[e[8]||(e[8]=f=>o.modalMarkup.custo=f),e[9]||(e[9]=f=>s.calcularModalMarkup("custo"))],debounce:500,somenteLeitura:"",dense:"",filled:"","lazy-rules":"","hide-bottom-space":"",rotulo:"Custo de reposi\xE7\xE3o",tipo:"decimal",decimals:"2",zerosDireita:"2",class:"q-mb-lg"},null,8,["modelValue"])]),_:1})]),_:1}),t(w,{gutter:"md-x",justify:"center"},{default:r(()=>[t(v,{col:"11 sm4"},{default:r(()=>[t(c,{modelValue:o.modalMarkup.fator,"onUpdate:modelValue":[e[10]||(e[10]=f=>o.modalMarkup.fator=f),e[11]||(e[11]=f=>s.calcularModalMarkup("fator"))],somenteLeitura:!(o.modalMarkup.custo>0),debounce:500,filled:"",dense:"","lazy-rules":"","hide-bottom-space":"",rotulo:"Fator Markup",tipo:"decimal",decimals:"2",zerosDireita:"2"},null,8,["modelValue","somenteLeitura"]),t(a,{class:"q-pa-xs",style:{"font-size":"11px","line-height":"1.1"}},{default:r(()=>e[36]||(e[36]=[z(" \xC9 um fator aplicado sobre o pre\xE7o de custo para determinar o pre\xE7o de venda. ")])),_:1})]),_:1}),t(v,{col:"11 sm4"},{default:r(()=>[t(c,{modelValue:o.modalMarkup.lucro,"onUpdate:modelValue":[e[12]||(e[12]=f=>o.modalMarkup.lucro=f),e[13]||(e[13]=f=>s.calcularModalMarkup("lucro"))],somenteLeitura:!(o.modalMarkup.custo>0),debounce:500,filled:"",dense:"","lazy-rules":"","hide-bottom-space":"",tipo:"decimal",rotulo:"Margem de Lucro",suffix:"%",decimals:"2",zerosDireita:"2"},null,8,["modelValue","somenteLeitura"]),t(a,{class:"q-pa-xs",style:{"font-size":"11px","line-height":"1.1"}},{default:r(()=>e[37]||(e[37]=[z(" \xC9 o percentual do pre\xE7o de venda correspondente ao lucro da opera\xE7\xE3o. ")])),_:1})]),_:1}),t(v,{col:"11 sm4"},{default:r(()=>[t(c,{modelValue:o.modalMarkup.markup,"onUpdate:modelValue":[e[14]||(e[14]=f=>o.modalMarkup.markup=f),e[15]||(e[15]=f=>s.calcularModalMarkup("markup"))],somenteLeitura:!(o.modalMarkup.custo>0),debounce:500,filled:"",dense:"","lazy-rules":"","hide-bottom-space":"",rotulo:"Percentual Markup",tipo:"decimal",decimals:"2",zerosDireita:"2",suffix:"%"},null,8,["modelValue","somenteLeitura"]),t(a,{class:"q-pa-xs",style:{"font-size":"11px","line-height":"1.1"}},{default:r(()=>e[38]||(e[38]=[z(" \xC9 um \xEDndice aplicado sobre o pre\xE7o de custo para determinar o pre\xE7o de venda. ")])),_:1})]),_:1})]),_:1}),t(w,{gutter:"md-x",justify:"center"},{default:r(()=>[t(v,{col:"11 sm5"},{default:r(()=>[t(c,{modelValue:o.modalMarkup.venda,"onUpdate:modelValue":[e[16]||(e[16]=f=>o.modalMarkup.venda=f),e[17]||(e[17]=f=>s.calcularModalMarkup("venda"))],somenteLeitura:!(o.modalMarkup.custo>0),debounce:500,filled:"",dense:"","lazy-rules":"","hide-bottom-space":"",rotulo:"Valor de Venda",tipo:"decimal",decimals:"2",zerosDireita:"2",class:"q-mt-md"},null,8,["modelValue","somenteLeitura"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Qe,{class:"bg-light"},{default:r(()=>[t(Pe,null,{default:r(()=>[t(et),t(ce,{onClick:e[18]||(e[18]=f=>s.fecharModalMarkup()),flat:"",label:"Cancelar",color:"tertiary"}),t(ce,{onClick:e[19]||(e[19]=f=>s.fecharModalMarkup(!0)),unelevated:"",label:"Aplicar",color:"primary",class:"q-ml-sm"})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","onKeyup"])}var fa=lt(sa,[["render",ma]]),It={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,e){(function(m){i.exports=m()})(function(){return function m(I,o,s){function l(v,w){if(!o[v]){if(!I[v]){var b=typeof it=="function"&&it;if(!w&&b)return b(v,!0);if(a)return a(v,!0);var f=new Error("Cannot find module '"+v+"'");throw f.code="MODULE_NOT_FOUND",f}var u=o[v]={exports:{}};I[v][0].call(u.exports,function(k){var g=I[v][1][k];return l(g||k)},u,u.exports,m,I,o,s)}return o[v].exports}for(var a=typeof it=="function"&&it,c=0;c<s.length;c++)l(s[c]);return l}({1:[function(m,I,o){var s=m("./utils"),l=m("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(c){for(var v,w,b,f,u,k,g,y=[],n=0,_=c.length,h=_,D=s.getTypeOf(c)!=="string";n<c.length;)h=_-n,b=D?(v=c[n++],w=n<_?c[n++]:0,n<_?c[n++]:0):(v=c.charCodeAt(n++),w=n<_?c.charCodeAt(n++):0,n<_?c.charCodeAt(n++):0),f=v>>2,u=(3&v)<<4|w>>4,k=1<h?(15&w)<<2|b>>6:64,g=2<h?63&b:64,y.push(a.charAt(f)+a.charAt(u)+a.charAt(k)+a.charAt(g));return y.join("")},o.decode=function(c){var v,w,b,f,u,k,g=0,y=0,n="data:";if(c.substr(0,n.length)===n)throw new Error("Invalid base64 input, it looks like a data url.");var _,h=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&h--,c.charAt(c.length-2)===a.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=l.uint8array?new Uint8Array(0|h):new Array(0|h);g<c.length;)v=a.indexOf(c.charAt(g++))<<2|(f=a.indexOf(c.charAt(g++)))>>4,w=(15&f)<<4|(u=a.indexOf(c.charAt(g++)))>>2,b=(3&u)<<6|(k=a.indexOf(c.charAt(g++))),_[y++]=v,u!==64&&(_[y++]=w),k!==64&&(_[y++]=b);return _}},{"./support":30,"./utils":32}],2:[function(m,I,o){var s=m("./external"),l=m("./stream/DataWorker"),a=m("./stream/Crc32Probe"),c=m("./stream/DataLengthProbe");function v(w,b,f,u,k){this.compressedSize=w,this.uncompressedSize=b,this.crc32=f,this.compression=u,this.compressedContent=k}v.prototype={getContentWorker:function(){var w=new l(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),b=this;return w.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),w},getCompressedWorker:function(){return new l(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},v.createWorkerFrom=function(w,b,f){return w.pipe(new a).pipe(new c("uncompressedSize")).pipe(b.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",b)},I.exports=v},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(m,I,o){var s=m("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},o.DEFLATE=m("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(m,I,o){var s=m("./utils"),l=function(){for(var a,c=[],v=0;v<256;v++){a=v;for(var w=0;w<8;w++)a=1&a?3988292384^a>>>1:a>>>1;c[v]=a}return c}();I.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(v,w,b,f){var u=l,k=f+b;v^=-1;for(var g=f;g<k;g++)v=v>>>8^u[255&(v^w[g])];return-1^v}(0|c,a,a.length,0):function(v,w,b,f){var u=l,k=f+b;v^=-1;for(var g=f;g<k;g++)v=v>>>8^u[255&(v^w.charCodeAt(g))];return-1^v}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(m,I,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(m,I,o){var s=null;s=typeof Promise!="undefined"?Promise:m("lie"),I.exports={Promise:s}},{lie:37}],7:[function(m,I,o){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",l=m("pako"),a=m("./utils"),c=m("./stream/GenericWorker"),v=s?"uint8array":"array";function w(b,f){c.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=f,this.meta={}}o.magic="\b\0",a.inherits(w,c),w.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(v,b.data),!1)},w.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},w.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},w.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(f){b.push({data:f,meta:b.meta})}},o.compressWorker=function(b){return new w("Deflate",b)},o.uncompressWorker=function(){return new w("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(m,I,o){function s(u,k){var g,y="";for(g=0;g<k;g++)y+=String.fromCharCode(255&u),u>>>=8;return y}function l(u,k,g,y,n,_){var h,D,x=u.file,F=u.compression,B=_!==v.utf8encode,$=a.transformTo("string",_(x.name)),T=a.transformTo("string",v.utf8encode(x.name)),G=x.comment,oe=a.transformTo("string",_(G)),E=a.transformTo("string",v.utf8encode(G)),O=T.length!==x.name.length,p=E.length!==G.length,U="",de="",Z="",me=x.dir,R=x.date,le={crc32:0,compressedSize:0,uncompressedSize:0};k&&!g||(le.crc32=u.crc32,le.compressedSize=u.compressedSize,le.uncompressedSize=u.uncompressedSize);var N=0;k&&(N|=8),B||!O&&!p||(N|=2048);var A=0,ee=0;me&&(A|=16),n==="UNIX"?(ee=798,A|=function(K,ye){var ke=K;return K||(ke=ye?16893:33204),(65535&ke)<<16}(x.unixPermissions,me)):(ee=20,A|=function(K){return 63&(K||0)}(x.dosPermissions)),h=R.getUTCHours(),h<<=6,h|=R.getUTCMinutes(),h<<=5,h|=R.getUTCSeconds()/2,D=R.getUTCFullYear()-1980,D<<=4,D|=R.getUTCMonth()+1,D<<=5,D|=R.getUTCDate(),O&&(de=s(1,1)+s(w($),4)+T,U+="up"+s(de.length,2)+de),p&&(Z=s(1,1)+s(w(oe),4)+E,U+="uc"+s(Z.length,2)+Z);var W="";return W+=`
\0`,W+=s(N,2),W+=F.magic,W+=s(h,2),W+=s(D,2),W+=s(le.crc32,4),W+=s(le.compressedSize,4),W+=s(le.uncompressedSize,4),W+=s($.length,2),W+=s(U.length,2),{fileRecord:b.LOCAL_FILE_HEADER+W+$+U,dirRecord:b.CENTRAL_FILE_HEADER+s(ee,2)+W+s(oe.length,2)+"\0\0\0\0"+s(A,4)+s(y,4)+$+U+oe}}var a=m("../utils"),c=m("../stream/GenericWorker"),v=m("../utf8"),w=m("../crc32"),b=m("../signature");function f(u,k,g,y){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=k,this.zipPlatform=g,this.encodeFileName=y,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(u){var k=u.meta.percent||0,g=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,c.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:g?(k+100*(g-y-1))/g:100}}))},f.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var k=this.streamFiles&&!u.file.dir;if(k){var g=l(u,k,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(u){this.accumulate=!1;var k=this.streamFiles&&!u.file.dir,g=l(u,k,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),k)this.push({data:function(y){return b.DATA_DESCRIPTOR+s(y.crc32,4)+s(y.compressedSize,4)+s(y.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var u=this.bytesWritten,k=0;k<this.dirRecords.length;k++)this.push({data:this.dirRecords[k],meta:{percent:100}});var g=this.bytesWritten-u,y=function(n,_,h,D,x){var F=a.transformTo("string",x(D));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(n,2)+s(n,2)+s(_,4)+s(h,4)+s(F.length,2)+F}(this.dirRecords.length,g,u,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(u){this._sources.push(u);var k=this;return u.on("data",function(g){k.processChunk(g)}),u.on("end",function(){k.closedSource(k.previous.streamInfo),k._sources.length?k.prepareNextSource():k.end()}),u.on("error",function(g){k.error(g)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(u){var k=this._sources;if(!c.prototype.error.call(this,u))return!1;for(var g=0;g<k.length;g++)try{k[g].error(u)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var u=this._sources,k=0;k<u.length;k++)u[k].lock()},I.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(m,I,o){var s=m("../compressions"),l=m("./ZipFileWorker");o.generateWorker=function(a,c,v){var w=new l(c.streamFiles,v,c.platform,c.encodeFileName),b=0;try{a.forEach(function(f,u){b++;var k=function(_,h){var D=_||h,x=s[D];if(!x)throw new Error(D+" is not a valid compression method !");return x}(u.options.compression,c.compression),g=u.options.compressionOptions||c.compressionOptions||{},y=u.dir,n=u.date;u._compressWorker(k,g).withStreamInfo("file",{name:f,dir:y,date:n,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(w)}),w.entriesCount=b}catch(f){w.error(f)}return w}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(m,I,o){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new s;for(var a in this)typeof this[a]!="function"&&(l[a]=this[a]);return l}}(s.prototype=m("./object")).loadAsync=m("./load"),s.support=m("./support"),s.defaults=m("./defaults"),s.version="3.10.1",s.loadAsync=function(l,a){return new s().loadAsync(l,a)},s.external=m("./external"),I.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(m,I,o){var s=m("./utils"),l=m("./external"),a=m("./utf8"),c=m("./zipEntries"),v=m("./stream/Crc32Probe"),w=m("./nodejsUtils");function b(f){return new l.Promise(function(u,k){var g=f.decompressed.getContentWorker().pipe(new v);g.on("error",function(y){k(y)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?k(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}I.exports=function(f,u){var k=this;return u=s.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),w.isNode&&w.isStream(f)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,u.optimizedBinaryString,u.base64).then(function(g){var y=new c(u);return y.load(g),y}).then(function(g){var y=[l.Promise.resolve(g)],n=g.files;if(u.checkCRC32)for(var _=0;_<n.length;_++)y.push(b(n[_]));return l.Promise.all(y)}).then(function(g){for(var y=g.shift(),n=y.files,_=0;_<n.length;_++){var h=n[_],D=h.fileNameStr,x=s.resolve(h.fileNameStr);k.file(x,h.decompressed,{binary:!0,optimizedBinaryString:!0,date:h.date,dir:h.dir,comment:h.fileCommentStr.length?h.fileCommentStr:null,unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions,createFolders:u.createFolders}),h.dir||(k.file(x).unsafeOriginalName=D)}return y.zipComment.length&&(k.comment=y.zipComment),k})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(m,I,o){var s=m("../utils"),l=m("../stream/GenericWorker");function a(c,v){l.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(v)}s.inherits(a,l),a.prototype._bindStream=function(c){var v=this;(this._stream=c).pause(),c.on("data",function(w){v.push({data:w,meta:{percent:0}})}).on("error",function(w){v.isPaused?this.generatedError=w:v.error(w)}).on("end",function(){v.isPaused?v._upstreamEnded=!0:v.end()})},a.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},I.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(m,I,o){var s=m("readable-stream").Readable;function l(a,c,v){s.call(this,c),this._helper=a;var w=this;a.on("data",function(b,f){w.push(b)||w._helper.pause(),v&&v(f)}).on("error",function(b){w.emit("error",b)}).on("end",function(){w.push(null)})}m("../utils").inherits(l,s),l.prototype._read=function(){this._helper.resume()},I.exports=l},{"../utils":32,"readable-stream":16}],14:[function(m,I,o){I.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(s,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,l);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,l)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var l=new Buffer(s);return l.fill(0),l},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(m,I,o){function s(x,F,B){var $,T=a.getTypeOf(F),G=a.extend(B||{},w);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(x=n(x)),G.createFolders&&($=y(x))&&_.call(this,$,!0);var oe=T==="string"&&G.binary===!1&&G.base64===!1;B&&B.binary!==void 0||(G.binary=!oe),(F instanceof b&&F.uncompressedSize===0||G.dir||!F||F.length===0)&&(G.base64=!1,G.binary=!0,F="",G.compression="STORE",T="string");var E=null;E=F instanceof b||F instanceof c?F:k.isNode&&k.isStream(F)?new g(x,F):a.prepareContent(x,F,G.binary,G.optimizedBinaryString,G.base64);var O=new f(x,E,G);this.files[x]=O}var l=m("./utf8"),a=m("./utils"),c=m("./stream/GenericWorker"),v=m("./stream/StreamHelper"),w=m("./defaults"),b=m("./compressedObject"),f=m("./zipObject"),u=m("./generate"),k=m("./nodejsUtils"),g=m("./nodejs/NodejsStreamInputAdapter"),y=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var F=x.lastIndexOf("/");return 0<F?x.substring(0,F):""},n=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},_=function(x,F){return F=F!==void 0?F:w.createFolders,x=n(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:F}),this.files[x]};function h(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var F,B,$;for(F in this.files)$=this.files[F],(B=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&x(B,$)},filter:function(x){var F=[];return this.forEach(function(B,$){x(B,$)&&F.push($)}),F},file:function(x,F,B){if(arguments.length!==1)return x=this.root+x,s.call(this,x,F,B),this;if(h(x)){var $=x;return this.filter(function(G,oe){return!oe.dir&&$.test(G)})}var T=this.files[this.root+x];return T&&!T.dir?T:null},folder:function(x){if(!x)return this;if(h(x))return this.filter(function(T,G){return G.dir&&x.test(T)});var F=this.root+x,B=_.call(this,F),$=this.clone();return $.root=B.name,$},remove:function(x){x=this.root+x;var F=this.files[x];if(F||(x.slice(-1)!=="/"&&(x+="/"),F=this.files[x]),F&&!F.dir)delete this.files[x];else for(var B=this.filter(function(T,G){return G.name.slice(0,x.length)===x}),$=0;$<B.length;$++)delete this.files[B[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var F,B={};try{if((B=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=B.type.toLowerCase(),B.compression=B.compression.toUpperCase(),B.type==="binarystring"&&(B.type="string"),!B.type)throw new Error("No output type specified.");a.checkSupport(B.type),B.platform!=="darwin"&&B.platform!=="freebsd"&&B.platform!=="linux"&&B.platform!=="sunos"||(B.platform="UNIX"),B.platform==="win32"&&(B.platform="DOS");var $=B.comment||this.comment||"";F=u.generateWorker(this,B,$)}catch(T){(F=new c("error")).error(T)}return new v(F,B.type||"string",B.mimeType)},generateAsync:function(x,F){return this.generateInternalStream(x).accumulate(F)},generateNodeStream:function(x,F){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(F)}};I.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(m,I,o){I.exports=m("stream")},{stream:void 0}],17:[function(m,I,o){var s=m("./DataReader");function l(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}m("../utils").inherits(l,s),l.prototype.byteAt=function(a){return this.data[this.zero+a]},l.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),v=a.charCodeAt(1),w=a.charCodeAt(2),b=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===v&&this.data[f+2]===w&&this.data[f+3]===b)return f-this.zero;return-1},l.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),v=a.charCodeAt(1),w=a.charCodeAt(2),b=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&v===f[1]&&w===f[2]&&b===f[3]},l.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},I.exports=l},{"../utils":32,"./DataReader":18}],18:[function(m,I,o){var s=m("../utils");function l(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,v=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)v=(v<<8)+this.byteAt(c);return this.index+=a,v},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},I.exports=l},{"../utils":32}],19:[function(m,I,o){var s=m("./Uint8ArrayReader");function l(a){s.call(this,a)}m("../utils").inherits(l,s),l.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},I.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(m,I,o){var s=m("./DataReader");function l(a){s.call(this,a)}m("../utils").inherits(l,s),l.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},l.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},l.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},l.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},I.exports=l},{"../utils":32,"./DataReader":18}],21:[function(m,I,o){var s=m("./ArrayReader");function l(a){s.call(this,a)}m("../utils").inherits(l,s),l.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},I.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(m,I,o){var s=m("../utils"),l=m("../support"),a=m("./ArrayReader"),c=m("./StringReader"),v=m("./NodeBufferReader"),w=m("./Uint8ArrayReader");I.exports=function(b){var f=s.getTypeOf(b);return s.checkSupport(f),f!=="string"||l.uint8array?f==="nodebuffer"?new v(b):l.uint8array?new w(s.transformTo("uint8array",b)):new a(s.transformTo("array",b)):new c(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(m,I,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(m,I,o){var s=m("./GenericWorker"),l=m("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}l.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:l.transformTo(this.destType,c.data),meta:c.meta})},I.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(m,I,o){var s=m("./GenericWorker"),l=m("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}m("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=l(c.data,this.streamInfo.crc32||0),this.push(c)},I.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(m,I,o){var s=m("../utils"),l=m("./GenericWorker");function a(c){l.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,l),a.prototype.processChunk=function(c){if(c){var v=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=v+c.data.length}l.prototype.processChunk.call(this,c)},I.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(m,I,o){var s=m("../utils"),l=m("./GenericWorker");function a(c){l.call(this,"DataWorker");var v=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(w){v.dataIsReady=!0,v.data=w,v.max=w&&w.length||0,v.type=s.getTypeOf(w),v.isPaused||v._tickAndRepeat()},function(w){v.error(w)})}s.inherits(a,l),a.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,v=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,v);break;case"uint8array":c=this.data.subarray(this.index,v);break;case"array":case"nodebuffer":c=this.data.slice(this.index,v)}return this.index=v,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},I.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(m,I,o){function s(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,a){return this._listeners[l].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,a){if(this._listeners[l])for(var c=0;c<this._listeners[l].length;c++)this._listeners[l][c].call(this,a)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var a=this;return l.on("data",function(c){a.processChunk(c)}),l.on("end",function(){a.end()}),l.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,a){return this.extraStreamInfo[l]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},I.exports=s},{}],29:[function(m,I,o){var s=m("../utils"),l=m("./ConvertWorker"),a=m("./GenericWorker"),c=m("../base64"),v=m("../support"),w=m("../external"),b=null;if(v.nodestream)try{b=m("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(k,g){return new w.Promise(function(y,n){var _=[],h=k._internalType,D=k._outputType,x=k._mimeType;k.on("data",function(F,B){_.push(F),g&&g(B)}).on("error",function(F){_=[],n(F)}).on("end",function(){try{var F=function(B,$,T){switch(B){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),T);case"base64":return c.encode($);default:return s.transformTo(B,$)}}(D,function(B,$){var T,G=0,oe=null,E=0;for(T=0;T<$.length;T++)E+=$[T].length;switch(B){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(oe=new Uint8Array(E),T=0;T<$.length;T++)oe.set($[T],G),G+=$[T].length;return oe;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+B+"'")}}(h,_),x);y(F)}catch(B){n(B)}_=[]}).resume()})}function u(k,g,y){var n=g;switch(g){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=g,this._mimeType=y,s.checkSupport(n),this._worker=k.pipe(new l(n)),k.lock()}catch(_){this._worker=new a("error"),this._worker.error(_)}}u.prototype={accumulate:function(k){return f(this,k)},on:function(k,g){var y=this;return k==="data"?this._worker.on(k,function(n){g.call(y,n.data,n.meta)}):this._worker.on(k,function(){s.delay(g,arguments,y)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(k){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},k)}},I.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(m,I,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",o.nodebuffer=typeof Buffer!="undefined",o.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")o.blob=!1;else{var s=new ArrayBuffer(0);try{o.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(s),o.blob=l.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!m("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(m,I,o){for(var s=m("./utils"),l=m("./support"),a=m("./nodejsUtils"),c=m("./stream/GenericWorker"),v=new Array(256),w=0;w<256;w++)v[w]=252<=w?6:248<=w?5:240<=w?4:224<=w?3:192<=w?2:1;v[254]=v[254]=1;function b(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}o.utf8encode=function(u){return l.nodebuffer?a.newBufferFrom(u,"utf-8"):function(k){var g,y,n,_,h,D=k.length,x=0;for(_=0;_<D;_++)(64512&(y=k.charCodeAt(_)))==55296&&_+1<D&&(64512&(n=k.charCodeAt(_+1)))==56320&&(y=65536+(y-55296<<10)+(n-56320),_++),x+=y<128?1:y<2048?2:y<65536?3:4;for(g=l.uint8array?new Uint8Array(x):new Array(x),_=h=0;h<x;_++)(64512&(y=k.charCodeAt(_)))==55296&&_+1<D&&(64512&(n=k.charCodeAt(_+1)))==56320&&(y=65536+(y-55296<<10)+(n-56320),_++),y<128?g[h++]=y:(y<2048?g[h++]=192|y>>>6:(y<65536?g[h++]=224|y>>>12:(g[h++]=240|y>>>18,g[h++]=128|y>>>12&63),g[h++]=128|y>>>6&63),g[h++]=128|63&y);return g}(u)},o.utf8decode=function(u){return l.nodebuffer?s.transformTo("nodebuffer",u).toString("utf-8"):function(k){var g,y,n,_,h=k.length,D=new Array(2*h);for(g=y=0;g<h;)if((n=k[g++])<128)D[y++]=n;else if(4<(_=v[n]))D[y++]=65533,g+=_-1;else{for(n&=_===2?31:_===3?15:7;1<_&&g<h;)n=n<<6|63&k[g++],_--;1<_?D[y++]=65533:n<65536?D[y++]=n:(n-=65536,D[y++]=55296|n>>10&1023,D[y++]=56320|1023&n)}return D.length!==y&&(D.subarray?D=D.subarray(0,y):D.length=y),s.applyFromCharCode(D)}(u=s.transformTo(l.uint8array?"uint8array":"array",u))},s.inherits(b,c),b.prototype.processChunk=function(u){var k=s.transformTo(l.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var g=k;(k=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),k.set(g,this.leftOver.length)}else k=this.leftOver.concat(k);this.leftOver=null}var y=function(_,h){var D;for((h=h||_.length)>_.length&&(h=_.length),D=h-1;0<=D&&(192&_[D])==128;)D--;return D<0||D===0?h:D+v[_[D]]>h?D:h}(k),n=k;y!==k.length&&(l.uint8array?(n=k.subarray(0,y),this.leftOver=k.subarray(y,k.length)):(n=k.slice(0,y),this.leftOver=k.slice(y,k.length))),this.push({data:o.utf8decode(n),meta:u.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=b,s.inherits(f,c),f.prototype.processChunk=function(u){this.push({data:o.utf8encode(u.data),meta:u.meta})},o.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(m,I,o){var s=m("./support"),l=m("./base64"),a=m("./nodejsUtils"),c=m("./external");function v(g){return g}function w(g,y){for(var n=0;n<g.length;++n)y[n]=255&g.charCodeAt(n);return y}m("setimmediate"),o.newBlob=function(g,y){o.checkSupport("blob");try{return new Blob([g],{type:y})}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(g),n.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(g,y,n){var _=[],h=0,D=g.length;if(D<=n)return String.fromCharCode.apply(null,g);for(;h<D;)y==="array"||y==="nodebuffer"?_.push(String.fromCharCode.apply(null,g.slice(h,Math.min(h+n,D)))):_.push(String.fromCharCode.apply(null,g.subarray(h,Math.min(h+n,D)))),h+=n;return _.join("")},stringifyByChar:function(g){for(var y="",n=0;n<g.length;n++)y+=String.fromCharCode(g[n]);return y},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var y=65536,n=o.getTypeOf(g),_=!0;if(n==="uint8array"?_=b.applyCanBeUsed.uint8array:n==="nodebuffer"&&(_=b.applyCanBeUsed.nodebuffer),_)for(;1<y;)try{return b.stringifyByChunk(g,n,y)}catch{y=Math.floor(y/2)}return b.stringifyByChar(g)}function u(g,y){for(var n=0;n<g.length;n++)y[n]=g[n];return y}o.applyFromCharCode=f;var k={};k.string={string:v,array:function(g){return w(g,new Array(g.length))},arraybuffer:function(g){return k.string.uint8array(g).buffer},uint8array:function(g){return w(g,new Uint8Array(g.length))},nodebuffer:function(g){return w(g,a.allocBuffer(g.length))}},k.array={string:f,array:v,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},k.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return u(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:v,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},k.uint8array={string:f,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:v,nodebuffer:function(g){return a.newBufferFrom(g)}},k.nodebuffer={string:f,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return k.nodebuffer.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:v},o.transformTo=function(g,y){if(y=y||"",!g)return y;o.checkSupport(g);var n=o.getTypeOf(y);return k[n][g](y)},o.resolve=function(g){for(var y=g.split("/"),n=[],_=0;_<y.length;_++){var h=y[_];h==="."||h===""&&_!==0&&_!==y.length-1||(h===".."?n.pop():n.push(h))}return n.join("/")},o.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(g){var y,n,_="";for(n=0;n<(g||"").length;n++)_+="\\x"+((y=g.charCodeAt(n))<16?"0":"")+y.toString(16).toUpperCase();return _},o.delay=function(g,y,n){setImmediate(function(){g.apply(n||null,y||[])})},o.inherits=function(g,y){function n(){}n.prototype=y.prototype,g.prototype=new n},o.extend=function(){var g,y,n={};for(g=0;g<arguments.length;g++)for(y in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],y)&&n[y]===void 0&&(n[y]=arguments[g][y]);return n},o.prepareContent=function(g,y,n,_,h){return c.Promise.resolve(y).then(function(D){return s.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader!="undefined"?new c.Promise(function(x,F){var B=new FileReader;B.onload=function($){x($.target.result)},B.onerror=function($){F($.target.error)},B.readAsArrayBuffer(D)}):D}).then(function(D){var x=o.getTypeOf(D);return x?(x==="arraybuffer"?D=o.transformTo("uint8array",D):x==="string"&&(h?D=l.decode(D):n&&_!==!0&&(D=function(F){return w(F,s.uint8array?new Uint8Array(F.length):new Array(F.length))}(D))),D):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(m,I,o){var s=m("./reader/readerFor"),l=m("./utils"),a=m("./signature"),c=m("./zipEntry"),v=m("./support");function w(b){this.files=[],this.loadOptions=b}w.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(f)+", expected "+l.pretty(b)+")")}},isSignature:function(b,f){var u=this.reader.index;this.reader.setIndex(b);var k=this.reader.readString(4)===f;return this.reader.setIndex(u),k},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),f=v.uint8array?"uint8array":"array",u=l.transformTo(f,b);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,f,u,k=this.zip64EndOfCentralSize-44;0<k;)b=this.reader.readInt(2),f=this.reader.readInt(4),u=this.reader.readData(f),this.zip64ExtensibleData[b]={id:b,length:f,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,f;for(b=0;b<this.files.length;b++)f=this.files[b],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(b=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var f=b;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var k=f-u;if(0<k)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=k);else if(k<0)throw new Error("Corrupted zip: missing "+Math.abs(k)+" bytes.")},prepareReader:function(b){this.reader=s(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},I.exports=w},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(m,I,o){var s=m("./reader/readerFor"),l=m("./utils"),a=m("./compressedObject"),c=m("./crc32"),v=m("./utf8"),w=m("./compressions"),b=m("./support");function f(u,k){this.options=u,this.loadOptions=k}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var k,g;if(u.skip(22),this.fileNameLength=u.readInt(2),g=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((k=function(y){for(var n in w)if(Object.prototype.hasOwnProperty.call(w,n)&&w[n].magic===y)return w[n];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,k,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var k=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(k),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=s(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var k,g,y,n=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<n;)k=u.readInt(2),g=u.readInt(2),y=u.readData(g),this.extraFields[k]={id:k,length:g,value:y};u.setIndex(n)},handleUTF8:function(){var u=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=v.utf8decode(this.fileName),this.fileCommentStr=v.utf8decode(this.fileComment);else{var k=this.findExtraFieldUnicodePath();if(k!==null)this.fileNameStr=k;else{var g=l.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var n=l.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var k=s(u.value);return k.readInt(1)!==1||c(this.fileName)!==k.readInt(4)?null:v.utf8decode(k.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var k=s(u.value);return k.readInt(1)!==1||c(this.fileComment)!==k.readInt(4)?null:v.utf8decode(k.readData(u.length-5))}return null}},I.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(m,I,o){function s(k,g,y){this.name=k,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=g,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var l=m("./stream/StreamHelper"),a=m("./stream/DataWorker"),c=m("./utf8"),v=m("./compressedObject"),w=m("./stream/GenericWorker");s.prototype={internalStream:function(k){var g=null,y="string";try{if(!k)throw new Error("No output type specified.");var n=(y=k.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),g=this._decompressWorker();var _=!this._dataBinary;_&&!n&&(g=g.pipe(new c.Utf8EncodeWorker)),!_&&n&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(h){(g=new w("error")).error(h)}return new l(g,y,"")},async:function(k,g){return this.internalStream(k).accumulate(g)},nodeStream:function(k,g){return this.internalStream(k||"nodebuffer").toNodejsStream(g)},_compressWorker:function(k,g){if(this._data instanceof v&&this._data.compression.magic===k.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new c.Utf8EncodeWorker)),v.createWorkerFrom(y,k,g)},_decompressWorker:function(){return this._data instanceof v?this._data.getContentWorker():this._data instanceof w?this._data:new a(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<b.length;u++)s.prototype[b[u]]=f;I.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(m,I,o){(function(s){var l,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var v=0,w=new c(k),b=s.document.createTextNode("");w.observe(b,{characterData:!0}),l=function(){b.data=v=++v%2}}else if(s.setImmediate||s.MessageChannel===void 0)l="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){k(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(k,0)};else{var f=new s.MessageChannel;f.port1.onmessage=k,l=function(){f.port2.postMessage(0)}}var u=[];function k(){var g,y;a=!0;for(var n=u.length;n;){for(y=u,u=[],g=-1;++g<n;)y[g]();n=u.length}a=!1}I.exports=function(g){u.push(g)!==1||a||l()}}).call(this,typeof rt!="undefined"?rt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(m,I,o){var s=m("immediate");function l(){}var a={},c=["REJECTED"],v=["FULFILLED"],w=["PENDING"];function b(n){if(typeof n!="function")throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,n!==l&&g(this,n)}function f(n,_,h){this.promise=n,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof h=="function"&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function u(n,_,h){s(function(){var D;try{D=_(h)}catch(x){return a.reject(n,x)}D===n?a.reject(n,new TypeError("Cannot resolve promise with itself")):a.resolve(n,D)})}function k(n){var _=n&&n.then;if(n&&(typeof n=="object"||typeof n=="function")&&typeof _=="function")return function(){_.apply(n,arguments)}}function g(n,_){var h=!1;function D(B){h||(h=!0,a.reject(n,B))}function x(B){h||(h=!0,a.resolve(n,B))}var F=y(function(){_(x,D)});F.status==="error"&&D(F.value)}function y(n,_){var h={};try{h.value=n(_),h.status="success"}catch(D){h.status="error",h.value=D}return h}(I.exports=b).prototype.finally=function(n){if(typeof n!="function")return this;var _=this.constructor;return this.then(function(h){return _.resolve(n()).then(function(){return h})},function(h){return _.resolve(n()).then(function(){throw h})})},b.prototype.catch=function(n){return this.then(null,n)},b.prototype.then=function(n,_){if(typeof n!="function"&&this.state===v||typeof _!="function"&&this.state===c)return this;var h=new this.constructor(l);return this.state!==w?u(h,this.state===v?n:_,this.outcome):this.queue.push(new f(h,n,_)),h},f.prototype.callFulfilled=function(n){a.resolve(this.promise,n)},f.prototype.otherCallFulfilled=function(n){u(this.promise,this.onFulfilled,n)},f.prototype.callRejected=function(n){a.reject(this.promise,n)},f.prototype.otherCallRejected=function(n){u(this.promise,this.onRejected,n)},a.resolve=function(n,_){var h=y(k,_);if(h.status==="error")return a.reject(n,h.value);var D=h.value;if(D)g(n,D);else{n.state=v,n.outcome=_;for(var x=-1,F=n.queue.length;++x<F;)n.queue[x].callFulfilled(_)}return n},a.reject=function(n,_){n.state=c,n.outcome=_;for(var h=-1,D=n.queue.length;++h<D;)n.queue[h].callRejected(_);return n},b.resolve=function(n){return n instanceof this?n:a.resolve(new this(l),n)},b.reject=function(n){var _=new this(l);return a.reject(_,n)},b.all=function(n){var _=this;if(Object.prototype.toString.call(n)!=="[object Array]")return this.reject(new TypeError("must be an array"));var h=n.length,D=!1;if(!h)return this.resolve([]);for(var x=new Array(h),F=0,B=-1,$=new this(l);++B<h;)T(n[B],B);return $;function T(G,oe){_.resolve(G).then(function(E){x[oe]=E,++F!==h||D||(D=!0,a.resolve($,x))},function(E){D||(D=!0,a.reject($,E))})}},b.race=function(n){var _=this;if(Object.prototype.toString.call(n)!=="[object Array]")return this.reject(new TypeError("must be an array"));var h=n.length,D=!1;if(!h)return this.resolve([]);for(var x=-1,F=new this(l);++x<h;)B=n[x],_.resolve(B).then(function($){D||(D=!0,a.resolve(F,$))},function($){D||(D=!0,a.reject(F,$))});var B;return F}},{immediate:36}],38:[function(m,I,o){var s={};(0,m("./lib/utils/common").assign)(s,m("./lib/deflate"),m("./lib/inflate"),m("./lib/zlib/constants")),I.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(m,I,o){var s=m("./zlib/deflate"),l=m("./utils/common"),a=m("./utils/strings"),c=m("./zlib/messages"),v=m("./zlib/zstream"),w=Object.prototype.toString,b=0,f=-1,u=0,k=8;function g(n){if(!(this instanceof g))return new g(n);this.options=l.assign({level:f,method:k,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},n||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var h=s.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(h!==b)throw new Error(c[h]);if(_.header&&s.deflateSetHeader(this.strm,_.header),_.dictionary){var D;if(D=typeof _.dictionary=="string"?a.string2buf(_.dictionary):w.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(h=s.deflateSetDictionary(this.strm,D))!==b)throw new Error(c[h]);this._dict_set=!0}}function y(n,_){var h=new g(_);if(h.push(n,!0),h.err)throw h.msg||c[h.err];return h.result}g.prototype.push=function(n,_){var h,D,x=this.strm,F=this.options.chunkSize;if(this.ended)return!1;D=_===~~_?_:_===!0?4:0,typeof n=="string"?x.input=a.string2buf(n):w.call(n)==="[object ArrayBuffer]"?x.input=new Uint8Array(n):x.input=n,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new l.Buf8(F),x.next_out=0,x.avail_out=F),(h=s.deflate(x,D))!==1&&h!==b)return this.onEnd(h),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(l.shrinkBuf(x.output,x.next_out))):this.onData(l.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&h!==1);return D===4?(h=s.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===b):D!==2||(this.onEnd(b),!(x.avail_out=0))},g.prototype.onData=function(n){this.chunks.push(n)},g.prototype.onEnd=function(n){n===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg},o.Deflate=g,o.deflate=y,o.deflateRaw=function(n,_){return(_=_||{}).raw=!0,y(n,_)},o.gzip=function(n,_){return(_=_||{}).gzip=!0,y(n,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(m,I,o){var s=m("./zlib/inflate"),l=m("./utils/common"),a=m("./utils/strings"),c=m("./zlib/constants"),v=m("./zlib/messages"),w=m("./zlib/zstream"),b=m("./zlib/gzheader"),f=Object.prototype.toString;function u(g){if(!(this instanceof u))return new u(g);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},g||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||g&&g.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var n=s.inflateInit2(this.strm,y.windowBits);if(n!==c.Z_OK)throw new Error(v[n]);this.header=new b,s.inflateGetHeader(this.strm,this.header)}function k(g,y){var n=new u(y);if(n.push(g,!0),n.err)throw n.msg||v[n.err];return n.result}u.prototype.push=function(g,y){var n,_,h,D,x,F,B=this.strm,$=this.options.chunkSize,T=this.options.dictionary,G=!1;if(this.ended)return!1;_=y===~~y?y:y===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?B.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?B.input=new Uint8Array(g):B.input=g,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new l.Buf8($),B.next_out=0,B.avail_out=$),(n=s.inflate(B,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&T&&(F=typeof T=="string"?a.string2buf(T):f.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,n=s.inflateSetDictionary(this.strm,F)),n===c.Z_BUF_ERROR&&G===!0&&(n=c.Z_OK,G=!1),n!==c.Z_STREAM_END&&n!==c.Z_OK)return this.onEnd(n),!(this.ended=!0);B.next_out&&(B.avail_out!==0&&n!==c.Z_STREAM_END&&(B.avail_in!==0||_!==c.Z_FINISH&&_!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(h=a.utf8border(B.output,B.next_out),D=B.next_out-h,x=a.buf2string(B.output,h),B.next_out=D,B.avail_out=$-D,D&&l.arraySet(B.output,B.output,h,D,0),this.onData(x)):this.onData(l.shrinkBuf(B.output,B.next_out)))),B.avail_in===0&&B.avail_out===0&&(G=!0)}while((0<B.avail_in||B.avail_out===0)&&n!==c.Z_STREAM_END);return n===c.Z_STREAM_END&&(_=c.Z_FINISH),_===c.Z_FINISH?(n=s.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c.Z_OK):_!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(B.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},o.Inflate=u,o.inflate=k,o.inflateRaw=function(g,y){return(y=y||{}).raw=!0,k(g,y)},o.ungzip=k},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(m,I,o){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";o.assign=function(c){for(var v=Array.prototype.slice.call(arguments,1);v.length;){var w=v.shift();if(w){if(typeof w!="object")throw new TypeError(w+"must be non-object");for(var b in w)w.hasOwnProperty(b)&&(c[b]=w[b])}}return c},o.shrinkBuf=function(c,v){return c.length===v?c:c.subarray?c.subarray(0,v):(c.length=v,c)};var l={arraySet:function(c,v,w,b,f){if(v.subarray&&c.subarray)c.set(v.subarray(w,w+b),f);else for(var u=0;u<b;u++)c[f+u]=v[w+u]},flattenChunks:function(c){var v,w,b,f,u,k;for(v=b=0,w=c.length;v<w;v++)b+=c[v].length;for(k=new Uint8Array(b),v=f=0,w=c.length;v<w;v++)u=c[v],k.set(u,f),f+=u.length;return k}},a={arraySet:function(c,v,w,b,f){for(var u=0;u<b;u++)c[f+u]=v[w+u]},flattenChunks:function(c){return[].concat.apply([],c)}};o.setTyped=function(c){c?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,l)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(s)},{}],42:[function(m,I,o){var s=m("./common"),l=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),v=0;v<256;v++)c[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;function w(b,f){if(f<65537&&(b.subarray&&a||!b.subarray&&l))return String.fromCharCode.apply(null,s.shrinkBuf(b,f));for(var u="",k=0;k<f;k++)u+=String.fromCharCode(b[k]);return u}c[254]=c[254]=1,o.string2buf=function(b){var f,u,k,g,y,n=b.length,_=0;for(g=0;g<n;g++)(64512&(u=b.charCodeAt(g)))==55296&&g+1<n&&(64512&(k=b.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(k-56320),g++),_+=u<128?1:u<2048?2:u<65536?3:4;for(f=new s.Buf8(_),g=y=0;y<_;g++)(64512&(u=b.charCodeAt(g)))==55296&&g+1<n&&(64512&(k=b.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(k-56320),g++),u<128?f[y++]=u:(u<2048?f[y++]=192|u>>>6:(u<65536?f[y++]=224|u>>>12:(f[y++]=240|u>>>18,f[y++]=128|u>>>12&63),f[y++]=128|u>>>6&63),f[y++]=128|63&u);return f},o.buf2binstring=function(b){return w(b,b.length)},o.binstring2buf=function(b){for(var f=new s.Buf8(b.length),u=0,k=f.length;u<k;u++)f[u]=b.charCodeAt(u);return f},o.buf2string=function(b,f){var u,k,g,y,n=f||b.length,_=new Array(2*n);for(u=k=0;u<n;)if((g=b[u++])<128)_[k++]=g;else if(4<(y=c[g]))_[k++]=65533,u+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&u<n;)g=g<<6|63&b[u++],y--;1<y?_[k++]=65533:g<65536?_[k++]=g:(g-=65536,_[k++]=55296|g>>10&1023,_[k++]=56320|1023&g)}return w(_,k)},o.utf8border=function(b,f){var u;for((f=f||b.length)>b.length&&(f=b.length),u=f-1;0<=u&&(192&b[u])==128;)u--;return u<0||u===0?f:u+c[b[u]]>f?u:f}},{"./common":41}],43:[function(m,I,o){I.exports=function(s,l,a,c){for(var v=65535&s|0,w=s>>>16&65535|0,b=0;a!==0;){for(a-=b=2e3<a?2e3:a;w=w+(v=v+l[c++]|0)|0,--b;);v%=65521,w%=65521}return v|w<<16|0}},{}],44:[function(m,I,o){I.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(m,I,o){var s=function(){for(var l,a=[],c=0;c<256;c++){l=c;for(var v=0;v<8;v++)l=1&l?3988292384^l>>>1:l>>>1;a[c]=l}return a}();I.exports=function(l,a,c,v){var w=s,b=v+c;l^=-1;for(var f=v;f<b;f++)l=l>>>8^w[255&(l^a[f])];return-1^l}},{}],46:[function(m,I,o){var s,l=m("../utils/common"),a=m("./trees"),c=m("./adler32"),v=m("./crc32"),w=m("./messages"),b=0,f=4,u=0,k=-2,g=-1,y=4,n=2,_=8,h=9,D=286,x=30,F=19,B=2*D+1,$=15,T=3,G=258,oe=G+T+1,E=42,O=113,p=1,U=2,de=3,Z=4;function me(d,M){return d.msg=w[M],M}function R(d){return(d<<1)-(4<d?9:0)}function le(d){for(var M=d.length;0<=--M;)d[M]=0}function N(d){var M=d.state,q=M.pending;q>d.avail_out&&(q=d.avail_out),q!==0&&(l.arraySet(d.output,M.pending_buf,M.pending_out,q,d.next_out),d.next_out+=q,M.pending_out+=q,d.total_out+=q,d.avail_out-=q,M.pending-=q,M.pending===0&&(M.pending_out=0))}function A(d,M){a._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,M),d.block_start=d.strstart,N(d.strm)}function ee(d,M){d.pending_buf[d.pending++]=M}function W(d,M){d.pending_buf[d.pending++]=M>>>8&255,d.pending_buf[d.pending++]=255&M}function K(d,M){var q,S,C=d.max_chain_length,V=d.strstart,j=d.prev_length,H=d.nice_match,P=d.strstart>d.w_size-oe?d.strstart-(d.w_size-oe):0,X=d.window,te=d.w_mask,Q=d.prev,se=d.strstart+G,_e=X[V+j-1],ge=X[V+j];d.prev_length>=d.good_match&&(C>>=2),H>d.lookahead&&(H=d.lookahead);do if(X[(q=M)+j]===ge&&X[q+j-1]===_e&&X[q]===X[V]&&X[++q]===X[V+1]){V+=2,q++;do;while(X[++V]===X[++q]&&X[++V]===X[++q]&&X[++V]===X[++q]&&X[++V]===X[++q]&&X[++V]===X[++q]&&X[++V]===X[++q]&&X[++V]===X[++q]&&X[++V]===X[++q]&&V<se);if(S=G-(se-V),V=se-G,j<S){if(d.match_start=M,H<=(j=S))break;_e=X[V+j-1],ge=X[V+j]}}while((M=Q[M&te])>P&&--C!=0);return j<=d.lookahead?j:d.lookahead}function ye(d){var M,q,S,C,V,j,H,P,X,te,Q=d.w_size;do{if(C=d.window_size-d.lookahead-d.strstart,d.strstart>=Q+(Q-oe)){for(l.arraySet(d.window,d.window,Q,Q,0),d.match_start-=Q,d.strstart-=Q,d.block_start-=Q,M=q=d.hash_size;S=d.head[--M],d.head[M]=Q<=S?S-Q:0,--q;);for(M=q=Q;S=d.prev[--M],d.prev[M]=Q<=S?S-Q:0,--q;);C+=Q}if(d.strm.avail_in===0)break;if(j=d.strm,H=d.window,P=d.strstart+d.lookahead,X=C,te=void 0,te=j.avail_in,X<te&&(te=X),q=te===0?0:(j.avail_in-=te,l.arraySet(H,j.input,j.next_in,te,P),j.state.wrap===1?j.adler=c(j.adler,H,te,P):j.state.wrap===2&&(j.adler=v(j.adler,H,te,P)),j.next_in+=te,j.total_in+=te,te),d.lookahead+=q,d.lookahead+d.insert>=T)for(V=d.strstart-d.insert,d.ins_h=d.window[V],d.ins_h=(d.ins_h<<d.hash_shift^d.window[V+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[V+T-1])&d.hash_mask,d.prev[V&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=V,V++,d.insert--,!(d.lookahead+d.insert<T)););}while(d.lookahead<oe&&d.strm.avail_in!==0)}function ke(d,M){for(var q,S;;){if(d.lookahead<oe){if(ye(d),d.lookahead<oe&&M===b)return p;if(d.lookahead===0)break}if(q=0,d.lookahead>=T&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,q=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),q!==0&&d.strstart-q<=d.w_size-oe&&(d.match_length=K(d,q)),d.match_length>=T)if(S=a._tr_tally(d,d.strstart-d.match_start,d.match_length-T),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=T){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,q=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else S=a._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(S&&(A(d,!1),d.strm.avail_out===0))return p}return d.insert=d.strstart<T-1?d.strstart:T-1,M===f?(A(d,!0),d.strm.avail_out===0?de:Z):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?p:U}function ne(d,M){for(var q,S,C;;){if(d.lookahead<oe){if(ye(d),d.lookahead<oe&&M===b)return p;if(d.lookahead===0)break}if(q=0,d.lookahead>=T&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,q=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=T-1,q!==0&&d.prev_length<d.max_lazy_match&&d.strstart-q<=d.w_size-oe&&(d.match_length=K(d,q),d.match_length<=5&&(d.strategy===1||d.match_length===T&&4096<d.strstart-d.match_start)&&(d.match_length=T-1)),d.prev_length>=T&&d.match_length<=d.prev_length){for(C=d.strstart+d.lookahead-T,S=a._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-T),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=C&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,q=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=T-1,d.strstart++,S&&(A(d,!1),d.strm.avail_out===0))return p}else if(d.match_available){if((S=a._tr_tally(d,0,d.window[d.strstart-1]))&&A(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return p}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(S=a._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<T-1?d.strstart:T-1,M===f?(A(d,!0),d.strm.avail_out===0?de:Z):d.last_lit&&(A(d,!1),d.strm.avail_out===0)?p:U}function he(d,M,q,S,C){this.good_length=d,this.max_lazy=M,this.nice_length=q,this.max_chain=S,this.func=C}function Ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*B),this.dyn_dtree=new l.Buf16(2*(2*x+1)),this.bl_tree=new l.Buf16(2*(2*F+1)),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16($+1),this.heap=new l.Buf16(2*D+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*D+1),le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function we(d){var M;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=n,(M=d.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?E:O,d.adler=M.wrap===2?0:1,M.last_flush=b,a._tr_init(M),u):me(d,k)}function Ve(d){var M=we(d);return M===u&&function(q){q.window_size=2*q.w_size,le(q.head),q.max_lazy_match=s[q.level].max_lazy,q.good_match=s[q.level].good_length,q.nice_match=s[q.level].nice_length,q.max_chain_length=s[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=T-1,q.match_available=0,q.ins_h=0}(d.state),M}function Ae(d,M,q,S,C,V){if(!d)return k;var j=1;if(M===g&&(M=6),S<0?(j=0,S=-S):15<S&&(j=2,S-=16),C<1||h<C||q!==_||S<8||15<S||M<0||9<M||V<0||y<V)return me(d,k);S===8&&(S=9);var H=new Ce;return(d.state=H).strm=d,H.wrap=j,H.gzhead=null,H.w_bits=S,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=C+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+T-1)/T),H.window=new l.Buf8(2*H.w_size),H.head=new l.Buf16(H.hash_size),H.prev=new l.Buf16(H.w_size),H.lit_bufsize=1<<C+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new l.Buf8(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=M,H.strategy=V,H.method=q,Ve(d)}s=[new he(0,0,0,0,function(d,M){var q=65535;for(q>d.pending_buf_size-5&&(q=d.pending_buf_size-5);;){if(d.lookahead<=1){if(ye(d),d.lookahead===0&&M===b)return p;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var S=d.block_start+q;if((d.strstart===0||d.strstart>=S)&&(d.lookahead=d.strstart-S,d.strstart=S,A(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-oe&&(A(d,!1),d.strm.avail_out===0))return p}return d.insert=0,M===f?(A(d,!0),d.strm.avail_out===0?de:Z):(d.strstart>d.block_start&&(A(d,!1),d.strm.avail_out),p)}),new he(4,4,8,4,ke),new he(4,5,16,8,ke),new he(4,6,32,32,ke),new he(4,4,16,16,ne),new he(8,16,32,32,ne),new he(8,16,128,128,ne),new he(8,32,128,256,ne),new he(32,128,258,1024,ne),new he(32,258,258,4096,ne)],o.deflateInit=function(d,M){return Ae(d,M,_,15,8,0)},o.deflateInit2=Ae,o.deflateReset=Ve,o.deflateResetKeep=we,o.deflateSetHeader=function(d,M){return d&&d.state?d.state.wrap!==2?k:(d.state.gzhead=M,u):k},o.deflate=function(d,M){var q,S,C,V;if(!d||!d.state||5<M||M<0)return d?me(d,k):k;if(S=d.state,!d.output||!d.input&&d.avail_in!==0||S.status===666&&M!==f)return me(d,d.avail_out===0?-5:k);if(S.strm=d,q=S.last_flush,S.last_flush=M,S.status===E)if(S.wrap===2)d.adler=0,ee(S,31),ee(S,139),ee(S,8),S.gzhead?(ee(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),ee(S,255&S.gzhead.time),ee(S,S.gzhead.time>>8&255),ee(S,S.gzhead.time>>16&255),ee(S,S.gzhead.time>>24&255),ee(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),ee(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(ee(S,255&S.gzhead.extra.length),ee(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(d.adler=v(d.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(ee(S,0),ee(S,0),ee(S,0),ee(S,0),ee(S,0),ee(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),ee(S,3),S.status=O);else{var j=_+(S.w_bits-8<<4)<<8;j|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(j|=32),j+=31-j%31,S.status=O,W(S,j),S.strstart!==0&&(W(S,d.adler>>>16),W(S,65535&d.adler)),d.adler=1}if(S.status===69)if(S.gzhead.extra){for(C=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>C&&(d.adler=v(d.adler,S.pending_buf,S.pending-C,C)),N(d),C=S.pending,S.pending!==S.pending_buf_size));)ee(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>C&&(d.adler=v(d.adler,S.pending_buf,S.pending-C,C)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){C=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>C&&(d.adler=v(d.adler,S.pending_buf,S.pending-C,C)),N(d),C=S.pending,S.pending===S.pending_buf_size)){V=1;break}V=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,ee(S,V)}while(V!==0);S.gzhead.hcrc&&S.pending>C&&(d.adler=v(d.adler,S.pending_buf,S.pending-C,C)),V===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){C=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>C&&(d.adler=v(d.adler,S.pending_buf,S.pending-C,C)),N(d),C=S.pending,S.pending===S.pending_buf_size)){V=1;break}V=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,ee(S,V)}while(V!==0);S.gzhead.hcrc&&S.pending>C&&(d.adler=v(d.adler,S.pending_buf,S.pending-C,C)),V===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&N(d),S.pending+2<=S.pending_buf_size&&(ee(S,255&d.adler),ee(S,d.adler>>8&255),d.adler=0,S.status=O)):S.status=O),S.pending!==0){if(N(d),d.avail_out===0)return S.last_flush=-1,u}else if(d.avail_in===0&&R(M)<=R(q)&&M!==f)return me(d,-5);if(S.status===666&&d.avail_in!==0)return me(d,-5);if(d.avail_in!==0||S.lookahead!==0||M!==b&&S.status!==666){var H=S.strategy===2?function(P,X){for(var te;;){if(P.lookahead===0&&(ye(P),P.lookahead===0)){if(X===b)return p;break}if(P.match_length=0,te=a._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,te&&(A(P,!1),P.strm.avail_out===0))return p}return P.insert=0,X===f?(A(P,!0),P.strm.avail_out===0?de:Z):P.last_lit&&(A(P,!1),P.strm.avail_out===0)?p:U}(S,M):S.strategy===3?function(P,X){for(var te,Q,se,_e,ge=P.window;;){if(P.lookahead<=G){if(ye(P),P.lookahead<=G&&X===b)return p;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=T&&0<P.strstart&&(Q=ge[se=P.strstart-1])===ge[++se]&&Q===ge[++se]&&Q===ge[++se]){_e=P.strstart+G;do;while(Q===ge[++se]&&Q===ge[++se]&&Q===ge[++se]&&Q===ge[++se]&&Q===ge[++se]&&Q===ge[++se]&&Q===ge[++se]&&Q===ge[++se]&&se<_e);P.match_length=G-(_e-se),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=T?(te=a._tr_tally(P,1,P.match_length-T),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(te=a._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),te&&(A(P,!1),P.strm.avail_out===0))return p}return P.insert=0,X===f?(A(P,!0),P.strm.avail_out===0?de:Z):P.last_lit&&(A(P,!1),P.strm.avail_out===0)?p:U}(S,M):s[S.level].func(S,M);if(H!==de&&H!==Z||(S.status=666),H===p||H===de)return d.avail_out===0&&(S.last_flush=-1),u;if(H===U&&(M===1?a._tr_align(S):M!==5&&(a._tr_stored_block(S,0,0,!1),M===3&&(le(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),N(d),d.avail_out===0))return S.last_flush=-1,u}return M!==f?u:S.wrap<=0?1:(S.wrap===2?(ee(S,255&d.adler),ee(S,d.adler>>8&255),ee(S,d.adler>>16&255),ee(S,d.adler>>24&255),ee(S,255&d.total_in),ee(S,d.total_in>>8&255),ee(S,d.total_in>>16&255),ee(S,d.total_in>>24&255)):(W(S,d.adler>>>16),W(S,65535&d.adler)),N(d),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?u:1)},o.deflateEnd=function(d){var M;return d&&d.state?(M=d.state.status)!==E&&M!==69&&M!==73&&M!==91&&M!==103&&M!==O&&M!==666?me(d,k):(d.state=null,M===O?me(d,-3):u):k},o.deflateSetDictionary=function(d,M){var q,S,C,V,j,H,P,X,te=M.length;if(!d||!d.state||(V=(q=d.state).wrap)===2||V===1&&q.status!==E||q.lookahead)return k;for(V===1&&(d.adler=c(d.adler,M,te,0)),q.wrap=0,te>=q.w_size&&(V===0&&(le(q.head),q.strstart=0,q.block_start=0,q.insert=0),X=new l.Buf8(q.w_size),l.arraySet(X,M,te-q.w_size,q.w_size,0),M=X,te=q.w_size),j=d.avail_in,H=d.next_in,P=d.input,d.avail_in=te,d.next_in=0,d.input=M,ye(q);q.lookahead>=T;){for(S=q.strstart,C=q.lookahead-(T-1);q.ins_h=(q.ins_h<<q.hash_shift^q.window[S+T-1])&q.hash_mask,q.prev[S&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=S,S++,--C;);q.strstart=S,q.lookahead=T-1,ye(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=T-1,q.match_available=0,d.next_in=H,d.input=P,d.avail_in=j,q.wrap=V,u},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(m,I,o){I.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(m,I,o){I.exports=function(s,l){var a,c,v,w,b,f,u,k,g,y,n,_,h,D,x,F,B,$,T,G,oe,E,O,p,U;a=s.state,c=s.next_in,p=s.input,v=c+(s.avail_in-5),w=s.next_out,U=s.output,b=w-(l-s.avail_out),f=w+(s.avail_out-257),u=a.dmax,k=a.wsize,g=a.whave,y=a.wnext,n=a.window,_=a.hold,h=a.bits,D=a.lencode,x=a.distcode,F=(1<<a.lenbits)-1,B=(1<<a.distbits)-1;e:do{h<15&&(_+=p[c++]<<h,h+=8,_+=p[c++]<<h,h+=8),$=D[_&F];t:for(;;){if(_>>>=T=$>>>24,h-=T,(T=$>>>16&255)===0)U[w++]=65535&$;else{if(!(16&T)){if((64&T)==0){$=D[(65535&$)+(_&(1<<T)-1)];continue t}if(32&T){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}G=65535&$,(T&=15)&&(h<T&&(_+=p[c++]<<h,h+=8),G+=_&(1<<T)-1,_>>>=T,h-=T),h<15&&(_+=p[c++]<<h,h+=8,_+=p[c++]<<h,h+=8),$=x[_&B];a:for(;;){if(_>>>=T=$>>>24,h-=T,!(16&(T=$>>>16&255))){if((64&T)==0){$=x[(65535&$)+(_&(1<<T)-1)];continue a}s.msg="invalid distance code",a.mode=30;break e}if(oe=65535&$,h<(T&=15)&&(_+=p[c++]<<h,(h+=8)<T&&(_+=p[c++]<<h,h+=8)),u<(oe+=_&(1<<T)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(_>>>=T,h-=T,(T=w-b)<oe){if(g<(T=oe-T)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(O=n,(E=0)===y){if(E+=k-T,T<G){for(G-=T;U[w++]=n[E++],--T;);E=w-oe,O=U}}else if(y<T){if(E+=k+y-T,(T-=y)<G){for(G-=T;U[w++]=n[E++],--T;);if(E=0,y<G){for(G-=T=y;U[w++]=n[E++],--T;);E=w-oe,O=U}}}else if(E+=y-T,T<G){for(G-=T;U[w++]=n[E++],--T;);E=w-oe,O=U}for(;2<G;)U[w++]=O[E++],U[w++]=O[E++],U[w++]=O[E++],G-=3;G&&(U[w++]=O[E++],1<G&&(U[w++]=O[E++]))}else{for(E=w-oe;U[w++]=U[E++],U[w++]=U[E++],U[w++]=U[E++],2<(G-=3););G&&(U[w++]=U[E++],1<G&&(U[w++]=U[E++]))}break}}break}}while(c<v&&w<f);c-=G=h>>3,_&=(1<<(h-=G<<3))-1,s.next_in=c,s.next_out=w,s.avail_in=c<v?v-c+5:5-(c-v),s.avail_out=w<f?f-w+257:257-(w-f),a.hold=_,a.bits=h}},{}],49:[function(m,I,o){var s=m("../utils/common"),l=m("./adler32"),a=m("./crc32"),c=m("./inffast"),v=m("./inftrees"),w=1,b=2,f=0,u=-2,k=1,g=852,y=592;function n(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function h(E){var O;return E&&E.state?(O=E.state,E.total_in=E.total_out=O.total=0,E.msg="",O.wrap&&(E.adler=1&O.wrap),O.mode=k,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(g),O.distcode=O.distdyn=new s.Buf32(y),O.sane=1,O.back=-1,f):u}function D(E){var O;return E&&E.state?((O=E.state).wsize=0,O.whave=0,O.wnext=0,h(E)):u}function x(E,O){var p,U;return E&&E.state?(U=E.state,O<0?(p=0,O=-O):(p=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?u:(U.window!==null&&U.wbits!==O&&(U.window=null),U.wrap=p,U.wbits=O,D(E))):u}function F(E,O){var p,U;return E?(U=new _,(E.state=U).window=null,(p=x(E,O))!==f&&(E.state=null),p):u}var B,$,T=!0;function G(E){if(T){var O;for(B=new s.Buf32(512),$=new s.Buf32(32),O=0;O<144;)E.lens[O++]=8;for(;O<256;)E.lens[O++]=9;for(;O<280;)E.lens[O++]=7;for(;O<288;)E.lens[O++]=8;for(v(w,E.lens,0,288,B,0,E.work,{bits:9}),O=0;O<32;)E.lens[O++]=5;v(b,E.lens,0,32,$,0,E.work,{bits:5}),T=!1}E.lencode=B,E.lenbits=9,E.distcode=$,E.distbits=5}function oe(E,O,p,U){var de,Z=E.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new s.Buf8(Z.wsize)),U>=Z.wsize?(s.arraySet(Z.window,O,p-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(U<(de=Z.wsize-Z.wnext)&&(de=U),s.arraySet(Z.window,O,p-U,de,Z.wnext),(U-=de)?(s.arraySet(Z.window,O,p-U,U,0),Z.wnext=U,Z.whave=Z.wsize):(Z.wnext+=de,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=de))),0}o.inflateReset=D,o.inflateReset2=x,o.inflateResetKeep=h,o.inflateInit=function(E){return F(E,15)},o.inflateInit2=F,o.inflate=function(E,O){var p,U,de,Z,me,R,le,N,A,ee,W,K,ye,ke,ne,he,Ce,we,Ve,Ae,d,M,q,S,C=0,V=new s.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return u;(p=E.state).mode===12&&(p.mode=13),me=E.next_out,de=E.output,le=E.avail_out,Z=E.next_in,U=E.input,R=E.avail_in,N=p.hold,A=p.bits,ee=R,W=le,M=f;e:for(;;)switch(p.mode){case k:if(p.wrap===0){p.mode=13;break}for(;A<16;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(2&p.wrap&&N===35615){V[p.check=0]=255&N,V[1]=N>>>8&255,p.check=a(p.check,V,2,0),A=N=0,p.mode=2;break}if(p.flags=0,p.head&&(p.head.done=!1),!(1&p.wrap)||(((255&N)<<8)+(N>>8))%31){E.msg="incorrect header check",p.mode=30;break}if((15&N)!=8){E.msg="unknown compression method",p.mode=30;break}if(A-=4,d=8+(15&(N>>>=4)),p.wbits===0)p.wbits=d;else if(d>p.wbits){E.msg="invalid window size",p.mode=30;break}p.dmax=1<<d,E.adler=p.check=1,p.mode=512&N?10:12,A=N=0;break;case 2:for(;A<16;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(p.flags=N,(255&p.flags)!=8){E.msg="unknown compression method",p.mode=30;break}if(57344&p.flags){E.msg="unknown header flags set",p.mode=30;break}p.head&&(p.head.text=N>>8&1),512&p.flags&&(V[0]=255&N,V[1]=N>>>8&255,p.check=a(p.check,V,2,0)),A=N=0,p.mode=3;case 3:for(;A<32;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}p.head&&(p.head.time=N),512&p.flags&&(V[0]=255&N,V[1]=N>>>8&255,V[2]=N>>>16&255,V[3]=N>>>24&255,p.check=a(p.check,V,4,0)),A=N=0,p.mode=4;case 4:for(;A<16;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}p.head&&(p.head.xflags=255&N,p.head.os=N>>8),512&p.flags&&(V[0]=255&N,V[1]=N>>>8&255,p.check=a(p.check,V,2,0)),A=N=0,p.mode=5;case 5:if(1024&p.flags){for(;A<16;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}p.length=N,p.head&&(p.head.extra_len=N),512&p.flags&&(V[0]=255&N,V[1]=N>>>8&255,p.check=a(p.check,V,2,0)),A=N=0}else p.head&&(p.head.extra=null);p.mode=6;case 6:if(1024&p.flags&&(R<(K=p.length)&&(K=R),K&&(p.head&&(d=p.head.extra_len-p.length,p.head.extra||(p.head.extra=new Array(p.head.extra_len)),s.arraySet(p.head.extra,U,Z,K,d)),512&p.flags&&(p.check=a(p.check,U,K,Z)),R-=K,Z+=K,p.length-=K),p.length))break e;p.length=0,p.mode=7;case 7:if(2048&p.flags){if(R===0)break e;for(K=0;d=U[Z+K++],p.head&&d&&p.length<65536&&(p.head.name+=String.fromCharCode(d)),d&&K<R;);if(512&p.flags&&(p.check=a(p.check,U,K,Z)),R-=K,Z+=K,d)break e}else p.head&&(p.head.name=null);p.length=0,p.mode=8;case 8:if(4096&p.flags){if(R===0)break e;for(K=0;d=U[Z+K++],p.head&&d&&p.length<65536&&(p.head.comment+=String.fromCharCode(d)),d&&K<R;);if(512&p.flags&&(p.check=a(p.check,U,K,Z)),R-=K,Z+=K,d)break e}else p.head&&(p.head.comment=null);p.mode=9;case 9:if(512&p.flags){for(;A<16;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(N!==(65535&p.check)){E.msg="header crc mismatch",p.mode=30;break}A=N=0}p.head&&(p.head.hcrc=p.flags>>9&1,p.head.done=!0),E.adler=p.check=0,p.mode=12;break;case 10:for(;A<32;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}E.adler=p.check=n(N),A=N=0,p.mode=11;case 11:if(p.havedict===0)return E.next_out=me,E.avail_out=le,E.next_in=Z,E.avail_in=R,p.hold=N,p.bits=A,2;E.adler=p.check=1,p.mode=12;case 12:if(O===5||O===6)break e;case 13:if(p.last){N>>>=7&A,A-=7&A,p.mode=27;break}for(;A<3;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}switch(p.last=1&N,A-=1,3&(N>>>=1)){case 0:p.mode=14;break;case 1:if(G(p),p.mode=20,O!==6)break;N>>>=2,A-=2;break e;case 2:p.mode=17;break;case 3:E.msg="invalid block type",p.mode=30}N>>>=2,A-=2;break;case 14:for(N>>>=7&A,A-=7&A;A<32;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if((65535&N)!=(N>>>16^65535)){E.msg="invalid stored block lengths",p.mode=30;break}if(p.length=65535&N,A=N=0,p.mode=15,O===6)break e;case 15:p.mode=16;case 16:if(K=p.length){if(R<K&&(K=R),le<K&&(K=le),K===0)break e;s.arraySet(de,U,Z,K,me),R-=K,Z+=K,le-=K,me+=K,p.length-=K;break}p.mode=12;break;case 17:for(;A<14;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(p.nlen=257+(31&N),N>>>=5,A-=5,p.ndist=1+(31&N),N>>>=5,A-=5,p.ncode=4+(15&N),N>>>=4,A-=4,286<p.nlen||30<p.ndist){E.msg="too many length or distance symbols",p.mode=30;break}p.have=0,p.mode=18;case 18:for(;p.have<p.ncode;){for(;A<3;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}p.lens[j[p.have++]]=7&N,N>>>=3,A-=3}for(;p.have<19;)p.lens[j[p.have++]]=0;if(p.lencode=p.lendyn,p.lenbits=7,q={bits:p.lenbits},M=v(0,p.lens,0,19,p.lencode,0,p.work,q),p.lenbits=q.bits,M){E.msg="invalid code lengths set",p.mode=30;break}p.have=0,p.mode=19;case 19:for(;p.have<p.nlen+p.ndist;){for(;he=(C=p.lencode[N&(1<<p.lenbits)-1])>>>16&255,Ce=65535&C,!((ne=C>>>24)<=A);){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(Ce<16)N>>>=ne,A-=ne,p.lens[p.have++]=Ce;else{if(Ce===16){for(S=ne+2;A<S;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(N>>>=ne,A-=ne,p.have===0){E.msg="invalid bit length repeat",p.mode=30;break}d=p.lens[p.have-1],K=3+(3&N),N>>>=2,A-=2}else if(Ce===17){for(S=ne+3;A<S;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}A-=ne,d=0,K=3+(7&(N>>>=ne)),N>>>=3,A-=3}else{for(S=ne+7;A<S;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}A-=ne,d=0,K=11+(127&(N>>>=ne)),N>>>=7,A-=7}if(p.have+K>p.nlen+p.ndist){E.msg="invalid bit length repeat",p.mode=30;break}for(;K--;)p.lens[p.have++]=d}}if(p.mode===30)break;if(p.lens[256]===0){E.msg="invalid code -- missing end-of-block",p.mode=30;break}if(p.lenbits=9,q={bits:p.lenbits},M=v(w,p.lens,0,p.nlen,p.lencode,0,p.work,q),p.lenbits=q.bits,M){E.msg="invalid literal/lengths set",p.mode=30;break}if(p.distbits=6,p.distcode=p.distdyn,q={bits:p.distbits},M=v(b,p.lens,p.nlen,p.ndist,p.distcode,0,p.work,q),p.distbits=q.bits,M){E.msg="invalid distances set",p.mode=30;break}if(p.mode=20,O===6)break e;case 20:p.mode=21;case 21:if(6<=R&&258<=le){E.next_out=me,E.avail_out=le,E.next_in=Z,E.avail_in=R,p.hold=N,p.bits=A,c(E,W),me=E.next_out,de=E.output,le=E.avail_out,Z=E.next_in,U=E.input,R=E.avail_in,N=p.hold,A=p.bits,p.mode===12&&(p.back=-1);break}for(p.back=0;he=(C=p.lencode[N&(1<<p.lenbits)-1])>>>16&255,Ce=65535&C,!((ne=C>>>24)<=A);){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(he&&(240&he)==0){for(we=ne,Ve=he,Ae=Ce;he=(C=p.lencode[Ae+((N&(1<<we+Ve)-1)>>we)])>>>16&255,Ce=65535&C,!(we+(ne=C>>>24)<=A);){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}N>>>=we,A-=we,p.back+=we}if(N>>>=ne,A-=ne,p.back+=ne,p.length=Ce,he===0){p.mode=26;break}if(32&he){p.back=-1,p.mode=12;break}if(64&he){E.msg="invalid literal/length code",p.mode=30;break}p.extra=15&he,p.mode=22;case 22:if(p.extra){for(S=p.extra;A<S;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}p.length+=N&(1<<p.extra)-1,N>>>=p.extra,A-=p.extra,p.back+=p.extra}p.was=p.length,p.mode=23;case 23:for(;he=(C=p.distcode[N&(1<<p.distbits)-1])>>>16&255,Ce=65535&C,!((ne=C>>>24)<=A);){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if((240&he)==0){for(we=ne,Ve=he,Ae=Ce;he=(C=p.distcode[Ae+((N&(1<<we+Ve)-1)>>we)])>>>16&255,Ce=65535&C,!(we+(ne=C>>>24)<=A);){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}N>>>=we,A-=we,p.back+=we}if(N>>>=ne,A-=ne,p.back+=ne,64&he){E.msg="invalid distance code",p.mode=30;break}p.offset=Ce,p.extra=15&he,p.mode=24;case 24:if(p.extra){for(S=p.extra;A<S;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}p.offset+=N&(1<<p.extra)-1,N>>>=p.extra,A-=p.extra,p.back+=p.extra}if(p.offset>p.dmax){E.msg="invalid distance too far back",p.mode=30;break}p.mode=25;case 25:if(le===0)break e;if(K=W-le,p.offset>K){if((K=p.offset-K)>p.whave&&p.sane){E.msg="invalid distance too far back",p.mode=30;break}ye=K>p.wnext?(K-=p.wnext,p.wsize-K):p.wnext-K,K>p.length&&(K=p.length),ke=p.window}else ke=de,ye=me-p.offset,K=p.length;for(le<K&&(K=le),le-=K,p.length-=K;de[me++]=ke[ye++],--K;);p.length===0&&(p.mode=21);break;case 26:if(le===0)break e;de[me++]=p.length,le--,p.mode=21;break;case 27:if(p.wrap){for(;A<32;){if(R===0)break e;R--,N|=U[Z++]<<A,A+=8}if(W-=le,E.total_out+=W,p.total+=W,W&&(E.adler=p.check=p.flags?a(p.check,de,W,me-W):l(p.check,de,W,me-W)),W=le,(p.flags?N:n(N))!==p.check){E.msg="incorrect data check",p.mode=30;break}A=N=0}p.mode=28;case 28:if(p.wrap&&p.flags){for(;A<32;){if(R===0)break e;R--,N+=U[Z++]<<A,A+=8}if(N!==(4294967295&p.total)){E.msg="incorrect length check",p.mode=30;break}A=N=0}p.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return u}return E.next_out=me,E.avail_out=le,E.next_in=Z,E.avail_in=R,p.hold=N,p.bits=A,(p.wsize||W!==E.avail_out&&p.mode<30&&(p.mode<27||O!==4))&&oe(E,E.output,E.next_out,W-E.avail_out)?(p.mode=31,-4):(ee-=E.avail_in,W-=E.avail_out,E.total_in+=ee,E.total_out+=W,p.total+=W,p.wrap&&W&&(E.adler=p.check=p.flags?a(p.check,de,W,E.next_out-W):l(p.check,de,W,E.next_out-W)),E.data_type=p.bits+(p.last?64:0)+(p.mode===12?128:0)+(p.mode===20||p.mode===15?256:0),(ee==0&&W===0||O===4)&&M===f&&(M=-5),M)},o.inflateEnd=function(E){if(!E||!E.state)return u;var O=E.state;return O.window&&(O.window=null),E.state=null,f},o.inflateGetHeader=function(E,O){var p;return E&&E.state?(2&(p=E.state).wrap)==0?u:((p.head=O).done=!1,f):u},o.inflateSetDictionary=function(E,O){var p,U=O.length;return E&&E.state?(p=E.state).wrap!==0&&p.mode!==11?u:p.mode===11&&l(1,O,U,0)!==p.check?-3:oe(E,O,U,U)?(p.mode=31,-4):(p.havedict=1,f):u},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(m,I,o){var s=m("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],v=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];I.exports=function(w,b,f,u,k,g,y,n){var _,h,D,x,F,B,$,T,G,oe=n.bits,E=0,O=0,p=0,U=0,de=0,Z=0,me=0,R=0,le=0,N=0,A=null,ee=0,W=new s.Buf16(16),K=new s.Buf16(16),ye=null,ke=0;for(E=0;E<=15;E++)W[E]=0;for(O=0;O<u;O++)W[b[f+O]]++;for(de=oe,U=15;1<=U&&W[U]===0;U--);if(U<de&&(de=U),U===0)return k[g++]=20971520,k[g++]=20971520,n.bits=1,0;for(p=1;p<U&&W[p]===0;p++);for(de<p&&(de=p),E=R=1;E<=15;E++)if(R<<=1,(R-=W[E])<0)return-1;if(0<R&&(w===0||U!==1))return-1;for(K[1]=0,E=1;E<15;E++)K[E+1]=K[E]+W[E];for(O=0;O<u;O++)b[f+O]!==0&&(y[K[b[f+O]]++]=O);if(B=w===0?(A=ye=y,19):w===1?(A=l,ee-=257,ye=a,ke-=257,256):(A=c,ye=v,-1),E=p,F=g,me=O=N=0,D=-1,x=(le=1<<(Z=de))-1,w===1&&852<le||w===2&&592<le)return 1;for(;;){for($=E-me,G=y[O]<B?(T=0,y[O]):y[O]>B?(T=ye[ke+y[O]],A[ee+y[O]]):(T=96,0),_=1<<E-me,p=h=1<<Z;k[F+(N>>me)+(h-=_)]=$<<24|T<<16|G|0,h!==0;);for(_=1<<E-1;N&_;)_>>=1;if(_!==0?(N&=_-1,N+=_):N=0,O++,--W[E]==0){if(E===U)break;E=b[f+y[O]]}if(de<E&&(N&x)!==D){for(me===0&&(me=de),F+=p,R=1<<(Z=E-me);Z+me<U&&!((R-=W[Z+me])<=0);)Z++,R<<=1;if(le+=1<<Z,w===1&&852<le||w===2&&592<le)return 1;k[D=N&x]=de<<24|Z<<16|F-g|0}}return N!==0&&(k[F+N]=E-me<<24|64<<16|0),n.bits=de,0}},{"../utils/common":41}],51:[function(m,I,o){I.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(m,I,o){var s=m("../utils/common"),l=0,a=1;function c(C){for(var V=C.length;0<=--V;)C[V]=0}var v=0,w=29,b=256,f=b+1+w,u=30,k=19,g=2*f+1,y=15,n=16,_=7,h=256,D=16,x=17,F=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oe=new Array(2*(f+2));c(oe);var E=new Array(2*u);c(E);var O=new Array(512);c(O);var p=new Array(256);c(p);var U=new Array(w);c(U);var de,Z,me,R=new Array(u);function le(C,V,j,H,P){this.static_tree=C,this.extra_bits=V,this.extra_base=j,this.elems=H,this.max_length=P,this.has_stree=C&&C.length}function N(C,V){this.dyn_tree=C,this.max_code=0,this.stat_desc=V}function A(C){return C<256?O[C]:O[256+(C>>>7)]}function ee(C,V){C.pending_buf[C.pending++]=255&V,C.pending_buf[C.pending++]=V>>>8&255}function W(C,V,j){C.bi_valid>n-j?(C.bi_buf|=V<<C.bi_valid&65535,ee(C,C.bi_buf),C.bi_buf=V>>n-C.bi_valid,C.bi_valid+=j-n):(C.bi_buf|=V<<C.bi_valid&65535,C.bi_valid+=j)}function K(C,V,j){W(C,j[2*V],j[2*V+1])}function ye(C,V){for(var j=0;j|=1&C,C>>>=1,j<<=1,0<--V;);return j>>>1}function ke(C,V,j){var H,P,X=new Array(y+1),te=0;for(H=1;H<=y;H++)X[H]=te=te+j[H-1]<<1;for(P=0;P<=V;P++){var Q=C[2*P+1];Q!==0&&(C[2*P]=ye(X[Q]++,Q))}}function ne(C){var V;for(V=0;V<f;V++)C.dyn_ltree[2*V]=0;for(V=0;V<u;V++)C.dyn_dtree[2*V]=0;for(V=0;V<k;V++)C.bl_tree[2*V]=0;C.dyn_ltree[2*h]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0}function he(C){8<C.bi_valid?ee(C,C.bi_buf):0<C.bi_valid&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0}function Ce(C,V,j,H){var P=2*V,X=2*j;return C[P]<C[X]||C[P]===C[X]&&H[V]<=H[j]}function we(C,V,j){for(var H=C.heap[j],P=j<<1;P<=C.heap_len&&(P<C.heap_len&&Ce(V,C.heap[P+1],C.heap[P],C.depth)&&P++,!Ce(V,H,C.heap[P],C.depth));)C.heap[j]=C.heap[P],j=P,P<<=1;C.heap[j]=H}function Ve(C,V,j){var H,P,X,te,Q=0;if(C.last_lit!==0)for(;H=C.pending_buf[C.d_buf+2*Q]<<8|C.pending_buf[C.d_buf+2*Q+1],P=C.pending_buf[C.l_buf+Q],Q++,H===0?K(C,P,V):(K(C,(X=p[P])+b+1,V),(te=B[X])!==0&&W(C,P-=U[X],te),K(C,X=A(--H),j),(te=$[X])!==0&&W(C,H-=R[X],te)),Q<C.last_lit;);K(C,h,V)}function Ae(C,V){var j,H,P,X=V.dyn_tree,te=V.stat_desc.static_tree,Q=V.stat_desc.has_stree,se=V.stat_desc.elems,_e=-1;for(C.heap_len=0,C.heap_max=g,j=0;j<se;j++)X[2*j]!==0?(C.heap[++C.heap_len]=_e=j,C.depth[j]=0):X[2*j+1]=0;for(;C.heap_len<2;)X[2*(P=C.heap[++C.heap_len]=_e<2?++_e:0)]=1,C.depth[P]=0,C.opt_len--,Q&&(C.static_len-=te[2*P+1]);for(V.max_code=_e,j=C.heap_len>>1;1<=j;j--)we(C,X,j);for(P=se;j=C.heap[1],C.heap[1]=C.heap[C.heap_len--],we(C,X,1),H=C.heap[1],C.heap[--C.heap_max]=j,C.heap[--C.heap_max]=H,X[2*P]=X[2*j]+X[2*H],C.depth[P]=(C.depth[j]>=C.depth[H]?C.depth[j]:C.depth[H])+1,X[2*j+1]=X[2*H+1]=P,C.heap[1]=P++,we(C,X,1),2<=C.heap_len;);C.heap[--C.heap_max]=C.heap[1],function(ge,ze){var Ke,qe,Ye,Se,tt,nt,Oe=ze.dyn_tree,ft=ze.max_code,kt=ze.stat_desc.static_tree,Ct=ze.stat_desc.has_stree,St=ze.stat_desc.extra_bits,pt=ze.stat_desc.extra_base,Je=ze.stat_desc.max_length,at=0;for(Se=0;Se<=y;Se++)ge.bl_count[Se]=0;for(Oe[2*ge.heap[ge.heap_max]+1]=0,Ke=ge.heap_max+1;Ke<g;Ke++)Je<(Se=Oe[2*Oe[2*(qe=ge.heap[Ke])+1]+1]+1)&&(Se=Je,at++),Oe[2*qe+1]=Se,ft<qe||(ge.bl_count[Se]++,tt=0,pt<=qe&&(tt=St[qe-pt]),nt=Oe[2*qe],ge.opt_len+=nt*(Se+tt),Ct&&(ge.static_len+=nt*(kt[2*qe+1]+tt)));if(at!==0){do{for(Se=Je-1;ge.bl_count[Se]===0;)Se--;ge.bl_count[Se]--,ge.bl_count[Se+1]+=2,ge.bl_count[Je]--,at-=2}while(0<at);for(Se=Je;Se!==0;Se--)for(qe=ge.bl_count[Se];qe!==0;)ft<(Ye=ge.heap[--Ke])||(Oe[2*Ye+1]!==Se&&(ge.opt_len+=(Se-Oe[2*Ye+1])*Oe[2*Ye],Oe[2*Ye+1]=Se),qe--)}}(C,V),ke(X,_e,C.bl_count)}function d(C,V,j){var H,P,X=-1,te=V[1],Q=0,se=7,_e=4;for(te===0&&(se=138,_e=3),V[2*(j+1)+1]=65535,H=0;H<=j;H++)P=te,te=V[2*(H+1)+1],++Q<se&&P===te||(Q<_e?C.bl_tree[2*P]+=Q:P!==0?(P!==X&&C.bl_tree[2*P]++,C.bl_tree[2*D]++):Q<=10?C.bl_tree[2*x]++:C.bl_tree[2*F]++,X=P,_e=(Q=0)===te?(se=138,3):P===te?(se=6,3):(se=7,4))}function M(C,V,j){var H,P,X=-1,te=V[1],Q=0,se=7,_e=4;for(te===0&&(se=138,_e=3),H=0;H<=j;H++)if(P=te,te=V[2*(H+1)+1],!(++Q<se&&P===te)){if(Q<_e)for(;K(C,P,C.bl_tree),--Q!=0;);else P!==0?(P!==X&&(K(C,P,C.bl_tree),Q--),K(C,D,C.bl_tree),W(C,Q-3,2)):Q<=10?(K(C,x,C.bl_tree),W(C,Q-3,3)):(K(C,F,C.bl_tree),W(C,Q-11,7));X=P,_e=(Q=0)===te?(se=138,3):P===te?(se=6,3):(se=7,4)}}c(R);var q=!1;function S(C,V,j,H){W(C,(v<<1)+(H?1:0),3),function(P,X,te,Q){he(P),Q&&(ee(P,te),ee(P,~te)),s.arraySet(P.pending_buf,P.window,X,te,P.pending),P.pending+=te}(C,V,j,!0)}o._tr_init=function(C){q||(function(){var V,j,H,P,X,te=new Array(y+1);for(P=H=0;P<w-1;P++)for(U[P]=H,V=0;V<1<<B[P];V++)p[H++]=P;for(p[H-1]=P,P=X=0;P<16;P++)for(R[P]=X,V=0;V<1<<$[P];V++)O[X++]=P;for(X>>=7;P<u;P++)for(R[P]=X<<7,V=0;V<1<<$[P]-7;V++)O[256+X++]=P;for(j=0;j<=y;j++)te[j]=0;for(V=0;V<=143;)oe[2*V+1]=8,V++,te[8]++;for(;V<=255;)oe[2*V+1]=9,V++,te[9]++;for(;V<=279;)oe[2*V+1]=7,V++,te[7]++;for(;V<=287;)oe[2*V+1]=8,V++,te[8]++;for(ke(oe,f+1,te),V=0;V<u;V++)E[2*V+1]=5,E[2*V]=ye(V,5);de=new le(oe,B,b+1,f,y),Z=new le(E,$,0,u,y),me=new le(new Array(0),T,0,k,_)}(),q=!0),C.l_desc=new N(C.dyn_ltree,de),C.d_desc=new N(C.dyn_dtree,Z),C.bl_desc=new N(C.bl_tree,me),C.bi_buf=0,C.bi_valid=0,ne(C)},o._tr_stored_block=S,o._tr_flush_block=function(C,V,j,H){var P,X,te=0;0<C.level?(C.strm.data_type===2&&(C.strm.data_type=function(Q){var se,_e=4093624447;for(se=0;se<=31;se++,_e>>>=1)if(1&_e&&Q.dyn_ltree[2*se]!==0)return l;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return a;for(se=32;se<b;se++)if(Q.dyn_ltree[2*se]!==0)return a;return l}(C)),Ae(C,C.l_desc),Ae(C,C.d_desc),te=function(Q){var se;for(d(Q,Q.dyn_ltree,Q.l_desc.max_code),d(Q,Q.dyn_dtree,Q.d_desc.max_code),Ae(Q,Q.bl_desc),se=k-1;3<=se&&Q.bl_tree[2*G[se]+1]===0;se--);return Q.opt_len+=3*(se+1)+5+5+4,se}(C),P=C.opt_len+3+7>>>3,(X=C.static_len+3+7>>>3)<=P&&(P=X)):P=X=j+5,j+4<=P&&V!==-1?S(C,V,j,H):C.strategy===4||X===P?(W(C,2+(H?1:0),3),Ve(C,oe,E)):(W(C,4+(H?1:0),3),function(Q,se,_e,ge){var ze;for(W(Q,se-257,5),W(Q,_e-1,5),W(Q,ge-4,4),ze=0;ze<ge;ze++)W(Q,Q.bl_tree[2*G[ze]+1],3);M(Q,Q.dyn_ltree,se-1),M(Q,Q.dyn_dtree,_e-1)}(C,C.l_desc.max_code+1,C.d_desc.max_code+1,te+1),Ve(C,C.dyn_ltree,C.dyn_dtree)),ne(C),H&&he(C)},o._tr_tally=function(C,V,j){return C.pending_buf[C.d_buf+2*C.last_lit]=V>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&V,C.pending_buf[C.l_buf+C.last_lit]=255&j,C.last_lit++,V===0?C.dyn_ltree[2*j]++:(C.matches++,V--,C.dyn_ltree[2*(p[j]+b+1)]++,C.dyn_dtree[2*A(V)]++),C.last_lit===C.lit_bufsize-1},o._tr_align=function(C){W(C,2,3),K(C,h,oe),function(V){V.bi_valid===16?(ee(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(C)}},{"../utils/common":41}],53:[function(m,I,o){I.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(m,I,o){(function(s){(function(l,a){if(!l.setImmediate){var c,v,w,b,f=1,u={},k=!1,g=l.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(l);y=y&&y.setTimeout?y:l,c={}.toString.call(l.process)==="[object process]"?function(D){process.nextTick(function(){_(D)})}:function(){if(l.postMessage&&!l.importScripts){var D=!0,x=l.onmessage;return l.onmessage=function(){D=!1},l.postMessage("","*"),l.onmessage=x,D}}()?(b="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",h,!1):l.attachEvent("onmessage",h),function(D){l.postMessage(b+D,"*")}):l.MessageChannel?((w=new MessageChannel).port1.onmessage=function(D){_(D.data)},function(D){w.port2.postMessage(D)}):g&&"onreadystatechange"in g.createElement("script")?(v=g.documentElement,function(D){var x=g.createElement("script");x.onreadystatechange=function(){_(D),x.onreadystatechange=null,v.removeChild(x),x=null},v.appendChild(x)}):function(D){setTimeout(_,0,D)},y.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var x=new Array(arguments.length-1),F=0;F<x.length;F++)x[F]=arguments[F+1];var B={callback:D,args:x};return u[f]=B,c(f),f++},y.clearImmediate=n}function n(D){delete u[D]}function _(D){if(k)setTimeout(_,0,D);else{var x=u[D];if(x){k=!0;try{(function(F){var B=F.callback,$=F.args;switch($.length){case 0:B();break;case 1:B($[0]);break;case 2:B($[0],$[1]);break;case 3:B($[0],$[1],$[2]);break;default:B.apply(a,$)}})(x)}finally{n(D),k=!1}}}}function h(D){D.source===l&&typeof D.data=="string"&&D.data.indexOf(b)===0&&_(+D.data.slice(b.length))}})(typeof self=="undefined"?s===void 0?this:s:self)}).call(this,typeof rt!="undefined"?rt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(It);var pa=It.exports;const We={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,destinatario:null,periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{nome:""},ordenacao:"dataHoraFinalizado",direcao:"desc",ordenacaoSefaz:"dhRecbto",direcaoSefaz:"desc"}},ha={components:{Lista:Bt,ComprasFicha:ia,ComprasImportacaoXML:fa},data(){return{usuario:"",clienteSistema:"",lista:[],contatos:{},destinatarioOpcoes:[],destinatarioSelecionado:null,mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"factory",titulo:"Compras",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:"",conexao:{icone:"hibrido",iconeTamanho:"xs",cor:"grey-5",rotulo:null,dica:"H\xEDbrido",denso:!0,flat:!0,escuro:!1}},resultado:{},busca:"",filtros:$utils.clonar(We.filtros),ordenacaoOpcoes:[{value:"dataHoraEmissao",label:"Data Emiss\xE3o"},{value:"dataHoraFinalizado",label:"Data Finalizado"}],ordenacaoSefaz:[{value:"dhRecbto",label:"Data Recebimento"}],direcaoOpcoes:[{value:"desc",label:"Decrescente"},{value:"asc",label:"Crescente"}],tabSelecionada:{valor:"Pedido de Compra"},tabs:[],tabSelecionada2:{valor:"Digita\xE7\xE3o"},tabs2:[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}],paginacao:$utils.clonar(We.paginacao),xmlDevolucao:!1,xmlEstrangeiro:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},abrirNotadeEntrada:null,modalPrevisaoEntrega:{},configImpressao:[],configImpressaoPedidoCompra:[{valor:"ped_compra",texto:"Pedido de Compra",observacao:"Modelo 1"},{valor:"pedidoCompra",texto:"Pedido de Compra",observacao:"Modelo 2"}],dialogEtiquetas:{impressao:!1,adicionar:!1,limpar:!1,item:{}},opcoesModelo:[],modeloSelecionado:"",emBranco:0,opcoesEmpresas:[],empresaSelecionada:"",tabelasPreco:[],opcoesTabelasPreco:[],tabelaPrecoSelecionada:""}},methods:{aoSelecionarDestinatario(){this.filtros.destinatario=$utils.clonar(this.destinatarioSelecionado)},async atualizar(i){var m;const e=$utils.logarIni("ComprasLista");await $tryLoading(async()=>{var w,b,f,u,k,g,y,n,_,h,D,x,F,B,$,T,G,oe,E,O,p,U,de,Z,me;let{buscarTabsRecentes:I,buscarDadosRecentes:o}=i!=null?i:{},s,l,a,c,v;if(I?(s=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ComprasLista_"+((w=this.usuario)==null?void 0:w.id)}),this.tabSelecionada.valor=(s==null?void 0:s.tabSelecionada)||"Pedido de Compra",this.setOpcoesTabs(this.tabSelecionada.valor)):this.setOpcoesTabs(this.tabSelecionada.valor),this.tabSelecionadaAnterior&&this.tabSelecionadaAnterior!==this.tabSelecionada.valor&&(this.filtros=$utils.clonarV2(We.filtros),this.paginacao=$utils.clonarV2(We.paginacao),this.busca="",o=!0),this.tabSelecionadaAnterior=this.tabSelecionada.valor,o&&(l=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ComprasLista_"+this.tabSelecionada.valor+((b=this.usuario)==null?void 0:b.id)}),l!=null&&l._id?(this.tabSelecionada2.valor=l==null?void 0:l.tabSelecionada2,this.destinatarioSelecionado=(f=l==null?void 0:l.filtros)==null?void 0:f.destinatario,this.busca=(l==null?void 0:l.busca)||"",this.paginacao.limite=(l==null?void 0:l.limite)||25,this.filtros={numero:((u=l==null?void 0:l.filtros)==null?void 0:u.numero)||"",numeroCompra:((k=l==null?void 0:l.filtros)==null?void 0:k.numeroCompra)||null,destinatario:((g=l==null?void 0:l.filtros)==null?void 0:g.destinatario)||null,periodoEmissao:{ini:((n=(y=l==null?void 0:l.filtros)==null?void 0:y.periodoEmissao)==null?void 0:n.ini)||"",fim:((h=(_=l==null?void 0:l.filtros)==null?void 0:_.periodoEmissao)==null?void 0:h.fim)||""},periodoFinalizado:{ini:((x=(D=l==null?void 0:l.filtros)==null?void 0:D.periodoFinalizado)==null?void 0:x.ini)||"",fim:((B=(F=l==null?void 0:l.filtros)==null?void 0:F.periodoFinalizado)==null?void 0:B.fim)||""},fornecedor:{nome:((T=($=l==null?void 0:l.filtros)==null?void 0:$.fornecedor)==null?void 0:T.nome)||""},ordenacao:((G=l==null?void 0:l.filtros)==null?void 0:G.ordenacao)||"dataHoraFinalizado",direcao:((oe=l==null?void 0:l.filtros)==null?void 0:oe.direcao)||"desc",ordenacaoSefaz:((E=l==null?void 0:l.filtros)==null?void 0:E.ordenacaoSefaz)||"dhRecbto",direcaoSefaz:((O=l==null?void 0:l.filtros)==null?void 0:O.direcaoSefaz)||"desc"},this.compareObject(We.filtros,this.filtros,["ordenacao","direcao","ordenacaoSefaz","direcaoSefaz"])&&(this.$refs.comprasLista.filtros=!0)):this.tabSelecionada.valor!=="Nota na SEFAZ"?this.tabSelecionada2.valor="Digita\xE7\xE3o":this.tabSelecionada2.valor="N\xE3o Importada",this.tabSelecionada2Anterior=this.tabSelecionada2.valor),a=$utils.eliminarVazios(this.filtros),c=this.paginacao.limite,v=this.paginacao.atual,a.status=this.tabSelecionada2.valor,a.operacao=this.tabSelecionada.valor,delete a.termoBusca,this.busca&&(a.termoBusca=this.busca,this.buscaAnterior!==this.busca&&(this.paginacao.atual=1),this.buscaAnterior=this.busca),this.tabSelecionada2.valor==="Todos"&&delete a.status,a.operacao==="Nota na SEFAZ"){let R=await $db.hibrido.lista({table:"documentoFiscalEletronico",columns:["id","xNomeEmitente","cpfCnpjEmitente","xNomeDestinatario","cpfCnpjDestinatario","vNF","situacao","nNF"],where:{tipo:"DFe",...this.tabSelecionada2.valor!=="Todos"?{situacao:this.tabSelecionada2.valor}:{}}});if(a.numero&&(R=R.filter(ee=>parseInt(ee.nNF)===parseInt(a.numero))),(p=a.fornecedor)!=null&&p.nome&&(R=R.filter(ee=>ee.xNomeEmitente.toLowerCase().includes(a.fornecedor.nome.toLowerCase()))),(U=a.destinatario)!=null&&U.numeroDocumentoNacional&&(R=R.filter(ee=>{var W;return((W=ee.cpfCnpjDestinatario)==null?void 0:W.replace(/\D/g,""))===a.destinatario.numeroDocumentoNacional.replace(/\D/g,"")})),a.termoBusca)if(/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(a.termoBusca))R=R.filter(W=>W.id===a.termoBusca);else{const W=$utils.removerAcentos(a.termoBusca.toUpperCase()).split(" ").filter(Boolean),K=W.filter(ne=>ne.match(/^\d+$/)),ye=W.filter(ne=>!ne.match(/^\d+$/)),ke=[];for(const ne of R){const he=$utils.removerAcentos([ne.xNomeEmitente,ne.xNomeDestinatario,ne.cpfCnpjEmitente,ne.cpfCnpjDestinatario].join(" ").toUpperCase()),Ce=[ne.nNF].map(String);let we=!0;for(const Ve of K)we=we&&Ce.includes(Ve);for(const Ve of ye)we=we&&he.includes(Ve);we&&ke.push(ne)}R=ke}const le=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",columns:["idDocumentoFiscalEletronico","dhRecbto"],whereIn:{idDocumentoFiscalEletronico:R.map(ee=>ee.id)}}),N=[];le.forEach(ee=>{var ne,he;const W=R.find(Ce=>Ce.id===ee.idDocumentoFiscalEletronico),K=new Date(ee.dhRecbto).setHours(0,0,0,0),ye=new Date((ne=a.periodoEmissao)==null?void 0:ne.ini).setHours(0,0,0,0),ke=new Date((he=a.periodoEmissao)==null?void 0:he.fim).setHours(0,0,0,0);(ye||ke)&&K&&(ye&&K<ye||ke&&K>ke)||W&&N.push({id:W.id,descricaoContato:W.xNomeEmitente,numeroDocumentoContato:this.$filters.cpfCnpj(W.cpfCnpjEmitente)||"",descricaoEmpresa:W.xNomeDestinatario,numeroDocumentoEmpresa:this.$filters.cpfCnpj(W.cpfCnpjDestinatario)||"",dhRecbto:ee.dhRecbto,totalDocumento:W.vNF,status:W.situacao,notaNumero:W.nNF})});const A=(v-1)*c;this.paginacao.total=N.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/c)||1,a.direcaoSefaz==="desc"?N.sort((ee,W)=>ee[a.ordenacaoSefaz]<W[a.ordenacaoSefaz]?1:-1):N.sort((ee,W)=>ee[a.ordenacaoSefaz]>W[a.ordenacaoSefaz]?1:-1),this.lista=N.splice(A,c)}else{const R=[a.ordenacao],le=[a.direcao];(de=a.destinatario)!=null&&de.value&&(a.idContatoEmpresa=a.destinatario.value);const N=await $db.compra.leListaCompleta({filtros:a,limit:c,page:v,sort:R,dir:le});this.paginacao.total=N.total,this.paginacao.maximo=N.totalPages,this.lista=N.data.compras}for(const{idContato:R}of this.lista)R&&!this.contatos[R]&&(this.contatos[R]={});this.carregarImagensContatos(this.contatos),this.configuraImpressao(a.idEmpresa),s={_id:"ComprasLista_"+((Z=this.usuario)==null?void 0:Z.id),tabSelecionada:this.tabSelecionada.valor},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:s}),l={_id:"ComprasLista_"+this.tabSelecionada.valor+((me=this.usuario)==null?void 0:me.id),tabSelecionada:this.tabSelecionada.valor,tabSelecionada2:this.tabSelecionada2.valor,filtros:$utils.clonar(this.filtros),busca:this.busca,limite:this.paginacao.limite},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:l})}),$utils.logarFim(e,((m=this.paginacao)==null?void 0:m.total)||1)},async carregarImagensContatos(i){const e=Object.keys(i);if(!!e.length){await $utils.dormir(200);try{const m=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:e}});for(const I of m)i[I.id].imagem=I.imagem||""}catch(m){console.error("Erro ao carregar imagens de contatos - ",m)}}},adicionarXml(i){this.xmlNotaEntrada.arquivo=i[0]},async concluirImportacao(i){await $tryLoading(async()=>{await $db.compra.grava({atual:i}),$q.notifyPositive("Importa\xE7\xE3o realizada com sucesso!"),this.tabSelecionada2.valor="Digita\xE7\xE3o",this.tabSelecionada.valor="Nota de Entrada",await this.$refs.comprasFicha.mostrar({id:i.documento.id})},{mensagem:"Gravando importa\xE7\xE3o..."})},async importarXmlNotaDeEntrada(){var o,s,l,a,c,v,w,b,f,u,k,g;let i;try{$utils.verificarErro(!this.xmlNotaEntrada.arquivo,"Adicione um arquivo XML antes de enviar!"),i=await new Promise((y,n)=>{const _=new FileReader;_.readAsText(this.xmlNotaEntrada.arquivo,"UTF-8"),_.onload=()=>y(_.result),_.onerror=h=>n(h)})}catch(y){return console.error(y),$q.notifyError("Ocorreu um erro na importa\xE7\xE3o"),!1}let e;try{e=await zt.parseStringPromise(i)}catch(y){return console.error(y),$q.notifyError("Arquivo inv\xE1lido ou corrompido"),!1}const m=(v=(c=(a=(l=(s=(o=e==null?void 0:e.nfeProc)==null?void 0:o.NFe)==null?void 0:s[0])==null?void 0:l.infNFe)==null?void 0:a[0])==null?void 0:c.$.Id)==null?void 0:v.substring(3);if($utils.verificarErro(!m,"N\xE3o foi poss\xEDvel encontrar a chave de acesso do XML. Arquivo inv\xE1lido!"),!((g=(k=(u=(f=(b=(w=e==null?void 0:e.nfeProc)==null?void 0:w.protNFe)==null?void 0:b[0])==null?void 0:f.infProt)==null?void 0:u[0])==null?void 0:k.nProt)==null?void 0:g[0])&&!await $q.dialogSimNao({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",html:!0})){$q.notifyError("Opera\xE7\xE3o para importa\xE7\xE3o de XML n\xE3o realizada!",erro);return}await $tryLoading(async()=>{const y=(await $db.hibrido.lista({table:"documento",whereFilter:{chaveAcesso:m}}))[0];$utils.verificarErro(y==null?void 0:y.id,"Esse xml j\xE1 foi importado!");const n=await $db.compra.importaXml({xmlString:i,xmlEstrangeiro:Boolean(this.xmlEstrangeiro)});n.documentosItem.find(({vinculado:_})=>!_)?this.$refs.comprasImportacaoXML.abrir(n):await this.concluirImportacao(n)},{mensagem:"Importando..."}),delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.xmlEstrangeiro=!1},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async abrir(i){this.tabSelecionada.valor!=="Nota na SEFAZ"&&this.$refs.comprasFicha.mostrar({id:i})},criarClick(){this.$refs.comprasFicha.criar()},importarXmlClick(){this.modalXMLNotaEntrada=!0},async limparFiltrosClick(){this.filtros=$utils.clonarV2(We.filtros),this.destinatarioSelecionado=null,await this.atualizar()},compareObject(i,e,m=[]){const I=Object.keys(i);for(const o of I)if(!m.includes(o)){if(typeof i[o]=="object"&&i[o]!==null){if(!this.compareObject(i[o],e[o],m))continue;return!0}else if(i[o]!==e[o])return!0}return!1},setOpcoesTabs(i){i!=="Nota na SEFAZ"?this.tabs2=[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}]:this.tabs2=[{valor:"N\xE3o Importada",rotulo:"N\xE3o Importada"},{valor:"Importada",rotulo:"Importada"},{valor:"Todos",rotulo:"Todas"}],this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.paginacao.atual=1),this.tabSelecionada2Anterior=this.tabSelecionada2.valor},async duplicarDocumento_click(i){!await $q.dialogSimNao({title:"Duplicar",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{const e=await $db.hibrido.le({table:"documento",id:i.id});$utils.verificarErro(!e.id,"Compra n\xE3o encontrada");const m=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:i.id}})).sort((s,l)=>new Date(s.dataHoraEmissao||0)-new Date(l.dataHoraEmissao||0)),I=[],o=$utils.uuid();await $db.hibrido.preGrava(I,"documento",{atual:{...e,id:o,codigoDocumento:void 0,numero:void 0,notaNumero:void 0,notaSerie:void 0,naturezaOperacao:void 0,dataCompra:void 0,chaveAcesso:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,dataHoraPrevisto:void 0,status:"Digita\xE7\xE3o",operacao:"Pedido de Compra"}}),await $db.hibrido.preGravaLista(I,"documentoItem",{atual:m.map(s=>({...s,id:$utils.uuid(),codigoDocumentoItem:void 0,idDocumento:o,codigoDocumento:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,status:"Digita\xE7\xE3o"}))}),await $db.hibrido.enviaLote(I),$q.notifyPositive("Duplica\xE7\xE3o realizada com sucesso!"),this.tabSelecionada2.valor="Digita\xE7\xE3o",this.tabSelecionada.valor="Pedido de Compra",await this.$refs.comprasFicha.mostrar({id:o})},{mensagem:"Duplicando..."})},async trocarCfop_click(i){!await $q.dialogSimNao({title:"Confirma\xE7\xE3o",message:"Deseja trocar os CFOP iniciados em 5 para 1556 e 6 para 2556?"})||await $tryLoading(async()=>{var l,a;const e=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:i.id}}),m=$utils.clonarV2(e),I=await $db.hibrido.lista({table:"cfop",whereIn:{id:$utils.unicos(m,"idCfop")}});let o=0;for(const c of I){const v=String((l=c.cfop)!=null?l:""),w=["5401","5402","5403","5405"].includes(v)?"1407":["6401","6402","6403","6405"].includes(v)?"2407":v.charAt(0)==="5"?"1556":v.charAt(0)==="6"?"2556":v;if(w!==v){const b=(a=(await $db.hibrido.lista({table:"cfop",where:{cfop:w}}))[0])==null?void 0:a.id;$utils.verificarErro(!b,`CFOP ${w} n\xE3o encontrado`);for(const f of m)f.idCfop===c.id&&(f.idCfop=b,o++)}}$utils.verificarErro(!o,"N\xE3o h\xE1 CFOPs com inicial 5 ou 6 para realizar trocas");const s=[];await $db.hibrido.preGravaLista(s,"documentoItem",{atual:m,original:e}),await $db.hibrido.enviaLote(s),$q.notifyPositive(`Troca de CFOP realizada com sucesso em ${o} itens!`)},{mensagem:"Processando..."})},async alterarPrevisaoEntrega_click(i){var e,m;this.modalPrevisaoEntrega={visivel:!0,dataPrevistaEntrega:(e=i.dataHoraPrevisto)==null?void 0:e.slice(0,10),horaPrevistaEntrega:(m=i.dataHoraPrevisto)==null?void 0:m.slice(11,16),compra:i}},async alterarPrevisaoEntrega(){await $tryLoading(async()=>{const{compra:i,dataPrevistaEntrega:e,horaPrevistaEntrega:m}=this.modalPrevisaoEntrega;$utils.verificarErro(!e,"\xC9 necess\xE1rio preencher a data");const I=Fe.formatDate(`${e} ${m||"00:00:00"}`);$utils.verificarErro(!I,"Data Inv\xE1lida"),I!==Fe.formatDate(i.dataHoraPrevisto)?(await $db.hibrido.grava("documento",{atual:{id:i.id,dataHoraPrevisto:I}}),i.dataHoraPrevisto=I,$q.notifyPositive("A previs\xE3o foi salva com sucesso"),this.modalPrevisaoEntrega={}):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")})},async downloadXmlDFeFiltrados(){var i,e,m,I,o;if(!!await $q.dialogSimNao({title:"Download XML's filtrados",message:"Deseja prosseguir com a opera\xE7\xE3o?"}))try{$q.loading.show();let s=[];if($db.hibrido.isOnline())s=(o=(I=(m=await $utils.geeksApi({downloadDFe:{funcao:"2D9F9B43-47D3-491E-AD49-528EC9547BDC",...this.tabSelecionada2.valor!=="Todos"?{situacao:this.tabSelecionada2.valor}:{},fornecedor:(i=this.filtros.fornecedor)==null?void 0:i.nome,numeroDocumentoNacionalDestinatario:(e=this.filtros.destinatario)==null?void 0:e.numeroDocumentoNacional,periodoRecbto:this.filtros.periodoEmissao}}))==null?void 0:m.data)==null?void 0:I.downloadDFe)!=null?o:[];else{let l=await $db.hibrido.lista({table:"documentoFiscalEletronico",columns:["id","dhEmi","cpfCnpjEmitente","cpfCnpjDestinatario","xNomeEmitente","xNomeDestinatario"],where:{tipo:"DFe",...this.tabSelecionada2.valor!=="Todos"?{situacao:this.tabSelecionada2.valor}:{}}});l=l.filter(c=>{var v,w,b;return!(((v=this.filtros.fornecedor)==null?void 0:v.nome)&&!c.xNomeEmitente.toLowerCase().includes(this.filtros.fornecedor.nome.toLowerCase())||((w=this.filtros.destinatario)==null?void 0:w.numeroDocumentoNacional)&&((b=c.cpfCnpjDestinatario)==null?void 0:b.replace(/\D/g,""))!==this.filtros.destinatario.numeroDocumentoNacional.replace(/\D/g,""))}),(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",columns:["idDocumentoFiscalEletronico","chNFe","dhRecbto","xmlProt"],whereIn:{idDocumentoFiscalEletronico:l.map(c=>c.id)}})).forEach(c=>{var u,k;const v=l.find(g=>g.id===c.idDocumentoFiscalEletronico),w=new Date(c.dhRecbto).setHours(0,0,0,0),b=new Date((u=this.filtros.periodoEmissao)==null?void 0:u.ini).setHours(0,0,0,0),f=new Date((k=this.filtros.periodoEmissao)==null?void 0:k.fim).setHours(0,0,0,0);(b||f)&&w&&(b&&w<b||f&&w>f)||v&&s.push({chNFe:c.chNFe,xml:c.xmlProt,cnpj:v.cpfCnpjDestinatario})})}if((s==null?void 0:s.length)>0){const l=Array.from(new Set(s.filter(c=>c.cnpj).map(c=>c.cnpj))),a=new pa;for(const c of l)for(const v of s.filter(w=>w.cnpj===c))a.file(`${c}/${v.chNFe}.procNFe.xml`,v.xml);a.generateAsync({type:"blob"}).then(function(c){const v=new Date,w=document.createElement("a");w.href=window.URL.createObjectURL(c),w.download=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}_NotasEntradaSEFAZ.zip`,w.click()})}}catch{$q.notify({message:"N\xE3o foi poss\xEDvel realizar o download",type:"negative"})}finally{$q.loading.hide()}},async downloadXmlDFe(i,e){!await $q.dialogSimNao({title:"Download XML",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{var c;const I=(e==="Nota de Entrada"?await $db.hibrido.lista({table:"documentoXML",where:{idDocumento:i}}):await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:i}}))[0],o=(I==null?void 0:I.xmlProt)||(I==null?void 0:I.xmlData),s=(I==null?void 0:I.chNFe)||((c=/<chNFe>(\d+)<\/chNFe>/i.exec(o))==null?void 0:c[1]);$utils.verificarErro(!o,"N\xE3o foi poss\xEDvel recuperar o XML");const l=document.createElement("a"),a=new Blob([o],{type:"text/plain"});l.setAttribute("href",window.URL.createObjectURL(a)),l.setAttribute("download",`${s||i}-procNFe.xml`),l.click()})},async importarXmlDFe(i){!await $q.dialogSimNao({title:"Importar XML",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{const e=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i}),m=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:i}}))[0];if((e==null?void 0:e.id)&&(m==null?void 0:m.xmlProt)){const I=(await $db.hibrido.lista({table:"documento",whereFilter:{chaveAcesso:m==null?void 0:m.chNFe}}))[0];$utils.verificarErro(I==null?void 0:I.id,"Esse xml j\xE1 foi importado!");const o=await $db.compra.importaXml({xmlString:m.xmlProt});o.documentoFiscalEletronico={id:i,situacao:"Importada"},o.documentosItem.find(({vinculado:s})=>!s)?this.$refs.comprasImportacaoXML.abrir(o):await this.concluirImportacao(o)}},{mensagem:"Importando..."})},async destinatarioOpcoesCarregar(){const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.destinatarioOpcoes=i.map(e=>({label:e.nome,value:e.id,numeroDocumentoNacional:e.numeroDocumentoNacional}))},async configuraImpressao(i){const e=await $db.configuracoes.porNome("impressao.compra",i);this.configImpressao=[...e.length?e.map(m=>({valor:m.valor,texto:m.texto,observacao:m.observacao})):[{valor:"invoice",texto:"Pedido de Compra",observacao:"Invoice"}]]},imprimirPedidoCompra(i,e){i==="pedidoCompra"&&this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/OptiSoul/pedidoCompra.html
            ?CodigoDocumento=${e}
            &hfCodigoSistema=${encodeURIComponent(JSON.stringify({data:{CodigoUsuario:this.usuario.codigoUsuario,CodigoSistema:this.clienteSistema.codigoSistema,CodigoClienteSistema:this.clienteSistema.codigoClienteSistema,Sistema:this.clienteSistema.sistema,URLServidor:this.clienteSistema.urlServidor,BancoDeDados:this.clienteSistema.bancoDeDados,CodigoCliente:this.clienteSistema.codigoCliente,Cliente:this.clienteSistema.cliente,Administrador:this.clienteSistema.administrador,GrupoInterno:this.clienteSistema.grupoInterno}}))}
          `),i==="ped_compra"&&this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/distribuidor/email.html
            ?CodigoDocumento=${e}
            &URLServidor=${encodeURIComponent(this.clienteSistema.urlServidor)}
            &Banco=${encodeURIComponent(this.clienteSistema.bancoDeDados)}
            &NomeReport=ped_compra
            &CodigoUsuario=${this.usuario.codigoUsuario}
            &hfCodigoSistema=${encodeURIComponent(JSON.stringify({data:{CodigoUsuario:this.usuario.codigoUsuario,CodigoSistema:this.clienteSistema.codigoSistema,CodigoClienteSistema:this.clienteSistema.codigoClienteSistema,Sistema:this.clienteSistema.sistema,Versao:this.clienteSistema.versao,URLServidor:this.clienteSistema.urlServidor,BancoDeDados:this.clienteSistema.bancoDeDados,CodigoCliente:this.clienteSistema.codigoCliente,Cliente:this.clienteSistema.cliente,Padrao:this.clienteSistema.padrao?this.clienteSistema.padrao:null,Administrador:this.clienteSistema.administrador,GrupoInterno:this.clienteSistema.grupoInterno}}))}
          `)},async configuraEtiqueta(){const i=await $db.configuracoes.le({nome:"impressao.etiqueta"}),e=await $db.configuracoes.le({prefixoNome:"impressao.optisoul.etiqueta."});this.opcoesModelo=[],i.length?i.forEach(m=>{this.opcoesModelo.push({rotulo:m.texto,valor:m.observacao&&m.observacao.trim()!==""?m.observacao:m.valor,modelo:m.valor})}):this.opcoesModelo.push({rotulo:"Etiqueta Carta (EBF-23)",valor:"etiqueta-carta-ebf23",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila \xD3culos/Joias",valor:"etiqueta-fila-joias",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila 3 Colunas",valor:"etiqueta-fila-3colunas",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Pimaco (A4 96)",valor:"etiqueta-pimaco-a496",modelo:"imprimir-etiquetas"}),e.length&&e.forEach(m=>{this.opcoesModelo.push({rotulo:m.texto,valor:m.valor.replace("OptiSoul/","")})}),this.modeloSelecionado=this.opcoesModelo[0].valor},async configuraEmpresas(){const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.opcoesEmpresas=i.map(e=>({rotulo:e.apelido||e.nome,valor:e.id,codigoEmpresa:e.codigoContato})),this.empresaSelecionada=""},async configuraTabelasPreco(){this.tabelasPreco=await $db.itemTabelaPreco.le({ativo:!0,tabelaMaster:!0})||[],this.opcoesTabelasPreco=this.tabelasPreco.map(i=>({rotulo:i.descricao,valor:i.id,codigoItemTabelaPreco:i.codigoItemTabelaPreco})),this.tabelaPrecoSelecionada=""},async dialogImprimirEtiquetas({acao:i,item:e}){try{await this.configuraEtiqueta(),await this.configuraEmpresas(),await this.configuraTabelasPreco(),this.dialogEtiquetas={[i]:!0,item:e||{},limpar:!1}}catch(m){console.error("Erro ao configurar impress\xE3o de etiquetas",m)}},imprimirEtiquetas(i){var e,m,I,o,s;if(i==="etiqueta_generica_ajustavel"||i==="etiqueta-fila"||i==="etiqueta-carta"||i==="EtiquetaPimaco6Col"){const l=i==="etiqueta_generica_ajustavel"?"":"OptiSoul/";this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/${l}${i}.html
            ?Banco=${encodeURIComponent(this.clienteSistema.bancoDeDados)}
            &URLServidor=${encodeURIComponent(this.clienteSistema.urlServidor)}
            &CodigoUsuario=${this.usuario.codigoUsuario}
            &EmBranco=${this.emBranco}
            &CodigoPedido=${(m=(e=this.dialogEtiquetas)==null?void 0:e.item)==null?void 0:m.codigoDocumento}
            &TabelaPreco=${this.tabelaPrecoSelecionada?encodeURIComponent(this.opcoesTabelasPreco.find(a=>a.valor===this.tabelaPrecoSelecionada).codigoItemTabelaPreco):""}
            &CodigoContatoEmpresa=${this.empresaSelecionada?encodeURIComponent(this.opcoesEmpresas.find(a=>a.valor===this.empresaSelecionada).codigoEmpresa):""}
            &cpfUsuarioLogado=${encodeURIComponent(this.usuario.cpf)}
            &hfCodigoSistema=${encodeURIComponent(JSON.stringify({data:{CodigoUsuario:this.usuario.codigoUsuario,CodigoSistema:this.clienteSistema.codigoSistema,CodigoClienteSistema:this.clienteSistema.codigoClienteSistema,Sistema:this.clienteSistema.sistema,URLServidor:this.clienteSistema.urlServidor,BancoDeDados:this.clienteSistema.bancoDeDados,CodigoCliente:this.clienteSistema.codigoCliente,Cliente:this.clienteSistema.cliente,Administrador:this.clienteSistema.administrador,GrupoInterno:this.clienteSistema.grupoInterno}}))}
          `)}else{const l=(I=this.opcoesModelo)==null?void 0:I.find(v=>v.valor===i),a=(l==null?void 0:l.modelo)||"",c=(l==null?void 0:l.valor)||"";$imprimir(a,{id:(s=(o=this.dialogEtiquetas)==null?void 0:o.item)==null?void 0:s.id,impressao:"etiquetas"},{modelo:c,idEmpresa:this.empresaSelecionada,idTabelaPreco:this.tabelaPrecoSelecionada,emBranco:this.emBranco})}},abrirImpressao(i){window.open(i.replace(/[\s\n]/g,""),"_blank").focus()},async adicionarEtiquetas(){var i;try{$q.loading.show();const e=this.dialogEtiquetas;let m=await $db.etiqueta.ler({cpfUsuarioLogado:this.usuario.numeroDocumentoNacional})||[];if(e!=null&&e.limpar){for(const l of m)await $db.etiqueta.remover(l.id);m=[]}const I=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:(i=e==null?void 0:e.item)==null?void 0:i.id}});if(!I.length){$q.notifyError("N\xE3o foi poss\xEDvel encontrar itens para carregar a impress\xE3o etiquetas");return}const o=I.map(l=>l.idItem),s=await $db.hibrido.lista({table:"item",columns:["id","codigoItem","descricaoConcatenada","valorVenda"],whereIn:{id:o}});if(!s.length){$q.notifyError("N\xE3o foi poss\xEDvel encontrar itens para carregar a impress\xE3o etiquetas");return}for(const l of s){if(m.length){const c=m.find(v=>v.idItem===l.id)||null;c&&await $db.etiqueta.remover(c==null?void 0:c.id)}const a={id:$utils.uuid(),idItem:l.id,nomeProduto:l.descricaoConcatenada,valor:l.valorVenda||0,quantidadeEtiquetas:I.find(c=>c.idItem===l.id).quantidade||0,cpfUsuarioLogado:this.usuario.numeroDocumentoNacional,dataHoraEmissao:$utils.dataAtual()};await $db.etiqueta.gravar({atual:a})}$q.loading.hide(),this.$q.dialog({title:"",message:"Ir para tela de impress\xE3o de etiquetas?",noRefocus:!0,preventClose:!0,ok:{label:"SIM",push:!0,class:"bg-primary",textColor:"white",flat:!0},cancel:{label:"N\xC3O",push:!0,color:"tertiary",flat:!0}}).onOk(()=>{this.$router.push({name:"EtiquetasLista"})}).onCancel(()=>{this.dialogEtiquetas.adicionar=!1})}catch(e){$q.loading.hide(),$q.notifyError("Erro ao adicionar etiquetas",e)}}},watch:{"tabSelecionada.valor"(){this.tabSelecionada.valor==="Nota na SEFAZ"?this.mostrar.btnMenuMais=!0:this.mostrar.btnMenuMais=!1}},async mounted(){await this.destinatarioOpcoesCarregar(),this.usuario=JSON.parse(localStorage.getItem("usuario")),this.clienteSistema=JSON.parse(localStorage.getItem("clienteSistema"));const i=[{valor:"Pedido de Compra",rotulo:"Pedido de Compra"},{valor:"Nota de Entrada",rotulo:"Nota de Entrada"}];[52,53,62].includes(Number(this.clienteSistema.codigoSistema))&&i.push({valor:"Nota na SEFAZ",rotulo:"Nota na SEFAZ"}),this.tabs=i,this.atualizar({buscarTabsRecentes:!0,buscarDadosRecentes:!0})}},ga={id:"ComprasLista"},va={class:"mw80 text-center"},ba={key:0,class:"text-weight-medium"},ya={class:"row q-ma-md"},wa={key:0,class:"row q-ma-md"},_a={class:"certificado-error-messages"},Ia={class:"col-12"},ka={class:"col-12"},Ca={class:"q-mt-lg text-right"};function Sa(i,e,m,I,o,s){const l=pe("campo"),a=pe("BadgeCopiarUid"),c=pe("avatar"),v=pe("g-label"),w=pe("badge"),b=pe("g-col"),f=pe("g-row"),u=pe("Lista"),k=pe("ComprasFicha"),g=pe("ComprasImportacaoXML"),y=pe("row");return L(),Ie("div",ga,[t(u,{ref:"comprasLista",busca:o.busca,"onUpdate:busca":e[15]||(e[15]=n=>o.busca=n),onAtualizar:s.atualizar,onLimparFiltrosClick:s.limparFiltrosClick,onCriarClick:s.criarClick,lista:o.lista,tabSelecionada:o.tabSelecionada,tabs:o.tabs,tabSelecionada2:o.tabSelecionada2,tabs2:o.tabs2,paginacao:o.paginacao,mostrar:o.mostrar},{menuExtras:r(()=>[be((L(),J(fe,{onClick:s.downloadXmlDFeFiltrados,clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"download"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[31]||(e[31]=[z("Download")])),_:1}),t(ue,{caption:""},{default:r(()=>e[32]||(e[32]=[z("XML's filtrados")])),_:1})]),_:1})]),_:1},8,["onClick"])),[[Ee]])]),botaoNovo:r(()=>[t(ce,{label:"Novo",icon:"add",unelevated:"",color:"primary","text-color":"white",class:"hideonmobile"},{default:r(()=>[t(Ue,null,{default:r(()=>[t(Ne,{link:"","no-border":"",separator:""},{default:r(()=>[be((L(),J(fe,{onClick:s.criarClick,clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"add"})]),_:1}),t(Y,null,{default:r(()=>e[33]||(e[33]=[z("Incluir Manual")])),_:1})]),_:1},8,["onClick"])),[[Ee]]),be((L(),J(fe,{onClick:s.importarXmlClick,clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"add"})]),_:1}),t(Y,null,{default:r(()=>e[34]||(e[34]=[z("Importar XML")])),_:1})]),_:1},8,["onClick"])),[[Ee]])]),_:1})]),_:1})]),_:1}),t(ce,{icon:"add",flat:"",round:"",color:"primary","text-color":"white",class:"hideondesktop"},{default:r(()=>[t(Ue,null,{default:r(()=>[t(Ne,{link:"","no-border":"",separator:""},{default:r(()=>[be((L(),J(fe,{onClick:s.criarClick,clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"add"})]),_:1}),t(Y,null,{default:r(()=>e[35]||(e[35]=[z("Incluir Manual")])),_:1})]),_:1},8,["onClick"])),[[Ee]]),be((L(),J(fe,{onClick:s.importarXmlClick,clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"add"})]),_:1}),t(Y,null,{default:r(()=>e[36]||(e[36]=[z("Importar XML")])),_:1})]),_:1},8,["onClick"])),[[Ee]])]),_:1})]),_:1})]),_:1})]),filtroCampos:r(()=>[t(l,{modelValue:o.filtros.numero,"onUpdate:modelValue":e[0]||(e[0]=n=>o.filtros.numero=n),dense:"",rotulo:"N\xBA Nota",class:"q-mt-md"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.numeroCompra,"onUpdate:modelValue":e[1]||(e[1]=n=>o.filtros.numeroCompra=n),dense:"",rotulo:"Ordem de compra",class:"q-mt-lg"},null,8,["modelValue"]),t(Ft,{modelValue:o.destinatarioSelecionado,"onUpdate:modelValue":[e[2]||(e[2]=n=>o.destinatarioSelecionado=n),s.aoSelecionarDestinatario],options:o.destinatarioOpcoes,clearable:"",dense:"",label:"Destinat\xE1rio",class:"q-mt-lg"},null,8,["modelValue","onUpdate:modelValue","options"]),t(l,{modelValue:o.filtros.fornecedor.nome,"onUpdate:modelValue":e[3]||(e[3]=n=>o.filtros.fornecedor.nome=n),dense:"",rotulo:"Fornecedor",class:"q-mt-lg"},null,8,["modelValue"]),this.tabSelecionada.valor==="Nota na SEFAZ"?(L(),Ie(De,{key:0},[t(l,{modelValue:o.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[4]||(e[4]=n=>o.filtros.periodoEmissao.ini=n),dense:"",rotulo:"Data Emiss\xE3o",tipo:"data",class:"q-mt-xl"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[5]||(e[5]=n=>o.filtros.periodoEmissao.fim=n),dense:"",tipo:"data",rotulo:"at\xE9",class:"q-mt-sm"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.ordenacaoSefaz,"onUpdate:modelValue":e[6]||(e[6]=n=>o.filtros.ordenacaoSefaz=n),options:o.ordenacaoSefaz,dense:"",rotuloFixo:"Ordenar por",tipo:"seletor",class:"q-mt-xl"},null,8,["modelValue","options"]),t(l,{modelValue:o.filtros.direcaoSefaz,"onUpdate:modelValue":e[7]||(e[7]=n=>o.filtros.direcaoSefaz=n),options:o.direcaoOpcoes,dense:"",rotuloFixo:"Dire\xE7\xE3o",tipo:"seletor",class:"q-mt-sm"},null,8,["modelValue","options"])],64)):(L(),Ie(De,{key:1},[t(l,{modelValue:o.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[8]||(e[8]=n=>o.filtros.periodoEmissao.ini=n),dense:"",tipo:"data",rotulo:"Data Emiss\xE3o",class:"q-mt-xl"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[9]||(e[9]=n=>o.filtros.periodoEmissao.fim=n),dense:"",rotulo:"at\xE9",tipo:"data",class:"q-mt-sm"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.periodoFinalizado.ini,"onUpdate:modelValue":e[10]||(e[10]=n=>o.filtros.periodoFinalizado.ini=n),dense:"",tipo:"data",rotulo:"Data Finalizado",class:"q-mt-xl"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.periodoFinalizado.fim,"onUpdate:modelValue":e[11]||(e[11]=n=>o.filtros.periodoFinalizado.fim=n),dense:"",tipo:"data",rotulo:"at\xE9",class:"q-mt-sm"},null,8,["modelValue"]),t(l,{modelValue:o.filtros.ordenacao,"onUpdate:modelValue":e[12]||(e[12]=n=>o.filtros.ordenacao=n),options:o.ordenacaoOpcoes,dense:"",rotuloFixo:"Ordenar por",tipo:"seletor",class:"q-mt-xl"},null,8,["modelValue","options"]),t(l,{modelValue:o.filtros.direcao,"onUpdate:modelValue":e[13]||(e[13]=n=>o.filtros.direcao=n),options:o.direcaoOpcoes,dense:"",rotuloFixo:"Dire\xE7\xE3o",tipo:"seletor",class:"q-mt-sm"},null,8,["modelValue","options"])],64)),t(l,{modelValue:o.paginacao.limite,"onUpdate:modelValue":e[14]||(e[14]=n=>o.paginacao.limite=n),dense:"",min:"1",tipo:"quantidade",rotulo:"Quantidade por p\xE1gina",class:"q-mt-xl q-mb-lg"},null,8,["modelValue"])]),itemLista:r(()=>[t(Ne,{bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:r(()=>[(L(!0),Ie(De,null,Te(o.lista,n=>(L(),Ie("div",{key:n.id,class:"itemHover"},[t(fe,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:r(()=>[t(Y,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:r(()=>[ve("div",va,[t(a,{id:n.id,numero:n.numero,cor:"positive",escuro:""},null,8,["id","numero"])])]),_:2},1024),t(Y,{class:"col-md col-lg col-xl no-margin"},{default:r(()=>[t(fe,{class:"q-pa-none"},{default:r(()=>[t(Y,{onClick:_=>s.abrir(n.id),class:"col-auto items-center cursor-pointer"},{default:r(()=>[t(c,{imagem:(o.contatos[n.idContato]||{}).imagem,rotulo:n.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),t(Y,{class:"col"},{default:r(()=>[t(ue,{onClick:_=>s.abrir(n.id),lines:"2",class:"text-weight-bold cursor-pointer"},{default:r(()=>[z(ae(n.descricaoContato)+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[37]||(e[37]=[z("Fornecedor")])),_:1})]),_:2},1032,["onClick"]),n.descricaoEmpresa?(L(),J(ue,{key:0,onClick:_=>s.abrir(n.id),caption:"",class:"cursor-pointer"},{default:r(()=>[n.descricaoEmpresa?(L(),J(v,{key:0,icon:"business 14px tertiary left"},{default:r(()=>[z(ae(n.descricaoEmpresa)+" ",1),n.numeroDocumentoEmpresa?(L(),Ie("span",ba,"("+ae(n.numeroDocumentoEmpresa)+")",1)):re("",!0)]),_:2},1024)):re("",!0)]),_:2},1032,["onClick"])):re("",!0),t(fe,{class:"q-pa-none hideonmobile q-mt-xs",style:{"min-height":"unset"}},{default:r(()=>[n.notaNumero?(L(),J(w,{key:0,cor:"tertiary",class:"mw50 text-center",escuro:""},{default:r(()=>[z(ae(n.notaNumero)+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[38]||(e[38]=[z("N\xFAmero da Nota")])),_:1})]),_:2},1024)):(L(),J(w,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:r(()=>[e[40]||(e[40]=z(" S/N ")),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[39]||(e[39]=[z("N\xFAmero da Nota")])),_:1})]),_:1}))]),_:2},1024),t(Y,{class:"hideondesktop q-mt-sm"},{default:r(()=>[t(f,{mg:"xs-b"},{default:r(()=>[n.dataHoraEmissao?(L(),J(b,{key:0,col:"shrink"},{default:r(()=>[t(v,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE0s ${i.$filters.hora(n.dataHoraEmissao)}`},{default:r(()=>[z(ae(i.$filters.data(n.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):re("",!0),n.dataHoraFinalizado?(L(),J(b,{key:1,col:"shrink",class:"q-ml-sm"},{default:r(()=>[t(v,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(n.dataHoraFinalizado)}`},{default:r(()=>[z(ae(i.$filters.data(n.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):re("",!0)]),_:2},1024),t(f,{mg:"xs-b"},{default:r(()=>[t(b,{col:"shrink"},{default:r(()=>[t(a,{id:n.id,numero:n.numero,cor:"positive",escuro:""},null,8,["id","numero"])]),_:2},1024),t(b,{col:"shrink",class:"q-ml-sm"},{default:r(()=>[n.notaNumero?(L(),J(w,{key:0,cor:"tertiary",class:"mw50",escuro:""},{default:r(()=>[z(ae(n.notaNumero)+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[41]||(e[41]=[z("N\xFAmero da Nota")])),_:1})]),_:2},1024)):(L(),J(w,{key:1,cor:"warning",class:"mw50",escuro:""},{default:r(()=>[e[43]||(e[43]=z(" S/N ")),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[42]||(e[42]=[z("N\xFAmero da Nota")])),_:1})]),_:1}))]),_:2},1024),t(b,{col:"shrink",class:"q-ml-sm"},{default:r(()=>[t(w,{rotulo:n.status,cor:n.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:n.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),t(f,null,{default:r(()=>[t(b,{col:"shrink",text:"bold"},{default:r(()=>[z(ae(i.$filters.numero(n.totalDocumento,2)),1)]),_:2},1024),be(t(b,{col:"grow",text:"center",class:"q-ml-sm"},{default:r(()=>[z(ae(n.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Be,n.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(Y,{onClick:_=>s.abrir(n.id),class:"hideonmobile maxw110 q-pl-sm no-margin cursor-pointer"},{default:r(()=>[this.tabSelecionada.valor==="Nota na SEFAZ"?(L(),Ie(De,{key:0},[n.dhRecbto?(L(),J(ue,{key:0,color:"tertiary",class:"ellipsis"},{default:r(()=>[t(ie,{name:"mdi-calendar-today"}),z(" "+ae(i.$filters.data(n.dhRecbto))+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[z(" Autorizado \xE0s "+ae(i.$filters.hora(n.dhRecbto)),1)]),_:2},1024)]),_:2},1024)):re("",!0)],64)):(L(),Ie(De,{key:1},[n.dataHoraEmissao?(L(),J(ue,{key:0,color:"tertiary",class:"ellipsis"},{default:r(()=>[t(ie,{name:"mdi-calendar-today"}),z(" "+ae(i.$filters.data(n.dataHoraEmissao))+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[z(" Emitido \xE0s "+ae(i.$filters.hora(n.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):re("",!0),n.dataHoraFinalizado?(L(),J(ue,{key:1,color:"tertiary",class:"ellipsis"},{default:r(()=>[t(ie,{name:"mdi-calendar"}),z(" "+ae(i.$filters.data(n.dataHoraFinalizado))+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[z(" Finalizado \xE1s "+ae(i.$filters.hora(n.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):re("",!0)],64))]),_:2},1032,["onClick"]),t(Y,{onClick:_=>s.abrir(n.id),class:"hideonmobile maxw100 q-pl-sm no-margin cursor-pointer"},{default:r(()=>[t(w,{cor:n.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:n.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:r(()=>[z(ae(n.status)+" ",1),t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[44]||(e[44]=[z(" Status ")])),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),t(Y,{onClick:_=>s.abrir(n.id),class:"hideonmobile maxw120 q-pl-sm no-margin cursor-pointer"},{default:r(()=>[t(ue,{class:"text-tertiary text-weight-bold text-right"},{default:r(()=>[z(ae(i.$filters.numero(n.totalDocumento,2)),1)]),_:2},1024),be(t(ue,{class:"text-tertiary text-right"},{default:r(()=>[z(ae(n.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Be,n.qtdeContatos>0]])]),_:2},1032,["onClick"]),t(Y,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:r(()=>[t(fe,{class:"q-pa-none"},{default:r(()=>[o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(Y,{key:0,class:"no-margin"},{default:r(()=>[t(ce,{onClick:_=>s.abrir(n.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):re("",!0),o.tabSelecionada.valor==="Nota na SEFAZ"?(L(),J(Y,{key:1,class:"no-margin",style:{width:"33.6px"}},{default:r(()=>[n.status==="N\xE3o Importada"?(L(),J(ce,{key:0,onClick:_=>s.importarXmlDFe(n.id),flat:"",round:"",dense:"",icon:"mdi-upload",size:"md",color:"tertiary",class:"buttons"},{default:r(()=>[t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[45]||(e[45]=[z("Importar XML")])),_:1})]),_:2},1032,["onClick"])):re("",!0)]),_:2},1024)):re("",!0),["Nota na SEFAZ","Nota de Entrada"].includes(o.tabSelecionada.valor)?(L(),J(Y,{key:2,class:"no-margin",style:{width:"33.6px"}},{default:r(()=>[t(ce,{onClick:_=>s.downloadXmlDFe(n.id,o.tabSelecionada.valor),flat:"",round:"",dense:"",icon:"mdi-download",color:"tertiary",size:"md",class:"buttons"},{default:r(()=>[t(xe,{anchor:"bottom middle",self:"center middle"},{default:r(()=>e[46]||(e[46]=[z("Download XML")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(Y,{key:3,class:"no-margin"},{default:r(()=>[t(ce,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:r(()=>[t(Ue,null,{default:r(()=>[be((L(),J(Ne,{link:"","no-border":"",separator:""},{default:r(()=>[(L(!0),Ie(De,null,Te(o.configImpressao,_=>(L(),J(fe,{key:_.valor,onClick:h=>i.$imprimir(_.valor,n.id),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>[z(ae(_.texto),1)]),_:2},1024),_.observacao?(L(),J(ue,{key:0,caption:""},{default:r(()=>[z(ae(_.observacao),1)]),_:2},1024)):re("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(L(!0),Ie(De,null,Te(o.configImpressaoPedidoCompra,_=>(L(),J(fe,{key:_.valor,onClick:h=>s.imprimirPedidoCompra(_.valor,n==null?void 0:n.codigoDocumento),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>[z(ae(_.texto),1)]),_:2},1024),_.observacao?(L(),J(ue,{key:0,caption:""},{default:r(()=>[z(ae(_.observacao),1)]),_:2},1024)):re("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(fe,{onClick:_=>s.dialogImprimirEtiquetas({acao:"adicionar",item:n}),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[47]||(e[47]=[z(" Etiquetas ")])),_:1}),t(ue,{caption:""},{default:r(()=>e[48]||(e[48]=[z(" Adicionar \xE1 Fila ")])),_:1})]),_:1})]),_:2},1032,["onClick"]),t(fe,{onClick:_=>s.dialogImprimirEtiquetas({acao:"impressao",item:n}),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[49]||(e[49]=[z(" Etiquetas ")])),_:1}),t(ue,{caption:""},{default:r(()=>e[50]||(e[50]=[z(" Impress\xE3o Direta ")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[Ee]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(Y,{key:4,class:"no-margin"},{default:r(()=>[t(ce,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:r(()=>[t(Ue,null,{default:r(()=>[be((L(),J(Ne,{link:"","no-border":"",separator:""},{default:r(()=>[o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:0,onClick:_=>s.duplicarDocumento_click(n),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"content_copy"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[51]||(e[51]=[z(" Duplicar ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:1,onClick:_=>s.alterarPrevisaoEntrega_click(n),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"local_shipping"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[52]||(e[52]=[z("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:2,onClick:_=>s.trocarCfop_click(n),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"sync_alt"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[53]||(e[53]=[z("Trocar CFOP para consumo")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),re("",!0)]),_:2},1024)),[[Ee]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):re("",!0)]),_:2},1024)]),_:2},1024),t(Y,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:r(()=>[t(ce,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:r(()=>[t(Ue,null,{default:r(()=>[be((L(),J(Ne,{link:"","no-border":"",separator:""},{default:r(()=>[re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:1,onClick:_=>s.abrir(n.id),clickable:"",class:"itemHover"},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"edit"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[58]||(e[58]=[z(" Editar ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor==="Nota na SEFAZ"&&n.status==="N\xE3o Importada"?(L(),J(fe,{key:2,onClick:_=>s.importarXmlDFe(n.id),clickable:"",class:"itemHover"},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"mdi-upload"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[59]||(e[59]=[z(" Importar XML ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),["Nota na SEFAZ","Nota de Entrada"].includes(o.tabSelecionada.valor)?(L(),J(fe,{key:3,onClick:_=>s.downloadXmlDFe(n.id,o.tabSelecionada.valor),clickable:"",class:"itemHover"},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"mdi-download"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[60]||(e[60]=[z(" Download XML ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(!0),Ie(De,{key:4},Te(o.configImpressao,_=>(L(),J(fe,{key:_.valor,onClick:h=>i.$imprimir(_.valor,n.id),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>[z(ae(_.texto),1)]),_:2},1024),_.observacao?(L(),J(ue,{key:0,caption:""},{default:r(()=>[z(ae(_.observacao),1)]),_:2},1024)):re("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(!0),Ie(De,{key:5},Te(o.configImpressaoPedidoCompra,_=>(L(),J(fe,{clickable:"",key:_.valor,onClick:h=>s.imprimirPedidoCompra(_.valor,n==null?void 0:n.codigoDocumento)},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>[z(ae(_.texto),1)]),_:2},1024),_.observacao?(L(),J(ue,{key:0,caption:""},{default:r(()=>[z(ae(_.observacao),1)]),_:2},1024)):re("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:6,clickable:"",onClick:_=>s.dialogImprimirEtiquetas({acao:"adicionar",item:n})},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[61]||(e[61]=[z(" Etiquetas ")])),_:1}),t(ue,{caption:""},{default:r(()=>e[62]||(e[62]=[z(" Adicionar \xE1 Fila ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:7,clickable:"",onClick:_=>s.dialogImprimirEtiquetas({acao:"impressao",item:n})},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"print"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[63]||(e[63]=[z(" Etiquetas ")])),_:1}),t(ue,{caption:""},{default:r(()=>e[64]||(e[64]=[z(" Impress\xE3o Direta ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:8,onClick:_=>s.duplicarDocumento_click(n),clickable:"",class:"itemHover"},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"content_copy"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[65]||(e[65]=[z(" Duplicar ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:9,onClick:_=>s.alterarPrevisaoEntrega_click(n),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"local_shipping"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[66]||(e[66]=[z("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?(L(),J(fe,{key:10,onClick:_=>s.trocarCfop_click(n),clickable:""},{default:r(()=>[t(Y,{avatar:""},{default:r(()=>[t(ie,{name:"sync_alt"})]),_:1}),t(Y,null,{default:r(()=>[t(ue,null,{default:r(()=>e[67]||(e[67]=[z("Trocar CFOP para consumo")])),_:1})]),_:1})]),_:2},1032,["onClick"])):re("",!0)]),_:2},1024)),[[Ee]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(ct)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onCriarClick","lista","tabSelecionada","tabs","tabSelecionada2","tabs2","paginacao","mostrar"]),t(k,{ref:"comprasFicha",onAtualizar:s.atualizar,onDialogImprimirEtiquetas:s.dialogImprimirEtiquetas},null,8,["onAtualizar","onDialogImprimirEtiquetas"]),t(g,{ref:"comprasImportacaoXML",onAtualizar:s.atualizar,onConcluirImportacao:s.concluirImportacao},null,8,["onAtualizar","onConcluirImportacao"]),t(Le,{modelValue:o.modalXMLNotaEntrada,"onUpdate:modelValue":e[19]||(e[19]=n=>o.modalXMLNotaEntrada=n),persistent:""},{default:r(()=>[t(je,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:r(()=>[ve("form",{onSubmit:e[18]||(e[18]=Nt((...n)=>s.importarXmlNotaDeEntrada&&s.importarXmlNotaDeEntrada(...n),["prevent"]))},[t(He,null,{default:r(()=>[t(Pe,null,{default:r(()=>[be(t(ce,{onClick:s.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"close"},null,8,["onClick"]),[[Ee]]),t(Re,null,{default:r(()=>e[68]||(e[68]=[z("Importar XML Nota de Entrada")])),_:1}),t(ce,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),t(Ze,{class:"u-container"},{default:r(()=>[t(Ge,{style:{"min-height":"300px"}},{default:r(()=>{var n,_,h;return[ve("div",ya,[t(qt,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:s.adicionarXml,filter:D=>D.filter(x=>x.type==="text/xml")},null,8,["factory","filter"]),t(bt,{modelValue:o.xmlDevolucao,"onUpdate:modelValue":e[16]||(e[16]=D=>o.xmlDevolucao=D),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),t(bt,{modelValue:o.xmlEstrangeiro,"onUpdate:modelValue":e[17]||(e[17]=D=>o.xmlEstrangeiro=D),label:"Importa\xE7\xE3o do exterior"},null,8,["modelValue"])]),Object.keys((h=(_=(n=o.xmlNotaEntrada.error)==null?void 0:n.data)==null?void 0:_.fields)!=null?h:{}).length?(L(),Ie("div",wa,[ve("ul",_a,[(L(!0),Ie(De,null,Te(Object.keys(o.xmlNotaEntrada.error.data.fields),D=>(L(),Ie("li",{key:D},[ve("span",null,ae(D),1),ve("span",null,ae(o.xmlNotaEntrada.error.data.fields[D]),1)]))),128))])])):re("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"]),t(Le,{modelValue:o.modalPrevisaoEntrega.visivel,"onUpdate:modelValue":e[22]||(e[22]=n=>o.modalPrevisaoEntrega.visivel=n),"content-css":{minWidth:"50vw"}},{default:r(()=>[t(At,null,{default:r(()=>[t(Pe,{class:"bg-primary text-white"},{default:r(()=>[t(Re,null,{default:r(()=>e[69]||(e[69]=[z("Alterar Previs\xE3o de Entrega")])),_:1}),be(t(ce,{dense:"",flat:"",icon:"close",round:""},null,512),[[Ee]])]),_:1}),t(Tt,null,{default:r(()=>[t(st,{onSubmit:s.alterarPrevisaoEntrega},{default:r(()=>[t(y,{class:"q-col-gutter-md"},{default:r(()=>[ve("div",Ia,[t(Xe,{modelValue:o.modalPrevisaoEntrega.dataPrevistaEntrega,"onUpdate:modelValue":e[20]||(e[20]=n=>o.modalPrevisaoEntrega.dataPrevistaEntrega=n),type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:""},null,8,["modelValue"])]),ve("div",ka,[t(Xe,{modelValue:o.modalPrevisaoEntrega.horaPrevistaEntrega,"onUpdate:modelValue":e[21]||(e[21]=n=>o.modalPrevisaoEntrega.horaPrevistaEntrega=n),type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:""},null,8,["modelValue"])])]),_:1}),ve("div",Ca,[be(t(ce,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[Ee]]),t(ce,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Alterar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Le,{modelValue:o.dialogEtiquetas.impressao,"onUpdate:modelValue":e[28]||(e[28]=n=>o.dialogEtiquetas.impressao=n)},{default:r(()=>[t(je,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"425px"}},{default:r(()=>[t(st,{onSubmit:e[27]||(e[27]=n=>s.imprimirEtiquetas(o.modeloSelecionado)),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",novalidate:""},{default:r(()=>[t(He,null,{default:r(()=>[t(Pe,{class:"bg-primary text-white"},{default:r(()=>[t(Re,null,{default:r(()=>[t(ie,{name:"mdi-tag-plus",size:"sm",class:"q-mr-sm"}),e[70]||(e[70]=z(" Imprimir Etiquetas "))]),_:1})]),_:1})]),_:1}),t(Ze,null,{default:r(()=>[t(Ge,{class:"q-pa-md"},{default:r(()=>[t(v,{class:"q-pb-lg"},{default:r(()=>{var n,_,h,D,x,F,B,$,T,G,oe,E,O;return[e[71]||(e[71]=z(" Imprimir os itens: ")),ve("strong",null,ae((n=o.tabSelecionada)==null?void 0:n.valor)+" "+ae((h=(_=o.dialogEtiquetas)==null?void 0:_.item)!=null&&h.numero?", #"+((x=(D=o.dialogEtiquetas)==null?void 0:D.item)==null?void 0:x.numero):"")+" "+ae((B=(F=o.dialogEtiquetas)==null?void 0:F.item)!=null&&B.descricaoContato?" - "+((T=($=o.dialogEtiquetas)==null?void 0:$.item)==null?void 0:T.descricaoContato):"")+" "+ae((oe=(G=o.dialogEtiquetas)==null?void 0:G.item)!=null&&oe.notaNumero?", Nota #"+((O=(E=o.dialogEtiquetas)==null?void 0:E.item)==null?void 0:O.notaNumero):""),1),e[72]||(e[72]=z(". "))]}),_:1}),t(l,{modelValue:o.modeloSelecionado,"onUpdate:modelValue":e[23]||(e[23]=n=>o.modeloSelecionado=n),opcoes:o.opcoesModelo,dense:"",filled:"",tipo:"seletor",rotulo:"Modelo",cor:"white","popup-content-class":"etiquetas-modelo-selecionado",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),t(l,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":e[24]||(e[24]=n=>o.empresaSelecionada=n),opcoes:o.opcoesEmpresas,dense:"",filled:"",clearable:"",tipo:"seletor",rotulo:"Empresa",color:"tertiary",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),t(l,{modelValue:o.tabelaPrecoSelecionada,"onUpdate:modelValue":e[25]||(e[25]=n=>o.tabelaPrecoSelecionada=n),opcoes:o.opcoesTabelasPreco,dense:"",filled:"",clearable:"",tipo:"seletor",rotulo:"Tabela de Pre\xE7o",color:"tertiary",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),t(l,{modelValue:o.emBranco,"onUpdate:modelValue":e[26]||(e[26]=n=>o.emBranco=n),min:0,tipo:"quantidade",dense:"",filled:"",rotulo:"Etiquetas em branco",color:"tertiary","text-color":"red"},null,8,["modelValue"])]),_:1})]),_:1}),t(Qe,{class:"bg-light"},{default:r(()=>[t(Pe,null,{default:r(()=>[t(et),be(t(ce,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-sm"},null,512),[[Ee]]),t(ce,{label:"Confirmar",color:"primary",type:"submit",unelevated:""})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Le,{modelValue:o.dialogEtiquetas.adicionar,"onUpdate:modelValue":e[30]||(e[30]=n=>o.dialogEtiquetas.adicionar=n)},{default:r(()=>[t(je,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"250px"}},{default:r(()=>[t(st,{onSubmit:s.adicionarEtiquetas,autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",novalidate:""},{default:r(()=>[t(He,null,{default:r(()=>[t(Pe,{class:"bg-primary text-white"},{default:r(()=>[t(Re,null,{default:r(()=>[t(ie,{name:"mdi-tag-plus",size:"sm",class:"q-mr-sm"}),e[73]||(e[73]=z(" Adicionar os itens a lista de etiquetas "))]),_:1})]),_:1})]),_:1}),t(Ze,null,{default:r(()=>[t(Ge,{class:"q-pa-md"},{default:r(()=>[t(v,{class:"q-pb-lg"},{default:r(()=>{var n,_,h,D,x,F,B,$,T,G,oe,E,O;return[e[74]||(e[74]=z(" Adicionar os itens: ")),ve("strong",null,ae((n=o.tabSelecionada)==null?void 0:n.valor)+" "+ae((h=(_=o.dialogEtiquetas)==null?void 0:_.item)!=null&&h.numero?", #"+((x=(D=o.dialogEtiquetas)==null?void 0:D.item)==null?void 0:x.numero):"")+" "+ae((B=(F=o.dialogEtiquetas)==null?void 0:F.item)!=null&&B.descricaoContato?" - "+((T=($=o.dialogEtiquetas)==null?void 0:$.item)==null?void 0:T.descricaoContato):"")+" "+ae((oe=(G=o.dialogEtiquetas)==null?void 0:G.item)!=null&&oe.notaNumero?", Nota #"+((O=(E=o.dialogEtiquetas)==null?void 0:E.item)==null?void 0:O.notaNumero):""),1),e[75]||(e[75]=z(" \xE0 lista de etiquetas para impress\xE3o. "))]}),_:1}),t(l,{modelValue:o.dialogEtiquetas.limpar,"onUpdate:modelValue":e[29]||(e[29]=n=>o.dialogEtiquetas.limpar=n),tipo:"logico",rotulo:"Limpar lista de etiquetas anterior."},null,8,["modelValue"])]),_:1})]),_:1}),t(Qe,{class:"bg-light"},{default:r(()=>[t(Pe,null,{default:r(()=>[t(et),be(t(ce,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-sm"},null,512),[[Ee]]),t(ce,{label:"Confirmar",color:"primary",type:"submit",unelevated:""})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])}var Aa=lt(ha,[["render",Sa]]);export{Aa as default};
