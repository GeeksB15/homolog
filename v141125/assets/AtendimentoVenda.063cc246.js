import{ab as ia,dB as na,a4 as sa,dC as la,aj as J,a6 as U,Q as q,j as H,dD as da,an as ra,_ as Z,r as y,o as c,d as C,w as m,f as s,A as $,h as ma,i as ca,k as V,H as aa,N as ea,C as g,at as ua,aO as K,e as p,D as va,Y as pa,ba as ga,cS as ha,p as I,bf as fa,P as W,S as B,T as E,U as M,B as N,bq as _,F as j,x as Y,d5 as Ca,d6 as A,t as x,m as ba,b7 as Ia}from"./index.8f3585ce.js";import{u as Va,a as wa,Q as xa}from"./QFab.8f2ea608.js";import{n as ya}from"./nfePrincipal.3e623a51.js";import{E as Da}from"./EnvelopeCard.8d4dfadb.js";import{V as Pa}from"./VendaCard.2e6da35a.js";import{G as Fa}from"./GChipsV2.1c6e7367.js";import{o as ka}from"./open-url.0dbfb71d.js";import"./compactarValidarNFe.c4e340be.js";import"./obterItens.b0e651d3.js";import"./codigosANP.a6c1a264.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.809f8200.js";import"./Campo.7001b787.js";import"./ModalHistoricoStatus.7f28beae.js";const ta={start:"self-end",center:"self-center",end:"self-start"},za=Object.keys(ta);var X=ia({name:"QFabAction",props:{...Va,icon:{type:String,default:""},anchor:{type:String,validator:i=>za.includes(i)},to:[String,Object],replace:Boolean},emits:["click"],setup(i,{slots:a,emit:l}){const d=na(la,()=>({showing:{value:!0},onChildClick:sa})),{formClass:e,labelProps:n}=wa(i,d.showing),u=J(()=>{const v=ta[i.anchor];return e.value+(v!==void 0?` ${v}`:"")}),t=J(()=>i.disable===!0||d.showing.value!==!0);function f(v){d.onChildClick(v),l("click",v)}function w(){const v=[];return a.icon!==void 0?v.push(a.icon()):i.icon!==""&&v.push(U(H,{name:i.icon})),(i.label!==""||a.label!==void 0)&&v[n.value.action](U("div",n.value.data,a.label!==void 0?a.label():[i.label])),da(a.default,v)}const b=ra();return Object.assign(b.proxy,{click:f}),()=>U(q,{class:u.value,...i,noWrap:!0,stack:i.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:t.value,onClick:f},w)}});const Ea={data(){return{motivo:"",motivos:[],tipo:"devolucao",visivel:!1}},emits:["executa"],methods:{async atualizar(){this.motivo="",this.tipo="devolucao";const i=await $db.configuracoes.le({nome:"vendas.garantia.motivo"});this.motivos=i.map(a=>a.valor)},executa(){if(this.tipo==="garantia"&&!this.motivo){this.$q.notify({message:"Selecione o motivo",type:"negative"});return}this.visivel=!1,this.$emit("executa",{tipo:this.tipo,motivo:this.motivo})},async mostrar(){await this.atualizar(),this.visivel=!0}}},_a={class:"layout-padding"},Aa={class:"q-mt-lg text-center"};function qa(i,a,l,d,e,n){const u=y("campo");return c(),C(va,{modelValue:e.visivel,"onUpdate:modelValue":a[5]||(a[5]=t=>e.visivel=t),"content-css":{minWidth:"30vw"}},{default:m(()=>[s($,{class:"q-dialog-plugin"},{default:m(()=>[s(ma,{class:"bg-primary text-white"},{default:m(()=>[s(ca,null,{default:m(()=>a[6]||(a[6]=[V("Devolu\xE7\xE3o/Garantia")])),_:1}),aa(s(q,{dense:"",flat:"",icon:"close",round:""},null,512),[[ea]])]),_:1}),g("div",_a,[g("form",{class:"q-pa-md",onSubmit:a[4]||(a[4]=ua((...t)=>n.executa&&n.executa(...t),["prevent"]))},[s(K,{modelValue:e.tipo,"onUpdate:modelValue":[a[0]||(a[0]=t=>e.tipo=t),a[1]||(a[1]=t=>e.motivo="")],class:"q-mr-sm",label:"Devolu\xE7\xE3o",val:"devolucao"},null,8,["modelValue"]),s(K,{modelValue:e.tipo,"onUpdate:modelValue":a[2]||(a[2]=t=>e.tipo=t),label:"Garantia",val:"garantia"},null,8,["modelValue"]),e.tipo==="garantia"?(c(),C(u,{key:0,modelValue:e.motivo,"onUpdate:modelValue":a[3]||(a[3]=t=>e.motivo=t),rotulo:"Motivo",tipo:"seletor",opcoes:e.motivos},null,8,["modelValue","opcoes"])):p("",!0),g("div",Aa,[s(q,{color:"primary",class:"q-ml-sm no-shadow",label:"Continua",type:"submit"})])],32)])]),_:1})]),_:1},8,["modelValue"])}var Ga=Z(Ea,[["render",qa]]);const Oa={components:{Avatar:pa,NfePrincipal:ya,EnvelopeCard:Da,VendaCard:Pa,VendaDevolucaoGarantia:Ga,VendaModal:ga,Envelope:ha,GChipsV2:Fa},computed:{temVendasAbertas(){return!!this.vendasAbertas.length},temVendasCanceladas(){return!!this.vendasCanceladas.length},temVendasFinalizadas(){return!!this.vendasFinalizadas.length},temRegistros(){return this.temVendasAbertas||this.temVendasCanceladas||this.temVendasFinalizadas}},data(){return{grupos:[],documentos:{},itens:{},documentosItens:[],vendasCompletas:{},vendasAbertas:[],vendasFinalizadas:[],vendasCanceladas:[],totalVendasAbertas:0,totalVendasFinalizadas:0,totalVendasCanceladas:0,filtro:{},tipoLista:"documentos",dataIni:null,dataFim:null,carregando:!1,colunas:[{name:"descricao",label:"Descri\xE7\xE3o",align:"left"},{name:"documento",label:"Documento",align:"left"},{name:"valorUnitario",label:"Valor Unit\xE1rio",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorTotal",label:"Valor Total",align:"right"},{name:"botao",label:"",align:"right"}],contato:null,tablePagination:{page:1,rowsPerPage:25},vendaCardPagination:{maxPages:7,perPage:5,vendasAbertas:{page:1,min:1,max:1},vendasFinalizadas:{page:1,min:1,max:1},vendasCanceladas:{page:1,min:1,max:1}},documentoItemDevolucaoGarantia:{},modalVenda:{visivel:!1,orcamento:{}},urlHistoricoCliente:"",sistemaPai:""}},methods:{abrirHistoricoCliente(){ka(this.urlHistoricoCliente)},adicionarVenda(){this.$refs.modalVenda.mostrar({idContato:this.$route.params.id})},adicionarEnvelope(){this.$refs.modalEnvelope.mostrar({idContato:this.$route.params.id})},abrirModalDevolucaoGarantia(i){this.documentoItemDevolucaoGarantia=i,this.$refs.modalDevolucaoGarantia.mostrar()},alternarLista(){this.tipoLista=this.tipoLista==="documentos"?"itens":"documentos",this.atualizar()},fechouNFe(i){i&&$utils.emitter.emit("atualizarDocumentosFiscais")},async finalizaDevolucaoGarantia(i){var D,F;let a,l;if(l=this.documentoItemDevolucaoGarantia||{},l.idDocumento&&(a=await $db.hibrido.le({table:"documento",id:l.idDocumento})),!a.id){this.$q.notify("Venda original n\xE3o encontrada");return}let d={};if(this.documentoItemDevolucaoGarantia.idItem&&(d=await $erp().item.get(this.documentoItemDevolucaoGarantia.idItem)||{}),!d.id){this.$q.notify("Erro na recupera\xE7\xE3o do item");return}const e=a.tipo==="Envelope"?a.idContatoResponsavel:a.idContato;if(!Boolean(e)){this.$q.notify("Destinat\xE1rio n\xE3o encontrado");return}if(!a.idEmpresa){this.$q.notify("Emitente n\xE3o encontrado");return}const n=await $erp().documento.where({idContato:e,idEmpresa:a.idEmpresa,tipo:"Venda",status:"Or\xE7amento"}).toArray();n.sort((G,k)=>new Date(G.dataHoraEmissao)<new Date(k.dataHoraEmissao)?1:-1);const u=await $utils.selecionarCfop({ncm:d.ncm,idItem:d.id,itemTipo:d.tipo,codigoDocumentoOperacao:((D=n[0])==null?void 0:D.codigoDocumentoOperacao)||a.codigoDocumentoOperacao,idContatoDestinatario:e,idContatoEmitente:a.idEmpresa,operacaoFator:1});if(!u){this.$q.notifyError("CFOP n\xE3o encontrado");return}let t={};const f=$utils.removerAcentos((this.documentoItemDevolucaoGarantia.tipoItem||"").toLowerCase())==="servico";i.tipo==="devolucao"&&(t.operacao=f?"Devolu\xE7\xE3o de Servi\xE7o":"Devolu\xE7\xE3o de Venda"),i.tipo==="garantia"&&(t.operacao=f?"Garantia de Servi\xE7o":"Garantia de Venda",t.motivo=i.motivo),t.id=$utils.uuid(),t.dataHoraFinalizado="",t.idDocumentoItemVenda=this.documentoItemDevolucaoGarantia.id,t.idDocumentoVenda=this.documentoItemDevolucaoGarantia.idDocumento,t.idItem=this.documentoItemDevolucaoGarantia.idItem,t.idPlanoContaDestino=this.documentoItemDevolucaoGarantia.idPlanoContaDestino,t.idPlanoContaEstoque=this.documentoItemDevolucaoGarantia.idPlanoContaEstoque,t.tipoItem=this.documentoItemDevolucaoGarantia.tipoItem,t.descricaoItem=this.documentoItemDevolucaoGarantia.descricaoItem,t.status="Or\xE7amento",t.quantidade=this.documentoItemDevolucaoGarantia.quantidade||1,t.operacaoFator=u==null?void 0:u.fator,t.idCfop=u==null?void 0:u.id;const w=this.documentoItemDevolucaoGarantia.descontoItem||0,b=(this.documentoItemDevolucaoGarantia.descontoTotalRateado||0)/t.quantidade,v=(this.documentoItemDevolucaoGarantia.descontoFaturaRateado||0)/t.quantidade,P=$utils.arredondar(w+b+v,4);t.descontoItem=$utils.arredondar(P*-1,4),t.descontoPercentualItem=$utils.arredondar(t.descontoItem/(this.documentoItemDevolucaoGarantia.valorItem||1)*100,2),t.descontoTotalRateado=0,t.descontoFaturaRateado=0,t.descontoSubTotal=this.documentoItemDevolucaoGarantia.descontoSubTotal||0,t.valorCustoMedio=this.documentoItemDevolucaoGarantia.valorCustoMedio||0,t.valorCustoReposicao=this.documentoItemDevolucaoGarantia.valorCustoReposicao||0,t.valorOriginal=(this.documentoItemDevolucaoGarantia.valorOriginal||0)*-1,t.valorItem=(this.documentoItemDevolucaoGarantia.valorItem||0)*-1,t.subTotal=$utils.arredondar(((this.documentoItemDevolucaoGarantia.valorItem||0)-P)*-t.quantidade,2),t.total=t.subTotal||0,t.valorReal=$utils.arredondar(((this.documentoItemDevolucaoGarantia.valorItem||0)-P)*-1,4),t.valorRealTotal=t.subTotal||0,t.valorIpi=(this.documentoItemDevolucaoGarantia.valorIpi||0)*-1,t.valorIcms=(this.documentoItemDevolucaoGarantia.valorIcms||0)*-1,t.valorIcmsSt=(this.documentoItemDevolucaoGarantia.valorIcmsSt||0)*-1,t.valorDifal=(this.documentoItemDevolucaoGarantia.valorDifal||0)*-1,t.loteEmpresa=this.documentoItemDevolucaoGarantia.loteEmpresa,localStorage.setItem("documentoItemDevolucao",JSON.stringify(t)),n.length&&(t.idDocumento=n[0].id,t.dataHoraEmissao=$utils.dataAtual(),await $db.documentoItem.grava({atual:t}),this.$q.notify({message:"Item adicionado ao or\xE7amento.",type:"positive"})),this.$refs.modalVenda.mostrar({id:(F=n[0])==null?void 0:F.id,idContato:this.$route.params.id})},async atualizar(){this.documentos={},this.itens={},this.documentosItens=[],this.vendasCompletas={},this.tablePagination={page:1,rowsPerPage:25};let i,a;a=JSON.parse(localStorage.getItem("clienteSistema"))||{},i="https://rel.storage.b15.com.br/Relatorios/OptiSoul/historico-cliente.html?",i+="CodigoCliente="+this.contato.codigoContato,i+="&BancoDeDados="+a.bancoDeDados,i+="&URLServidor="+a.urlServidor,this.urlHistoricoCliente=i,await this.atualizarVendas()},async carregarImagensItens(i){const a=Object.keys(i);if(!!a.length){await $utils.dormir(200);try{const l=await $db.hibrido.lista({table:"item",columns:["id","descricao","imagem"],whereIn:{id:a}});for(const d of l)i[d.id].imagem=d.imagem||""}catch(l){console.error("Erro ao ler imagens de itens - ",l)}}},async carregarImagensContatos(i){const a=Object.keys(i);if(!!a.length){await $utils.dormir(200);try{const l=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:a}});for(const d of l)i[d.id].imagem=d.imagem||""}catch(l){console.error("Erro ao carregar imagens de contatos - ",l)}}},executar(){this.atualizar()},async atualizarVendas(){var a,l,d;const i=$utils.logarIni("AtendimentoVenda");await $tryLoading(async()=>{$db.hibrido.isOnline()?this.tipoLista==="itens"?await this.atualizarVendasItensOnline():await this.atualizarVendasOnline():this.tipoLista==="itens"?await this.atualizarVendasItensOffline():await this.atualizarVendasOffline()},{mensagem:"Carregando vendas...",erro:"Ocorreu um erro ao consultar vendas",carregando:e=>this.carregando=e}),$utils.logarFim(i,(((a=this.vendasAbertas)==null?void 0:a.length)||0)+(((l=this.vendasFinalizadas)==null?void 0:l.length)||0)+(((d=this.totalVendasCanceladas)==null?void 0:d.length)||0))},async atualizarVendasOnline(){var u,t,f,w,b,v;if(!this.contato.id){console.error("id contato n\xE3o fornecido em atualizarVendasOnline");return}const{vendasAbertas:i,vendasFinalizadas:a,vendasCanceladas:l}=await $db.venda.leListaCompletaOnline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},grupos:this.grupos},vendaCardPagination:this.vendaCardPagination}),d=[...i.data.vendas,...a.data.vendas,...l.data.vendas],e={...i.data.itens,...a.data.itens,...l.data.itens},n={...i.data.contatos,...a.data.contatos,...l.data.contatos};for(const P of d)for(const D of P.carrinho)D.item=e[D.idItem];this.vendasCompletas={dadosContatos:n,contatosEmpresa:a.data.contatosEmpresa,faturasAbertas:a.data.faturasAbertas},this.vendaCardPagination.vendasAbertas.max=(u=i.totalPages)!=null?u:0,this.vendaCardPagination.vendasFinalizadas.max=(t=a.totalPages)!=null?t:0,this.vendaCardPagination.vendasCanceladas.max=(f=l.totalPages)!=null?f:0,this.vendasAbertas=i.data.vendas,this.vendasFinalizadas=a.data.vendas,this.vendasCanceladas=l.data.vendas,this.totalVendasAbertas=$filters.numero((w=i.somaTotalDocumento)!=null?w:0,2),this.totalVendasFinalizadas=$filters.numero((b=a.somaTotalDocumento)!=null?b:0,2),this.totalVendasCanceladas=$filters.numero((v=l.somaTotalDocumento)!=null?v:0,2),this.carregarImagensContatos(this.vendasCompletas.dadosContatos)},async atualizarVendasOffline(){var O,T,S,R,L,Q;const i=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"aberta",grupos:this.grupos},page:this.vendaCardPagination.vendasAbertas.page,limit:5}),a=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"finalizada",grupos:this.grupos},page:this.vendaCardPagination.vendasFinalizadas.page,limit:5}),l=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"cancelada",grupos:this.grupos},page:this.vendaCardPagination.vendasCanceladas.page,limit:5}),d=[...i.data,...a.data,...l.data],e=d.map(({id:r})=>r),n=await $db.hibrido.lista({table:"documentoItem",whereIn:{idDocumento:e}}),u=await $db.hibrido.lista({table:"documento",whereIn:{documentoId:e}}),t=d.map(({idContato:r})=>r),f=d.map(({idContatoVendedor:r})=>r),w=[...t,...f].filter(Boolean),b=await $db.hibrido.lista({table:"contato",whereIn:{id:w}}),v={};for(const r of b)v[r.id]=r;const D=(await $db.hibrido.lista({table:"empresa",columns:["idContato"],whereFilter:{ativo:!0}})).map(({idContato:r})=>r),F=await $db.hibrido.lista({table:"contato",columns:["id"],whereIn:{id:D},whereFilter:{ativo:!0}}),G=(await $db.hibrido.lista({table:"documento",where:{tipo:"Fatura",idContato:this.contato.id},whereFilter:{status:"Aberta"}})).sort((r,h)=>!r.numero||r.numero<h.numero?-1:1),k=n.filter(({idItem:r})=>r).map(({idItem:r})=>r),o=await $db.hibrido.lista({table:"item",whereIn:{id:k}}),z={};for(const r of o)z[r.id]=r;for(const r of d){r.carrinho=n.filter(({idDocumento:h})=>h===r.id),r.envelopes=u.filter(h=>h.documentoId===r.id&&h.tipo==="Envelope"),r.customs=u.filter(h=>h.documentoId===r.id&&h.tipo==="Custom"),r.oss=u.filter(h=>h.documentoId===r.id&&h.tipo==="Ordem de Servi\xE7o"),r.kits=u.filter(h=>h.documentoId===r.id&&h.tipo==="Venda Kit");for(const h of r.carrinho)h.item=z[h.idItem];for(const h of r.envelopes)h.itens=r.carrinho.filter(({idDocumentoAdicional:oa})=>oa===h.id)}this.vendasCompletas={dadosContatos:v,contatosEmpresa:F,faturasAbertas:G},this.vendaCardPagination.vendasAbertas.max=(O=i.totalPages)!=null?O:0,this.vendaCardPagination.vendasFinalizadas.max=(T=a.totalPages)!=null?T:0,this.vendaCardPagination.vendasCanceladas.max=(S=l.totalPages)!=null?S:0,this.vendasAbertas=i.data,this.vendasFinalizadas=a.data,this.vendasCanceladas=l.data,this.totalVendasAbertas=$filters.numero((R=i.somaTotalDocumento)!=null?R:0,2),this.totalVendasFinalizadas=$filters.numero((L=a.somaTotalDocumento)!=null?L:0,2),this.totalVendasCanceladas=$filters.numero((Q=l.somaTotalDocumento)!=null?Q:0,2)},async atualizarVendasItensOnline(){if(!this.contato.id){console.error("id contato n\xE3o fornecido em atualizarVendasItensOnline");return}const{vendasFinalizadas:i}=await $db.venda.leListaCompletaItensOnline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},grupos:this.grupos},vendaCardPagination:this.vendaCardPagination}),a={};let l=[];for(const d of i.data.vendas)a[d.id]=d,!(d.tipo==="Envelope"&&d.idContatoResponsavel!==this.contato.id)&&l.push(...d.carrinho);if(this.documentos=a,this.itens=i.data.itens,l=l.filter(d=>d.idItem),this.grupos.length){const d=await this.filtraTermos(l,this.grupos);d.length>0&&(l=l.filter(e=>d.includes(e.idItem)))}this.documentosItens=l.sort((d,e)=>new Date(e.dataHoraFinalizado||e.DataHoraEmissao||0)-new Date(d.dataHoraFinalizado||d.DataHoraEmissao||0)),this.carregarImagensItens(this.itens)},async atualizarVendasItensOffline(){const i=await $db.venda.leListaCompletaOffline({where:{idContato:this.contato.id,periodo:{dataIni:this.dataIni,dataFim:this.dataFim},status:"finalizada",grupos:this.grupos},page:this.vendaCardPagination.vendasFinalizadas.page,limit:1e3}),a={},l={},d=i.data.filter(t=>t.tipo==="Envelope"&&t.idContatoResponsavel===this.contato.id||t.tipo==="Venda").map(({id:t})=>t);let e=await $db.hibrido.lista({table:"documentoItem",whereIn:{idDocumento:d}});await $db.hibrido.lista({table:"documento",whereIn:{documentoId:d}});const n=e.filter(({idItem:t})=>t).map(({idItem:t})=>t),u=await $db.hibrido.lista({table:"item",whereIn:{id:n}});for(const t of u)l[t.id]=t;for(const t of i.data)a[t.id]=t;if(this.documentos=a,this.itens=l,e=e.filter(t=>t.idItem),this.grupos.length){const t=await this.filtraTermos(e,this.grupos);t.length>0&&(e=e.filter(f=>t.includes(f.idItem)))}this.documentosItens=e.sort((t,f)=>new Date(f.dataHoraFinalizado||f.DataHoraEmissao||0)-new Date(t.dataHoraFinalizado||t.DataHoraEmissao||0))},async filtraTermos(i,a){const l=(await $db.item.ler({filtros:{ids:i.map(t=>t.idItem)}})).data,d=a.map(t=>$utils.removerAcentos(t.toUpperCase())).filter(Boolean),e=d.filter(t=>t.match(/^\d+$/)),n=d.filter(t=>!t.match(/^\d+$/)),u=new Set;for(const t of l){const f=$utils.removerAcentos([t.id,"#"+t.codigoItem,t.descricaoConcatenada,t.marca,t.referencia].join(" ").toUpperCase()),w=[t.codigoItem].map(String);let b=!0;for(const v of e)b=b&&w.includes(v);for(const v of n)b=b&&f.includes(v);b&&u.add(t.id)}return Array.from(u)},async limparFiltro(){this.grupos=[],this.dataFim=new Date;const i=new Date;if(i.setFullYear(i.getFullYear()-2),this.dataIni=i,this.contato.codigoContato){const a=await $db.configuracoes.leValorNumerico("venda.codigoconsumidor");this.contato.codigoContato===a&&(this.dataIni=this.dataFim)}}},watch:{"$route.params.id"(){const i=this.$route.params.id;!i||$db.contato.le({id:i}).then(a=>{this.contato=a,this.tipoLista="documentos",this.limparFiltro().then(()=>{this.atualizar()}).catch(l=>{$q.notifyError("Ops! Ocorreu um erro",l)})}).catch(a=>{$q.notifyError("Ops! Ocorreu um erro",a)})}},created(){$utils.emitter.off("atualizarAtendimentoVenda"),$utils.emitter.on("atualizarAtendimentoVenda",this.atualizar)},mounted(){this.sistemaPai=$utils.sistemaPai();const i=this.$route.params.id;!i||$db.contato.le({id:i}).then(a=>{this.contato=a,this.limparFiltro().then(()=>{this.atualizar()}).catch(l=>{$q.notifyError("Ops! Ocorreu um erro",l)})}).catch(a=>{$q.notifyError("Ops! Ocorreu um erro",a)})}},Ta={class:"AtendimentoVenda q-pb-md"},Sa={class:"row q-mt-md",style:{display:"flex","align-items":"center"}},Ra={class:"col"},La={class:"col-12 col-md-6"},Qa={class:"col"},Ha={class:"col"},Ua={class:"col-auto q-ml-xs"},Ba={key:0,class:"row justify-end q-mb-md"},Ma={class:"row"},Na={key:1,class:"row justify-end q-mb-md"},ja={key:0,class:"row justify-end q-mb-md"},Ya={class:"row"},Ja={key:1,class:"row justify-end q-mb-md"},Ka={key:0,class:"col-12",style:{"margin-bottom":"50px"}},Wa={key:1,class:"col-12",style:{"margin-bottom":"50px"}},Xa={class:"row items-center",style:{"min-width":"180px","max-width":"100%"}},Za={class:"col-auto hideonmobile"},$a={class:"col",style:{"word-break":"break-word","white-space":"initial"}},ae={key:0,style:{"text-decoration":"line-through"}},ee={key:2,class:"q-pa-lg text-center"},te={key:3};function oe(i,a,l,d,e,n){var k;const u=y("GChipsV2"),t=y("campo"),f=y("row"),w=y("VendaCard"),b=y("EnvelopeCard"),v=y("avatar"),P=y("VendaModal"),D=y("Envelope"),F=y("VendaDevolucaoGarantia"),G=y("NfePrincipal");return c(),I("div",Ta,[g("div",Sa,[g("div",Ra,[s($,{class:"q-pa-sm q-ml-sm no-shadow"},{default:m(()=>[s(f,{class:"items-center q-col-gutter-md"},{default:m(()=>[g("div",La,[s(u,{modelValue:e.grupos,"onUpdate:modelValue":[a[0]||(a[0]=o=>e.grupos=o),n.atualizarVendas],placeholder:"Filtre por Produto, Marca, N\xFAmero..."},{prepend:m(()=>[s(H,{name:"mdi-filter"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),g("div",Qa,[s(t,{modelValue:e.dataIni,"onUpdate:modelValue":a[1]||(a[1]=o=>e.dataIni=o),tipo:"data",onBlur:n.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])]),a[10]||(a[10]=g("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[g("label",null,"at\xE9")],-1)),g("div",Ha,[s(t,{modelValue:e.dataFim,"onUpdate:modelValue":a[2]||(a[2]=o=>e.dataFim=o),tipo:"data",onBlur:n.atualizar,dense:"",outlined:""},null,8,["modelValue","onBlur"])])]),_:1})]),_:1})]),g("div",Ua,[s(q,{round:"",dense:"",flat:"",icon:"more_vert",color:"primary",size:"md"},{default:m(()=>[s(fa,null,{default:m(()=>[aa((c(),C(W,{link:"","no-border":"",separator:""},{default:m(()=>[e.tipoLista==="itens"?(c(),C(B,{key:0,onClick:n.alternarLista,clickable:""},{default:m(()=>[s(E,{avatar:""},{default:m(()=>[s(H,{name:"view_stream"})]),_:1}),s(E,null,{default:m(()=>[s(M,null,{default:m(()=>a[11]||(a[11]=[V("Vendas")])),_:1})]),_:1})]),_:1},8,["onClick"])):p("",!0),e.tipoLista==="documentos"?(c(),C(B,{key:1,onClick:n.alternarLista,clickable:""},{default:m(()=>[s(E,{avatar:""},{default:m(()=>[s(H,{name:"view_list"})]),_:1}),s(E,null,{default:m(()=>[s(M,null,{default:m(()=>a[12]||(a[12]=[V("Produtos e Servi\xE7os")])),_:1})]),_:1})]),_:1},8,["onClick"])):p("",!0),s(B,{clickable:"",onClick:n.abrirHistoricoCliente},{default:m(()=>[s(E,{avatar:""},{default:m(()=>[s(H,{name:"mdi-account"})]),_:1}),s(E,null,{default:m(()=>[s(M,null,{default:m(()=>a[13]||(a[13]=[V("Hist\xF3rico do Cliente")])),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})),[[ea]])]),_:1})]),_:1})])]),!e.carregando&&n.temRegistros&&e.tipoLista==="documentos"?(c(),C(W,{key:0,class:"no-border"},{default:m(()=>[n.temVendasAbertas?(c(),C(N,{key:0,"model-value":!0,label:`Abertas (Total R$ ${e.totalVendasAbertas})`,group:"vendasAbertas"},{default:m(()=>[e.vendaCardPagination.vendasAbertas.max>1?(c(),I("div",Ba,[s(_,{modelValue:e.vendaCardPagination.vendasAbertas.page,"onUpdate:modelValue":a[3]||(a[3]=o=>e.vendaCardPagination.vendasAbertas.page=o),min:e.vendaCardPagination.vendasAbertas.min,unelevated:"",max:e.vendaCardPagination.vendasAbertas.max,ellipses:"","max-pages":e.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):p("",!0),g("div",Ma,[(c(!0),I(j,null,Y(e.vendasAbertas,o=>(c(),I("div",{class:"q-px-sm full-width",key:o.id},[o.tipo==="Venda"?(c(),C(w,{key:0,id:o.id,dadosVenda:o,vendasCompletas:e.vendasCompletas,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","dadosVenda","vendasCompletas","onExecutar"])):p("",!0),o.tipo==="Envelope"?(c(),C(b,{key:1,id:o.id,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):p("",!0)]))),128))]),e.vendaCardPagination.vendasAbertas.max>1?(c(),I("div",Na,[s(_,{modelValue:e.vendaCardPagination.vendasAbertas.page,"onUpdate:modelValue":a[4]||(a[4]=o=>e.vendaCardPagination.vendasAbertas.page=o),min:e.vendaCardPagination.vendasAbertas.min,unelevated:"",max:e.vendaCardPagination.vendasAbertas.max,ellipses:"","max-pages":e.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):p("",!0)]),_:1},8,["label"])):p("",!0),n.temVendasFinalizadas?(c(),C(N,{key:1,"model-value":!0,label:`Finalizadas (Total R$ ${e.totalVendasFinalizadas})`,group:"vendasFinalizadas"},{default:m(()=>[e.vendaCardPagination.vendasFinalizadas.max>1?(c(),I("div",ja,[s(_,{modelValue:e.vendaCardPagination.vendasFinalizadas.page,"onUpdate:modelValue":a[5]||(a[5]=o=>e.vendaCardPagination.vendasFinalizadas.page=o),unelevated:"",min:e.vendaCardPagination.vendasFinalizadas.min,max:e.vendaCardPagination.vendasFinalizadas.max,ellipses:"","max-pages":e.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):p("",!0),g("div",Ya,[(c(!0),I(j,null,Y(e.vendasFinalizadas,o=>(c(),I("div",{class:"q-px-sm full-width",key:o.id},[o.tipo==="Venda"?(c(),C(w,{key:0,id:o.id,dadosVenda:o,vendasCompletas:e.vendasCompletas,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","dadosVenda","vendasCompletas","onExecutar"])):p("",!0),o.tipo==="Envelope"?(c(),C(b,{key:1,id:o.id,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):p("",!0)]))),128))]),e.vendaCardPagination.vendasFinalizadas.max>1?(c(),I("div",Ja,[s(_,{modelValue:e.vendaCardPagination.vendasFinalizadas.page,"onUpdate:modelValue":a[6]||(a[6]=o=>e.vendaCardPagination.vendasFinalizadas.page=o),min:e.vendaCardPagination.vendasFinalizadas.min,max:e.vendaCardPagination.vendasFinalizadas.max,ellipses:"",unelevated:"","max-pages":e.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):p("",!0)]),_:1},8,["label"])):p("",!0),n.temVendasCanceladas?(c(),C(N,{key:2,"model-value":!0,label:`Canceladas (Total R$ ${e.totalVendasCanceladas})`,group:"vendasCanceladas"},{default:m(()=>[e.vendaCardPagination.vendasCanceladas.max>1?(c(),I("div",Ka,[s(_,{modelValue:e.vendaCardPagination.vendasCanceladas.page,"onUpdate:modelValue":a[7]||(a[7]=o=>e.vendaCardPagination.vendasCanceladas.page=o),min:e.vendaCardPagination.vendasCanceladas.min,max:e.vendaCardPagination.vendasCanceladas.max,ellipses:"","max-pages":e.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):p("",!0),(c(!0),I(j,null,Y(e.vendasCanceladas,o=>(c(),I("div",{key:o.id},[o.tipo==="Venda"?(c(),C(w,{key:0,id:o.id,dadosVenda:o,vendasCompletas:e.vendasCompletas,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","dadosVenda","vendasCompletas","onExecutar"])):p("",!0),o.tipo==="Envelope"?(c(),C(b,{key:1,id:o.id,onExecutar:n.executar,class:"q-mb-md"},null,8,["id","onExecutar"])):p("",!0)]))),128)),e.vendaCardPagination.vendasCanceladas.max>1?(c(),I("div",Wa,[s(_,{modelValue:e.vendaCardPagination.vendasCanceladas.page,"onUpdate:modelValue":a[8]||(a[8]=o=>e.vendaCardPagination.vendasCanceladas.page=o),min:e.vendaCardPagination.vendasCanceladas.min,max:e.vendaCardPagination.vendasCanceladas.max,ellipses:"","max-pages":e.vendaCardPagination.maxPages,class:"float-right",onClick:n.atualizarVendas},null,8,["modelValue","min","max","max-pages","onClick"])])):p("",!0)]),_:1},8,["label"])):p("",!0)]),_:1})):p("",!0),!e.carregando&&n.temRegistros&&e.tipoLista==="itens"?(c(),C(Ia,{key:1,rows:e.documentosItens,columns:e.colunas,pagination:e.tablePagination,"onUpdate:pagination":a[9]||(a[9]=o=>e.tablePagination=o),class:"no-shadow text-left q-mt-md my-sticky-header-column-table"},{body:m(o=>[s(Ca,{props:o},{default:m(()=>[s(A,{key:"descricao",props:o},{default:m(()=>{var z,O,T,S,R,L,Q,r;return[g("div",Xa,[g("div",Za,[s(v,{imagem:(z=e.itens[o.row.idItem])==null?void 0:z.imagem,rotulo:(O=e.itens[o.row.idItem])==null?void 0:O.descricaoConcatenada,tamanho:"40",class:"q-mr-sm"},null,8,["imagem","rotulo"])]),g("div",$a,[V(x(o.row.idItem?(T=e.itens[o.row.idItem])==null?void 0:T.descricaoConcatenada:""),1),a[14]||(a[14]=g("br",null,null,-1)),V(" "+x(o.row.idItem&&(S=e.itens[o.row.idItem])!=null&&S.referencia?"Ref. "+((R=e.itens[o.row.idItem])==null?void 0:R.referencia):""),1),a[15]||(a[15]=g("br",null,null,-1)),V(" "+x(o.row.idItem&&(L=e.itens[o.row.idItem])!=null&&L.codigoItem?"#"+((Q=e.itens[o.row.idItem])==null?void 0:Q.codigoItem):""),1),a[16]||(a[16]=g("br",null,null,-1)),V(" "+x(o.row.idItem&&((r=e.itens[o.row.idItem])==null?void 0:r.marca)||""),1)])])]}),_:2},1032,["props"]),s(A,{key:"documento",props:o},{default:m(()=>[V(x(e.documentos[o.row.idDocumento].tipo)+" #"+x(parseInt(e.documentos[o.row.idDocumento].numero)||(e.documentos[o.row.idDocumento].id||"").slice(-6)),1),a[17]||(a[17]=g("br",null,null,-1)),V(" "+x(e.documentos[o.row.idDocumento].status),1),a[18]||(a[18]=g("br",null,null,-1)),V(" "+x(i.$filters.dataHora(e.documentos[o.row.idDocumento].dataHoraFinalizado||e.documentos[o.row.idDocumento].dataHoraEmissao)),1)]),_:2},1032,["props"]),s(A,{key:"valorUnitario",props:o},{default:m(()=>[o.row.valorReal!==o.row.valorItem?(c(),I("span",ae,x(i.$filters.numero(o.row.valorItem,2)),1)):p("",!0),V(" "+x(i.$filters.numero(o.row.valorReal,2)),1)]),_:2},1032,["props"]),s(A,{key:"quantidade",props:o},{default:m(()=>[V(x(o.row.quantidade*o.row.operacaoFator*-1),1)]),_:2},1032,["props"]),s(A,{key:"valorTotal",props:o},{default:m(()=>[V(x(i.$filters.numero(o.row.valorRealTotal,2)),1)]),_:2},1032,["props"]),s(A,{key:"botao",props:o},{default:m(()=>[o.row.operacaoFator===-1?(c(),C(q,{key:0,clickable:"",class:"q-ml-sm",color:"warning",dense:"",flat:"",icon:"replay",round:"",onClick:z=>n.abrirModalDevolucaoGarantia(o.row)},{default:m(()=>[s(ba,null,{default:m(()=>a[19]||(a[19]=[V("Devolu\xE7\xE3o/Garantia")])),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):p("",!0),!e.carregando&&!n.temRegistros?(c(),I("div",ee,a[20]||(a[20]=[g("p",null,[g("small",null,"Registros n\xE3o encontrados")],-1)]))):p("",!0),(k=e.contato)!=null&&k.ativo?(c(),I("div",te,[e.sistemaPai==="optisoul"?(c(),C(xa,{key:0,"vertical-actions-align":"right",round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},direction:"up"},{default:m(()=>[s(X,{color:"primary",onClick:n.adicionarEnvelope,icon:"mdi-glasses",label:"Envelope"},null,8,["onClick"]),s(X,{color:"primary",onClick:n.adicionarVenda,icon:"shopping_cart",label:"Venda"},null,8,["onClick"])]),_:1})):(c(),C(q,{key:1,round:"",color:"primary",class:"fixed",icon:"add",size:"lg",style:{right:"18px",bottom:"18px"},onClick:n.adicionarVenda},null,8,["onClick"]))])):p("",!0),s(P,{ref:"modalVenda",onExecutar:n.executar},null,8,["onExecutar"]),s(D,{ref:"modalEnvelope",onAtualizar:n.atualizar},null,8,["onAtualizar"]),s(F,{ref:"modalDevolucaoGarantia",onExecuta:n.finalizaDevolucaoGarantia},null,8,["onExecuta"]),s(G,{onFechar:n.fechouNFe},null,8,["onFechar"])])}var Ce=Z(Oa,[["render",oe]]);export{Ce as default};
