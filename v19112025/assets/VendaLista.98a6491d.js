import{_ as J,ba as X,r as g,o as c,p as v,f as u,w as V,d as H,e as j,H as G,P as K,F as W,x as Y,b4 as Z}from"./index.ddbcd6b2.js";import"./xlsx.5b6945e2.js";import{L as $}from"./Lista.b4055103.js";import{V as R}from"./VendaCard.e43e35c1.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.4c3f19ab.js";import"./Campo.b5e4ca18.js";import"./compactarValidarNFe.864374b8.js";import"./obterItens.958b48e4.js";import"./codigosANP.a6c1a264.js";import"./ModalHistoricoStatus.0bbab54c.js";const aa={components:{Lista:$,VendaCard:R,VendaModal:X},data(){return{usuario:"",permissao:{vendedoresDigitadores:!1,outrasEmpresas:!1},usaExpedicao:!1,carregar:!1,listaLayout:[],lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-cart-arrow-up",titulo:"Vendas",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:"",conexao:{icone:"hibrido",iconeTamanho:"xs",cor:"grey-5",rotulo:null,dica:"H\xEDbrido",denso:!0,flat:!0,escuro:!1}},busca:"",filtrosOriginal:{},filtros:{cliente:null,idEmpresa:null,idContatoVendedor:null,idContatoDigitador:null,statusEnvio:null,valorTotal:0,tipoData:"emissao",data:{ini:"",fim:""},ordenacao:"dataHoraEmissao",direcao:"desc"},empresaOpcoes:[],opcoesVendedores:[],statusEnvioOpcoes:[{value:"Enviados",label:"Enviados"},{value:"N\xE3o Enviados",label:"N\xE3o Enviados"}],dataOpcoes:[{value:"emissao",label:"Data Emiss\xE3o"},{value:"finalizado",label:"Data Finalizado"},{value:"faturado",label:"Data Faturado"}],ordenacaoOpcoes:[{value:"dataHoraEmissao",label:"Data de Emiss\xE3o"},{value:"dataHoraFinalizado",label:"Data Finalizado"}],direcaoOpcoes:[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}],tabSelecionada:{valor:""},tabs:[{valor:"Or\xE7amento",rotulo:"Or\xE7amento"},{valor:"Aguardando Estoque",rotulo:"Ag. Estoque"},{valor:"Aguardando Financeiro",rotulo:"Ag. Financeiro"},{valor:"Aguardando Libera\xE7\xE3o",rotulo:"Ag. Libera\xE7\xE3o"},{valor:"Aguardando Pagamento,Aguardando Faturamento",rotulo:"Ag. Pagamento"},{valor:"Finalizado,Faturado,Entregue",rotulo:"Finalizado"},{valor:"N\xE3o Aprovado",rotulo:"N\xE3o Aprovado"},{valor:"",rotulo:"Todas"}],detalhesVisivel:!1,paginacao:{atual:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(i){var o,s,l,a,d,r,p,h,b,e,C,E,L,D,y,A,q,w,F,O,x,S,k,z,I,T,U,M,P;try{$q.loading.show(),this.carregar=!1,this.qtdeItensCarregados=0,this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor;let{buscarDadosRecentes:N}=i!=null?i:{},t={},f={};N&&(t=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"VendaLista_"+((o=this.usuario)==null?void 0:o.id)}),t!=null&&t._id&&(this.tabSelecionada.valor=(t==null?void 0:t.tabSelecionada)||"",this.busca=(t==null?void 0:t.busca)||null,this.filtros={cliente:((s=t==null?void 0:t.filtros)==null?void 0:s.cliente)||null,idEmpresa:((l=t==null?void 0:t.filtros)==null?void 0:l.idEmpresa)||null,idContatoVendedor:((a=t==null?void 0:t.filtros)==null?void 0:a.idContatoVendedor)||null,idContatoDigitador:((d=t==null?void 0:t.filtros)==null?void 0:d.idContatoDigitador)||null,statusEnvio:((r=t==null?void 0:t.filtros)==null?void 0:r.statusEnvio)||null,tipoData:((p=t==null?void 0:t.filtros)==null?void 0:p.tipoData)||"emissao",valorTotal:((h=t==null?void 0:t.filtros)==null?void 0:h.valorTotal)||0,data:{ini:((e=(b=t==null?void 0:t.filtros)==null?void 0:b.data)==null?void 0:e.ini)||"",fim:((E=(C=t==null?void 0:t.filtros)==null?void 0:C.data)==null?void 0:E.fim)||""},ordenacao:((L=t==null?void 0:t.filtros)==null?void 0:L.ordenacao)||"dataHoraEmissao",direcao:((D=t==null?void 0:t.filtros)==null?void 0:D.direcao)||"desc"},this.compareObject(this.filtrosOriginal,this.filtros,["ordenacao","direcao"])&&(this.$refs.vendaLista.filtros=!0))),this.filtros.cliente=(A=(y=this.filtros)==null?void 0:y.cliente)==null?void 0:A.trim(),this.filtros=$utils.eliminarVazios(this.filtros),this.filtros.status=this.tabSelecionada.valor,f=$utils.clonarV2(this.filtros),this.filtros.tipoData==="emissao"&&(f.emissao={ini:(w=(q=this.filtros)==null?void 0:q.data)==null?void 0:w.ini,fim:(O=(F=this.filtros)==null?void 0:F.data)==null?void 0:O.fim}),this.filtros.tipoData==="finalizado"&&(f.finalizado={ini:(S=(x=this.filtros)==null?void 0:x.data)==null?void 0:S.ini,fim:(z=(k=this.filtros)==null?void 0:k.data)==null?void 0:z.fim}),this.filtros.tipoData==="faturado"&&(f.faturado={ini:(T=(I=this.filtros)==null?void 0:I.data)==null?void 0:T.ini,fim:(M=(U=this.filtros)==null?void 0:U.data)==null?void 0:M.fim}),this.permissao.vendedoresDigitadores||(f.idContatoVendedor=this.usuario.id),delete f.tipoData,delete f.data,this.busca&&(this.paginacao.atual=1,/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)?(this.tabSelecionada.valor="",this.filtros.status="",f={status:"",idVenda:this.busca}):f.termoBusca=this.busca);const _=[this.filtros.ordenacao],Q=[this.filtros.direcao],n=await $db.venda.leListaCompleta({filtros:f,limit:this.paginacao.limite,page:this.paginacao.atual,sort:_,dir:Q});let B=!0;for(const m of n==null?void 0:n.data)this.listaLayout.hasOwnProperty(m.id)||(this.listaLayout[m.id]={detalhes:!1}),this.listaLayout[m.id].detalhes||(B=!1);this.$refs.vendaLista.detalhes=(P=n==null?void 0:n.data)!=null&&P.length?B:!1,this.lista=n==null?void 0:n.data,this.paginacao.total=n==null?void 0:n.total,this.paginacao.maximo=n==null?void 0:n.totalPages,t={_id:"VendaLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca||"",filtros:$utils.clonarV2(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:t})}catch{$q.notify({message:"Erro ao carregar vendas.",type:"negative"}),$q.loading.hide()}finally{this.lista.length===0&&$q.loading.hide()}},criarClick(){this.$refs.vendaModal.mostrar()},detalhesClick(){this.detalhesVisivel=!this.detalhesVisivel,this.lista.forEach(i=>{this.$refs[i.id][0].detalhesVisivel=this.detalhesVisivel,this.listaLayout[i.id].detalhes=this.detalhesVisivel})},verificarListaLayout(i){let{id:o,acao:s,estado:l}=i!=null?i:{};if(s="detalhes"){let a=!0;o&&(this.listaLayout[o].detalhes=l!=null?l:!this.listaLayout[o].detalhes);for(const d of this.lista)this.listaLayout[d.id].detalhes&&(this.$refs[d.id][0].detalhesVisivel=!0),this.listaLayout[d.id].detalhes||(a=!1);this.detalhesVisivel=a,this.$refs.vendaLista.detalhes=a}},async abrirModalContatos(){const i=await $g.promptContato.show({filtro:{ativo:!0}});!(i!=null&&i.id)||(this.filtros.cliente=i.nome)},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),this.paginacao.total=25,this.paginacao.maximo=1,await this.atualizar()},compareObject(i,o,s=[]){const l=Object.keys(i);for(const a of l)if(!s.includes(a)){if(typeof i[a]=="object"&&i[a]!==null){if(!this.compareObject(i[a],o[a],s))continue;return!0}else if(i[a]!==o[a])return!0}return!1},async configurarPermissao(){this.permissao={vendedoresDigitadores:await $db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos"),outrasEmpresas:await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")}},async configurarEmpresas(){const i=[];let o=[];if(!this.permissao.outrasEmpresas){o=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;for(const s of o)i.push({label:s.nome,value:s.id})}if(this.permissao.outrasEmpresas){o=await $db.empresa.ler({filtro:{ativo:!0}});for(const s of o)i.push({label:s.nome,value:s.idContato})}this.empresaOpcoes=i==null?void 0:i.sort((s,l)=>{var a;return(a=s==null?void 0:s.label)==null?void 0:a.localeCompare(l==null?void 0:l.label)})},async configurarVendedores(){const i=(await $db.contato.ler({filtros:{ativo:!0,vendedores:!0}})).data;i==null||i.sort((o,s)=>{var l;return(l=o==null?void 0:o.nome)==null?void 0:l.localeCompare(s==null?void 0:s.nome)}),i.forEach(o=>{this.opcoesVendedores.push({label:o.nome,value:o.id})})},async configurarExpedicao(){var o;const i=await $db.configuracoes.le({nome:"vendas.usaExpedicao"});this.usaExpedicao=((o=i==null?void 0:i[0])==null?void 0:o.valor)==="1",this.usaExpedicao&&this.tabs.splice(4,0,{valor:"Aguardando Confer\xEAncia,Aguardando Corre\xE7\xE3o,Aguardando Embalagem,Aguardando Entrega,Aguardando Separa\xE7\xE3o,Em Confer\xEAncia,Em Embalagem,Em Separa\xE7\xE3o",rotulo:"Ag. Log\xEDstica"})},async abrirItem(i){this.$router.replace({params:{id:i}}).finally(()=>{this.$refs.vendaModal.mostrar({id:i})})},carregou(){this.qtdeItensCarregados=this.qtdeItensCarregados+1,this.qtdeItensCarregados===this.lista.length&&(this.carregar=!0,this.verificarListaLayout({acao:"detalhes"}),$q.loading.hide())}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),await this.configurarPermissao(),await this.configurarEmpresas(),await this.configurarVendedores(),await this.configurarExpedicao(),this.$route.params.id&&this.$route.params.id.length?(this.abrirItem(this.$route.params.id),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},oa={id:"VendaLista"};function ta(i,o,s,l,a,d){const r=g("campo"),p=g("VendaCard"),h=g("Lista"),b=g("VendaModal");return c(),v("div",oa,[u(h,{ref:"vendaLista",busca:a.busca,"onUpdate:busca":o[12]||(o[12]=e=>a.busca=e),onAtualizar:d.atualizar,onLimparFiltrosClick:d.limparFiltrosClick,onDetalhesClick:d.detalhesClick,onCriarClick:d.criarClick,lista:a.lista,tabSelecionada:a.tabSelecionada,tabs:a.tabs,paginacao:a.paginacao,mostrar:a.mostrar},{filtroCampos:V(()=>[u(r,{modelValue:a.filtros.cliente,"onUpdate:modelValue":o[0]||(o[0]=e=>a.filtros.cliente=e),debounce:500,dense:"",somenteLeitura:"",before:[{icon:"search",handler:d.abrirModalContatos}],rotulo:"Por cliente ou respons\xE1vel",class:"q-mt-sm"},null,8,["modelValue","before"]),u(r,{modelValue:a.filtros.idEmpresa,"onUpdate:modelValue":o[1]||(o[1]=e=>a.filtros.idEmpresa=e),options:a.empresaOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Por empresa",class:"q-mt-lg"},null,8,["modelValue","options"]),a.permissao.vendedoresDigitadores?(c(),H(r,{key:0,modelValue:a.filtros.idContatoVendedor,"onUpdate:modelValue":o[2]||(o[2]=e=>a.filtros.idContatoVendedor=e),options:a.opcoesVendedores,clearable:"",dense:"",tipo:"seletor",rotulo:"Vendedor",class:"q-mt-lg"},null,8,["modelValue","options"])):j("",!0),a.permissao.vendedoresDigitadores?(c(),H(r,{key:1,modelValue:a.filtros.idContatoDigitador,"onUpdate:modelValue":o[3]||(o[3]=e=>a.filtros.idContatoDigitador=e),options:a.opcoesVendedores,clearable:"",dense:"",tipo:"seletor",rotulo:"Digitador",class:"q-mt-lg"},null,8,["modelValue","options"])):j("",!0),u(r,{modelValue:a.filtros.statusEnvio,"onUpdate:modelValue":o[4]||(o[4]=e=>a.filtros.statusEnvio=e),options:a.statusEnvioOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Status Envio",class:"q-mt-lg"},null,8,["modelValue","options"]),u(r,{modelValue:a.filtros.valorTotal,"onUpdate:modelValue":o[5]||(o[5]=e=>a.filtros.valorTotal=e),debounce:500,dense:"",tipo:"decimal",min:"0",decimals:"4",zerosDireita:"2",rotulo:"Valor total maior que",class:"q-mt-lg"},null,8,["modelValue"]),u(r,{modelValue:a.filtros.tipoData,"onUpdate:modelValue":o[6]||(o[6]=e=>a.filtros.tipoData=e),options:a.dataOpcoes,dense:"",tipo:"seletor",rotulo:"Selecione o tipo de data",class:"q-mt-xl"},null,8,["modelValue","options"]),u(r,{modelValue:a.filtros.data.ini,"onUpdate:modelValue":o[7]||(o[7]=e=>a.filtros.data.ini=e),clearable:"",dense:"",tipo:"data",rotulo:"De",class:"q-mt-sm"},null,8,["modelValue"]),u(r,{modelValue:a.filtros.data.fim,"onUpdate:modelValue":o[8]||(o[8]=e=>a.filtros.data.fim=e),clearable:"",dense:"",tipo:"data",rotulo:"at\xE9",class:"q-mt-xs"},null,8,["modelValue"]),u(r,{modelValue:a.filtros.ordenacao,"onUpdate:modelValue":o[9]||(o[9]=e=>a.filtros.ordenacao=e),options:a.ordenacaoOpcoes,dense:"",rotuloFixo:"Ordenar por",tipo:"seletor",class:"q-mt-xl"},null,8,["modelValue","options"]),u(r,{modelValue:a.filtros.direcao,"onUpdate:modelValue":o[10]||(o[10]=e=>a.filtros.direcao=e),options:a.direcaoOpcoes,dense:"",rotuloFixo:"Dire\xE7\xE3o",tipo:"seletor",class:"q-mt-sm"},null,8,["modelValue","options"]),u(r,{modelValue:a.paginacao.limite,"onUpdate:modelValue":o[11]||(o[11]=e=>a.paginacao.limite=e),tipo:"quantidade",dense:"",min:"1",rotulo:"Quantidade por p\xE1gina",class:"q-mt-xl q-mb-md"},null,8,["modelValue"])]),itemLista:V(()=>[G(u(K,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:V(()=>[(c(!0),v(W,null,Y(a.lista,e=>(c(),v("div",{key:e.id,class:"itemHover"},[u(p,{onCarregou:d.carregou,ref_for:!0,ref:e.id,id:e.id,onVerificarListaLayout:d.verificarListaLayout,layout:"lista"},null,8,["onCarregou","id","onVerificarListaLayout"])]))),128))]),_:1},512),[[Z,a.carregar]])]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onDetalhesClick","onCriarClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),u(b,{continueMesmaTela:!1,ref:"vendaModal"},null,512)])}var pa=J(aa,[["render",ta]]);export{pa as default};
